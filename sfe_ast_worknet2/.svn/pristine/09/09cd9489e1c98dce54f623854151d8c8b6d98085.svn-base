<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panChart=null;$.panList=null;$.lblDept=null;$.lblProduct=null;$.lblPlace=null;$.lblType=null;$.cmbDept=null;$.cmbEmp=null;$.cmbProduct=null;$.cmbPlace=null;$.lblGuide=null;$.btnGuide=null;$.btnSearch=null;$.grdList=null;$.rdoView=null;$.lblLabel1=null;$.rdoDown=null;$.rdoType=null;$.chart1=null;$.chart2=null;$.varCompanyGubn="";$.varSearchType="";$.varColumnName={};function createJSON_Q(workType){var params=[];if(workType=="Q"){switch($.varSearchType){case"1":params=[workType,$.cmbDept.getValue(),$.cmbEmp.getValue(),$.cmbPlace.getValue(),"",$.cmbProduct.getValue(),$.rdoType.getValue(),$.rdoDown.getValue()];break;case"2":params=[workType,$.cmbDept.getValue(),$.cmbEmp.getValue(),"","",$.cmbProduct.getValue(),$.rdoType.getValue(),$.rdoDown.getValue()];break;case"3":params=[workType,$.cmbDept.getValue(),$.cmbEmp.getValue(),$.cmbPlace.getValue(),"",$.cmbProduct.getValue(),$.rdoType.getValue(),$.rdoDown.getValue()];break;default:break}}else{if(workType=="M"){params=[workType,"","","","","","",""]}}return createExecuteParamInfo("P_crmSSAT_YearProgress_Q",params)}function searchData(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function initChart(){$.chart1.init({chart:{type:"column",width:1200,height:220},title:{text:""},xAxis:{labels:{enabled:true}},yAxis:[{title:{text:""},stackLabels:{enabled:true,style:{fontWeight:"bold",color:"gray"}},labels:{format:"{value}"}},{title:{text:""},stackLabels:{enabled:true,style:{fontWeight:"bold",color:"gray"}},labels:{format:"{value}%",},opposite:true}],legend:{enabled:true,align:"right",verticalAlign:"top",y:110,layout:"vertical"},tooltip:{enabled:true,shared:true},plotOptions:{column:{pointPadding:0.2,borderWidth:0,}}});$.chart2.init({chart:{type:"line",width:1200,height:220},title:{text:""},xAxis:{labels:{enabled:true}},yAxis:{title:{text:""},stackLabels:{enabled:true,style:{fontWeight:"bold",color:"gray"}},labels:{format:"{value}%",},min:0,max:100},legend:{enabled:true,align:"right",verticalAlign:"top",layout:"vertical"},tooltip:{enabled:true,shared:true},plotOptions:{column:{pointPadding:0.2,borderWidth:0,}}})}function changeStringToInt(value){if(value.indexOf(",")>=0&&value.indexOf(".")>=0){value=value.replace(/,/g,"");return Math.round(value)}else{if(value.indexOf(",")>=0&&value.indexOf(".")<0){return Number(unmask(value))}else{return Number(value)}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1060);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,85);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panChart=new FingerPanel(host,"panChart",0,130,1200,450);$.panChart.setText("");$.panChart.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,590,1200,450);$.panList.setText("최근1년실적추이");$.panList.setBottomLine(true);$.lblDept=new FingerLabel(host,"lblDept",0,15,100,20);$.lblDept.setText("부서/담당");$.lblProduct=new FingerLabel(host,"lblProduct",370,15,100,20);$.lblProduct.setText("품목");$.lblPlace=new FingerLabel(host,"lblPlace",0,45,100,20);$.lblPlace.setText("병원/지역");$.lblType=new FingerLabel(host,"lblType",370,50,100,20);$.lblType.setText("구분");$.cmbDept=new FingerComboBox(host,"cmbDept",105,15,140,20);$.cmbEmp=new FingerComboBox(host,"cmbEmp",250,15,100,20);$.cmbProduct=new FingerComboBox(host,"cmbProduct",475,15,140,20);$.cmbPlace=new FingerComboBox(host,"cmbPlace",105,45,245,20);$.lblGuide=new FingerLabel(host,"lblGuide",780,15,180,20);$.lblGuide.setText("Special Sales Analysls Tool...");$.btnGuide=new FingerButton(host,"btnGuide",820,45,120,20);$.btnGuide.setText("자료이용안내");$.btnSearch=new FingerButton(host,"btnSearch",1120,45,80,20);$.btnSearch.setText("조회");$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,405);$.rdoView=new FingerRadioBox(host,"rdoView",820,95,210,20);$.lblLabel1=new FingerLabel(host,"lblLabel1",715,95,105,20);$.lblLabel1.setText("약가인하월보정");$.rdoDown=new FingerRadioBox(host,"rdoDown",825,95,140,20);$.rdoType=new FingerRadioBox(host,"rdoType",475,50,140,20);$.chart1=new FingerBarChart(host,"chart1",0,0,1200,220);$.chart2=new FingerBarChart(host,"chart2",0,230,1200,220);$.panQuery.setBorder(true);$.panChart.setBorder(true);$.panList.setBorder(true);$.rdoType.addButtons([{code_name:"금액",sub_code:"A"},{code_name:"수량",sub_code:"Q"}]);$.rdoView.addButtons([{code_name:"Chart",sub_code:"C"},{code_name:"Grid",sub_code:"G"},{code_name:"Both",sub_code:"B"}]);$.rdoDown.addButtons([{code_name:"실제",sub_code:"X"},{code_name:"보정",sub_code:"O"}]);$.cmbEmp.setEnable(false);$.cmbDept.setAllowBlank(false,"부서");$.cmbProduct.setAllowBlank(false,"품목");$.lblGuide.setVisible(false);$.btnGuide.setVisible(false);$.lblLabel1.setVisible(false);$.rdoDown.setVisible(false);$.rdoType.setValue("A");$.rdoView.setValue("B");$.rdoDown.setValue("X");$.grdList.setColumns([new FingerDataGridColumn("title",100,"left","string","판매월"),new FingerDataGridColumn("minus_11_mm_value",90,"right","string","-11월"),new FingerDataGridColumn("minus_10_mm_value",90,"right","string","-10월"),new FingerDataGridColumn("minus_9_mm_value",90,"right","string","-9월"),new FingerDataGridColumn("minus_8_mm_value",90,"right","string","-8월"),new FingerDataGridColumn("minus_7_mm_value",90,"right","string","-7월"),new FingerDataGridColumn("minus_6_mm_value",90,"right","string","-6월"),new FingerDataGridColumn("minus_5_mm_value",90,"right","string","-5월"),new FingerDataGridColumn("minus_4_mm_value",90,"right","string","-4월"),new FingerDataGridColumn("minus_3_mm_value",90,"right","string","-3월"),new FingerDataGridColumn("minus_2_mm_value",90,"right","string","-2월"),new FingerDataGridColumn("minus_1_mm_value",90,"right","string","-1월"),new FingerDataGridColumn("minus_0_mm_value",90,"right","string","당월")]);$.grdList.init({panel:$.panList,scroll:"xy"});$.host=host;$.args=args};$.start=function(){$.panMain.add($.panList);$.panMain.add($.panChart);$.panMain.add($.panQuery);$.panMain.add($.rdoView);$.panMain.add($.lblLabel1);$.panMain.add($.rdoDown);$.panQuery.add($.btnGuide);$.panQuery.add($.lblGuide);$.panQuery.add($.cmbPlace);$.panQuery.add($.cmbProduct);$.panQuery.add($.cmbEmp);$.panQuery.add($.cmbDept);$.panQuery.add($.lblType);$.panQuery.add($.lblPlace);$.panQuery.add($.lblProduct);$.panQuery.add($.lblDept);$.panQuery.add($.btnSearch);$.panQuery.add($.rdoType);$.panChart.add($.chart1);$.panChart.add($.chart2);$.panList.add($.grdList);$.cmbDept.setEmptyRow(true);$.cmbEmp.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbPlace.setEmptyRow(true);$.cmbDept.setColumn("dept_code","dept_name");$.cmbEmp.setColumn("employee_id","emp_name");$.cmbProduct.setColumn("product_code","product_name");$.cmbPlace.setColumn("company_id","company_name");var ds=bizComponentData2($,"Q1","L_CRM00195|L_CRM0131|L_CRM241|L_CRM0052");setComboBind([$.cmbDept,$.cmbProduct,$.cmbPlace,$.cmbEmp],ds);initChart();var dept=g_main.session.obj.DeptCode;if(dept.substr(0,2)=="S1"||dept.substr(0,2)=="T3"||dept.substr(0,2)=="S2"||dept.substr(0,2)=="S3"||dept.substr(0,2)=="T1"||dept.substr(0,2)=="S4"||dept.substr(0,2)=="S5"||dept.substr(0,2)=="F1"){if(dept.substr(2,2)=="00"||dept.substr(2,2)=="90"){return}$.cmbDept.setValue(dept);if(g_main.session.obj.DutyCode=="08"){return}$.cmbEmp.setValue(g_main.session.obj.UserID)}};$.callback=function(type,ds){if(type=="M"){if(ds.resultList.length<=0){return}var rs=ds.resultList[0][0];$.varColumnName=rs;if(rs){$.grdList.resetColumns([new FingerDataGridColumn("title",100,"left","string","판매월"),new FingerDataGridColumn("minus_11_mm_value",90,"right","string",rs.m1),new FingerDataGridColumn("minus_10_mm_value",90,"right","string",rs.m2),new FingerDataGridColumn("minus_9_mm_value",90,"right","string",rs.m3),new FingerDataGridColumn("minus_8_mm_value",90,"right","string",rs.m4),new FingerDataGridColumn("minus_7_mm_value",90,"right","string",rs.m5),new FingerDataGridColumn("minus_6_mm_value",90,"right","string",rs.m6),new FingerDataGridColumn("minus_5_mm_value",90,"right","string",rs.m7),new FingerDataGridColumn("minus_4_mm_value",90,"right","string",rs.m8),new FingerDataGridColumn("minus_3_mm_value",90,"right","string",rs.m9),new FingerDataGridColumn("minus_2_mm_value",90,"right","string",rs.m10),new FingerDataGridColumn("minus_1_mm_value",90,"right","string",rs.m11),new FingerDataGridColumn("minus_0_mm_value",90,"right","string",rs.m12)])}searchData("Q")}else{if(type=="Q"){$.grdList.setData("");setDataGrid([null,$.grdList],ds);var rs=ds.resultList[0];var chart1=$.chart1.getChart();var chart2=$.chart2.getChart();var cnt=chart1.series.length;if(cnt>0){for(var i=0;i<cnt;i++){chart1.series[0].remove()}}var cnt=chart2.series.length;if(cnt>0){for(var i=0;i<cnt;i++){chart2.series[0].remove()}}var ctg=$.varColumnName;chart1.xAxis[0].setCategories([ctg.m1,ctg.m2,ctg.m3,ctg.m4,ctg.m5,ctg.m6,ctg.m7,ctg.m8,ctg.m9,ctg.m10,ctg.m11,ctg.m12]);chart2.xAxis[0].setCategories([ctg.m1,ctg.m2,ctg.m3,ctg.m4,ctg.m5,ctg.m6,ctg.m7,ctg.m8,ctg.m9,ctg.m10,ctg.m11,ctg.m12]);var colors=getChartColor("fixed_4");for(var i=0;i<3;i++){chart1.addSeries({name:rs[i].title,data:[changeStringToInt(rs[i].minus_11_mm_value),changeStringToInt(rs[i].minus_10_mm_value),changeStringToInt(rs[i].minus_9_mm_value),changeStringToInt(rs[i].minus_8_mm_value),changeStringToInt(rs[i].minus_7_mm_value),changeStringToInt(rs[i].minus_6_mm_value),changeStringToInt(rs[i].minus_5_mm_value),changeStringToInt(rs[i].minus_4_mm_value),changeStringToInt(rs[i].minus_3_mm_value),changeStringToInt(rs[i].minus_2_mm_value),changeStringToInt(rs[i].minus_1_mm_value),changeStringToInt(rs[i].minus_0_mm_value)],type:(rs[i].title=="달성률"?"line":"column"),yAxis:(rs[i].title=="달성률"?1:0),color:colors[i],tooltip:{valueSuffix:(rs[i].title=="달성률"?"%":"")}})}if(rs.length>=6){for(var i=5;i<rs.length;i++){chart2.addSeries({name:rs[i].title,data:[Number(rs[i].minus_11_mm_value),Number(rs[i].minus_10_mm_value),Number(rs[i].minus_9_mm_value),Number(rs[i].minus_8_mm_value),Number(rs[i].minus_7_mm_value),Number(rs[i].minus_6_mm_value),Number(rs[i].minus_5_mm_value),Number(rs[i].minus_4_mm_value),Number(rs[i].minus_3_mm_value),Number(rs[i].minus_2_mm_value),Number(rs[i].minus_1_mm_value),Number(rs[i].minus_0_mm_value)],color:colors[i],tooltip:{valueSuffix:"%"}})}$.panChart.setProperty(0,130,1200,450);$.panList.setProperty(0,590,1200,450);$.chart2.setVisible(true)}else{$.panChart.setProperty(0,130,1200,220);$.panList.setProperty(0,360,1200,450);$.chart2.setVisible(false)}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){if(!validateControls([$.cmbDept,$.cmbProduct])){return}if($.rdoType.getValue()==""){MessageBoxShow("구분 은(는) 필수입력 항목입니다.");return}if($.varCompanyGubn=="H"){$.varSearchType="1"}else{if(!$.varCompanyGubn){$.varSearchType="2"}else{$.varSearchType="3"}}searchData("M")}else{if(id=="btnGuide"){}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){$.cmbEmp.clear();$.cmbPlace.clear();if(!value){$.cmbEmp.setEnable(false);$.cmbPlace.setEnable(false);return}$.cmbEmp.setEnable(true);var ds=bizComponentData2($,"Q4","L_CRM0052","and dept_code = '"+value+"'");setComboBind([$.cmbEmp],ds)}else{if(id=="cmbEmp"){$.cmbPlace.clear();if(!value){$.cmbPlace.setEnable(false);return}$.cmbPlace.setEnable(true);var ds=bizComponentData2($,"Q4","L_CRM241","and employee_id = '"+value+"'");setComboBind([$.cmbPlace],ds)}else{if(id=="cmbPlace"){$.varCompanyGubn=value.substr(0,1)}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){if(id=="rdoView"){switch(value){case"C":$.panChart.setVisible(true);$.panList.setVisible(false);break;case"G":$.panChart.setVisible(false);$.panList.setVisible(true);$.panList.setProperty(0,130,1200,450);break;case"B":$.panChart.setVisible(true);$.panList.setVisible(true);$.panList.setProperty(0,590,1200,450);$.panChart.setProperty(0,130,1200,450);break}}};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){}};</script>