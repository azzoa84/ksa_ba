<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtdoc_title=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.grdList=null;$.panWFMain=null;$.grdFile=null;$.grdDoc=null;$.lbldept_code=null;$.txtdept_code=null;$.txtdept_name=null;$.lblemployee_id=null;$.txtemployee_name=null;$.txtemployee_id=null;$.lblpic=null;$.imgItemPic=null;$.txtwf_doc_id=null;$.lblTotalAmt=null;$.speTotalAmt=null;$.session=g_main.session.obj;$.varWFDocId="";$.varBusinessId="";$.varOriginWfDocId="";$.varWFType="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFPromoteItemReq"]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_crmPromoItemReqeust_Q",[workType,""]);return json}function createJSON_S(workType){var json="";var cRow=$.grdList.getAllRows();if(cRow.length<1){return false}var rows=[];for(var i in cRow){if(Number($.grdList.getValue(i,"req_qty"))>0){rows.push([workType,$.varWfDocId,Number(i)+1,"",$.grdList.getValue(i,"pr_item_code"),$.grdList.getValue(i,"req_qty"),$.grdList.getValue(i,"unit_price"),"","","","","#DeptCode#","#UserID#","Promo","","","","N",0,"",0,"","","","N","N","",""])}}json=createExecuteParamInfo("P_crmWFPromoItemReq_S_B64",rows);return json}function searchWFDocument(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function fnQRY_P_crmPromoItemReqeust_Q(workType){var json=createJSON_Q1(workType);callQuery(["req",json],workType,$)}function fnSET_P_crmWFDocument_S(workType){var json=createJSON_S(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);if(ds){return true}}return false}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtdoc_title.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function moveWFGeneralProc(){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function calcUseAmt(){var total_amt=0;for(var i=0;i<$.grdList.getRowCount();i++){total_amt+=Number($.grdList.getValue(i,"unit_price"))*Number($.grdList.getValue(i,"req_qty"))}$.speTotalAmt.setValue(total_amt)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1075);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtdoc_title=new FingerEdit(host,"txtdoc_title",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFDetail=new FingerPanel(host,"panWFDetail",0,475,1200,285);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,770,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,770,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,210);$.grdList=new FingerDataGrid(host,"grdList",0,75,750,275);$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,400);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.lbldept_code=new FingerLabel(host,"lbldept_code",75,20,100,20);$.lbldept_code.setText("신청부서");$.txtdept_code=new FingerEdit(host,"txtdept_code",1085,225,30,20);$.txtdept_name=new FingerEdit(host,"txtdept_name",180,20,205,20);$.lblemployee_id=new FingerLabel(host,"lblemployee_id",395,20,100,20);$.lblemployee_id.setText("신청자");$.txtemployee_name=new FingerEdit(host,"txtemployee_name",500,20,140,20);$.txtemployee_id=new FingerEdit(host,"txtemployee_id",1085,255,30,20);$.lblpic=new FingerLabel(host,"lblpic",750,210,90,20);$.lblpic.setText("제품 사진");$.imgItemPic=new FingerImage(host,"imgItemPic",870,85,310,263);$.txtwf_doc_id=new FingerEdit(host,"txtwf_doc_id",775,25,140,20);$.lblTotalAmt=new FingerLabel(host,"lblTotalAmt",755,20,100,20);$.lblTotalAmt.setText("합계 금액");$.speTotalAmt=new FingerSpinEdit(host,"speTotalAmt",860,20,140,20);$.panTitle.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtdoc_title.setAllowBlank(false,"문서제목");$.txtdept_name.setReadOnly(true);$.txtemployee_name.setReadOnly(true);$.txtwf_doc_id.setVisible(false);$.txtdept_code.setVisible(false);$.txtemployee_id.setVisible(false);$.speTotalAmt.setReadOnly(true);$.speTotalAmt.setValue(0);$.grdList.setColumns([new FingerDataGridColumn("pr_item_code",180,"left","string","판촉물코드",{hidden:true}),new FingerDataGridColumn("pr_item_name",270,"left","string","판촉물명",{readonly:true}),new FingerDataGridColumn("unit_price",80,"left","int","단가",{readonly:true,format:"int"}),new FingerDataGridColumn("req_qty",80,"left","int","신청수량",{format:"int"}),new FingerDataGridColumn("pr_item_desc",300,"left","string","판촉물설명",{readonly:true})]);$.grdList.init({panel:$.panWFMain,scroll:"xy",edit:true,isFilter:false,nonExcel:true});$.grdList.setBorder(false);$.grdList.setEditable(true);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.imgItemPic.setZooming(true,true,true);$.imgItemPic.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panWFMain);$.panTitle.add($.lblTitle);$.panTitle.add($.txtdoc_title);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panWFMain.add($.grdList);$.panWFMain.add($.imgItemPic);$.panWFMain.add($.lblpic);$.panWFMain.add($.txtemployee_id);$.panWFMain.add($.txtemployee_name);$.panWFMain.add($.lblemployee_id);$.panWFMain.add($.txtdept_name);$.panWFMain.add($.txtdept_code);$.panWFMain.add($.lbldept_code);$.panWFMain.add($.txtwf_doc_id);$.panWFMain.add($.lblTotalAmt);$.panWFMain.add($.speTotalAmt);$.txtdept_code.setValue($.session.DeptCode);$.txtdept_name.setValue($.session.DeptName);$.txtemployee_id.setValue($.session.EmpCode);$.txtemployee_name.setValue($.session.EmpName);searchWFDocument("Q3");fnQRY_P_crmPromoItemReqeust_Q("Q1")};$.callback=function(type,ds){if(type=="Q3"){$.varBusinessId=ds.resultList[0][0].business_id;$.varWFType=ds.resultList[0][0].wf_type;$.txtdoc_title.setValue(ds.resultList[0][0].business_title)}else{if(type=="Q1"){setDataGrid([$.grdList],ds);var index=0;if($.md){index=$.grdList.getGridRowIndex("pr_item_code",$.md.pr_item_code)}$.grdList.selectRow(index)}else{if(type=="N"){}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtdoc_title.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);if(args[6]){$.md=args[6][0]}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if($.grdList.getRowCount()<1){return}if(!validateControls([$.txtdoc_title])){return}$.grdList.editStop();calcUseAmt();if(!$.varWfDocId){saveWFDocument("","N")}if(fnSET_P_crmWFDocument_S("N")){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFPromoItemReq",new_line:true};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{removeWFDocument($.varWfDocId)}}else{if(id=="btnTmpSave"){if($.grdList.getRowCount()<1){return}if(saveWFDocument("","N")&&fnSET_P_crmWFDocument_S("N")){moveWFGeneralProc()}else{removeWFDocument($.varWfDocId)}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){var data=$.grdList.getValue(rId);$.imgItemPic.setValue(data.pr_item_picture)}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList"){calcUseAmt()}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(fileList)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요",function(){if(g_main.msgShare==true){if(result){MessageBoxShow("파일 삭제 되었습니다.");$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.varWfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)&&fnSET_P_crmWFDocument_S("N")){moveWFGeneralProc()}else{removeWFDocument($.varWfDocId)}}}}else{if(id=="crmWFEndDocSub"){var rows=[];for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>