<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.btnFileAdd=null;$.btnFileDelete=null;$.btnDocAdd=null;$.btnDocDelete=null;$.ediDetail=null;$.panContent=null;$.grdList=null;$.cmbReceiptDate=null;$.lblSampleType=null;$.cmbSampleType=null;$.lblProduct=null;$.cmbSampleCode=null;$.lblReqQty=null;$.speReqQty=null;$.lblBudegetCode=null;$.cmbBudegetCode=null;$.txtContactId=null;$.spePrice=null;$.htmLine=null;$.lblContact=null;$.bteContact=null;$.lblCompany=null;$.bteCompany=null;$.lblBusinessNo=null;$.txtBusinessNo=null;$.lblYoyang=null;$.txtYoyangNo=null;$.lblStudy=null;$.lblPharmacist=null;$.txtPharmacist=null;$.lblShipDate=null;$.dteShipDate=null;$.lblShipAddr=null;$.txtShipAddr=null;$.chkDirect=null;$.lblDonationNo=null;$.cmbDonationNo=null;$.lblSerialNo=null;$.txtSerialNo=null;$.grdFile=null;$.grdDoc=null;$.tabMain=null;$.grdList2=null;$.panTab=null;$.btnSave=null;$.btnDelete=null;$.cmbStudy=null;$.wfDocId="";$.businessId="";$.startRate="";$.endRate="";$.contactId="";$.companyId="";$.strClinicalWH="03";$.strSampleWH="02";$.txtPharmacist="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFSampleOut"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmWFSampleOut_Q",[workType,$.contactId]);return json}function createJSON_S(workType){var json="";log("in");log($.cmbBudegetCode.getValue().substring(0,9));if($.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="70"){var rows=$.grdList2.getAllRows();if(rows.length<1){MessageBoxShow("저장할 샘플 신청 품목 목록이 없습니다.");return false}var tempRows=[];var seq=1;for(var i in rows){tempRows.push([workType,$.wfDocId,Number(seq),$.cmbReceiptDate.getValue().substring(0,4),$.cmbReceiptDate.getValue().substring(4,5),"#DeptCode#",$.cmbBudegetCode.getValue().substring(0,9),rows[i].ParentProduct,"#UserID#",$.cmbSampleType.getValue(),rows[i].Product,getToday(""),$.companyId,$.bteCompany.getText(),$.contactId,$.bteContact.getText(),$.txtBusinessNo.getValue()||"",$.txtYoyangNo.getValue()||"",$.cmbDonationNo.getValue()||"",rows[i].Study,rows[i].Pharmacist,extFormat(rows[i].ReqDate,"yyyyMMdd"),rows[i].Address,Number(rows[i].Quantity),$.strClinicalWH,$.txtSerialNo.getValue()||"",$.txtContactId.getValue()||""]);seq++}log(tempRows);json=createExecuteParamInfo("P_crmWFSampleOutD_S",tempRows)}if($.cmbSampleType.getValue()!="20"&&$.cmbSampleType.getValue()!="70"){json=createExecuteParamInfo("P_crmWFSampleOutD_S",[workType,$.wfDocId,1,$.cmbReceiptDate.getValue().substring(0,4),$.cmbReceiptDate.getValue().substring(4,5),"#DeptCode#",$.cmbBudegetCode.getValue().substring(0,9),$.cmbSampleCode.getValue("parent_product_code")||"","#UserID#",$.cmbSampleType.getValue(),$.cmbSampleCode.getValue(),getToday(""),$.companyId,$.bteCompany.getText()||"",$.contactId,$.bteContact.getText()||"",$.txtBusinessNo.getValue()||"",$.txtYoyangNo.getValue()||"",$.cmbDonationNo.getValue()||"",$.cmbStudy.getValue()||"","","",$.txtShipAddr.getValue()||"",Number($.speReqQty.getValue()),$.strSampleWH,$.txtSerialNo.getValue()||"",$.txtContactId.getValue()||""])}return json}function searchWFDocument(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function searchSample(workType){var json=createJSON_Q2("Q");callQuery(["req",json],"Q",$)}function saveWFChangeMargin(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$)}}function summit(popResult){if(popResult.isCancel){$.wfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){$.saveType="tmp";saveWFChangeMargin("N")}else{removeWFDocument($.wfDocId)}}}function tmpSave(){if(saveWFDocument("","N")){saveWFChangeMargin("N")}else{removeWFDocument($.wfDocId)}}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.businessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.ediDetail,$.wfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.wfDocId=ds.returnStr}return true}function yoyangChange(){if($.cmbSampleType.getValue()!=""){if(($.txtYoyangNo.getValue()==null||$.txtYoyangNo.getValue()=="")&&($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"||$.cmbSampleType.getValue()=="70")){MessageBoxShow("일반, 임상, DC 등을 목적으로 하는 견본품 지급은 요양기관기호가 정확해야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");return false}else{if($.txtYoyangNo.getValue()!=null&&$.txtYoyangNo.getValue()!=""){if($.txtYoyangNo.getValue().substring(0,1)=="X"&&($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"||$.cmbSampleType.getValue()=="70")){MessageBoxShow("일반, 임상, DC 등을 목적으로 하는 견본품 지급은 요양기관기호가 정확해야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");return false}}else{if(($.grdList.getRowCount()!=0)&&($.cmbSampleType.getValue().substring(0,1)=="1"||$.cmbSampleType.getValue().substring(0,1)=="4")){MessageBoxShow("일반, DC 등을 목적으로 하는 견본품 지급은 1회만 가능합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");return false}}}}else{MessageBoxShow("샘플지급구분을 먼저 선택하셔야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");if($.grdList.getSelectedRowIdx()){$.grdList.deleteRow($.grdList.getRowCount()-1)}return false}return true}function checkChange(){if($.chkDirect.getValue()=="Y"){$.txtBusinessNo.setReadOnly(false);$.txtYoyangNo.setReadOnly(false);$.bteCompany.setValue("");$.bteCompany.setText("");$.bteContact.setValue("");$.bteContact.setText("")}else{$.txtBusinessNo.setReadOnly(true);$.txtYoyangNo.setReadOnly(true);$.bteCompany.setValue("");$.bteCompany.setText("");$.bteContact.setValue("");$.bteContact.setText("")}}function moveWFGeneralProc(){var param={wf_doc_id:$.wfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1415);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,650);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,730,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,1130,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,1130,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.btnFileAdd=new FingerButton(host,"btnFileAdd",215,-37.5,120,20);$.btnFileAdd.setText("파일추가");$.btnFileDelete=new FingerButton(host,"btnFileDelete",320,-37.5,120,20);$.btnFileDelete.setText("파일삭제");$.btnDocAdd=new FingerButton(host,"btnDocAdd",525,-37.5,120,20);$.btnDocAdd.setText("문서추가");$.btnDocDelete=new FingerButton(host,"btnDocDelete",630,-37.5,120,20);$.btnDocDelete.setText("문서삭제");$.ediDetail=new FingerWebEditor(host,"ediDetail",0,0,1200,310);$.panContent=new FingerPanel(host,"panContent",0,0,1200,325);$.panContent.setText("");$.panContent.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,330);$.cmbReceiptDate=new FingerComboBox(host,"cmbReceiptDate",25,10,140,20);$.lblSampleType=new FingerLabel(host,"lblSampleType",170,10,100,20);$.lblSampleType.setText("신청구분");$.cmbSampleType=new FingerComboBox(host,"cmbSampleType",275,10,145,20);$.lblProduct=new FingerLabel(host,"lblProduct",170,40,100,20);$.lblProduct.setText("품목");$.cmbSampleCode=new FingerComboBox(host,"cmbSampleCode",275,40,200,20);$.lblReqQty=new FingerLabel(host,"lblReqQty",480,40,80,20);$.lblReqQty.setText("신청수량");$.speReqQty=new FingerSpinEdit(host,"speReqQty",565,40,50,20);$.lblBudegetCode=new FingerLabel(host,"lblBudegetCode",615,40,100,20);$.lblBudegetCode.setText("예산항목");$.cmbBudegetCode=new FingerComboBox(host,"cmbBudegetCode",720,40,195,20);$.txtContactId=new FingerEdit(host,"txtContactId",940,40,95,20);$.spePrice=new FingerSpinEdit(host,"spePrice",940,70,95,25);$.htmLine=new FingerHTMLView(host,"htmLine",185,130,730,20);$.lblContact=new FingerLabel(host,"lblContact",170,150,100,20);$.lblContact.setText("고객");$.bteContact=new FingerButtonEdit(host,"bteContact",275,150,190,20);$.bteContact.setText("");$.lblCompany=new FingerLabel(host,"lblCompany",170,180,100,20);$.lblCompany.setText("거래처");$.bteCompany=new FingerButtonEdit(host,"bteCompany",275,180,190,20);$.bteCompany.setText("");$.lblBusinessNo=new FingerLabel(host,"lblBusinessNo",470,180,100,20);$.lblBusinessNo.setText("사업자번호");$.txtBusinessNo=new FingerEdit(host,"txtBusinessNo",575,180,100,20);$.lblYoyang=new FingerLabel(host,"lblYoyang",680,180,100,20);$.lblYoyang.setText("요양기관기호");$.txtYoyangNo=new FingerEdit(host,"txtYoyangNo",785,180,100,20);$.lblStudy=new FingerLabel(host,"lblStudy",420,10,100,20);$.lblStudy.setText("임상연구선택");$.lblPharmacist=new FingerLabel(host,"lblPharmacist",170,70,100,20);$.lblPharmacist.setText("담당관리약사");$.txtPharmacist=new FingerEdit(host,"txtPharmacist",275,70,140,20);$.lblShipDate=new FingerLabel(host,"lblShipDate",420,70,100,20);$.lblShipDate.setText("입고요청일");$.dteShipDate=new FingerDateEdit(host,"dteShipDate",525,70,140,20);$.lblShipAddr=new FingerLabel(host,"lblShipAddr",170,100,100,20);$.lblShipAddr.setText("실배송처주소");$.txtShipAddr=new FingerEdit(host,"txtShipAddr",275,100,640,20);$.chkDirect=new FingerCheckBox(host,"chkDirect",90,150,75,20);$.chkDirect.setText("직접입력");$.lblDonationNo=new FingerLabel(host,"lblDonationNo",450,10,180,20);$.lblDonationNo.setText("자선목적 의약품지원 신고서");$.cmbDonationNo=new FingerComboBox(host,"cmbDonationNo",635,10,280,20);$.lblSerialNo=new FingerLabel(host,"lblSerialNo",170,70,100,20);$.lblSerialNo.setText("시리얼넘버");$.txtSerialNo=new FingerEdit(host,"txtSerialNo",275,70,140,20);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.tabMain=new FingerTab(host,"tabMain",0,245,1200,360);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,1200,330);$.panTab=new FingerPanel(host,"panTab",0,0,1200,325);$.panTab.setText("");$.panTab.setBottomLine(true);$.btnSave=new FingerButton(host,"btnSave",1025,235,95,30);$.btnSave.setText("저장");$.btnDelete=new FingerButton(host,"btnDelete",1105,235,95,30);$.btnDelete.setText("삭제");$.cmbStudy=new FingerComboBox(host,"cmbStudy",525,10,390,20);$.panTitle.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.btnFileAdd.setVisible(false);$.btnFileDelete.setVisible(false);$.btnDocAdd.setVisible(false);$.btnDocDelete.setVisible(false);$.tabMain.addTab([{text:"해당고객의 과거 샘플 지원 내역",body:$.panContent,width:200},{text:"샘플 신청 품목 목록",body:$.panTab,width:180}]);$.tabMain.setActiveTab(0);$.tabMain.hideTab(1);$.btnSave.setClass("btn_save");$.btnSave.setVisible(false);$.btnDelete.setVisible(false);$.cmbReceiptDate.setColumn("half_code","half_name");$.cmbStudy.setColumn("study_id","study_name");$.cmbSampleCode.setColumn("product_code","product_name");$.cmbBudegetCode.setColumn("budget_code","budget_name");$.cmbDonationNo.setColumn("cp_id","cp_support_date");$.cmbBudegetCode.setColumnConfig([{id:"budget_name",width:300},{id:"aval_amt",width:100},{id:"budget_code",width:0.1},{id:"dept_code",width:0.1}]);$.cmbDonationNo.setColumnConfig([{id:"cp_id",width:100},{id:"cp_support_date",width:100},{id:"cp_support_target",width:150},{id:"product_name",width:100},{id:"emp_name",width:100}]);$.htmLine.setHTML("<hr/>");$.cmbSampleType.setEmptyRow(true);$.cmbSampleCode.setEmptyRow(true);$.cmbStudy.setEmptyRow(true);$.cmbBudegetCode.setEmptyRow(true);$.lblDonationNo.setVisible(false);$.cmbDonationNo.setVisible(false);$.lblSerialNo.setVisible(false);$.txtSerialNo.setVisible(false);$.lblStudy.setVisible(false);$.cmbStudy.setVisible(false);$.lblPharmacist.setVisible(false);$.txtPharmacist.setVisible(false);$.lblShipDate.setVisible(false);$.dteShipDate.setVisible(false);$.lblShipAddr.setVisible(false);$.txtShipAddr.setVisible(false);$.chkDirect.setVisible(false);$.txtBusinessNo.setReadOnly(true);$.txtYoyangNo.setReadOnly(true);$.txtTitle.setAllowBlank(false,"문서제목");$.cmbReceiptDate.setAllowBlank(false,"기간");$.cmbSampleType.setAllowBlank(false,"신청구분");$.cmbSampleCode.setAllowBlank(false,"품목");$.speReqQty.setAllowBlank(false,"신청수량");$.cmbBudegetCode.setAllowBlank(false,"예산항목");$.cmbStudy.setAllowBlank(false,"임상연구선택");$.txtPharmacist.setAllowBlank(false,"담당 관리약사");$.dteShipDate.setAllowBlank(false,"입고요청일");$.txtShipAddr.setAllowBlank(false,"실배송처 주소");$.cmbDonationNo.setAllowBlank(false,"자선목적 의약품지원 신고서");$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("sample_type",100,"left","string","구분"),new FingerDataGridColumn("sample_type_name",100,"left","string","구분"),new FingerDataGridColumn("req_date",100,"left","date","신청일",{readonly:true}),new FingerDataGridColumn("product_code",150,"left","string","품목코드"),new FingerDataGridColumn("product_name",170,"left","string","품목",{readonly:true}),new FingerDataGridColumn("company_id",100,"left","string","거래처아이디"),new FingerDataGridColumn("company_name",180,"left","string","거래처",{readonly:true}),new FingerDataGridColumn("business_no",110,"right","string","사업자번호",{readonly:true}),new FingerDataGridColumn("contact_id",120,"right","string","고객아이디",{readonly:true}),new FingerDataGridColumn("contact_name",130,"left","string","고객"),new FingerDataGridColumn("job_position",150,"right","string","진료과목/직위"),new FingerDataGridColumn("budget_code",130,"right","string","예산항목코드"),new FingerDataGridColumn("budget_name",140,"right","string","예산항목"),new FingerDataGridColumn("req_qty",100,"right","string","수량",{format:"int"})]);$.grdList.init();$.grdList.setColumnHidden(["sample_type","product_code","company_id","contact_id","budget_code"],true);$.grdList2.colIdx=$.grdList2.setColumns([new FingerDataGridColumn("Product",250,"left","string","샘플품목"),new FingerDataGridColumn("Quantity",130,"right","int","수량",{format:"int"}),new FingerDataGridColumn("Study",230,"left","string","해당연구"),new FingerDataGridColumn("Pharmacist",200,"left","string","담당 관리약사명"),new FingerDataGridColumn("ReqDate",150,"left","string","입고요청일",{format:"s_ymd"}),new FingerDataGridColumn("Address",230,"left","string","실배송처 주소"),new FingerDataGridColumn("ParentProduct",100,"left","string","상위품목",{hidden:true}),new FingerDataGridColumn("Seq",100,"left","string","순번",{hidden:true}),new FingerDataGridColumn("LastYN",100,"left","string","마지막행여부",{hidden:true})]);$.grdList2.init();$.grdList2.setEditable(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.cmbReceiptDate);$.panWFMain.add($.lblSampleType);$.panWFMain.add($.cmbSampleType);$.panWFMain.add($.lblProduct);$.panWFMain.add($.cmbSampleCode);$.panWFMain.add($.lblReqQty);$.panWFMain.add($.speReqQty);$.panWFMain.add($.lblBudegetCode);$.panWFMain.add($.cmbBudegetCode);$.panWFMain.add($.txtContactId);$.panWFMain.add($.spePrice);$.panWFMain.add($.htmLine);$.panWFMain.add($.lblContact);$.panWFMain.add($.bteContact);$.panWFMain.add($.lblCompany);$.panWFMain.add($.bteCompany);$.panWFMain.add($.lblBusinessNo);$.panWFMain.add($.txtBusinessNo);$.panWFMain.add($.lblYoyang);$.panWFMain.add($.txtYoyangNo);$.panWFMain.add($.lblStudy);$.panWFMain.add($.lblPharmacist);$.panWFMain.add($.txtPharmacist);$.panWFMain.add($.lblShipDate);$.panWFMain.add($.dteShipDate);$.panWFMain.add($.lblShipAddr);$.panWFMain.add($.txtShipAddr);$.panWFMain.add($.chkDirect);$.panWFMain.add($.cmbDonationNo);$.panWFMain.add($.lblDonationNo);$.panWFMain.add($.lblSerialNo);$.panWFMain.add($.txtSerialNo);$.panWFMain.add($.tabMain);$.panWFMain.add($.btnSave);$.panWFMain.add($.btnDelete);$.panWFMain.add($.cmbStudy);$.panWFDetail.add($.ediDetail);$.panFile.add($.btnFileAdd);$.panFile.add($.btnFileDelete);$.panFile.add($.grdFile);$.panDoc.add($.btnDocAdd);$.panDoc.add($.btnDocDelete);$.panDoc.add($.grdDoc);$.panContent.add($.grdList);$.panTab.add($.grdList2);relocateChildIndexInPanel([$.panWFMain]);searchWFDocument("Q3");$.cmbReceiptDate.setColumn("half_code","half_name");$.cmbStudy.setColumn("study_id","study_name");$.cmbSampleCode.setColumn("product_code","product_name");var ds1=bizComponentData2($,"Q1","L_CRM0008|L_CRM0062|L_CRM0207|L_CRM0067|L_CRM0136");setComboBind([$.cmbReceiptDate,$.cmbSampleType,$.cmbStudy,$.cmbSampleCode,$.cmbBudegetCode],ds1);$.strClinicalWH=g_main.session.getValue("ClinicalWH")||"03";$.strSampleWH=g_main.session.getValue("SampleWH")||"02";var comboList=[];comboList.push({half_code:"20191",half_name:"2019년 상반기"});$.cmbReceiptDate.setData(comboList);log($.strClinicalWH);log($.strSampleWH);$.grdList2.setColumnDropDownList("Product",ds1.resultList[3],{key:"product_code",name:"product_name"});$.grdList2.setColumnDropDownList("Study",ds1.resultList[2],{key:"study_id",name:"study_name"});if(g_main.session.getValue("SystemDeveloper")=="Y"){$.txtContactId.setVisible(true);$.spePrice.setVisible(true)}else{$.txtContactId.setVisible(false);$.spePrice.setVisible(false)}$.speReqQty.setValue(0);searchSample()};$.callback=function(type,ds){if(type=="Q3"){$.businessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue(ds.resultList[0][0].business_title+"("+g_main.session.getValue("DeptName")+"/"+g_main.session.getValue("EmpName")+")")}else{if(type=="Q"){setDataGrid([$.grdList],ds)}else{if(type=="N"){if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);return}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);return}}if($.saveType=="summit"){var param={wf_doc_id:$.wfDocId,wf_form_id:"crmWFSampleOut"};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{if($.saveType=="tmp"){moveWFGeneralProc()}}}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];console.log(args);if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.wfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.ediDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.cmbSampleType.setValue(md.sample_type);$.cmbSampleCode.setValue(md.sample_code);$.cmbBudegetCode.setValue(md.budget_code);$.chkDirect.setValue(md.company_yn);$.txtBusinessNo.setValue(md.business_no);$.companyId=md.company_id;$.bteCompany.setValue(md.company_name);$.contactId=md.contact_id;$.bteContact.setValue(md.contact_name);$.cmbDonationNo.setValue(md.donation_no);$.speReqQty.setValue(md.req_qty);$.txtYoyangNo.setValue(md.yoyang_no)}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSubmit"){if(!validateControls([$.txtTitle])){return}if(!$.panWFMain.validateControls()){return}if(($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue().substring(0,1)=="4")&&$.grdList.getRowCount()>0){for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"product_code")==($.cmbSampleCode.getValue())){MessageBoxShow("일반, DC 등을 목적으로 하는 견본품 지급은 고객 당 1회로 제한됩니다.");return}}}if($.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="70"){if($.grdList2.getRowCount()<1){MessageBoxShow("샘플 신청 품목 목록이 존재하지 않습니다.");return}}if($.bteContact.getText()==""){MessageBoxShow("고객정보가 존재하지 않습니다.");return}if($.txtBusinessNo.getValue()==""){MessageBoxShow("사업자번호가 존재하지 않습니다.");return}$.popUpCallId=id;$.saveType="summit";tmpSave()}else{if(id=="btnTmpSave"){if(!validateControls([$.txtTitle])){return}if(!$.panWFMain.validateControls()){return}$.saveType="tmp";tmpSave()}else{if(id=="btnSave"){if(!$.panWFMain.validateControls()){return}$.grdList2.addRow({});$.grdList2.setValue($.grdList2.getRowCount()-1,"Product",$.cmbSampleCode.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"Quantity",$.speReqQty.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"Study",$.cmbStudy.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"Pharmacist",$.txtPharmacist.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"ReqDate",$.dteShipDate.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"Address",$.txtShipAddr.getValue());$.grdList2.setValue($.grdList2.getRowCount()-1,"ParentProduct",$.cmbSampleCode.getValue("parent_product_code"));$.grdList2.setValue($.grdList2.getRowCount()-1,"Seq",$.grdList2.getRowCount());$.grdList2.setValue($.grdList2.getRowCount()-1,"LastYN","N")}else{if(id=="btnDelete"){if($.grdList2.getRowCount()<=0){return}else{$.grdList2.deleteRow($.grdList2.getSelectedRowIdx())}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteContact"){if($.chkDirect.getValue()=="N"){var param={contact_name:$.bteContact.getText()||""};g_main.openPopup("popContact2.html","popContact","의뢰자 조회",605,580,"","",param,"","")}}else{if(id=="bteCompany"){if($.chkDirect.getValue()=="N"){var param={company_name:$.bteCompany.getText()||""};g_main.openPopup("popCompany.html","popCompany","거래처팝업",385,545,"","",param,"","")}}}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chkDirect"){checkChange()}};$.fingercombobox_change=function(id,value){if(id=="cmbSampleType"){var strQuery="";if($.cmbSampleType.getValue()!=""){$.speReqQty.setValue(1)}else{$.speReqQty.setValue(0)}$.txtBusinessNo.setReadOnly(true);$.txtYoyangNo.setReadOnly(true);if($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="30"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"||$.cmbSampleType.getValue()=="50"||$.cmbSampleType.getValue()=="60"||$.cmbSampleType.getValue()=="80"||$.cmbSampleType.getValue()=="99"){$.tabMain.setActiveTab(0);$.tabMain.hideTab(1);$.tabMain.showTab(0);$.chkDirect.setVisible(false);$.chkDirect.setValue("N");$.txtPharmacist.setAllowBlank(true,"담당 관리약사");$.txtShipAddr.setAllowBlank(true,"실배송처 주소");$.dteShipDate.setAllowBlank(true,"입고요청일");$.cmbDonationNo.setAllowBlank(true,"자선목적 의약품지원 신고서");$.speReqQty.setAllowBlank(true,"신청수량");$.txtSerialNo.setAllowBlank(true,"시리얼넘버");$.cmbStudy.setAllowBlank(true,"임상연구선택");$.txtSerialNo.setAllowBlank(true,"시리얼넘버");$.cmbDonationNo.setAllowBlank(true,"자선목적 의약품지원 신고서");$.lblPharmacist.setVisible(false);$.txtPharmacist.setVisible(false);$.lblShipDate.setVisible(false);$.dteShipDate.setVisible(false);$.lblShipAddr.setVisible(false);$.txtShipAddr.setVisible(false);$.btnSave.setVisible(false);$.btnDelete.setVisible(false);$.speReqQty.setValue(1);$.chkDirect.setVisible(false);$.chkDirect.setEnable(false);$.lblSerialNo.setVisible(false);$.txtSerialNo.setVisible(false);$.lblStudy.setVisible(false);$.cmbStudy.setVisible(false);$.lblDonationNo.setVisible(false);$.cmbDonationNo.setVisible(false);if($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"){$.chkDirect.setVisible(false);$.chkDirect.setValue("N");$.speReqQty.setValue(1);$.speReqQty.setReadOnly(true)}else{$.chkDirect.setVisible(true);$.chkDirect.setEnable(true);$.speReqQty.setValue(1);$.speReqQty.setReadOnly(false)}if($.cmbSampleType.getValue()=="30"){$.lblDonationNo.setVisible(true);$.cmbDonationNo.setVisible(true);$.cmbDonationNo.setAllowBlank(false,"자선목적 의약품지원 신고서");$.lblStudy.setVisible(false);$.cmbStudy.setVisible(false);$.txtSerialNo.setAllowBlank(true,"시리얼넘버")}else{$.lblDonationNo.setVisible(false);$.cmbDonationNo.setVisible(false);$.cmbDonationNo.setAllowBlank(true,"자선목적 의약품지원 신고서");$.lblStudy.setVisible(false);$.cmbStudy.setVisible(false);$.cmbStudy.setAllowBlank(true,"임상연구선택")}if($.cmbSampleType.getValue()=="80"){$.lblSerialNo.setVisible(true);$.txtSerialNo.setVisible(true);$.txtSerialNo.setAllowBlank(false,"시리얼넘버");$.lblShipAddr.setVisible(true);$.txtShipAddr.setVisible(true);$.txtShipAddr.setAllowBlank(false,"실배송처 주소")}else{$.lblSerialNo.setVisible(false);$.txtSerialNo.setVisible(false);$.txtSerialNo.setAllowBlank(true,"시리얼넘버");$.lblShipAddr.setVisible(false);$.txtShipAddr.setVisible(false);$.txtShipAddr.setAllowBlank(true,"실배송처 주소")}}else{if($.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="70"){$.tabMain.setActiveTab(1);$.tabMain.hideTab(0);$.tabMain.showTab(1);$.speReqQty.setReadOnly(false);$.speReqQty.setValue(1);$.chkDirect.setVisible(true);$.chkDirect.setEnable(true);$.lblSerialNo.setVisible(false);$.txtSerialNo.setVisible(false);$.lblStudy.setVisible(true);$.cmbStudy.setVisible(true);$.btnSave.setVisible(true);$.btnDelete.setVisible(true);$.lblDonationNo.setVisible(false);$.cmbDonationNo.setVisible(false);$.lblPharmacist.setVisible(true);$.txtPharmacist.setVisible(true);$.lblShipDate.setVisible(true);$.dteShipDate.setVisible(true);$.lblShipAddr.setVisible(true);$.txtShipAddr.setVisible(true);$.txtSerialNo.setAllowBlank(true,"시리얼넘버");$.cmbDonationNo.setAllowBlank(true,"자선목적 의약품지원 신고서");$.cmbStudy.setAllowBlank(false,"임상연구선택");$.txtPharmacist.setAllowBlank(false,"담당 관리약사");$.txtShipAddr.setAllowBlank(false,"실배송처 주소");$.dteShipDate.setAllowBlank(false,"입고요청일");$.speReqQty.setAllowBlank(false,"신청수량")}}if($.cmbSampleType.getValue().substring(0,1)=="2"||$.cmbSampleType.getValue()=="70"){strQuery=" and a.WhsCode = '"+$.strClinicalWH+"' "}else{if($.cmbSampleType.getValue()=="80"){strQuery=" and a.WhsCode = '"+$.strSampleWH+"' and b.product_code = 'P20XT400M112C'"}else{strQuery=" and a.WhsCode = '"+$.strSampleWH+"'"}}$.cmbSampleCode.clear();var ds=bizComponentData2($,"Q4","L_CRM0067",strQuery);setComboBind([$.cmbSampleCode],ds)}else{if(id=="cmbSampleCode"){if(!$.cmbSampleType.getValue()||$.cmbSampleType.getValue()==""){return}var strQuery2="";var strQuery3="";$.cmbDonationNo.clear();if($.cmbSampleType.getValue()=="30"){strQuery2=" and c.dept_code in ('C220')";strQuery3=" and a.dept_code in ('C220')";var ds2=bizComponentData2($,"Q4","L_CRM0149",strQuery2);setComboBind([$.cmbDonationNo],ds2)}else{if($.cmbSampleType.getValue()=="70"){if(g_main.session.getValue("DeptCode")=="U110"){strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("12","11")+"' and a.dept_code = 'U110' and a.budget_code = 'B00200009'"}else{if(g_main.session.getValue("DeptCode")=="U120"){strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("12","11")+"' and a.dept_code = 'U120' and a.budget_code = 'B00200009'"}else{if(g_main.session.getValue("DeptCode")=="U140"){strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("12","11")+"' and a.dept_code = 'U140' and a.budget_code = 'B00200009'"}else{strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("12","11")+"' and a.dept_code not in ('U110', 'U120', 'U140')"}}}}else{if($.cmbSampleType.getValue()=="20"){if(g_main.session.getValue("DeptCode")=="U120"){strQuery3=" and a.dept_code = 'U120' and a.budget_code = 'B00200010'"}else{if(g_main.session.getValue("DeptCode")=="A030"){strQuery3=" and a.dept_code = 'U100' and a.budget_code = 'B00200010'"}else{if(g_main.session.getValue("DeptCode")=="U140"){strQuery3=" and a.dept_code = 'U140' and a.budget_code = 'B00200010'"}else{if(g_main.session.getValue("DeptCode")=="U110"){strQuery3=" and a.dept_code = 'U110' and a.budget_code = 'B00200010'"}else{strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("12","11").replace("17","11")+"' and a.dept_code not in ('U110', 'U120', 'U140')"}}}}}else{if($.cmbSampleType.getValue()=="60"){strQuery3=" and a.dept_code = 'E150' and a.budget_code = 'B01700076'"}else{strQuery3=" and substring(c.product_code,2,2) = '"+$.cmbSampleCode.getValue().substring(1,3).replace("08","07").replace("14","13").replace("17","11")+"' and a.dept_code not in ('U110', 'U120', 'U140')";if($.cmbSampleType.getValue()=="99"&&$.cmbSampleCode.getValue()=="P09GA200M100T"){strQuery3=" and a.dept_code = 'E150' and a.budget_code = 'B01700076'"}}}}}$.cmbBudegetCode.clear();var ds=bizComponentData2($,"Q4","L_CRM0136",strQuery3);setComboBind([$.cmbBudegetCode],ds)}else{if(id=="cmbBudegetCode"){$.spePrice.setValue($.cmbBudegetCode.getValue("aval_amt"));$.txtContactId.setValue($.cmbBudegetCode.getValue("dept_code"))}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txtYoyangNo"){if($.cmbSampleType.getValue()!=""){if(($.txtYoyangNo.getValue()==null||$.txtYoyangNo.getValue()=="")&&($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"||$.cmbSampleType.getValue()=="70")){MessageBoxShow("일반, 임상, DC 등을 목적으로 하는 견본품 지급은 요양기관기호가 정확해야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");if($.grdList.getSelectedRowIdx()){$.grdList.deleteRow($.grdList.getRowCount()-1)}return}else{if($.txtYoyangNo.getValue()!=null&&$.txtYoyangNo.getValue()!=""){if($.txtYoyangNo.getValue().substring(0,1)=="X"&&($.cmbSampleType.getValue()=="10"||$.cmbSampleType.getValue()=="20"||$.cmbSampleType.getValue()=="40"||$.cmbSampleType.getValue()=="41"||$.cmbSampleType.getValue()=="70")){MessageBoxShow("일반, 임상, DC 등을 목적으로 하는 견본품 지급은 요양기관기호가 정확해야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");if($.grdList.getSelectedRowIdx()){$.grdList.deleteRow($.grdList.getRowCount()-1)}return}}else{if(($.grdList.getRowCount()!=0)&&($.cmbSampleType.getValue().substring(0,1)=="1"||$.cmbSampleType.getValue().substring(0,1)=="4")){MessageBoxShow("일반, DC 등을 목적으로 하는 견본품 지급은 1회만 가능합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");if($.grdList.getSelectedRowIdx()){$.grdList.deleteRow($.grdList.getRowCount()-1)}return}}}}else{MessageBoxShow("샘플지급구분을 먼저 선택하셔야 합니다.");$.bteCompany.setText("");$.bteCompany.setValue("");$.bteContact.setValue("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("");if($.grdList.getSelectedRowIdx()){$.grdList.deleteRow($.grdList.getRowCount()-1)}return}}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDoc"){if(btnId=="btnAdd"){$.popUpCallId="btnDocAdd";var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popContact"){if($.popUpCallId=="bteContact"){if(!popResult.company_id){$.companyId="";$.contactId="";$.bteCompany.setText("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("")}else{$.companyId=popResult.company_id;$.contactId=popResult.contact_id;$.bteCompany.setText(popResult.company_name);$.bteContact.setText(popResult.contact_name);$.txtBusinessNo.setValue(popResult.business_no);$.txtYoyangNo.setValue(popResult.yoyang_no);if(yoyangChange()){searchSample()}}}}else{if(id=="popCompany"){if($.popUpCallId=="bteCompany"){if(!popResult.company_id){$.companyId="";$.contactId="";$.bteCompany.setText("");$.bteContact.setText("");$.txtBusinessNo.setValue("");$.txtYoyangNo.setValue("")}else{$.companyId=popResult.company_id;$.contactId="";$.bteCompany.setText(popResult.company_name);$.bteContact.setText("");$.txtBusinessNo.setValue(popResult.business_no);$.txtYoyangNo.setValue(popResult.yoyang_no);$.txtShipAddr.setValue(popResult.company_addr);if(yoyangChange()){searchSample()}}}}else{if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){summit(popResult)}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>