<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panMaster=null;$.panList1=null;$.panList2=null;$.grdMaster=null;$.grdList2=null;$.lblyyyy=null;$.lblapply_start_date=null;$.dteStart=null;$.lblWave=null;$.dteEnd=null;$.lblmemo=null;$.txtMemo=null;$.dteyyyy=null;$.saveYn=null;$.btnSearch=null;$.deleteRows=[];function QueryClick(workType){fnQRY_P_HRB6100_Q("MASTER")}function fnQRY_P_HRB6100_Q(workType){var ymd="";if(workType=="MASTER"){ymd=""}else{var rId=$.grdMaster.getSelectedRowIdx();ymd=$.grdMaster.getValue(rId,"yyyy")}var json=createJSON_Q(workType,ymd);callQuery(["req",json],workType,$)}function createJSON_Q(workType,ymd){var json=createExecuteParamInfo("HR..P_HRB6100_Q",[workType,ymd]);return json}function fnSET_P_HRB6100_S(workType){if(!validateControls([$.dteyyyy,$.dteStart,$.dteEnd])){return false}var json=createJSON_S(workType);callExecute(["req",json],workType,$)}function createJSON_S(workType){var json=createExecuteParamInfo("HR..P_HRB6100_S",[workType,$.dteyyyy.getValue(),$.dteStart.getValue(),$.dteEnd.getValue(),$.txtMemo.getValue(),"#UserID#","#HostInfo#"]);return json}function fnSET_P_HRB6100_S1(workType){for(var i=0;i<$.grdList2.getRowCount();i++){for(var j=i+1;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(i,"tax_free_code")==$.grdList2.getValue(j,"tax_free_code")){MessageBoxShow("중복된 비과세 코드가 존재합니다.");return}}}var json=createJSON_S1(workType);if(json){callExecute(["req",json],"S_detail",$)}}function createJSON_S1(workType){var json="";var rows=[];var changedRows=$.grdList2.getChangedRows();if($.deleteRows.length>0){for(var i in $.deleteRows){changedRows.push($.deleteRows[i])}}if(changedRows.length==0){MessageBoxShow("저장할 내용이 존재하지 않습니다.");return false}for(var i in changedRows){workType=changedRows[i].rowType;rows.push([workType,$.dteyyyy.getValue(),changedRows[i].tax_free_code||"",changedRows[i].tax_free_name||"",changedRows[i].receipt_code||"",changedRows[i].tax_free_descr||"",changedRows[i].receipt_yn||"",changedRows[i].tax_free_limit_period||"",changedRows[i].tax_free_limit_amt||0,"#UserID#","#HostInfo#"])}json=createExecuteParamInfo("HR..P_HRB6100_S1",rows);return json}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,715);$.panMain.setText("");$.panMain.setBottomLine(true);$.panMaster=new FingerPanel(host,"panMaster",0,0,275,700);$.panMaster.setText("기준년도");$.panMaster.setBottomLine(true);$.panList1=new FingerPanel(host,"panList1",285,0,915,165);$.panList1.setText("비과세 기본정보");$.panList1.setBottomLine(true);$.panList2=new FingerPanel(host,"panList2",285,170,915,525);$.panList2.setText("비과세 코드정보");$.panList2.setBottomLine(true);$.grdMaster=new FingerDataGrid(host,"grdMaster",0,0,275,650);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,915,480);$.lblyyyy=new FingerLabel(host,"lblyyyy",0,15,100,20);$.lblyyyy.setText("기준년도");$.lblapply_start_date=new FingerLabel(host,"lblapply_start_date",0,45,100,20);$.lblapply_start_date.setText("적용기간");$.dteStart=new FingerDateEdit(host,"dteStart",105,45,140,20);$.lblWave=new FingerLabel(host,"lblWave",245,45,20,20);$.lblWave.setText("~");$.dteEnd=new FingerDateEdit(host,"dteEnd",270,45,140,20);$.lblmemo=new FingerLabel(host,"lblmemo",0,75,100,20);$.lblmemo.setText("메모");$.txtMemo=new FingerEdit(host,"txtMemo",105,75,595,20);$.dteyyyy=new FingerDateEdit(host,"dteyyyy",105,15,140,20);$.saveYn=new FingerEdit(host,"saveYn",250,15,25,20);$.btnSearch=new FingerButton(host,"btnSearch",585,-40,100,30);$.btnSearch.setText("조회");$.panMaster.setBorder(false);$.saveYn.setVisible(false);$.panList1.addButtons(["btnDelete","btnSave","btnNew"]);$.panList2.addButtons(["btnDelete","btnAdd","btnSave"]);$.dteyyyy.setDateFormat("yyyy");$.dteyyyy.setAllowBlank(false,"기준년도");$.dteStart.setAllowBlank(false,"시작일");$.dteEnd.setAllowBlank(false,"종료일");$.btnSearch.setVisible(false);$.grdMaster.setColumns([new FingerDataGridColumn("yyyy",80,"left","string","기준년도"),new FingerDataGridColumn("apply_start_date",90,"left","string","적용시작일",{format:"s_ymd"}),new FingerDataGridColumn("apply_end_date",90,"left","string","적용종료일",{format:"s_ymd"})]);$.grdMaster.init({panel:$.panMaster,nonExcel:true,isFilter:false,scroll:"xy"});$.grdList2.setColumns([new FingerDataGridColumn("tax_free_code",100,"left","string",{text:"비과세코드",css:"col_chk"}),new FingerDataGridColumn("tax_free_name",100,"left","string","비과세약칭"),new FingerDataGridColumn("receipt_code",100,"left","string","영수증기재란"),new FingerDataGridColumn("tax_free_descr",300,"left","string","비과세설명"),new FingerDataGridColumn("receipt_yn",100,"center","checkbox","영수증작성"),new FingerDataGridColumn("tax_free_limit_period",100,"left","string","비과세한도기준"),new FingerDataGridColumn("tax_free_limit_amt",100,"right","int","비과세한도액",{format:"int"})]);$.grdList2.init({panel:$.panList2,scroll:"xy",nonExcel:true,isFilter:false,eventCellReadOnly:true});$.grdList2.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panMaster);$.panMain.add($.panList1);$.panMain.add($.panList2);$.panMaster.add($.grdMaster);$.panList1.add($.lblyyyy);$.panList1.add($.lblapply_start_date);$.panList1.add($.dteStart);$.panList1.add($.lblWave);$.panList1.add($.dteEnd);$.panList1.add($.lblmemo);$.panList1.add($.txtMemo);$.panList1.add($.dteyyyy);$.panList1.add($.saveYn);$.panList1.add($.btnSearch);$.panList2.add($.grdList2);QueryClick();var ds=bizComponentData2($,"Q1","L_HRB006|L_HRB007");$.grdList2.setColumnDropDownList("receipt_code",ds.resultList[0],{key:"sub_code",name:"code_name"});$.grdList2.setColumnDropDownList("tax_free_limit_period",ds.resultList[1],{key:"sub_code",name:"code_name"})};$.callback=function(type,ds){if(type=="MASTER"){$.deleteRows=[];setDataGrid([$.grdMaster],ds);var rIdx=0;if($.yyyy){rIdx=$.grdMaster.getGridRowIndex("yyyy",$.yyyy)}$.yyyy="";$.grdMaster.selectRow(rIdx)}else{if(type=="DETAIL"){setDataGrid([$.grdList2],ds);var aRow=$.grdList2.getAllRows();for(var i in aRow){if($.grdList2.getRowStatus(i)=="N"){aRow[i].tax_free_code_readonly=false;aRow[i].tax_free_code_readonly=false}else{aRow[i].tax_free_code_readonly=true;aRow[i].tax_free_code_readonly=true}}$.grdList2.selectRow(0)}else{if(type=="D"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{MessageBoxShow("정상적으로 삭제되었습니다.");QueryClick()}}}else{if(type=="U"||type=="N"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{$.yyyy=$.dteyyyy.getValue();MessageBoxShow("정상적으로 저장되었습니다.");QueryClick()}}}else{if(type=="S_detail"){if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);return}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);return}}$.yyyy=$.dteyyyy.getValue();MessageBoxShow("정상적으로 저장되었습니다.");QueryClick()}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){QueryClick()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdMaster"){$.deleteRows=[];$.yyyy="";fnQRY_P_HRB6100_Q("DETAIL");$.dteyyyy.setEnable(false);$.saveYn.setValue("fal");var rId=$.grdMaster.getSelectedRowIdx();$.dteyyyy.setValue($.grdMaster.getValue(rId,"yyyy"));$.dteStart.setValue($.grdMaster.getValue(rId,"apply_start_date"));$.dteEnd.setValue($.grdMaster.getValue(rId,"apply_end_date"));$.txtMemo.setValue($.grdMaster.getValue(rId,"memo"))}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList1"){if(btnId=="btnNew"){$.deleteRows=[];$.yyyy="";$.panList1.clear();$.grdList2.clear();$.dteyyyy.setEnable(true);$.saveYn.setValue("tu")}else{if(btnId=="btnDelete"){var rId=$.grdMaster.getSelectedRowIdx();confirmBoxShow($.grdMaster.getValue(rId,"yyyy")+"년도 정보를 정말 삭제하시겠습니까?",function(){if(g_main.msgShare==true){fnSET_P_HRB6100_S("D")}})}else{if(btnId=="btnSave"){log($.saveYn.getValue());var strStatus="";if($.saveYn.getValue()=="tu"){strStatus="N"}else{strStatus="U"}fnSET_P_HRB6100_S(strStatus)}}}}else{if(panelId=="panList2"){if(btnId=="btnAdd"){$.grdList2.editStop();$.grdList2.addRow();var aRow=$.grdList2.getAllRows();for(var i in aRow){if($.grdList2.getRowStatus(i)=="N"){aRow[i].tax_free_code_readonly=false;aRow[i].receipt_yn="Y"}else{aRow[i].tax_free_code_readonly=true}}}else{if(btnId=="btnDelete"){var rId=$.grdList2.getSelectedRowIdx();if(!rId){return}$.grdList2.editStop();if($.grdList2.getRowStatus(rId)!="N"){confirmBoxShow("삭제하시겠습니까?",function(){if(g_main.msgShare==true){$.grdList2.getItem(rId).rowType="D";$.deleteRows.push($.grdList2.getValue(rId));$.grdList2.deleteCurrentRow()}})}else{$.grdList2.deleteCurrentRow()}}else{if(btnId=="btnSave"){var rId=$.grdMaster.getSelectedRowIdx();if(!rId){return}$.grdList2.editStop();for(var i=0;i<$.grdList2.getRowCount();i++){if(!$.grdList2.getValue(i,"tax_free_code")){MessageBoxShow("비과세코드 은(는) 필수입력항목입니다.");return}}fnSET_P_HRB6100_S1("")}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>