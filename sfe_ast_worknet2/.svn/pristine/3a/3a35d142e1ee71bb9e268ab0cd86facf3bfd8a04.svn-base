<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.tabMain=null;$.lblDate=null;$.dteDate=null;$.lblChannel=null;$.cmbChannel=null;$.lblProduct=null;$.cmbProductCode=null;$.lblDeptEmp=null;$.cmbDept=null;$.cmbEmployee=null;$.btnSearch=null;$.panStdFY=null;$.panStdMonth=null;$.panFYList=null;$.panFYChart=null;$.panFYResult=null;$.grdFYList=null;$.grdFYResult=null;$.panMonthList=null;$.panMonthChart=null;$.panMonthResult=null;$.grdMonthList=null;$.grdMonthResult=null;$.chartSaleResultFY=null;$.chartSaleResultMonth=null;$.rdoFy=null;$.rboMonth=null;$.htmlMsg=null;$.session=g_main.session.obj;$.colors=getChartColor("fixed_3");$.varTabId=0;$.varFyDt=null;$.varMonthDt=null;$.varData=[[{yyyymm_date:"201704"},{yyyymm_date:"201705"},{yyyymm_date:"201706"},{yyyymm_date:"201707"},{yyyymm_date:"201708"},{yyyymm_date:"201709"},{yyyymm_date:"201710"},{yyyymm_date:"201711"},{yyyymm_date:"201712"},{yyyymm_date:"201801"},{yyyymm_date:"201802"},{yyyymm_date:"201803"}],[{gubun:"10",gubun_name:"소화 데이터",ym1:6022702,ym2:5753504,ym3:6572511,ym4:6096488,ym5:6388088,ym6:5713210,ym7:5745460,ym8:5371593,ym9:6350167,ym10:6170700,ym11:5523992,ym12:0},{gubun:"20",gubun_name:"최근1년 실적 기준 예측",ym1:6022702,ym2:5753504,ym3:6572511,ym4:6096488,ym5:6388088,ym6:5713210,ym7:5745460,ym8:5371593,ym9:6350167,ym10:6170700,ym11:5523992,ym12:4588721},{gubun:"30",gubun_name:"3개년 실적 기준 예측",ym1:6916148.128571,ym2:6993787.228571,ym3:7071426.328571,ym4:7149065.428571,ym5:7226704.528571,ym6:7304343.628571,ym7:7381982.728571,ym8:7459621.828571,ym9:7537260.928571,ym10:7614900.028571,ym11:7692539.128571,ym12:7770178.228571},{gubun:"40",gubun_name:"3개년 실적 평균",ym1:5454668,ym2:5178683,ym3:5210284,ym4:5199945,ym5:5121450,ym6:5903965,ym7:4710774,ym8:5304195,ym9:6811631,ym10:5378000,ym11:6025702,ym12:4997315}]];$.isFYGridSelect=false;$.isMonthGridSelect=false;function createJSON_Q(workType,companyId,sidoguCode){var json=createExecuteParamInfo("P_crmSaleResult_Q",[workType,$.dteDate.getValue(),companyId?companyId:"",sidoguCode?sidoguCode:"",$.cmbChannel.getValue(),$.cmbProductCode.getValue(),$.cmbDept.getValue(),$.cmbEmployee.getValue(),$.varTabId==1?$.rboMonth.getValue():$.rdoFy.getValue(),"COMPANY","#UserID#"]);return json}function searchCondition(){if($.varTabId==1){$.isMonthGridSelect=false;$.grdMonthList.clearSelect();searchList("Q_MONTH")}else{$.isFYGridSelect=false;$.grdFYList.clearSelect();searchList("Q_FY")}}function searchList(workType,companyId,sidoguCode){if(!$.panTop.validateControls()){return}var json=createJSON_Q(workType,companyId,sidoguCode);callQuery(["req",json],workType,$)}function renderChart(dt,id){var chart="";chart=id.getChart();chartDestroy(chart);var cate=dt[0];var data=dt[1];var cateArr=[];var saleAmtArr=[];var oneYearForecastArr=[];var threeYearForecastArr=[];var threeYearForecastArr1=[];for(var i=0;i<cate.length;i++){cateArr.push(cate[i].yyyymm_date.substr(2,2)+"'"+cate[i].yyyymm_date.substr(4,cate[i].yyyymm_date.length))}chart.xAxis[0].setCategories(cateArr);for(var i=0;i<data.length;i++){var rowDataObj=Object.keys(data[i]);for(var j=0;j<rowDataObj.length;j++){if(rowDataObj[j].indexOf("ym")>-1){if(data[i].gubun=="10"){saleAmtArr.push(calcDecimalToInt(data[i][rowDataObj[j]]))}else{if(data[i].gubun=="20"){oneYearForecastArr.push(calcDecimalToInt(data[i][rowDataObj[j]]))}else{if(data[i].gubun=="30"){threeYearForecastArr.push(calcDecimalToInt(data[i][rowDataObj[j]]))}else{threeYearForecastArr1.push(calcDecimalToInt(data[i][rowDataObj[j]]))}}}}}}var strTitle="";if($.varTabId==1){if($.rboMonth.getValue()=="10"){strTitle="단위(천원)"}else{strTitle="단위(개)"}}else{if($.rdoFy.getValue()=="10"){strTitle="단위(천원)"}else{strTitle="단위(개)"}}chart.yAxis[0].update({title:{text:strTitle}});chart.addSeries({name:"소화 데이터",data:saleAmtArr,yAxis:0,market:{lineWidth:2,lineColor:Highcharts.getOptions().colors[3],fillColor:"white"},color:$.colors[0],zIndex:5});chart.addSeries({name:"최근 1년 실적 기준 예측",data:oneYearForecastArr,yAxis:0,market:{lineWidth:2,lineColor:Highcharts.getOptions().colors[3],fillColor:"white"},dashStyle:"shortdot",color:"#4374D9",zIndex:3});chart.addSeries({name:"3개년 실적 기준 Trend",data:threeYearForecastArr,yAxis:0,market:{lineWidth:2,lineColor:Highcharts.getOptions().colors[3],fillColor:"white"},dashStyle:"shortdot",color:$.colors[2],zIndex:2});chart.addSeries({name:"3개년 실적 평균 예측",data:threeYearForecastArr1,yAxis:0,market:{lineWidth:2,lineColor:Highcharts.getOptions().colors[3],fillColor:"white"},dashStyle:"shortdot",color:$.colors[3],zIndex:1})}function initData(){$.dteDate.setValue(getToday());var ds=bizComponentData2($,"Q1","L_CRM0120|L_CRM0015|L_CRM0131");setComboBind([$.cmbDept,$.cmbChannel,$.cmbProductCode],ds);initAuthentication();initChart($.chartSaleResultFY);initChart($.chartSaleResultMonth)}function initChart(id){id.init({chart:{width:855,height:500},title:{text:null},xAxis:{categories:[],label:{enabled:true}},yAxis:[{title:{text:"단위(백만원)",style:{color:"#787878","font-size":"14px","font-weight":"600"}},min:0,plotLines:[{value:0,width:1,}],lineWidth:1,labels:{formatter:function(){return Highcharts.numberFormat(this.value,0)}}}],credits:{enabled:false},series:[],tooltip:{shared:true},legend:{enabled:true,align:"center",verticalAlign:"bottom"}})}function chartDestroy(chart){var cnt=chart.series.length;if(cnt>0){for(var i=0;i<cnt;i++){chart.series[0].remove()}}}function calcDecimalToInt(val){if(val){if($.varTabId==1){return cutNumber(val,$.rboMonth.getValue())}else{return cutNumber(val,$.rdoFy.getValue())}}else{return null}}function cutNumber(val,radioValue){if(!val){return 0}if(radioValue=="10"){return Math.round(val/1000)}else{return Math.round(val)}}function modifyGrid(data,gridId,radioValue){var copyData=deepCopyObj(data);for(var i=0;i<copyData.length;i++){var rowObj=Object.keys(copyData[i]);for(var j=0;j<rowObj.length;j++){if(rowObj[j].indexOf("ym")>-1){copyData[i][rowObj[j]]=cutNumber(copyData[i][rowObj[j]],radioValue)}}}setDataGrid([gridId],copyData,true)}function initAuthentication(){if($.session.SystemDeveloper=="N"){if($.session.DeptLeaderYN=="Y"){$.cmbDept.setValue($.session.DeptCode)}else{$.cmbDept.setValue($.session.DeptCode);$.cmbEmployee.setValue($.session.EmpCode)}}}function tmpRender(){renderChart($.varData,$.chartSaleResultFY);$.grdFYResult.clear();$.grdFYResult.removeColumns();var cols=[];cols.push(new FingerDataGridColumn("gubun_name",145,"left","string","구분"));var keys=Object.keys($.varData[1][0]);var iCount=0;for(var i=0;i<keys.length;i++){if(keys[i].indexOf("ym")>-1){cols.push(new FingerDataGridColumn(keys[i],100,"right","int",$.varData[0][iCount].yyyymm_date.substr(2,2)+"'"+$.varData[0][iCount].yyyymm_date.substr(4,$.varData[0][iCount].yyyymm_date.length),{format:"int"}));iCount++}}$.grdFYResult.resetColumns(cols);setDataGrid([$.grdFYResult],$.varData[1],true)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,865);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,55);$.panTop.setText("");$.panTop.setBottomLine();$.tabMain=new FingerTab(host,"tabMain",0,65,1200,795);$.lblDate=new FingerLabel(host,"lblDate",0,15,100,20);$.lblDate.setText("연월");$.dteDate=new FingerDateEdit(host,"dteDate",105,15,140,20);$.lblChannel=new FingerLabel(host,"lblChannel",220,15,100,20);$.lblChannel.setText("채널");$.cmbChannel=new FingerComboBox(host,"cmbChannel",325,15,140,20);$.lblProduct=new FingerLabel(host,"lblProduct",435,15,100,20);$.lblProduct.setText("품목");$.cmbProductCode=new FingerComboBox(host,"cmbProductCode",540,15,140,20);$.lblDeptEmp=new FingerLabel(host,"lblDeptEmp",690,15,100,20);$.lblDeptEmp.setText("부서/담당자");$.cmbDept=new FingerComboBox(host,"cmbDept",795,15,170,20);$.cmbEmployee=new FingerComboBox(host,"cmbEmployee",965,15,110,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.panStdFY=new FingerPanel(host,"panStdFY",0,0,1200,755);$.panStdFY.setText("");$.panStdFY.setBottomLine(true);$.panStdMonth=new FingerPanel(host,"panStdMonth",0,0,1200,755);$.panStdMonth.setText("");$.panStdMonth.setBottomLine(true);$.panFYList=new FingerPanel(host,"panFYList",0,5,330,500);$.panFYList.setText("");$.panFYList.setBottomLine(true);$.panFYChart=new FingerPanel(host,"panFYChart",340,5,858,500);$.panFYChart.setText("");$.panFYChart.setBottomLine(true);$.panFYResult=new FingerPanel(host,"panFYResult",0,515,1198,225);$.panFYResult.setText("결과데이터");$.panFYResult.setBottomLine(true);$.grdFYList=new FingerDataGrid(host,"grdFYList",0,0,330,500);$.grdFYResult=new FingerDataGrid(host,"grdFYResult",0,0,1198,180);$.panMonthList=new FingerPanel(host,"panMonthList",0,5,330,500);$.panMonthList.setText("");$.panMonthList.setBottomLine(true);$.panMonthChart=new FingerPanel(host,"panMonthChart",340,5,858,500);$.panMonthChart.setText("");$.panMonthChart.setBottomLine(true);$.panMonthResult=new FingerPanel(host,"panMonthResult",0,515,1198,225);$.panMonthResult.setText("결과데이터");$.panMonthResult.setBottomLine(true);$.grdMonthList=new FingerDataGrid(host,"grdMonthList",0,0,330,500);$.grdMonthResult=new FingerDataGrid(host,"grdMonthResult",0,0,1198,180);$.chartSaleResultFY=new FingerBarChart(host,"chartSaleResultFY",0,0,855,500);$.chartSaleResultMonth=new FingerBarChart(host,"chartSaleResultMonth",0,0,855,500);$.rdoFy=new FingerRadioBox(host,"rdoFy",1095,65,125,20);$.rboMonth=new FingerRadioBox(host,"rboMonth",1095,65,125,20);$.htmlMsg=new FingerHTMLView(host,"htmlMsg",340,70,565,20);$.panTop.setBorder(true);$.panFYChart.setBorder(true);$.panMonthChart.setBorder(true);$.tabMain.addTab([{text:"FY 기준",body:$.panStdFY,width:130},{text:"마지막 소화처리 월 기준",body:$.panStdMonth,width:160}]);$.cmbDept.setColumn("dept_code","dept_name");$.cmbEmployee.setColumn("employee_id","emp_name");$.cmbProductCode.setColumn("product_code","product_name");$.dteDate.setDateFormat("yyyymm");$.cmbChannel.setEmptyRow(true);$.cmbProductCode.setEmptyRow(true);$.cmbDept.setEmptyRow(true);$.cmbEmployee.setEmptyRow(true);$.dteDate.setAllowBlank(false,"연월");$.rdoFy.addButtons([{sub_code:"10",code_name:"금액"},{sub_code:"20",code_name:"수량"}]);$.rboMonth.addButtons([{sub_code:"10",code_name:"금액"},{sub_code:"20",code_name:"수량"}]);$.rboMonth.setVisible(false);$.rdoFy.setValue("20");$.rboMonth.setValue("20");$.htmlMsg.setValue("(* 예측 값은 회귀 분석식으로 오차율 +- 로 계산 됩니다)");$.htmlMsg.setStyle("font-size","12px");$.grdFYList.setColumns([new FingerDataGridColumn("company_name",200,"left","string","거래처"),new FingerDataGridColumn("sido_name",113,"left","string","지역")]);$.grdFYList.init({scroll:"xy"});$.grdFYList.setBorder(true);$.grdFYResult.setColumns([new FingerDataGridColumn("gubun_name",120,"left","string","구분")]);$.grdFYResult.init({panel:$.panFYResult,scroll:"xy",isFilter:false});$.grdFYResult.setBorder(false);$.grdMonthList.setColumns([new FingerDataGridColumn("company_name",200,"left","string","거래처"),new FingerDataGridColumn("sido_name",113,"left","string","지역")]);$.grdMonthList.init({scroll:"xy"});$.grdMonthList.setBorder(true);$.grdMonthResult.setColumns([new FingerDataGridColumn("gubun_name",120,"left","string","구분")]);$.grdMonthResult.init({panel:$.panMonthResult,scroll:"xy",isFilter:false});$.grdMonthResult.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.tabMain);$.panMain.add($.rdoFy);$.panMain.add($.rboMonth);$.panMain.add($.htmlMsg);$.panTop.add($.btnSearch);$.panTop.add($.cmbEmployee);$.panTop.add($.cmbDept);$.panTop.add($.lblDeptEmp);$.panTop.add($.cmbProductCode);$.panTop.add($.lblProduct);$.panTop.add($.cmbChannel);$.panTop.add($.lblChannel);$.panTop.add($.dteDate);$.panTop.add($.lblDate);$.panStdFY.add($.panFYResult);$.panStdFY.add($.panFYChart);$.panStdFY.add($.panFYList);$.panStdMonth.add($.panMonthList);$.panStdMonth.add($.panMonthChart);$.panStdMonth.add($.panMonthResult);$.panFYList.add($.grdFYList);$.panFYChart.add($.chartSaleResultFY);$.panFYResult.add($.grdFYResult);$.panMonthList.add($.grdMonthList);$.panMonthChart.add($.chartSaleResultMonth);$.panMonthResult.add($.grdMonthResult);relocateChildIndexInPanel([$.panTop]);initData()};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdMonthList],ds);setDataGrid([$.grdFYList],ds)}else{if(type=="Q_FY"){var dt=ds.resultList;$.varFyDt=dt;renderChart(dt,$.chartSaleResultFY);$.grdFYResult.clear();$.grdFYResult.removeColumns();var cols=[];cols.push(new FingerDataGridColumn("gubun_name",160,"left","string","구분"));var keys=Object.keys(dt[1][0]);var iCount=0;for(var i=0;i<keys.length;i++){if(keys[i].indexOf("ym")>-1){cols.push(new FingerDataGridColumn(keys[i],85,"right","int",dt[0][iCount].yyyymm_date.substr(2,2)+"'"+dt[0][iCount].yyyymm_date.substr(4,dt[0][iCount].yyyymm_date.length),{format:"int"}));iCount++}}$.grdFYResult.resetColumns(cols);modifyGrid(dt[1],$.grdFYResult,$.rdoFy.getValue());if(!$.isFYGridSelect){setDataGrid([$.grdFYList],dt[2],true)}}else{if(type=="Q_MONTH"){var dt=ds.resultList;$.varMonthDt=dt;renderChart(dt,$.chartSaleResultMonth);$.grdMonthResult.clear();$.grdMonthResult.removeColumns();var cols=[];cols.push(new FingerDataGridColumn("gubun_name",160,"left","string","구분"));var keys=Object.keys(dt[1][0]);var iCount=0;for(var i=0;i<keys.length;i++){if(keys[i].indexOf("ym")>-1){cols.push(new FingerDataGridColumn(keys[i],85,"right","int",dt[0][iCount].yyyymm_date.substr(2,2)+"'"+dt[0][iCount].yyyymm_date.substr(4,dt[0][iCount].yyyymm_date.length),{format:"int"}));iCount++}}$.grdMonthResult.resetColumns(cols);modifyGrid(dt[1],$.grdMonthResult,$.rboMonth.getValue());if(!$.isMonthGridSelect){setDataGrid([$.grdMonthList],dt[2],true)}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchCondition()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){if(!value){$.cmbEmployee.setEnable(false);$.cmbEmployee.setValue("");return}$.cmbEmployee.setEnable(true);var strQuery="where DeptCode ='"+$.cmbDept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0104",strQuery,"","");$.cmbEmployee.clear();setComboBind([$.cmbEmployee],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdFYList"){$.isFYGridSelect=true;var dt=$.grdFYList.getValue(rId);searchList("Q_FY",dt.company_id,dt.sidogu_code)}else{if(id=="grdMonthList"){$.isMonthGridSelect=true;var dt=$.grdMonthList.getValue(rId);searchList("Q_MONTH",dt.company_id,dt.sidogu_code)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){if(id=="rdoFy"){var rId=$.grdFYList.getSelectedRowIdx();if(rId){var dt=$.grdFYList.getValue(rId);searchList("Q_FY",dt.company_id,dt.sidogu_code)}else{searchCondition()}}else{if(id=="rboMonth"){var rId=$.grdMonthList.getSelectedRowIdx();if(rId){var dt=$.grdMonthList.getValue(rId);searchList("Q_MONTH",dt.company_id,dt.sidogu_code)}else{searchCondition()}}}};$.fingertab_selectionchange=function(id,tabid){if(id=="tabMain"){$.varTabId=tabid;if(tabid==1){$.rdoFy.setVisible(false);$.rboMonth.setVisible(true)}else{$.rdoFy.setVisible(true);$.rboMonth.setVisible(false)}}};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>