<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTree=null;$.panList=null;$.panDetail=null;$.panFCST=null;$.lblVerCode=null;$.txtVerCode=null;$.lblVerName=null;$.txtVerName=null;$.lblFy=null;$.dteFy=null;$.lblBudgetType=null;$.cmbBudgetType=null;$.lblEditYn=null;$.chkEditYn=null;$.lblExdsalesActualYm=null;$.dteExdsalesActualYm=null;$.lblUseStatus=null;$.cmbUseStatus=null;$.lblSortSeq=null;$.speSortSeq=null;$.lblExfsalesActualYm=null;$.dteExfsalesActualYm=null;$.lblCreateUser=null;$.txtCreateUser=null;$.lblUpdateTime=null;$.lblExpenseActualYm=null;$.dteExpenseActualYm=null;$.htmlEditMsg=null;$.htmlExdSalesMsg=null;$.htmlExfsalesMsg=null;$.htmlExpenseMsg=null;$.btnExdsalesUpdate=null;$.btnExfsalesUpdate=null;$.btnExpenseUpdate=null;$.dteFcstStartDate=null;$.dteFcstEndDate=null;$.lblEx1=null;$.treeSort=null;$.grdList=null;$.grdFCST=null;$.txtUpdateTime=null;$.session=g_main.session.obj;$.workTypeStr="N";$.verCode="";$.fcstGridChange=true;$.selBudgetType="";$.selFY="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_bgtVersionManage_Q",[workType,(workType=="Q_DETAIL"||workType=="Q_FCST"?$.verCode:""),$.selBudgetType,$.selFY,"#UserID#"]);return json}function createJSON_S_DETAIL(){var json=createExecuteParamInfo("P_bgtVersionManage_S",[$.workTypeStr,($.workTypeStr=="N"?"":$.txtVerCode.getValue()),$.txtVerName.getValue(),$.dteFy.getValue()||"",$.cmbBudgetType.getValue(),$.chkEditYn.getValue(),"",$.cmbUseStatus.getValue(),$.speSortSeq.getValue()||0,"","","","",0,"#UserID#"]);return json}function createJSON_S_FCST(workType){var dt=$.grdFCST.getAllRows();var rows=[];var json="";var rowData="";var iCount=1;for(var i=0;i<dt.length;i++){rowData=dt[i];rows.push([workType,$.txtVerCode.getValue(),"","","","","","",0,"","",rowData.fy,rowData.spread,iCount,"#UserID#"]);iCount++}json=createExecuteParamInfo("P_bgtVersionManage_S",rows);return json}function selectBudgetVersion(){searchList("Q");searchList("Q_TREE")}function searchList(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveDetail(){var json=createJSON_S_DETAIL();var ds=callExecuteSync(["req",json],"SAVE_DETAIL");if(ds&&ds.errorCode){if(ds.errorCode=="MSG0002"){$.verCode=ds.resultList[0][0].ver_code;MessageBoxShow("정상적으로 등록 되었습니다.");selectBudgetVersion()}else{if(ds.errorCode=="MSG0004"){MessageBoxShow("정상적으로 수정 되었습니다.");selectBudgetVersion()}else{if(ds.errorCode=="MSG0003"){MessageBoxShow("정상적으로 삭제되었습니다.");initView();selectBudgetVersion()}else{if(ds.errorCode=="ERR1000"){MessageBoxShow("해당FY에 이미 저장 된 기본예산이 있습니다.")}}}}}}function saveFcst(workType){var json=createJSON_S_FCST(workType);var ds=callExecuteSync(["req",json],"SAVE_FCST");if(ds){MessageBoxShow("정상적으로 저장되었습니다.");searchList("Q_FCST")}}function profitBtnEnable(budgetType){var bo=(budgetType=="BASIC"?false:true);$.btnExdsalesUpdate.setEnable(bo);$.btnExfsalesUpdate.setEnable(bo);$.btnExpenseUpdate.setEnable(bo)}function comboBudgetTypeEvent(value){if(value=="BASIC"){$.dteExdsalesActualYm.setValue("");$.dteExfsalesActualYm.setValue("");$.dteExpenseActualYm.setValue("");$.htmlExdSalesMsg.setValue("");$.htmlExdSalesMsg.setValue("");$.htmlExdSalesMsg.setValue("")}}function setDetailPanel(bo){$.panDetail.setEnable(bo);$.dteExdsalesActualYm.setEnable(false);$.dteExfsalesActualYm.setEnable(false);$.dteExpenseActualYm.setEnable(false);$.txtVerCode.setEnable(false);$.txtCreateUser.setEnable(false);$.txtUpdateTime.setEnable(false)}function initView(){$.grdList.clearSelect();setSaveStatus("N");$.panDetail.clear();$.grdFCST.clear();$.selBudgetType="";$.selFY="";$.dteFcstStartDate.setValue("");$.dteFcstEndDate.setValue("");profitBtnEnable("BASIC");setDetailPanel(true)}function setSaveStatus(type){$.workTypeStr=type;if(type=="N"){$.verCode=""}}function setFcstDate(from,to){for(var i=from;i<=to;i++){$.grdFCST.addRow({fy:i,spread:""})}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1035);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTree=new FingerPanel(host,"panTree",0,10,185,435);$.panTree.setText("분류");$.panTree.setBottomLine(true);$.panList=new FingerPanel(host,"panList",195,10,1005,435);$.panList.setText("버전내역");$.panList.setBottomLine(true);$.panDetail=new FingerPanel(host,"panDetail",0,455,1200,236);$.panDetail.setText("버전상세");$.panDetail.setBottomLine(true);$.panFCST=new FingerPanel(host,"panFCST",0,700,460,300);$.panFCST.setText("FCST 기간");$.panFCST.setBottomLine(true);$.lblVerCode=new FingerLabel(host,"lblVerCode",0,15,100,20);$.lblVerCode.setText("버전코드");$.txtVerCode=new FingerEdit(host,"txtVerCode",105,15,170,20);$.lblVerName=new FingerLabel(host,"lblVerName",285,15,100,20);$.lblVerName.setText("버전명");$.txtVerName=new FingerEdit(host,"txtVerName",390,15,335,20);$.lblFy=new FingerLabel(host,"lblFy",760,15,100,20);$.lblFy.setText("기준FY");$.dteFy=new FingerDateEdit(host,"dteFy",865,15,140,20);$.lblBudgetType=new FingerLabel(host,"lblBudgetType",0,60,100,20);$.lblBudgetType.setText("예산기준");$.cmbBudgetType=new FingerComboBox(host,"cmbBudgetType",105,60,175,20);$.lblEditYn=new FingerLabel(host,"lblEditYn",285,60,100,20);$.lblEditYn.setText("편집가능여부");$.chkEditYn=new FingerCheckBox(host,"chkEditYn",390,60,140,20);$.chkEditYn.setText("");$.lblExdsalesActualYm=new FingerLabel(host,"lblExdsalesActualYm",760,60,100,20);$.lblExdsalesActualYm.setText("소화실적기준");$.dteExdsalesActualYm=new FingerDateEdit(host,"dteExdsalesActualYm",865,60,140,20);$.lblUseStatus=new FingerLabel(host,"lblUseStatus",0,105,100,20);$.lblUseStatus.setText("Open상태");$.cmbUseStatus=new FingerComboBox(host,"cmbUseStatus",105,105,175,20);$.lblSortSeq=new FingerLabel(host,"lblSortSeq",285,105,100,20);$.lblSortSeq.setText("정렬순서");$.speSortSeq=new FingerSpinEdit(host,"speSortSeq",390,105,140,20);$.lblExfsalesActualYm=new FingerLabel(host,"lblExfsalesActualYm",760,105,100,20);$.lblExfsalesActualYm.setText("납품실적기준월");$.dteExfsalesActualYm=new FingerDateEdit(host,"dteExfsalesActualYm",865,105,140,20);$.lblCreateUser=new FingerLabel(host,"lblCreateUser",0,150,100,20);$.lblCreateUser.setText("등록자");$.txtCreateUser=new FingerEdit(host,"txtCreateUser",105,150,170,20);$.lblUpdateTime=new FingerLabel(host,"lblUpdateTime",285,150,100,20);$.lblUpdateTime.setText("갱신일시");$.lblExpenseActualYm=new FingerLabel(host,"lblExpenseActualYm",760,150,100,20);$.lblExpenseActualYm.setText("비용실적기준월");$.dteExpenseActualYm=new FingerDateEdit(host,"dteExpenseActualYm",865,150,140,20);$.htmlEditMsg=new FingerHTMLView(host,"htmlEditMsg",395,82,360,20);$.htmlExdSalesMsg=new FingerHTMLView(host,"htmlExdSalesMsg",865,82,325,20);$.htmlExfsalesMsg=new FingerHTMLView(host,"htmlExfsalesMsg",865,127,325,20);$.htmlExpenseMsg=new FingerHTMLView(host,"htmlExpenseMsg",865,172,325,20);$.btnExdsalesUpdate=new FingerButton(host,"btnExdsalesUpdate",1010,60,125,20);$.btnExdsalesUpdate.setText("소화실적반영");$.btnExfsalesUpdate=new FingerButton(host,"btnExfsalesUpdate",1010,105,125,20);$.btnExfsalesUpdate.setText("납품실적반영");$.btnExpenseUpdate=new FingerButton(host,"btnExpenseUpdate",1010,150,125,20);$.btnExpenseUpdate.setText("비용실적반영");$.dteFcstStartDate=new FingerDateEdit(host,"dteFcstStartDate",125,710,95,20);$.dteFcstEndDate=new FingerDateEdit(host,"dteFcstEndDate",245,710,95,20);$.lblEx1=new FingerLabel(host,"lblEx1",220,710,20,20);$.lblEx1.setText("~");$.treeSort=new FingerTree(host,"treeSort",0,0,185,390);$.grdList=new FingerDataGrid(host,"grdList",0,0,1005,390);$.grdFCST=new FingerDataGrid(host,"grdFCST",0,0,460,255);$.txtUpdateTime=new FingerEdit(host,"txtUpdateTime",390,150,140,20);$.panDetail.addButtons(["btnDelete","btnSave","btnNew"]);$.panDetail.addButton("btnVersionCopy","버전복사");$.panDetail.setButtonAction("btnVersionCopy","custom",80);$.panFCST.addButtons(["btnSave"]);$.htmlEditMsg.setHTML("(* 편집가능여부 '체크'일 때, 예산데이터 수정이 가능합니다.)");$.dteFy.setDateFormat("yyyy");$.dteExdsalesActualYm.setDateFormat("yyyymm");$.dteExfsalesActualYm.setDateFormat("yyyymm");$.dteExpenseActualYm.setDateFormat("yyyymm");$.dteFcstStartDate.setDateFormat("yyyy");$.dteFcstEndDate.setDateFormat("yyyy");$.dteFcstStartDate.setStyle("zIndex","10");$.dteFcstEndDate.setStyle("zIndex","10");$.htmlEditMsg.setStyle("color","red");$.htmlExdSalesMsg.setStyle("color","red");$.htmlExfsalesMsg.setStyle("color","red");$.htmlExpenseMsg.setStyle("color","red");$.btnExdsalesUpdate.setClass("btn_new");$.btnExfsalesUpdate.setClass("btn_new");$.btnExpenseUpdate.setClass("btn_new");$.txtVerName.setAllowBlank(false,"버전명");$.dteFy.setAllowBlank(false,"기준FY");$.cmbBudgetType.setAllowBlank(false,"예산기준");$.dteFcstStartDate.setEnable(false);$.cmbBudgetType.setEmptyRow(true);$.cmbUseStatus.setEmptyRow(true);$.grdList.setColumns([new FingerDataGridColumn("ver_code",100,"left","string","버전코드"),new FingerDataGridColumn("ver_name",208,"left","string","버전명"),new FingerDataGridColumn("fy",70,"left","left","기준FY"),new FingerDataGridColumn("budget_type",100,"left","string","예산기준"),new FingerDataGridColumn("sort_seq",80,"right","int","정렬순서",{format:"int"}),new FingerDataGridColumn("edit_yn",100,"left","string","편집가능여부"),new FingerDataGridColumn("use_status",90,"left","string","Open상태"),new FingerDataGridColumn("update_time",140,"left","string","최종업데이트"),new FingerDataGridColumn("emp_name",100,"left","string","업데이트유저")]);$.grdList.init({panel:$.panList,scroll:"xy"});$.grdList.setBorder(false);$.grdFCST.setColumns([new FingerDataGridColumn("fy",220,"left","string","FY",{readonly:true}),new FingerDataGridColumn("spread",223,"left","string","입력기준")]);$.grdFCST.init();$.grdFCST.setEditable(true);$.grdFCST.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTree);$.panMain.add($.panList);$.panMain.add($.panDetail);$.panMain.add($.panFCST);$.panMain.add($.dteFcstStartDate);$.panMain.add($.dteFcstEndDate);$.panMain.add($.lblEx1);$.panTree.add($.treeSort);$.panList.add($.grdList);$.panDetail.add($.dteFy);$.panDetail.add($.lblFy);$.panDetail.add($.txtVerName);$.panDetail.add($.lblVerName);$.panDetail.add($.txtVerCode);$.panDetail.add($.lblVerCode);$.panDetail.add($.dteExdsalesActualYm);$.panDetail.add($.lblExdsalesActualYm);$.panDetail.add($.chkEditYn);$.panDetail.add($.lblEditYn);$.panDetail.add($.cmbBudgetType);$.panDetail.add($.lblBudgetType);$.panDetail.add($.lblUseStatus);$.panDetail.add($.cmbUseStatus);$.panDetail.add($.lblSortSeq);$.panDetail.add($.speSortSeq);$.panDetail.add($.lblExfsalesActualYm);$.panDetail.add($.dteExfsalesActualYm);$.panDetail.add($.lblCreateUser);$.panDetail.add($.txtCreateUser);$.panDetail.add($.lblUpdateTime);$.panDetail.add($.lblExpenseActualYm);$.panDetail.add($.dteExpenseActualYm);$.panDetail.add($.htmlEditMsg);$.panDetail.add($.htmlExdSalesMsg);$.panDetail.add($.htmlExfsalesMsg);$.panDetail.add($.htmlExpenseMsg);$.panDetail.add($.btnExdsalesUpdate);$.panDetail.add($.btnExfsalesUpdate);$.panDetail.add($.btnExpenseUpdate);$.panDetail.add($.txtUpdateTime);$.panFCST.add($.grdFCST);relocateChildIndexInPanel([$.panDetail]);var ds=bizComponentData2($,"Q1","L_BGT001|L_BGT002|L_BGT003|L_BGT004");$.grdList.setColumnDropDownList("edit_yn",ds.resultList[0]);$.grdList.setColumnDropDownList("use_status",ds.resultList[1]);$.grdList.setColumnDropDownList("budget_type",ds.resultList[2]);$.grdFCST.setColumnDropDownList("spread",ds.resultList[3]);setComboBind([null,$.cmbUseStatus,$.cmbBudgetType],ds);setDetailPanel(true);selectBudgetVersion()};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);if($.verCode){var index=$.grdList.getGridRowIndex("ver_code",$.verCode);$.grdList.selectRow(index)}}else{if(type=="Q_TREE"){$.treeSort.clearAll();$.treeSort.load(ds.resultList[0],"id","parent_id","name","icon")}else{if(type=="Q_DETAIL"){if(ds&&ds.errorCode=="MSG0001"){var rs=ds.resultList[0][0];$.txtVerCode.setValue(rs.ver_code);$.txtVerName.setValue(rs.ver_name);$.dteFy.setValue(rs.fy);$.cmbBudgetType.setValue(rs.budget_type);$.chkEditYn.setValue(rs.edit_yn);$.dteExdsalesActualYm.setValue(rs.exdsales_actual_ym);$.cmbUseStatus.setValue(rs.use_status);$.speSortSeq.setValue(rs.sort_seq);$.dteExfsalesActualYm.setValue(rs.exfsales_actual_ym);$.txtCreateUser.setValue(rs.emp_name);$.txtUpdateTime.setValue(rs.update_time);$.dteExpenseActualYm.setValue(rs.expense_actual_ym);$.htmlExdSalesMsg.setValue(rs.exdsales_update_time);$.htmlExfsalesMsg.setValue(rs.exfsales_update_time);$.htmlExpenseMsg.setValue(rs.expense_update_time);comboBudgetTypeEvent(rs.budget_type);profitBtnEnable(rs.budget_type);setSaveStatus("U");searchList("Q_FCST")}}else{if(type=="Q_FCST"){setDataGrid([$.grdFCST],ds);if(ds){if(ds.errorCode=="MSG0001"){var index=$.grdFCST.getRowCount()-1;var maxFY=$.grdFCST.getValue(index,"fy");$.fcstGridChange=false;$.dteFcstEndDate.setValue(maxFY);$.fcstGridChange=true}else{$.dteFcstEndDate.setValue("")}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnExdsalesUpdate"){if(!$.dteExdsalesActualYm.getValue()){MessageBoxShow("소화실적기준을 입력하세요.");return}MessageBoxShow("준비중입니다")}else{if(id=="btnExfsalesUpdate"){if(!$.dteExfsalesActualYm.getValue()){MessageBoxShow("납품실적기준월을 입력하세요.");return}MessageBoxShow("준비중입니다")}else{if(id=="btnExpenseUpdate"){if(!$.dteExpenseActualYm.getValue()){MessageBoxShow("비용실적기준월을 입력하세요.");return}MessageBoxShow("준비중입니다")}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbBudgetType"){comboBudgetTypeEvent(value)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteFy"){$.dteFcstStartDate.setValue(value);var startFY=$.dteFcstStartDate.getValue();var endFY=$.dteFcstEndDate.getValue();if(startFY&&endFY){$.grdFCST.clear();setFcstDate(startFY,endFY)}}else{if(id=="dteFcstEndDate"){var startFY=$.dteFcstStartDate.getValue();var endFY=value;if(!endFY||!$.fcstGridChange){return}if(startFY>endFY){MessageBoxShow("시작 기간보다 빠릅니다.");$.dteFcstEndDate.setValue("");return}$.grdFCST.clear();setFcstDate(startFY,endFY)}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){var rowData=$.grdList.getValue(rId);$.verCode=rowData.ver_code;searchList("Q_DETAIL")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDetail"){if(btnId=="btnNew"){initView()}else{if(btnId=="btnSave"){if(!$.panDetail.validateControls()){return}var msg=($.workTypeStr=="N"?"신규 등록":"수정")+" 하시겠습니까?";confirmBoxShow(msg,function(){if(g_main.msgShare==true){saveDetail()}})}else{if(btnId=="btnDelete"){var rId=$.grdList.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 내역이 없습니다.");return}var msg="삭제 하시겠습니까?";confirmBoxShow(msg,function(){if(g_main.msgShare==true){$.workTypeStr="D";saveDetail()}})}else{if(btnId=="btnVersionCopy"){MessageBoxShow("준비중입니다")}}}}}else{if(panelId=="panFCST"){if(btnId=="btnSave"){if(!$.txtVerCode.getValue()){MessageBoxShow("이미 등록된 버전만 FCST 등록이 가능합니다.");return}if($.grdFCST.getRowCount()<1){MessageBoxShow("저장할 내역이 없습니다..");return}for(var i=0;i<$.grdFCST.getRowCount();i++){var rowData=$.grdFCST.getValue(i);if(!rowData.spread){MessageBoxShow("FCST 입력기준은 필수 입력입니다.");$.grdFCST.selectRow(i);return}}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveFcst("N_FCST")}})}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){if(id=="treeSort"){initView();if(value.parent=="#"){$.selBudgetType="";$.selFY=""}else{if(value.parent=="BUDGET_TYPE"){$.selBudgetType=value.id;$.selFY=""}else{$.selBudgetType="";$.selFY=value.id}}searchList("Q")}};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){if(id=="treeSort"){$.treeSort.expandAll()}};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>