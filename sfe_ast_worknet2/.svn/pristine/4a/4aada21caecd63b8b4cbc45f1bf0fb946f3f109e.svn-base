<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panList=null;$.panDetail=null;$.panTab1=null;$.panTab2=null;$.tabMain=null;$.lblTitle=null;$.lblContents=null;$.txtTitle=null;$.txtContents=null;$.grdList=null;$.lblDTitle=null;$.lblDParent=null;$.lblDSeq=null;$.txtDTitle=null;$.bteDParent=null;$.speDSeq=null;$.chkCategory=null;$.chkUse=null;$.btnSearch=null;$.btnLink=null;$.btnFileList=null;$.btnAddFile=null;$.webContents=null;$.grdFile=null;$.varMoralId="";$.varDeleteFiles=[];function createJSON_Q(workType,moralId){var json=createExecuteParamInfo("P_MOR1000_Q1",[workType,$.txtTitle.getValue()||"",$.txtContents.getValue()||"",moralId]);return json}function createJSON_S1(workType){var json=createExecuteParamInfo("P_MOR1000_S1",[workType,$.varMoralId,$.txtDTitle.getValue()||"",$.bteDParent.getValue()||"",$.chkCategory.getValue()=="Y"||$.chkCategory.getValue()==true?"Y":"N",$.chkUse.getValue()=="Y"||$.chkUse.getValue()==true?"Y":"N",$.webContents.getHTML(),$.webContents.getHTML(),$.speDSeq.getValue()||0,"#UserID#"]);return json}function createJSON_S2(workType){var json="";var cRow=$.grdFile.getChangedRows();if(cRow.length<1&&$.varDeleteFiles.length<1){return}if($.varDeleteFiles.length>0){for(var i in $.varDeleteFiles){cRow.push($.varDeleteFiles[i])}}var rows=[];for(var i in cRow){rows.push([cRow[i].rowType,$.varMoralId,Number(cRow[i].seq),cRow[i].local_fname,cRow[i].server_fname,"MOR/"+cRow[i].server_path,"#UserID#"])}json=createExecuteParamInfo("P_MOR1000_S2",rows);return json}function searchMOR1000(workType,moralId){var json=createJSON_Q(workType,moralId);callQuery(["req",json],workType,$)}function saveMOR1000(workType){var json=createJSON_S1(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"||ds.errorCode=="MSG0004"){if(workType=="N"){$.varMoralId=ds.returnStr}else{if(workType=="D"){$.varMoralId=""}}if(workType!="D"&&($.grdFile.getChangedRows().length>0||$.varDeleteFiles.length>0)){saveMOR1000Files("N")}else{searchMOR1000("TREE","")}}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("등록도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0030"){MessageBoxShow("수정도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0031"){MessageBoxShow("삭제도중 오류가 발생하였습니다.");return}}}}}}function saveMOR1000Files(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds){if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"){searchMOR1000("TREE","")}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("파일등록도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0031"){MessageBoxShow("파일삭제도중 오류가 발생하였습니다.");return}}}}else{searchMOR1000("TREE","")}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,815);$.panMain.setText("");$.panMain.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,0,350,800);$.panList.setText("윤리강령 리스트");$.panList.setBottomLine(true);$.panDetail=new FingerPanel(host,"panDetail",360,0,840,800);$.panDetail.setText("기본정보");$.panDetail.setBottomLine(true);$.panTab1=new FingerPanel(host,"panTab1",0,0,840,620);$.panTab1.setText("");$.panTab1.setBottomLine(true);$.panTab2=new FingerPanel(host,"panTab2",0,0,840,620);$.panTab2.setText("첨부파일");$.panTab2.setBottomLine(true);$.tabMain=new FingerTab(host,"tabMain",0,105,840,650);$.lblTitle=new FingerLabel(host,"lblTitle",0,10,60,20);$.lblTitle.setText("제목");$.lblContents=new FingerLabel(host,"lblContents",0,40,60,20);$.lblContents.setText("내용");$.txtTitle=new FingerEdit(host,"txtTitle",65,10,250,20);$.txtContents=new FingerEdit(host,"txtContents",65,40,250,20);$.grdList=new FingerDataGrid(host,"grdList",0,80,350,670);$.lblDTitle=new FingerLabel(host,"lblDTitle",0,10,100,20);$.lblDTitle.setText("제목");$.lblDParent=new FingerLabel(host,"lblDParent",0,40,100,20);$.lblDParent.setText("상위윤령");$.lblDSeq=new FingerLabel(host,"lblDSeq",0,70,100,20);$.lblDSeq.setText("정렬순서");$.txtDTitle=new FingerEdit(host,"txtDTitle",105,10,320,20);$.bteDParent=new FingerButtonEdit(host,"bteDParent",105,40,320,20);$.bteDParent.setText("");$.speDSeq=new FingerSpinEdit(host,"speDSeq",105,70,140,20);$.chkCategory=new FingerCheckBox(host,"chkCategory",265,70,100,20);$.chkCategory.setText("목차여부");$.chkUse=new FingerCheckBox(host,"chkUse",350,70,100,20);$.chkUse.setText("사용여부");$.btnSearch=new FingerButton(host,"btnSearch",270,-37.5,80,20);$.btnSearch.setText("조회");$.btnLink=new FingerButton(host,"btnLink",550,10,100,20);$.btnLink.setText("문서링크");$.btnFileList=new FingerButton(host,"btnFileList",635,10,120,20);$.btnFileList.setText("첨부파일목록");$.btnAddFile=new FingerButton(host,"btnAddFile",740,10,100,20);$.btnAddFile.setText("파일첨부");$.webContents=new FingerWebEditor(host,"webContents",0,45,840,575);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,840,620);$.panDetail.addButtons(["btnDelete","btnSave","btnNew"]);$.panTab2.addButtons(["btnDelete","btnAdd"]);$.grdList.setColumns([new FingerDataGridColumn("moral_id",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("title",330,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("sort_seq",99,"left","string","정렬순서",{hidden:true})]);$.grdList.init({view:"treetable",treeKey:{id:"KeyID",parent:"ParentID"}});$.grdList.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("moral_id",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("seq",99,"left","string","일련번호",{hidden:true}),new FingerDataGridColumn("local_fname",820,"left","string","파일명"),new FingerDataGridColumn("server_fname",99,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("server_path",99,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("file_path",99,"left","string","로컬파일경로",{hidden:true})]);$.grdFile.init({panel:$.panTab2});$.grdFile.setBorder(false);$.txtDTitle.setAllowBlank(false,"제목");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panList);$.panMain.add($.panDetail);$.panMain.add($.panTab1);$.panMain.add($.panTab2);$.panList.add($.lblTitle);$.panList.add($.lblContents);$.panList.add($.txtTitle);$.panList.add($.grdList);$.panList.add($.btnSearch);$.panList.add($.txtContents);$.panDetail.add($.tabMain);$.panDetail.add($.lblDTitle);$.panDetail.add($.lblDParent);$.panDetail.add($.lblDSeq);$.panDetail.add($.txtDTitle);$.panDetail.add($.bteDParent);$.panDetail.add($.speDSeq);$.panDetail.add($.chkCategory);$.panDetail.add($.chkUse);$.panTab1.add($.btnLink);$.panTab1.add($.btnFileList);$.panTab1.add($.btnAddFile);$.panTab1.add($.webContents);$.panTab2.add($.grdFile);$.tabMain.addTab([{text:"컨텐츠",body:$.panTab1},{text:"첨부파일",body:$.panTab2}]);searchMOR1000("TREE","");relocateChildIndexInPanel([$.panList])};$.callback=function(type,ds){if(type=="TREE"){setDataGrid([$.grdList],ds);$.grdList.openNode("all");if($.varMoralId!=""){$.grdList.selectRow($.grdList.getGridRowIndex("moral_id",$.varMoralId,0))}else{$.grdList.selectRow(0)}}else{if(type=="Q1"){var rs=ds.resultList[0][0];$.varMoralId=rs.moral_id;$.bteDParent.setValue(rs.parent_moral_id);$.txtDTitle.setValue(rs.title);$.bteDParent.setText(rs.parent_moral_title);$.speDSeq.setValue(rs.sort_seq);$.chkCategory.setValue(rs.category_yn);$.chkUse.setValue(rs.use_yn);setDataGrid([null,null,$.grdFile],ds);setTimeout(function(){$.webContents.setValue(ds.resultList[1][0].contents_html)},100)}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchMOR1000("TREE","")}else{if(id=="btnLink"){$.popUpCallId=id;var param={type:"L",title:""};g_main.openPopup("popMORList.html","popMORList","윤리강령 리스트",0,0,"","",param,"","")}else{if(id=="btnAddFile"){OpenFileUploader("MOR",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnDownLoad"){var rId=$.grdFile.getSelectedRowIdx();var download_url=("MOR"+$.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"));g_fileBrowser.download(download_url)}else{if(id=="btnFileList"){$.popUpCallId=id;var param={};g_main.openPopup("popMORFileList.html","popMORFileList","첨부파일 리스트",403,500,"","",param,"","")}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteDParent"){var param={type:"P",title:$.bteDParent.getText()};g_main.openPopup("popMORList.html","popMORList","윤리강령 리스트",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){$.popUpCallId=id;if(id=="bteDParent"&&value=="13"){var param={type:"P",title:$.bteDParent.getText()};g_main.openPopup("popMORList.html","popMORList","윤리강령 리스트",0,0,"","",param,"","")}};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){searchMOR1000("Q1",$.grdList.getValue(rId,"moral_id"))}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txtTitle"||id=="txtContents")&&value=="13"){searchMOR1000("TREE","")}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDetail"){if(btnId=="btnNew"){$.varMoralId="";$.panDetail.clear();$.webContents.setValue("");$.grdFile.setData("");$.chkUse.setValue("Y");$.txtDTitle.setFocus()}else{if(btnId=="btnSave"){if(!validateControls([$.txtDTitle])){return}saveMOR1000($.varMoralId==""?"N":"U")}else{if(btnId=="btnDelete"){if($.varMoralId==""){return}confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveMOR1000("D")}})}}}}else{if(panelId=="panTab2"){if(btnId=="btnAdd"){OpenFileUploader("MOR",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}var maxSeq=0;var fileList=$.grdFile.getAllRows();var rs=ds.resultList[0];for(var i in fileList){maxSeq=maxSeq<fileList[i].seq?fileList[i].seq:maxSeq}for(var i in rs){rs[i].seq=maxSeq+i+1}$.grdFile.addRows(rs)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.varDeleteFiles.push({rowType:"D",moral_id:"",seq:$.grdFile.getValue(rId,"seq"),local_fname:$.grdFile.getValue(rId,"local_fname"),server_fname:$.grdFile.getValue(rId,"server_fname"),server_path:$.grdFile.getValue(rId,"server_path"),file_path:$.grdFile.getValue(rId,"file_path"),});$.grdFile.deleteCurrentRow()}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult!=null){if(id=="popMORList"){if($.popUpCallId=="bteDParent"){$.bteDParent.setValue(popResult.moral_id);$.bteDParent.setText(popResult.title)}else{if($.popUpCallId=="btnLink"){var caption=popResult.title.split("/");if(caption[0]){$.webContents.setValue($.webContents.getHTML()+"<a class='doc' onclick='g_currentModule.clickDocumentLink(\""+caption[0]+"\")'><img align='middle' src='./images/icon/editor/p_txt_s.gif'>"+caption[1]+"</a>")}else{$.webContents.setValue($.webContents.getHTML()+"<a href='"+caption[1]+"'>"+caption[1]+"</a>")}}}}else{if(id=="popMORFileList"){if($.popUpCallId=="btnFileList"){$.webContents.setValue($.webContents.getHTML()+popResult.local_fname)}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>