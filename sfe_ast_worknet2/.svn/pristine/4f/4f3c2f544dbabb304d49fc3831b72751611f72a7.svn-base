<script>function Main(){var $=this;$.host=null;$.panMain=null;$.grdList=null;$.btnReceive=null;$.btnSuccess=null;$.btnCancel=null;$.lblApprovalAmt=null;$.speApprovalAmt=null;$.lblLabel1=null;$.lblLabel2=null;$.speReceiptCnt=null;$.panFooter=null;$.btnMemoSave=null;$.varApprovalNo1="";$.varApprovalNo2="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmCardApprovalSub_Q",[workType,"#UserID#"]);return json}function createJSON_S(workType){var bResult=false;var rows=[];for(var i=0;i<$.grdList.getRowCount();i++){if(workType=="FTRFLG20"){if($.grdList.getValue(i,"CHECKYN")=="Y"||$.grdList.getValue(i,"CHECKYN")==true){rows.push([workType,$.grdList.getValue(i,"APPDAT"),$.grdList.getValue(i,"CARDNO"),$.grdList.getValue(i,"APPRNO"),$.grdList.getValue(i,"MEMO"),"","","#UserID#"]);bResult=true}}else{if(workType=="RECEIVE"){if(($.grdList.getValue(i,"CHECKYN")=="Y"||$.grdList.getValue(i,"CHECKYN")==true)&&$.grdList.getValue(i,"FTRFLG")=="00"){rows.push([workType,$.grdList.getValue(i,"APPDAT"),$.grdList.getValue(i,"CARDNO"),$.grdList.getValue(i,"APPRNO"),$.grdList.getValue(i,"MEMO"),"","","#UserID#"]);bResult=true}}else{if(workType=="MEMOSAVE"){if(($.grdList.getValue(i,"CHECKYN")=="Y"||$.grdList.getValue(i,"CHECKYN")==true)){rows.push([workType,$.grdList.getValue(i,"APPDAT"),$.grdList.getValue(i,"CARDNO"),$.grdList.getValue(i,"APPRNO"),$.grdList.getValue(i,"MEMO"),"","","#UserID#"]);bResult=true}}}}}if(bResult){var json=createExecuteParamInfo("P_crmBCARDMAS_S",rows);return json}else{return false}}function searchList(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveBCARDMAS(workType){var json=createJSON_S(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);log(ds);if(workType=="FTRFLG20"||workType=="MEMOSAVE"){if(ds&&ds.errorCode=="MSG0000"){return true}else{return false}}else{searchList("Q");$.speApprovalAmt.setValue(0)}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1100,385);$.panMain.setText("");$.panMain.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1100,320);$.btnReceive=new FingerButton(host,"btnReceive",20,20,120,20);$.btnReceive.setText("영수증받기");$.btnSuccess=new FingerButton(host,"btnSuccess",955,20,80,20);$.btnSuccess.setText("확인");$.btnCancel=new FingerButton(host,"btnCancel",1020,20,80,20);$.btnCancel.setText("취소");$.lblApprovalAmt=new FingerLabel(host,"lblApprovalAmt",620,20,100,20);$.lblApprovalAmt.setText("승인금액 계");$.speApprovalAmt=new FingerSpinEdit(host,"speApprovalAmt",725,20,140,20);$.lblLabel1=new FingerLabel(host,"lblLabel1",165,20,120,20);$.lblLabel1.setText("전달받은 영수증");$.lblLabel2=new FingerLabel(host,"lblLabel2",350,20,20,20);$.lblLabel2.setText("개");$.speReceiptCnt=new FingerSpinEdit(host,"speReceiptCnt",290,20,60,20);$.panFooter=new FingerPanel(host,"panFooter",0,320,1100,65);$.panFooter.setText("");$.panFooter.setBottomLine(true);$.btnMemoSave=new FingerButton(host,"btnMemoSave",130,20,120,20);$.btnMemoSave.setText("메모 저장");$.speApprovalAmt.setReadOnly(true);$.btnReceive.setEnable(false);$.lblLabel1.setVisible(false);$.lblLabel2.setVisible(false);$.speReceiptCnt.setVisible(false);$.grdList.setColumns([new FingerDataGridColumn("CHECKYN",50,"center","checkbox","선택"),new FingerDataGridColumn("FTRFLG",75,"center","string","구분",{readonly:true}),new FingerDataGridColumn("APPDAT",115,"center","string","승인시간",{readonly:true}),new FingerDataGridColumn("CARDNO",99,"center","string","카드번호",{readonly:true}),new FingerDataGridColumn("CARDNM",230,"center","string","카드정보",{readonly:true}),new FingerDataGridColumn("APPRNO",85,"left","string","승인번호",{readonly:true}),new FingerDataGridColumn("CURREN",55,"center","string","통화",{readonly:true}),new FingerDataGridColumn("APPAMT",100,"right","string","승인금액(KRW)",{format:"int",readonly:true}),new FingerDataGridColumn("EXCRAT",99,"right","string","환율",{readonly:true}),new FingerDataGridColumn("TAXAMT",75,"right","string","세금",{format:"int",readonly:true}),new FingerDataGridColumn("VENKNM",170,"left","string","가맹점",{readonly:true}),new FingerDataGridColumn("ORGVENKNM",160,"left","string","실가맹점",{readonly:true}),new FingerDataGridColumn("VENGRP",150,"left","string","업태분류",{readonly:true}),new FingerDataGridColumn("MEMO",300,"left","string","메모"),new FingerDataGridColumn("KNAME",99,"left","string","한글명",{readonly:true}),new FingerDataGridColumn("EMPNUM",99,"left","string","사원번호",{readonly:true}),new FingerDataGridColumn("VENADD",99,"left","string","가맹점 주소",{readonly:true}),new FingerDataGridColumn("bank",99,"left","string","은행",{readonly:true}),new FingerDataGridColumn("account",99,"left","string","계좌번호",{readonly:true}),new FingerDataGridColumn("bank_account",99,"left","string","입금계좌",{readonly:true}),new FingerDataGridColumn("acct_name",99,"left","string","예금주",{readonly:true})]);$.grdList.init({panel:$.panList,scroll:"xy"});$.grdList.setEditable(true);$.grdList.setColumnHidden(["CARDNO","EXCRAT","KNAME","EMPNUM","VENADD","BANK","ACCOUNT","BANK_ACCOUNT","ACCT_NAME"],true);$.grdList.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.grdList);$.panMain.add($.panFooter);$.panFooter.add($.speReceiptCnt);$.panFooter.add($.lblLabel2);$.panFooter.add($.lblLabel1);$.panFooter.add($.speApprovalAmt);$.panFooter.add($.lblApprovalAmt);$.panFooter.add($.btnCancel);$.panFooter.add($.btnSuccess);$.panFooter.add($.btnReceive);$.panFooter.add($.btnMemoSave);$.varNonFooter=false;if($.p_argument){if($.p_argument.nonFooter){$.varNonFooter=true}}if($.varNonFooter){if($.p_argument.home_yn){$.btnSuccess.setVisible(false)}else{$.panFooter.setVisible(false);$.grdList.setSize(1100,380);$.grdList.setColumnHidden(["CHECKYN"],true)}}searchList("Q");searchList("Q1");var ds=bizComponentData2($,"Q2","L_CRM0050");$.grdList.setColumnDropDownList("FTRFLG",ds.resultList[0])};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);var isReceive=false;var userId=g_main.session.obj.UserID;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"FTRFLG")=="00"){isReceive=true;break}}if(isReceive){$.btnReceive.setEnable(true)}else{$.btnReceive.setEnable(false)}}else{if(type=="Q1"){$.speApprovalAmt.setValue(ds.resultList[0][0].receipt_cnt)}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnReceive"){for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"CHECKYN")=="Y"||$.grdList.getValue(i,"CHECKYN")==true){if($.grdList.getValue(i,"FTRFLG")!="00"){MessageBoxShow("전달 대기중인 영수증만 선택가능합니다.");return}}}saveBCARDMAS("RECEIVE")}else{if(id=="btnSuccess"){if($.grdList.getRowCount()<=0){return}var params=[];for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"CHECKYN")=="Y"){if($.grdList.getValue(i,"FTRFLG")=="00"){MessageBoxShow("전 대기중인 영수증이 선택되었습니다. 연수증 받기를 먼저 진행해 주시기 바랍니다.");return}params.push({FTRFLG:$.grdList.getValue(i,"FTRFLG"),FTRFLG_NAME:$.grdList.getValue(i,"FTRFLG_NAME"),APPDAT:$.grdList.getValue(i,"APPDAT"),CARDNO:$.grdList.getValue(i,"CARDNO"),CARDNM:$.grdList.getValue(i,"CARDNM"),APPRNO:$.grdList.getValue(i,"APPRNO"),APPAMT:$.grdList.getValue(i,"APPAMT"),EXCRAT:$.grdList.getValue(i,"EXCRAT"),TAXAMT:$.grdList.getValue(i,"TAXAMT"),VENKNM:$.grdList.getValue(i,"VENKNM"),ORGVENKNM:$.grdList.getValue(i,"ORGVENKNM"),VENGRP:$.grdList.getValue(i,"VENGRP"),MEMO:$.grdList.getValue(i,"MEMO"),KNAME:$.grdList.getValue(i,"KNAME"),EMPNUM:$.grdList.getValue(i,"EMPNUM"),VENADD:$.grdList.getValue(i,"VENADD"),BANK:$.grdList.getValue(i,"bank"),ACCOUNT:$.grdList.getValue(i,"account"),BANK_ACCOUNT:$.grdList.getValue(i,"bank_account"),ACCT_NAME:$.grdList.getValue(i,"acct_name"),EMAIL:$.grdList.getValue(i,"email")})}}if(saveBCARDMAS("FTRFLG20")){g_popupStack.setData(params);g_popupStack.close()}else{MessageBoxShow("존재 하지 않는 카드정보입니다. 다시 확인해 주세요.");return}}else{if(id=="btnCancel"){g_popupStack.close()}else{if(id=="btnMemoSave"){if(saveBCARDMAS("MEMOSAVE")){g_popupStack.setData(params);g_popupStack.close()}else{MessageBoxShow("메모 저장 시 오류가 발생했습니다.");return}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList"){if(cInd=="CHECKYN"){if($.grdList.getValue(rId,"FTRFLG")!="10"&&$.grdList.getValue(rId,"FTRFLG")!="00"){$.grdList.setValue(rId,cInd,"N");return}var sumAmt=0;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"CHECKYN")=="Y"||$.grdList.getValue(i,"CHECKYN")==true){sumAmt+=Number($.grdList.getValue(i,"APPAMT"))}}$.speApprovalAmt.setValue(sumAmt)}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>