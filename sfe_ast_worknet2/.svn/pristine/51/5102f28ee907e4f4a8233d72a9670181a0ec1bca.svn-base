<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.grdFile=null;$.grdDoc=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.wbeWFDetail=null;$.lblemployee=null;$.cboDept=null;$.cboEmployee=null;$.lblreq_date=null;$.dteReqDate=null;$.lblTargetNum=null;$.numTargetNum=null;$.lblTargetNum2=null;$.lblRoleDescr=null;$.memRoleDescr=null;$.lblPeriod=null;$.numPeriodYear=null;$.lblYear=null;$.lblMonth=null;$.numPeriodMonth=null;$.lblFeeBudget=null;$.numFeeBudget=null;$.lblFeeBudget2=null;$.lblNotice=null;$.varWfDocId="";$.varBusinessId="";$.varWFType="";function createJSON_S(workType){var json=createExecuteParamInfo("P_crmWFOutsourcingReq_S",[workType,$.varWfDocId,$.cboDept.getValue(),$.cboEmployee.getValue(),$.dteReqDate.getValue(),$.numTargetNum.getValue(),$.memRoleDescr.getValue(),$.numPeriodYear.getValue(),$.numPeriodMonth.getValue(),$.numFeeBudget.getValue()]);return json}function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFOutsourcingReq"]);return json}function searchWFDocument(workType){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function saveWFOutsourcingReq(btnId){if(!validateControls([$.txtTitle])){return}if(!validateControls([$.cboDept,$.cboEmployee,$.dteReqDate,$.numTargetNum,$.memRoleDescr,$.numPeriodYear,$.numPeriodMonth,$.numFeeBudget])){return}if($.grdFile.getRowCount()<1){MessageBoxShow("첨부파일이 등록되지 않았습니다.");return}if(btnId=="btnTmpSave"){if(saveWFDocument("","N")){saveWFOutsourcingReqS("N")}}else{if(btnId=="btnSubmit"){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFOutsourcingReq"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}}}function saveWFOutsourcingReqS(workType){var json=createJSON_S("N");callQuery(["req",json],"N",$)}function saveList(workType){var json=createJSON_S("N");callQuery(["req",json],workType,$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function moveWFGeneralProc(){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function getToday(){var date=new Date();date.setTime(date.getTime()+3*86400000);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if((""+month).length==1){month="0"+month}if((""+day).length==1){day="0"+day}return""+year+month+day}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1175);$.panMain.setText("");$.panMain.setBottomLine();$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,310);$.panWFMain.setText("기안 내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,385,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,785,440,180);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,785,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,752,235);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.lblemployee=new FingerLabel(host,"lblemployee",0,10,100,20);$.lblemployee.setText("기안자");$.cboDept=new FingerComboBox(host,"cboDept",110,10,140,20);$.cboEmployee=new FingerComboBox(host,"cboEmployee",260,10,140,20);$.lblreq_date=new FingerLabel(host,"lblreq_date",500,10,100,20);$.lblreq_date.setText("신청일");$.dteReqDate=new FingerDateEdit(host,"dteReqDate",620,10,140,20);$.lblTargetNum=new FingerLabel(host,"lblTargetNum",0,60,100,20);$.lblTargetNum.setText("모집인원");$.numTargetNum=new FingerSpinEdit(host,"numTargetNum",110,60,70,20);$.lblTargetNum2=new FingerLabel(host,"lblTargetNum2",180,60,20,20);$.lblTargetNum2.setText("명");$.lblRoleDescr=new FingerLabel(host,"lblRoleDescr",0,90,100,20);$.lblRoleDescr.setText("직무내용");$.memRoleDescr=new FingerMemoEdit(host,"memRoleDescr",110,90,350,60);$.lblPeriod=new FingerLabel(host,"lblPeriod",0,160,100,20);$.lblPeriod.setText("파견직사용기간");$.numPeriodYear=new FingerSpinEdit(host,"numPeriodYear",110,160,50,20);$.lblYear=new FingerLabel(host,"lblYear",160,160,30,20);$.lblYear.setText("년");$.lblMonth=new FingerLabel(host,"lblMonth",250,160,40,20);$.lblMonth.setText("개월");$.numPeriodMonth=new FingerSpinEdit(host,"numPeriodMonth",200,160,50,20);$.lblFeeBudget=new FingerLabel(host,"lblFeeBudget",0,190,100,20);$.lblFeeBudget.setText("지급수수료예산");$.numFeeBudget=new FingerSpinEdit(host,"numFeeBudget",110,190,80,20);$.lblFeeBudget2=new FingerLabel(host,"lblFeeBudget2",190,190,40,20);$.lblFeeBudget2.setText("만원");$.lblNotice=new FingerLabel(host,"lblNotice",0,225,400,20);$.lblNotice.setText("* 파견직 담당 상세 업무 내용을 첨부파일로 업로드 해주시기 바랍니다.");$.wfType="";$.businessId="";$.wfDocId="";$.dsDept=null;$.panTitle.setBorder(true);$.panWFMain.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.cboDept.setEnable(false);$.cboEmployee.setEnable(false);$.dteReqDate.setEnable(false);$.cboDept.setAllowBlank(false,"신청자 부서");$.cboEmployee.setAllowBlank(false,"신청자");$.dteReqDate.setAllowBlank(false,"신청일");$.numTargetNum.setAllowBlank(false,"모집인원");$.memRoleDescr.setAllowBlank(false,"직무내용");$.numPeriodYear.setAllowBlank(false,"사용기간(년)");$.numPeriodMonth.setAllowBlank(false,"사용기간(개월)");$.numFeeBudget.setAllowBlank(false,"지급수수료 예산");$.txtTitle.setAllowBlank(false,"문서제목");$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.lblemployee);$.panWFMain.add($.cboDept);$.panWFMain.add($.cboEmployee);$.panWFMain.add($.lblreq_date);$.panWFMain.add($.dteReqDate);$.panWFMain.add($.lblTargetNum);$.panWFMain.add($.numTargetNum);$.panWFMain.add($.lblTargetNum2);$.panWFMain.add($.lblRoleDescr);$.panWFMain.add($.memRoleDescr);$.panWFMain.add($.lblPeriod);$.panWFMain.add($.numPeriodYear);$.panWFMain.add($.lblYear);$.panWFMain.add($.lblMonth);$.panWFMain.add($.numPeriodMonth);$.panWFMain.add($.lblFeeBudget);$.panWFMain.add($.numFeeBudget);$.panWFMain.add($.lblFeeBudget2);$.panWFMain.add($.lblNotice);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.cboDept.addItem(g_main.session.getValue("DeptCode"),g_main.session.getValue("DeptName"));$.cboEmployee.addItem(g_main.session.getValue("EmpCode"),g_main.session.getValue("EmpName"));$.cboDept.setValue(g_main.session.obj.DeptCode);$.cboEmployee.setValue(g_main.session.obj.EmpCode);$.numPeriodYear.setMinValue(0);$.numPeriodYear.setMaxValue(2);$.numPeriodMonth.setMinValue(0);$.numPeriodMonth.setMaxValue(11);$.numFeeBudget.setMinValue(0);$.dteReqDate.setValue(getToday());searchWFDocument()};$.callback=function(type,ds){if(type=="Q3"){$.varBusinessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue(ds.resultList[0][0].business_title)}else{if(type=="N"){moveWFGeneralProc()}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];console.log(JSON.stringify(args));if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.cboDept.setValue(md.dept_code);$.cboEmployee.setValue(md.emp_code);$.dteReqDate.setValue(md.req_date);$.numTargetNum.setValue(md.target_num);$.memRoleDescr.setValue(md.role_descr);$.numPeriodYear.setValue(md.period_year);$.numPeriodMonth.setValue(md.period_month);$.numFeeBudget.setValue(md.fee_budget)}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSubmit"){saveWFOutsourcingReq(id)}else{if(id=="btnTmpSave"){saveWFOutsourcingReq(id)}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popModAppr"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveList("N")}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>