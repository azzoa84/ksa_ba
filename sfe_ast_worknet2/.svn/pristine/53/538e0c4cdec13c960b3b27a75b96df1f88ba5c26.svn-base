<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.lblEmpName=null;$.lblDeptName=null;$.lblInvoiceNo=null;$.lblIssueDate=null;$.lblDueDate=null;$.lblChargeTo=null;$.lblDescription=null;$.lblAmount=null;$.lblDebitCredit=null;$.lblDetails=null;$.txtEmpName=null;$.txtDeptName=null;$.txtInvoiceNo=null;$.dteIssueDate=null;$.dteDueDate=null;$.cmbChargeTo=null;$.txtDescription=null;$.speAmount=null;$.cmbCurrency=null;$.rdoDebitCredit=null;$.memDetails=null;$.lblCurrency=null;$.wbeWFDetail=null;$.grdFile=null;$.grdDoc=null;$.varWFDocId="";$.varBusinessId="";$.varWFType="";$.type="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFInvoice"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmWFInvoice_Q",[workType,"#UserID#"]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmWFInvoiceD_S",[workType,$.varWfDocId,"#UserID#","#DeptCode#",$.txtEmpName.getValue(),$.txtDeptName.getValue(),"",$.dteIssueDate.getValue(),$.dteDueDate.getValue(),$.cmbChargeTo.getValue(),$.txtDescription.getValue(),$.speAmount.getValue(),$.cmbCurrency.getValue(),$.rdoDebitCredit.getValue(),$.memDetails.getValue()]);return json}function searchWFDocument(workType){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchInvoice(workType){var json=createJSON_Q2("Q");callQuery(["req",json],"Q",$)}function saveWFInvoice(workType){if(checkValidation()===false){return}var json=createJSON_S("N");callQuery(["req",json],"N",$)}function checkValidation(){if(!validateControls([$.txtTitle,$.txtEmpName,$.txtDeptName,$.dteIssueDate,$.dteDueDate,$.cmbChargeTo,$.cmbCurrency,$.txtDescription])){return false}if($.speAmount.getValue()==0||$.speAmount.getValue()==""){MessageBoxShow("Amount 은(는) 필수입력 항목 입니다.");return false}else{if(!$.rdoDebitCredit.getValue()){MessageBoxShow("Debit/Credit 은(는) 필수입력 항목 입니다.");return false}}return true}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1200);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,420);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,500,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(false);$.panFile=new FingerPanel(host,"panFile",0,900,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,900,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.lblEmpName=new FingerLabel(host,"lblEmpName",5,15,100,20);$.lblEmpName.setText("발행자");$.lblDeptName=new FingerLabel(host,"lblDeptName",280,15,100,20);$.lblDeptName.setText("발행부서");$.lblInvoiceNo=new FingerLabel(host,"lblInvoiceNo",5,45,100,20);$.lblInvoiceNo.setText("Invoice No.");$.lblIssueDate=new FingerLabel(host,"lblIssueDate",5,75,100,20);$.lblIssueDate.setText("Issue Date");$.lblDueDate=new FingerLabel(host,"lblDueDate",280,75,100,20);$.lblDueDate.setText("Due Date");$.lblChargeTo=new FingerLabel(host,"lblChargeTo",0,105,100,20);$.lblChargeTo.setText("Charge to");$.lblDescription=new FingerLabel(host,"lblDescription",5,135,100,20);$.lblDescription.setText("Description");$.lblAmount=new FingerLabel(host,"lblAmount",5,165,100,20);$.lblAmount.setText("Amount");$.lblDebitCredit=new FingerLabel(host,"lblDebitCredit",5,195,100,20);$.lblDebitCredit.setText("Debit/Credit");$.lblDetails=new FingerLabel(host,"lblDetails",5,225,100,20);$.lblDetails.setText("Details");$.txtEmpName=new FingerEdit(host,"txtEmpName",110,15,140,20);$.txtDeptName=new FingerEdit(host,"txtDeptName",385,15,140,20);$.txtInvoiceNo=new FingerEdit(host,"txtInvoiceNo",110,45,415,20);$.dteIssueDate=new FingerDateEdit(host,"dteIssueDate",110,75,140,20);$.dteDueDate=new FingerDateEdit(host,"dteDueDate",385,75,140,20);$.cmbChargeTo=new FingerComboBox(host,"cmbChargeTo",110,105,415,20);$.txtDescription=new FingerEdit(host,"txtDescription",110,135,415,20);$.speAmount=new FingerSpinEdit(host,"speAmount",110,165,140,20);$.cmbCurrency=new FingerComboBox(host,"cmbCurrency",385,165,140,20);$.rdoDebitCredit=new FingerRadioBox(host,"rdoDebitCredit",110,195,140,25);$.memDetails=new FingerMemoEdit(host,"memDetails",110,225,410,130);$.lblCurrency=new FingerLabel(host,"lblCurrency",280,165,100,20);$.lblCurrency.setText("통화");$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.panTitle.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtInvoiceNo.setReadOnly(true);$.txtInvoiceNo.setValue("최종 결재 승인 후 Inovice No.가 생성됩니다.");$.txtTitle.setAllowBlank(false,"문서제목");$.txtEmpName.setAllowBlank(false,"발행자");$.txtDeptName.setAllowBlank(false,"발행부서");$.dteIssueDate.setAllowBlank(false,"Issue Date");$.dteDueDate.setAllowBlank(false,"Due Date");$.cmbChargeTo.setAllowBlank(false,"Chage to");$.txtDescription.setAllowBlank(false,"Description");$.txtDescription.setMaxLength(60);$.speAmount.setAllowBlank(false,"Amount");$.cmbCurrency.setAllowBlank(false,"통화");$.rdoDebitCredit.addButtons([{sub_code:"10",code_name:"Debit"},{sub_code:"20",code_name:"Credit"}]);$.rdoDebitCredit.setValue("10");$.cmbChargeTo.setEmptyRow(true,"");$.cmbCurrency.setEmptyRow(true,"");$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.lblEmpName);$.panWFMain.add($.lblDeptName);$.panWFMain.add($.lblInvoiceNo);$.panWFMain.add($.lblIssueDate);$.panWFMain.add($.lblDueDate);$.panWFMain.add($.lblChargeTo);$.panWFMain.add($.lblDescription);$.panWFMain.add($.lblAmount);$.panWFMain.add($.lblDebitCredit);$.panWFMain.add($.lblDetails);$.panWFMain.add($.txtEmpName);$.panWFMain.add($.txtDeptName);$.panWFMain.add($.txtInvoiceNo);$.panWFMain.add($.dteIssueDate);$.panWFMain.add($.dteDueDate);$.panWFMain.add($.cmbChargeTo);$.panWFMain.add($.txtDescription);$.panWFMain.add($.speAmount);$.panWFMain.add($.cmbCurrency);$.panWFMain.add($.rdoDebitCredit);$.panWFMain.add($.memDetails);$.panWFMain.add($.lblCurrency);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);var ds=bizComponentData2($,"Q1","L_CRM266");setComboBind([$.cmbChargeTo],ds);var ds=bizComponentData2($,"Q1","L_COM022");setComboBind([$.cmbCurrency],ds);if($.p_argument){if($.p_argument.title!=""){$.type="POP";$.dteIssueDate.setValue($.p_argument.issue_date);$.dteDueDate.setValue($.p_argument.due_date);$.txtDescription.setValue($.p_argument.description);$.speAmount.setValue($.p_argument.amount);$.cmbCurrency.setValue("0010");$.memDetails.setValue($.p_argument.details)}}searchWFDocument();searchInvoice()};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;if($.type=="POP"){$.txtTitle.setValue("["+$.p_argument.title+"]  "+result.business_title)}else{$.txtTitle.setValue(result.business_title)}}else{if(type=="Q"){var result=ds.resultList[0][0];$.txtEmpName.setValue(result.emp_name_eng);$.txtDeptName.setValue(result.dept_name_eng)}else{if(type=="N"){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param);if($.type=="POP"){g_popupStack.close()}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.txtEmpName.setValue(md.emp_name_eng);$.txtDeptName.setValue(md.dept_name_eng);$.dteIssueDate.setValue(md.issue_date);$.dteDueDate.setValue(md.due_date);$.cmbChargeTo.setValue(md.charge_to);$.txtDescription.setValue(md.description);$.speAmount.setValue(md.amount);$.cmbCurrency.setValue(md.amount_currency);$.rdoDebitCredit.setValue(md.credit_type);$.memDetails.setValue(md.details)}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(checkValidation()===false){return}var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFInvoice"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){if($.type=="POP"){MessageBoxShow("radris 업무 연동시 임시저장은 사용 불가 합니다.");return}if(saveWFDocument("","N")){saveWFInvoice()}}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(id=="btnDocDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}else{if(id=="btnFileAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnFileDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveWFInvoice()}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>