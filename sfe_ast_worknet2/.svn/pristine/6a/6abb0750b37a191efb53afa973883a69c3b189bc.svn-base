<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.btnSearch=null;$.grdList=null;$.lbl_budget_half=null;$.cmb_budget_half=null;$.lbl_Dept=null;$.cmb_Dept=null;$.lbl_Employee=null;$.cmb_Employee=null;$.lbl_Product=null;$.cmb_Product=null;$.btnHelp=null;$.btnSave=null;$.btnConfirm=null;$.lbl_budget_add=null;$.lbl_budget_add_range=null;$.pan_budget_add=null;$.isTmpSave=false;function createJson_Q(workType){var json=createExecuteParamInfo("P_crmAM_budget_adjust_Q",[workType,$.cmb_budget_half.getValue().substring(0,4),$.cmb_budget_half.getValue().substring(4,5),$.cmb_Dept.getValue(),$.cmb_Employee.getValue()||"",$.cmb_Product.getValue()]);return json}function createJson_S(workType){var rows=[];var changedRows=$.grdList.getChangedRows();if(changedRows.length==0){MessageBoxShow("저장할 내용이 존재하지 않습니다.");return false}var gRows=$.grdList.getAllRows();var budget_total=0;var budget_add_range=$.lbl_budget_add_range.getValue();for(var i in gRows){if(gRows[i].budget_add<0){MessageBoxShow("예산조정 금액은 0 보다 작을 수 없습니다.");return false}budget_total=budget_total+Number(gRows[i].budget_add)}if(setComma(budget_total)!=budget_add_range){MessageBoxShow("예산조정 합계는 조정가능예산과 동일해야 합니다.");return false}for(var i in changedRows){rows.push([workType,$.cmb_budget_half.getValue().substring(0,4),$.cmb_budget_half.getValue().substring(4,5),$.cmb_Dept.getValue(),changedRows[i].employee_id,changedRows[i].company_id,changedRows[i].sidogu_code,$.cmb_Product.getValue(),Number(changedRows[i].budget_add)])}var json=createExecuteParamInfo("P_crmAM_budget_adjust_S",rows);return json}function searchAM_budget_adjust(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function saveAM_budget_adjust(workType){if(!$.panQuery.validateControls()){return}var json=createJson_S(workType);if(!json){return}callExecute(["req",json],workType,$)}function queryClick(){searchAM_budget_adjust("Q")}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,700);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine();$.panList=new FingerPanel(host,"panList",0,65,1200,500);$.panList.setText("AM 예산");$.panList.setBottomLine(true);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,455);$.lbl_budget_half=new FingerLabel(host,"lbl_budget_half",0,15,100,20);$.lbl_budget_half.setText("년도/반기");$.cmb_budget_half=new FingerComboBox(host,"cmb_budget_half",105,15,170,20);$.lbl_Dept=new FingerLabel(host,"lbl_Dept",255,15,100,20);$.lbl_Dept.setText("부서");$.cmb_Dept=new FingerComboBox(host,"cmb_Dept",360,15,165,20);$.lbl_Employee=new FingerLabel(host,"lbl_Employee",504,15,100,20);$.lbl_Employee.setText("이름");$.cmb_Employee=new FingerComboBox(host,"cmb_Employee",610,15,140,20);$.lbl_Product=new FingerLabel(host,"lbl_Product",730,15,100,20);$.lbl_Product.setText("품목");$.cmb_Product=new FingerComboBox(host,"cmb_Product",835,15,140,20);$.btnHelp=new FingerButton(host,"btnHelp",1035,15,100,20);$.btnHelp.setText("화면안내");$.btnSave=new FingerButton(host,"btnSave",873,-40,95,30);$.btnSave.setText("임시저장");$.btnConfirm=new FingerButton(host,"btnConfirm",955,-40,95,30);$.btnConfirm.setText("확정");$.lbl_budget_add=new FingerLabel(host,"lbl_budget_add",825,465,100,20);$.lbl_budget_add.setText("조정가능예산 :");$.lbl_budget_add_range=new FingerLabel(host,"lbl_budget_add_range",945,465,100,20);$.lbl_budget_add_range.setText("");$.pan_budget_add=new FingerPanel(host,"pan_budget_add",840,575,210,30);$.pan_budget_add.setText("");$.pan_budget_add.setBottomLine(true);$.panQuery.setBorder(true);$.pan_budget_add.setBorder(true);$.cmb_budget_half.setEmptyRow(false);$.cmb_Dept.setEmptyRow(true);$.cmb_Employee.setEmptyRow(true);$.cmb_Product.setEmptyRow(true);$.cmb_budget_half.setAllowBlank(false,"년도/반기");$.cmb_Product.setAllowBlank(false,"품목");$.btnHelp.setStyle("color","orange","1");$.btnSave.setClass("btn_save");$.btnConfirm.setClass("btn_new");$.btnHelp.setVisible(false);$.lbl_budget_add_range.setStyle("text-align","right");$.lbl_budget_add.setStyle("font-weight","bold");$.lbl_budget_add.setFontColor("#e74c3c");$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("dept_name",120,"left","string",[{text:"부서",rowspan:2},""],{readonly:true,footer:{text:"",colspan:4}}),new FingerDataGridColumn("emp_name",80,"left","string",[{text:"이름",rowspan:2},""],{readonly:true}),new FingerDataGridColumn("product_name",80,"left","string",[{text:"품목",rowspan:2},""],{readonly:true}),new FingerDataGridColumn("cs_name",153,"left","string",[{text:"거래처/지역",rowspan:2},""],{readonly:true}),new FingerDataGridColumn("target_result",100,"right","int",[{text:"영업소 AM 진행 결과",colspan:3},"확정목표"],{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("target_result_share",130,"right","int",["","영업소내%"],{readonly:true,format:"percent_2",footer:{content:"summColumn"}}),new FingerDataGridColumn("target_result_growth",130,"right","int",["","확정기준성장률"],{readonly:true}),new FingerDataGridColumn("budget",130,"right","int",[{text:"예산",colspan:3},"기준예산"],{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("budget_add",130,"right","int",[{text:""},{text:"예산조정",css:"col_edit"}],{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("budget_result",130,"right","int",["","확정예산"],{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("company_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("sidogu_code",0,"left","string","",{hidden:true}),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("product_code",0,"left","string","",{hidden:true}),new FingerDataGridColumn("dept_code",0,"left","string","",{hidden:true})]);$.grdList.init({panel:$.panList,footer:true});$.grdList.setBorder(false);$.grdList.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panMain.add($.pan_budget_add);$.panQuery.add($.btnSearch);$.panQuery.add($.btnHelp);$.panQuery.add($.cmb_Product);$.panQuery.add($.lbl_Product);$.panQuery.add($.cmb_Employee);$.panQuery.add($.lbl_Employee);$.panQuery.add($.cmb_Dept);$.panQuery.add($.lbl_Dept);$.panQuery.add($.cmb_budget_half);$.panQuery.add($.lbl_budget_half);$.panList.add($.grdList);$.panList.add($.btnSave);$.panList.add($.btnConfirm);$.panList.add($.lbl_budget_add);$.panList.add($.lbl_budget_add_range);relocateChildIndexInPanel([$.panQuery]);var ds=bizComponentData2($,"Q1","L_CRM195|L_CRM0059");$.cmb_Dept.setColumn("dept_code","dept_name");$.cmb_Product.setColumn("product_code","product_name");setComboBind([$.cmb_Dept,$.cmb_Product],ds);var subQuery=" and dept_code = '"+$.cmb_Dept.getValue()+"' and delete_yn <> 'Y'";var ds2=bizComponentData2($,"Q4","L_CRM0052",subQuery);$.cmb_Employee.setColumn("employee_id","emp_name");setComboBind([$.cmb_Employee],ds2);var ds3=bizComponentData2($,"Q2","S_9999_1");setComboBind([$.cmb_budget_half],ds3);var dCode=g_main.session.obj.DeptCode;var eCode=g_main.session.obj.EmpCode;$.cmb_Dept.setValue(dCode);$.cmb_Employee.setValue(eCode);if(g_main.session.obj.DutyCode=="08"){$.cmb_Employee.setEnable(true);$.cmb_Employee.setValue("")}else{$.cmb_Employee.setEnable(false)}if(g_main.session.obj.SystemDeveloper=="Y"||dCode=="F110"||dCode.substring(0,2)=="F2"||dCode.substring(0,2)=="T2"||dCode.substring(2,4)=="90"){$.cmb_Employee.setValue("");$.cmb_Dept.setEnable(true);$.cmb_Employee.setEnable(true)}else{$.cmb_Dept.setEnable(false)}if(dCode.substring(0,2)=="F2"||dCode.substring(0,2)=="T2"||dCode.substring(2,4)=="90"){$.btnSave.setEnable(false);$.btnConfirm.setEnable(false)}else{$.btnSave.setEnable(true);$.btnConfirm.setEnable(true)}if(g_main.session.obj.EmpCode=="ka160376"){$.cmb_Dept.setValue("");$.cmb_Employee.setValue("");$.cmb_Dept.setEnable(true);$.cmb_Employee.setEnable(true)}};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);$.grdList.selectRow(0);$.lbl_budget_add_range.setText(setComma(ds.resultList[1][0].budget_add_range))}else{if(type=="S"||type=="C"){if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);return}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);return}}if($.isTmpSave){MessageBoxShow("정상적으로 저장되었습니다.");searchAM_budget_adjust("Q")}else{$.isTmpSave=true;saveAM_budget_adjust("C")}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){queryClick()}else{if(id=="btnSave"){$.isTmpSave=true;saveAM_budget_adjust("S")}else{if(id=="btnConfirm"){$.isTmpSave=false;saveAM_budget_adjust("S")}else{if(id=="btnHelp"){g_fileBrowser.download(getServerFileUrl("AMFiles/AM 예산조정 화면 안내.pdf"))}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmb_Dept"){$.cmb_Employee.clear();var subQuery=" and dept_code = '"+$.cmb_Dept.getValue()+"' and delete_yn <> 'Y'";var ds=bizComponentData2($,"Q4","L_CRM0052",subQuery);$.cmb_Employee.setColumn("employee_id","emp_name");setComboBind([$.cmb_Employee],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>