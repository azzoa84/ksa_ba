<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.grdList=null;$.lblYear=null;$.lblEmp=null;$.bteEmp=null;$.cmbYear=null;$.lblEvalMonth=null;$.cmbEvalMonth=null;$.lblEmployeeList=null;$.cmbEmployeeList=null;$.txtEmpCode=null;$.btnApproval=null;$.btnCancel=null;function createJSON_Q(workType){var json=createExecuteParamInfo("HR..P_HRE3820_Q",[workType,$.cmbYear.getValue(),$.cmbEvalMonth.getValue(),$.cmbEmployeeList.getValue()]);return json}function createJSON_S(workType){var json="";if(workType!=""){var data=$.grdList.getAllRows();if(data.length==0){return}var rows=[];for(var i in data){var dr=data[i];rows.push([workType,dr.kpi_code||"",g_main.session.obj.UserID,"#HostInfo#"])}json=createExecuteParamInfo("HR..P_HRE3820_S",rows)}return json}function onLoad(){$.txtEmpCode.setValue(g_main.session.obj.UserID);$.bteEmp.setText(g_main.session.obj.UserName);$.cmbYear.setValue("2019");if(g_main.session.obj.HREvaluateRole!="ADMIN"){$.bteEmp.setEnable(false)}if(g_main.session.obj.DeptCode.substr(0,1)=="S"||g_main.session.obj.DeptCode.substr(0,1)=="T"){MessageBoxShow("개인별 업적승인이 불가능합니다.");$.panQuery.setEnable(false);$.btnApproval.setEnable(false);$.btnCancel.setEnable(false);$.panList.disableButton("all")}}function setReadOnly(){if($.grdList.getRowCount()<1){$.btnApproval.setEnable(false);$.btnCancel.setEnable(false)}else{if($.grdList.getValue(1,"kpi_approve_yn")=="N"){$.btnApproval.setEnable(false);$.btnCancel.setEnable(false)}else{if($.grdList.getValue(1,"kpi_approve_yn")=="Y"){$.btnApproval.setEnable(true);$.btnCancel.setEnable(true)}}}}function searchList(workType){if(!$.panQuery.validateControls()){return}var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveList(workType){if(!$.panQuery.validateControls()){return}var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$)}}function txtEmpCode_EditValueChanged(value){if(value){$.cmbEmployeeList.clear();var subQuery=" AND a.eval_year = '"+$.cmbYear.getValue()+"' and a.eval_month = '"+$.cmbEvalMonth.getValue()+"' and a.eval_evaluater2 = '"+$.txtEmpCode.getValue()+"'";var ds=bizComponentData2($,"Q4","L_HRE036",subQuery);setComboBind([$.cmbEmployeeList],ds)}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,765);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine();$.panList=new FingerPanel(host,"panList",0,65,1200,695);$.panList.setText("업적 내역");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,655);$.lblYear=new FingerLabel(host,"lblYear",0,15,100,20);$.lblYear.setText("평가년도");$.lblEmp=new FingerLabel(host,"lblEmp",545,15,60,20);$.lblEmp.setText("평가자");$.bteEmp=new FingerButtonEdit(host,"bteEmp",610,15,120,20);$.bteEmp.setText("");$.cmbYear=new FingerComboBox(host,"cmbYear",105,15,120,20);$.lblEvalMonth=new FingerLabel(host,"lblEvalMonth",240,15,70,20);$.lblEvalMonth.setText("평가명");$.cmbEvalMonth=new FingerComboBox(host,"cmbEvalMonth",315,15,205,20);$.lblEmployeeList=new FingerLabel(host,"lblEmployeeList",745,15,100,20);$.lblEmployeeList.setText("평가대상자");$.cmbEmployeeList=new FingerComboBox(host,"cmbEmployeeList",850,15,110,20);$.txtEmpCode=new FingerEdit(host,"txtEmpCode",735,15,40,20);$.btnApproval=new FingerButton(host,"btnApproval",1035,15,90,20);$.btnApproval.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",1110,15,90,20);$.btnCancel.setText("승인취소");$.cmbYear.setAllowBlank(false,"평가년도");$.cmbEvalMonth.setAllowBlank(false,"평가명");$.bteEmp.setAllowBlank(false,"성명");$.cmbEmployeeList.setAllowBlank(false,"평가대상자");$.cmbYear.setEmptyRow(true);$.cmbEmployeeList.setEmptyRow(true);$.cmbEvalMonth.setEmptyRow(true);$.cmbYear.setReadOnly(true);$.txtEmpCode.setVisible(false);$.btnApproval.setEnable(false);$.btnCancel.setEnable(false);$.cmbEmployeeList.setColumnConfig([{id:"emp_full_name",width:130},{id:"approve_yn",width:100},{id:"approve_yn",width:100},{id:"emp_code",width:1}]);$.panQuery.setBorder(true);$.grdList.setColumns([new FingerDataGridColumn("seq",50,"center","string",[{text:"",colspan:5},"순번"],{readonly:true,verticalMiddle:true}),new FingerDataGridColumn("kpi_type",90,"center","string",["","성과구분<br>(공통/개인)"],{verticalMiddle:true}),new FingerDataGridColumn("kpi_csf",200,"left","multi_line_edit",["","사업목표 달성을 위한 본인의<br>핵심 실행 과제"]),new FingerDataGridColumn("kpi_name",150,"left","multi_line_edit",["","KPI 명"]),new FingerDataGridColumn("weighted_rate",80,"center","int",["","가중치(%)"],{footer:{content:"summColumn"},verticalMiddle:true}),new FingerDataGridColumn("kpi_scale_5",200,"left","multi_line_edit",[{text:"평가척도 (Scale)",colspan:5},"5"]),new FingerDataGridColumn("kpi_scale_4",200,"left","multi_line_edit",["","4"]),new FingerDataGridColumn("kpi_scale_3",200,"left","multi_line_edit",["","3(목표)"]),new FingerDataGridColumn("kpi_scale_2",200,"left","multi_line_edit",["","2"]),new FingerDataGridColumn("kpi_scale_1",200,"left","multi_line_edit",["","1"]),new FingerDataGridColumn("kpi_code",0,"left","string","KPI코드",{hidden:true}),new FingerDataGridColumn("kpi_approve_yn",80,"left","string","1차 승인여부",{hidden:true}),new FingerDataGridColumn("kpi_approve_yn2",80,"left","string","2차 승인여부",{hidden:true}),new FingerDataGridColumn("kpi_fix_yn",80,"left","string","확정여부",{hidden:true})]);$.grdList.init({panel:$.panList,scroll:"xy",footer:true,isFilter:false,headerRowHeight:40,rowHeight:100});$.grdList.setBorder(false);$.bteEmp.setDirectSearch("#EMP#");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panQuery.add($.lblYear);$.panQuery.add($.lblEmp);$.panQuery.add($.bteEmp);$.panQuery.add($.cmbYear);$.panQuery.add($.lblEvalMonth);$.panQuery.add($.cmbEvalMonth);$.panQuery.add($.lblEmployeeList);$.panQuery.add($.cmbEmployeeList);$.panQuery.add($.txtEmpCode);$.panQuery.add($.btnApproval);$.panQuery.add($.btnCancel);$.panList.add($.grdList);$.cmbYear.setColumn("eval_year","eval_year1");$.cmbEvalMonth.setColumn("eval_month","eval_name");$.cmbEmployeeList.setColumn("emp_code","emp_full_name");$.cmbEmployeeList.setColumnConfig([{id:"emp_code",width:100},{id:"emp_full_name",width:120},{id:"approve_yn",width:100},{id:"approve_yn2",width:100}]);var ds=bizComponentData2($,"Q1","L_HRE010_2|L_HRE0090_3|L_HRE007");setComboBind([$.cmbYear,$.cmbEvalMonth],ds);$.grdList.setColumnDropDownList("kpi_type",ds.resultList[2],null,true);onLoad()};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);setReadOnly()}else{if(type=="CANCLE"||type=="APPROVE"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{if(type=="CANCLE"){MessageBoxShow("승인취소되었습니다.")}else{MessageBoxShow("승인되었습니다.")}var empcode=$.cmbEmployeeList.getValue();$.cmbEmployeeList.clear();var subQuery=" AND a.eval_year = '"+$.cmbYear.getValue()+"' and a.eval_month = '"+$.cmbEvalMonth.getValue()+"' and a.eval_evaluater2 = '"+$.txtEmpCode.getValue()+"'";var ds=bizComponentData2($,"Q4","L_HRE036",subQuery);setComboBind([$.cmbEmployeeList],ds);$.cmbEmployeeList.setValue(empcode);searchList("Q")}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList("Q")}else{if(id=="btnCancel"){if($.grdList.getRowCount()<1){return}else{if($.grdList.getValue(1,"kpi_approve_yn2")=="N"){MessageBoxShow("아직 승인되지 않았습니다.");return}else{confirmBoxShow("승인취소하시겠습니까?",function(){if(g_main.msgShare==true){saveList("CANCLE")}})}}}else{if(id=="btnApproval"){if($.grdList.getRowCount()<1){return}else{if($.grdList.getValue(1,"kpi_approve_yn")=="N"){MessageBoxShow("아직 1차 승인되지 않았습니다.");return}else{confirmBoxShow("승인처리하시겠습니까?",function(){if(g_main.msgShare==true){saveList("APPROVE")}})}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteEmp"){param={emp_name:$.bteEmp.getText()};g_main.openPopup("popEmp.html","popEmp","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){if((id=="bteEmp")&&value=="13"){$.popUpCallId=id;if(id=="bteEmp"){param={emp_name:$.bteEmp.getText()};g_main.openPopup("popEmp.html","popEmp","",0,0,"","",param,"","")}}};$.fingerbuttonedit_lostfocus=function(id,value){if(id=="bteEmp"){if(!value){$.txtEmpCode.setValue("")}}};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbYear"){if(value){$.cmbEvalMonth.clear();var subQuery=" and eval_year = '"+value+"'";var ds=bizComponentData2($,"Q4","L_HRE0090_3",subQuery);setComboBind([$.cmbEvalMonth],ds)}}else{if(id=="cmbEvalMonth"){if(value){$.cmbEmployeeList.clear();var subQuery=" AND a.eval_year = '"+$.cmbYear.getValue()+"' and a.eval_month = '"+value+"' and a.eval_evaluater2 = '"+$.txtEmpCode.getValue()+"'";var ds=bizComponentData2($,"Q4","L_HRE036",subQuery);setComboBind([$.cmbEmployeeList],ds);log(ds.resultList[0][0])}}else{if(id=="cmbEmployeeList"){if(value){searchList("Q")}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popEmp"){if($.popUpCallId=="bteEmp"){if(popResult.employee_id){$.txtEmpCode.setValue(popResult.employee_id);$.bteEmp.setText(popResult.emp_name);txtEmpCode_EditValueChanged($.cmbEvalMonth.getValue())}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>