<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.btnFileAdd=null;$.btnFileDelete=null;$.btnDocAdd=null;$.btnDocDelete=null;$.ediDetail=null;$.cmbBaseDate=null;$.panList=null;$.grdList=null;$.panDetail=null;$.lblCancelType=null;$.cmbCancelType=null;$.lblPlanType=null;$.cmbPlanType=null;$.lblPlanAmt=null;$.spePlanAmt=null;$.lblAvalAmt=null;$.speAvalAmt=null;$.lblBudgetName=null;$.txtBudgetName=null;$.lblTargetMkt=null;$.cmbTargetMkt=null;$.lblTargetBudget=null;$.cmbTargetBudget=null;$.lblPromoCode=null;$.cmbPromoCode=null;$.lblPrProductName=null;$.cmbPrProductName=null;$.lblCompanyNameList=null;$.lblSidoguNameList=null;$.bteSidoguNameList=null;$.bteCompanyNameList=null;$.grdFile=null;$.grdDoc=null;$.tmp1=null;$.tmp2=null;$.spePlanAmt2=null;$.speChangeAmt=null;$.lblPlanAmt2=null;$.lblChangeAmt=null;$.speAvalAmt2=null;$.lblAvalAmt2=null;$.bteTargetCompanyNameList=null;$.lblTargetCompanyNameList=null;$.bteTargetSidoguNameList=null;$.lblTargetSidoguNameList=null;$.cmbTargetCompanyNameList=null;$.cmbTargetSidoguNameList=null;$.cmbTargetProductName=null;$.lblTargetProductName=null;$.strplan_amt=0;$.md="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFBgtPlanCancel"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmBudgetPlan_Q",[workType,$.cmbBaseDate.getValue().substring(0,4),$.cmbBaseDate.getValue().substring(4,5),"#DeptCode#","#UserID#"]);return json}function createJSON_S(workType){var strTargetBudgetCode="";var strTargetProductCode="";var strTargetCompanyId="";var strTargetEmpCode="";strTargetBudgetCode=$.cmbTargetBudget.getValue("budget_code");if($.cmbCancelType.getValue()=="30"){strTargetProductCode=$.cmbTargetBudget.getValue("product_code")}else{if($.cmbCancelType.getValue()=="60"){strTargetProductCode=$.cmbTargetProductName.getValue()}}var json=createExecuteParamInfo("P_crmWFBudgetPlanCancelD_S",[workType,$.wfDocId,$.cmbBaseDate.getValue().substring(0,4),$.cmbBaseDate.getValue().substring(4,5),$.grdList.getValue($.grdList.getSelectedRowIdx(),"dept_code"),$.grdList.getValue($.grdList.getSelectedRowIdx(),"budget_code"),$.grdList.getValue($.grdList.getSelectedRowIdx(),"product_code"),Number($.grdList.getValue($.grdList.getSelectedRowIdx(),"plan_seq")),$.cmbCancelType.getValue(),Number($.speChangeAmt.getValue()),Number($.spePlanAmt.getValue()),Number($.speAvalAmt.getValue()),Number($.spePlanAmt2.getValue()),Number($.speAvalAmt2.getValue()),$.grdList.getValue($.rId,"plan_dept_code"),$.grdList.getValue($.rId,"plan_employee_id"),$.cmbPromoCode.getValue(),$.cmbPrProductName.getValue(),$.grdList.getValue($.rId,"sidogu_code_list"),$.bteSidoguNameList.getText(),$.bteCompanyNameList.getValue(),$.bteCompanyNameList.getText(),$.cmbTargetMkt.getValue(),strTargetBudgetCode,strTargetProductCode,$.cmbTargetSidoguNameList.getValue()||"",$.cmbTargetSidoguNameList.getText()||"",$.cmbTargetCompanyNameList.getValue()||"",$.cmbTargetCompanyNameList.getText()||"",strTargetEmpCode,$.grdList.getValue($.rId,"wf_doc_id"),Number($.grdList.getValue($.grdList.getSelectedRowIdx(),"plan_seq"))]);return json}function searchWFDocument(workType){if(workType=="Q3"){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}else{if(workType=="Q2"){var json=createJSON_Q("Q2");callQuery(["req",json],"Q2",$)}}}function searchWFBgtPlanCancel(workType){var json=createJSON_Q2("CAN");callQuery(["req",json],"CAN",$)}function saveWFBgtPlanCancel(workType){if(!validateControls([$.txtTitle,$.cmbBaseDate,$.cmbCancelType,$.cmbPlanType,$.txtBudgetName])){return}if($.grdList.getRowCount()<1||$.rId<=0){MessageBoxShow("선택된 예산사용집계 내용이 없어 상신할 수 없습니다.");return}if($.cmbCancelType.getValue()=="10"){if(!$.grdList.getValue($.rId,"plan_type")==$.cmbPlanType.getValue()){MessageBoxShow("선택한 계획구분과 다릅니다. 다시 선택해 주세요.");$.cmbPlanType.setFocus();return}if(!(Number($.grdList.getValue($.rId,"use_amt"))==0&&Number($.grdList.getValue($.rId,"hold_amt"))==0)){MessageBoxShow("사용금액과 Hold 금액이 없는 건에 대해서만 취소가 가능합니다.");return}}else{if($.cmbCancelType.getValue()=="20"){var dplan_amt=0;var dtotal_aval_amt=0;var daval_amt=0;var duse_amt=0;var dmax_amt=0;var dmin_amt=0;dplan_amt=Number($.grdList.getValue($.rId,"plan_amt"));dtotal_aval_amt=Number($.grdList.getValue($.rId,"total_aval_amt"));daval_amt=Number($.grdList.getValue($.rId,"aval_amt"));duse_amt=Number($.grdList.getValue($.rId,"use_amt"));dmax_amt=dplan_amt+dtotal_aval_amt-daval_amt;dmin_amt=duse_amt;if((Number($.speChangeAmt.getValue()))<-daval_amt||(Number($.speChangeAmt.getValue()))==0){MessageBoxShow("변경 계획금액을 잘못입력하셨습니다. 확인하여 주십시요.");$.speChangeAmt.setFocus();return}}else{if($.cmbCancelType.getValue()=="30"||$.cmbCancelType.getValue()=="40"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}if($.cmbTargetMkt.getValue()==""||$.cmbTargetBudget.getValue()==""){MessageBoxShow("이관할 부서나 예산항목을 선택해 주세요.");return}}else{if($.cmbCancelType.getValue()=="50"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}}else{if($.cmbCancelType.getValue()=="60"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}if($.cmbTargetProductName.getValue()==""){MessageBoxShow("대상 품목을 선택해 주세요.");return}}}}}}var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],workType,$,false);var bResult=false;if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{bResult=true}}return bResult}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.businessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.ediDetail,$.wfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.wfDocId=ds.returnStr}return true}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1365);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFDetail=new FingerPanel(host,"panWFDetail",0,685,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,1075,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,1075,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.btnFileAdd=new FingerButton(host,"btnFileAdd",215,-37.5,120,20);$.btnFileAdd.setText("파일추가");$.btnFileDelete=new FingerButton(host,"btnFileDelete",320,-37.5,120,20);$.btnFileDelete.setText("파일삭제");$.btnDocAdd=new FingerButton(host,"btnDocAdd",525,-37.5,120,20);$.btnDocAdd.setText("문서추가");$.btnDocDelete=new FingerButton(host,"btnDocDelete",630,-37.5,120,20);$.btnDocDelete.setText("문서삭제");$.ediDetail=new FingerWebEditor(host,"ediDetail",0,0,1200,310);$.cmbBaseDate=new FingerComboBox(host,"cmbBaseDate",875,-37.5,140,20);$.panList=new FingerPanel(host,"panList",0,65,1200,355);$.panList.setText("예산사용집계");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,310);$.panDetail=new FingerPanel(host,"panDetail",0,430,1200,250);$.panDetail.setText("사용계획");$.panDetail.setBottomLine(true);$.lblCancelType=new FingerLabel(host,"lblCancelType",0,15,100,20);$.lblCancelType.setText("구분");$.cmbCancelType=new FingerComboBox(host,"cmbCancelType",105,15,140,20);$.lblPlanType=new FingerLabel(host,"lblPlanType",250,15,100,20);$.lblPlanType.setText("계획구분");$.cmbPlanType=new FingerComboBox(host,"cmbPlanType",355,15,140,20);$.lblPlanAmt=new FingerLabel(host,"lblPlanAmt",525,15,125,20);$.lblPlanAmt.setText("변경전 계획금액");$.spePlanAmt=new FingerSpinEdit(host,"spePlanAmt",655,15,145,20);$.lblAvalAmt=new FingerLabel(host,"lblAvalAmt",825,15,100,20);$.lblAvalAmt.setText("변경전 가용금액");$.speAvalAmt=new FingerSpinEdit(host,"speAvalAmt",930,15,145,20);$.lblBudgetName=new FingerLabel(host,"lblBudgetName",0,45,100,20);$.lblBudgetName.setText("예산항목");$.txtBudgetName=new FingerEdit(host,"txtBudgetName",105,45,385,20);$.lblTargetMkt=new FingerLabel(host,"lblTargetMkt",0,75,100,20);$.lblTargetMkt.setText("대상부서");$.cmbTargetMkt=new FingerComboBox(host,"cmbTargetMkt",105,75,390,20);$.lblTargetBudget=new FingerLabel(host,"lblTargetBudget",0,105,100,20);$.lblTargetBudget.setText("대상예산");$.cmbTargetBudget=new FingerComboBox(host,"cmbTargetBudget",105,105,390,20);$.lblPromoCode=new FingerLabel(host,"lblPromoCode",550,105,100,20);$.lblPromoCode.setText("판촉항목");$.cmbPromoCode=new FingerComboBox(host,"cmbPromoCode",655,105,150,20);$.lblPrProductName=new FingerLabel(host,"lblPrProductName",825,105,100,20);$.lblPrProductName.setText("품목");$.cmbPrProductName=new FingerComboBox(host,"cmbPrProductName",930,105,150,20);$.lblCompanyNameList=new FingerLabel(host,"lblCompanyNameList",550,135,100,20);$.lblCompanyNameList.setText("거래처");$.lblSidoguNameList=new FingerLabel(host,"lblSidoguNameList",825,135,100,20);$.lblSidoguNameList.setText("지역");$.bteSidoguNameList=new FingerButtonEdit(host,"bteSidoguNameList",930,135,145,20);$.bteSidoguNameList.setText("");$.bteCompanyNameList=new FingerButtonEdit(host,"bteCompanyNameList",655,135,145,20);$.bteCompanyNameList.setText("");$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.tmp1=new FingerNumberEdit(host,"tmp1",670,75,0,0);$.tmp2=new FingerNumberEdit(host,"tmp2",670,45,0,0);$.spePlanAmt2=new FingerSpinEdit(host,"spePlanAmt2",655,75,145,20);$.speChangeAmt=new FingerSpinEdit(host,"speChangeAmt",655,45,145,20);$.lblPlanAmt2=new FingerLabel(host,"lblPlanAmt2",525,75,125,20);$.lblPlanAmt2.setText("변경후 계획금액");$.lblChangeAmt=new FingerLabel(host,"lblChangeAmt",525,45,125,20);$.lblChangeAmt.setText("변경금액");$.speAvalAmt2=new FingerSpinEdit(host,"speAvalAmt2",930,75,145,20);$.lblAvalAmt2=new FingerLabel(host,"lblAvalAmt2",825,75,100,20);$.lblAvalAmt2.setText("변경후 가용금액");$.bteTargetCompanyNameList=new FingerButtonEdit(host,"bteTargetCompanyNameList",670,165,145,20);$.bteTargetCompanyNameList.setText("");$.lblTargetCompanyNameList=new FingerLabel(host,"lblTargetCompanyNameList",0,135,100,20);$.lblTargetCompanyNameList.setText("대상거래처");$.bteTargetSidoguNameList=new FingerButtonEdit(host,"bteTargetSidoguNameList",930,165,145,20);$.bteTargetSidoguNameList.setText("");$.lblTargetSidoguNameList=new FingerLabel(host,"lblTargetSidoguNameList",265,135,60,20);$.lblTargetSidoguNameList.setText("대상지역");$.cmbTargetCompanyNameList=new FingerComboBox(host,"cmbTargetCompanyNameList",105,135,160,20);$.cmbTargetSidoguNameList=new FingerComboBox(host,"cmbTargetSidoguNameList",330,135,165,20);$.cmbTargetProductName=new FingerComboBox(host,"cmbTargetProductName",105,165,160,20);$.lblTargetProductName=new FingerLabel(host,"lblTargetProductName",0,165,100,20);$.lblTargetProductName.setText("대상품목");$.panTitle.setBorder(true);$.txtTitle.setAllowBlank(false,"문서제목");$.cmbBaseDate.setEnable(false);$.cmbBaseDate.setAllowBlank(false,"기간");$.cmbPlanType.setEnable(false);$.cmbCancelType.setAllowBlank(false,"구분");$.cmbPlanType.setAllowBlank(false,"계획구분");$.txtBudgetName.setReadOnly(true);$.txtBudgetName.setAllowBlank(false,"예산항목");$.spePlanAmt.setEnable(false);$.speAvalAmt.setEnable(false);$.speChangeAmt.setEnable(true);$.spePlanAmt2.setEnable(false);$.speAvalAmt2.setEnable(false);$.cmbPromoCode.setEnable(false);$.cmbPrProductName.setEnable(false);$.bteSidoguNameList.setEnable(false);$.bteCompanyNameList.setEnable(false);$.cmbTargetMkt.setEnable(false);$.cmbTargetBudget.setEnable(false);$.cmbCancelType.setEmptyRow(true);$.cmbPlanType.setEmptyRow(true);$.cmbTargetMkt.setEmptyRow(true);$.cmbTargetBudget.setEmptyRow(true);$.cmbPromoCode.setEmptyRow(true);$.cmbPrProductName.setEmptyRow(true);$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.bteTargetCompanyNameList.setVisible(false);$.bteTargetSidoguNameList.setVisible(false);$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetCompanyNameList.setEmptyRow(true);$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetSidoguNameList.setEmptyRow(true);$.cmbTargetProductName.setVisible(false);$.cmbTargetProductName.setEmptyRow(true);$.lblCompanyNameList.setVisible(false);$.lblSidoguNameList.setVisible(false);$.bteSidoguNameList.setVisible(false);$.bteCompanyNameList.setVisible(false);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("dept_code",100,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("plan_type",60,"left","string","구분"),new FingerDataGridColumn("doc_id",270,"left","string","결재문서번호",{hidden:true}),new FingerDataGridColumn("wf_doc_id",140,"left","string","결재문서아이디"),new FingerDataGridColumn("budget_code",90,"right","string","예산코드",{hidden:true}),new FingerDataGridColumn("budget_name",450,"left","string","예산항목"),new FingerDataGridColumn("product_code",150,"right","string","품목코드",{hidden:true}),new FingerDataGridColumn("assign_seq",150,"right","string","공유순번",{hidden:true}),new FingerDataGridColumn("plan_amt",100,"right","string","계획금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("use_amt",100,"right","string","사용금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("hold_amt",80,"right","string","결재중금액",{hidden:true}),new FingerDataGridColumn("aval_amt",100,"right","string","가용금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("total_aval_amt",100,"left","string","총가용금액",{hidden:true}),new FingerDataGridColumn("use_percent",100,"left","string","사용비율",{hidden:true}),new FingerDataGridColumn("use_count",100,"left","string","건수",{hidden:true}),new FingerDataGridColumn("share_yn",100,"left","string","공유여부",{hidden:true}),new FingerDataGridColumn("promo_budget_yn",100,"left","string","판촉예산여부",{hidden:true}),new FingerDataGridColumn("promo_code",120,"left","string","판촉항목"),new FingerDataGridColumn("pr_product_code",60,"left","string","품목"),new FingerDataGridColumn("company_id_list",100,"left","string","거래처코드",{hidden:true}),new FingerDataGridColumn("company_name_list",160,"left","string","거래처",{hidden:true}),new FingerDataGridColumn("sidogu_code_list",100,"left","string","지역코드",{hidden:true}),new FingerDataGridColumn("sidogu_name_list",150,"left","string","지역",{hidden:true}),new FingerDataGridColumn("plan_seq",100,"left","string","계획순번",{hidden:true}),new FingerDataGridColumn("plan_dept_code",100,"left","string","계획부서",{hidden:true}),new FingerDataGridColumn("plan_employee_id",100,"left","string","계획사원",{hidden:true})]);$.grdList.init({panel:$.panList,scroll:"y",footer:true});$.grdList.setEditable(false);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.btnFileAdd.setVisible(false);$.btnFileDelete.setVisible(false);$.btnDocAdd.setVisible(false);$.btnDocDelete.setVisible(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panList);$.panMain.add($.panDetail);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFDetail.add($.ediDetail);$.panFile.add($.btnFileAdd);$.panFile.add($.btnFileDelete);$.panFile.add($.grdFile);$.panDoc.add($.btnDocAdd);$.panDoc.add($.btnDocDelete);$.panDoc.add($.grdDoc);$.panList.add($.grdList);$.panList.add($.cmbBaseDate);$.panDetail.add($.lblCancelType);$.panDetail.add($.cmbCancelType);$.panDetail.add($.lblPlanType);$.panDetail.add($.cmbPlanType);$.panDetail.add($.lblPlanAmt);$.panDetail.add($.spePlanAmt);$.panDetail.add($.lblAvalAmt);$.panDetail.add($.speAvalAmt);$.panDetail.add($.lblBudgetName);$.panDetail.add($.txtBudgetName);$.panDetail.add($.lblTargetMkt);$.panDetail.add($.cmbTargetMkt);$.panDetail.add($.lblTargetBudget);$.panDetail.add($.cmbTargetBudget);$.panDetail.add($.lblPromoCode);$.panDetail.add($.cmbPromoCode);$.panDetail.add($.lblPrProductName);$.panDetail.add($.cmbPrProductName);$.panDetail.add($.lblCompanyNameList);$.panDetail.add($.lblSidoguNameList);$.panDetail.add($.bteSidoguNameList);$.panDetail.add($.bteCompanyNameList);$.panDetail.add($.spePlanAmt2);$.panDetail.add($.speChangeAmt);$.panDetail.add($.lblPlanAmt2);$.panDetail.add($.lblChangeAmt);$.panDetail.add($.speAvalAmt2);$.panDetail.add($.lblAvalAmt2);$.panDetail.add($.tmp2);$.panDetail.add($.tmp1);$.panDetail.add($.bteTargetCompanyNameList);$.panDetail.add($.lblTargetCompanyNameList);$.panDetail.add($.bteTargetSidoguNameList);$.panDetail.add($.lblTargetSidoguNameList);$.panDetail.add($.cmbTargetCompanyNameList);$.panDetail.add($.cmbTargetSidoguNameList);$.panDetail.add($.cmbTargetProductName);$.panDetail.add($.lblTargetProductName);relocateChildIndexInPanel([$.panDetail]);searchWFDocument("Q3");$.receiptStartDate="";$.receiptEndDate="";$.wfDocId="";$.varCompanyId="";$.varLocationId="";var ds=bizComponentData2($,"Q1","L_CRM0008|L_CRM0044|L_CRM0051|L_CRM0078|L_CRM0072|L_CRM0059");$.cmbBaseDate.setColumn("half_code","half_name");$.cmbTargetMkt.setColumn("dept_code","dept_name");$.cmbTargetBudget.setColumn("code","budget_name");$.cmbPromoCode.setColumn("promo_code","promo_name");$.cmbPrProductName.setColumn("product_code","product_name");$.grdList.setColumnDropDownList("promo_code",ds.resultList[4],{key:"promo_code",name:"promo_name"});$.grdList.setColumnDropDownList("pr_product_code",ds.resultList[5],{key:"product_code",name:"product_name"});setComboBind([$.cmbBaseDate,$.cmbCancelType,$.cmbTargetMkt,$.cmbTargetBudget,$.cmbPromoCode,$.cmbPrProductName],ds);var ds2=bizComponentData2($,"Q1","L_CRM0034");$.grdList.setColumnDropDownList("plan_type",ds2.resultList[0]);setComboBind([$.cmbPlanType],ds2);$.receiptStartDate=ds.resultList[0][0].receipt_start_date;$.receiptEndDate=ds.resultList[0][0].receipt_end_date;searchWFBgtPlanCancel("CAN")};$.callback=function(type,ds){if(type=="Q3"){$.businessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue("["+g_main.session.getValue("DeptName")+"] "+ds.resultList[0][0].business_title)}else{if(type=="N"){var param={wf_doc_id:$.wfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}else{if(type=="CAN"){if(ds.resultList[0].length<=0){$.grdList.extObj.clearAll();$.grdList.setDisplayPanelRowCount("0")}else{setDataGrid([$.grdList],ds);if($.strbudget_code){for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"budget_code")==$.strbudget_code&&$.grdList.getValue(i,"product_code")==$.strproduct_code&&$.grdList.getValue(i,"plan_seq")==$.strplan_seq){$.grdList.selectRow(i)}}}else{$.grdList.selectRow(0)}}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];console.log("--------------------------------");console.log(args);if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{if(cs.wf_status=="60"){$.wfDocId=cs.wf_doc_id}}$.txtTitle.setValue(cs.doc_title);$.ediDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);$.md=args[6][0];$.strbudget_code=$.md.budget_code;$.strproduct_code=$.md.product_code;$.strplan_seq=$.md.plan_seq}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!validateControls([$.txtTitle,$.cmbBaseDate,$.cmbCancelType,$.cmbPlanType,$.txtBudgetName])){return}if($.grdList.getRowCount()<1||$.rId<=0){MessageBoxShow("선택된 예산사용집계 내용이 없어 상신할 수 없습니다.");return}if($.cmbCancelType.getValue()=="10"){if(!$.grdList.getValue($.rId,"plan_type")==$.cmbPlanType.getValue()){MessageBoxShow("선택한 계획구분과 다릅니다. 다시 선택해 주세요.");$.cmbPlanType.setFocus();return}if(!(Number($.grdList.getValue($.rId,"use_amt"))==0&&Number($.grdList.getValue($.rId,"hold_amt"))==0)){MessageBoxShow("사용금액과 Hold 금액이 없는 건에 대해서만 취소가 가능합니다.");return}}else{if($.cmbCancelType.getValue()=="20"){var dplan_amt=0;var dtotal_aval_amt=0;var daval_amt=0;var duse_amt=0;var dmax_amt=0;var dmin_amt=0;dplan_amt=Number($.grdList.getValue($.rId,"plan_amt"));dtotal_aval_amt=Number($.grdList.getValue($.rId,"total_aval_amt"));daval_amt=Number($.grdList.getValue($.rId,"aval_amt"));duse_amt=Number($.grdList.getValue($.rId,"use_amt"));dmax_amt=dplan_amt+dtotal_aval_amt-daval_amt;dmin_amt=duse_amt;log(duse_amt);log(dplan_amt);if((Number($.speChangeAmt.getValue()))<-daval_amt||(Number($.speChangeAmt.getValue()))==0){MessageBoxShow("변경금액을 잘못입력하셨습니다. 확인하여 주십시요.");$.speChangeAmt.setFocus();return}}else{if($.cmbCancelType.getValue()=="30"||$.cmbCancelType.getValue()=="40"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}if($.cmbTargetMkt.getValue()==""||$.cmbTargetBudget.getValue()==""){MessageBoxShow("이관할 부서나 예산항목을 선택해 주세요.");return}}else{if($.cmbCancelType.getValue()=="50"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}}else{if($.cmbCancelType.getValue()=="60"){if(Number($.speChangeAmt.getValue())<1){MessageBoxShow("이관금액은 1원이상 입력하여야 합니다.");$.speChangeAmt.setFocus();return}if(Number($.speChangeAmt.getValue())>Number($.speAvalAmt.getValue())){MessageBoxShow("이관금액은 가용금액보다 클 수 없습니다.");$.speChangeAmt.setFocus();return}if($.cmbTargetProductName.getValue()==""){MessageBoxShow("대상 품목을 선택해 주세요.");return}}}}}}if(!$.wfDocId){saveWFDocument("","N")}if(saveWFBgtPlanCancel("N")){var param={wf_doc_id:$.wfDocId,wf_form_id:"crmWFBgtPlanCancel",new_line:true};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{removeWFDocument($.wfDocId)}}else{if(id=="btnTmpSave"){saveWFBgtPlanCancel(id)}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteCompanyNameList"){var param={company_id:$.bteCompanyNameList.getValue()||"",company_name:$.bteCompanyNameList.getText()||""};g_main.openPopup("popCompanyListSub.html","popCompanyListSub","",0,0,"","",param,"","")}else{if(id=="bteSidoguNameList"){var param={sidogu_code:$.bteCompanyNameList.getValue()||"",sidogu_name:$.bteCompanyNameList.getText()||""};g_main.openPopup("popSidogu.html","popSidogu","",0,0,"","",param,"","")}}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbBaseDate"){}else{if(id=="cmbCancelType"){if($.cmbCancelType.getValue()==""){$.lblChangeAmt.setText("변경금액");$.speChangeAmt.setEnable(false);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(true);$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteCompanyNameList.setAllowBlank(true);$.bteSidoguNameList.setEnable(false);$.bteSidoguNameList.setAllowBlank(true);$.bteSidoguNameList.setValue("");$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setReadOnly(true);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(true);$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(true);$.cmbPrProductName.setEnable(false);$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);return}var bPromoChk=false;if($.grdList.getValue($.rId,"promo_budget_yn")!=null&&$.grdList.getValue($.rId,"promo_budget_yn")=="Y"){bPromoChk=true}if($.cmbCancelType.getValue()=="10"){$.lblChangeAmt.setText("취소금액");$.speChangeAmt.setEnable(false);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteCompanyNameList.setAllowBlank(true);$.bteSidoguNameList.setEnable(false);$.bteSidoguNameList.setAllowBlank(true);$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setReadOnly(true);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(true);$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(true);$.cmbPrProductName.setEnable(false);$.cmbPrProductName.setValue($.grdList.getValue($.rId,"pr_product_code"));$.cmbPromoCode.setAllowBlank(true);$.cmbPrProductName.setAllowBlank(true);$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);if($.grdList.getRowCount()>0){if(Number($.grdList.getValue($.rId,"use_amt"))==0&&Number($.grdList.getValue($.rId,"hold_amt"))==0){$.speChangeAmt.setValue($.grdList.getValue($.rId,"plan_amt"));$.spePlanAmt2.setValue(0);$.speAvalAmt2.setValue(0)}else{MessageBoxShow("사용금액과 Hold 금액이 없는 건에 대해서만 취소가 가능합니다.");$.spePlanAmt2.setValue($.grdList.getValue($.rId,"plan_amt"));$.speAvalAmt2.setValue($.grdList.getValue($.rId,"aval_amt"));return}}else{return}}else{if($.cmbCancelType.getValue()=="20"){$.lblChangeAmt.setText("변경금액");$.speChangeAmt.setEnable(true);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.spePlanAmt2.setValue($.spePlanAmt.getValue());$.speAvalAmt2.setValue($.speAvalAmt.getValue());$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteSidoguNameList.setEnable(false);$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setReadOnly(true);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(true);$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(true);$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);$.cmbPromoCode.setAllowBlank(!bPromoChk);$.cmbPrProductName.setAllowBlank(!bPromoChk)}else{if($.cmbCancelType.getValue()=="30"){$.lblChangeAmt.setText("이관금액");$.speChangeAmt.setEnable(true);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.spePlanAmt2.setValue($.spePlanAmt.getValue());$.speAvalAmt2.setValue($.speAvalAmt.getValue());$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteSidoguNameList.setEnable(false);$.lblTargetMkt.setVisible(true);$.lblTargetBudget.setVisible(true);$.cmbTargetMkt.setVisible(true);$.cmbTargetBudget.setVisible(true);$.cmbTargetMkt.setReadOnly(false);$.cmbTargetMkt.setEnable(true);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(false,"대상부서");$.cmbTargetBudget.setReadOnly(false);$.cmbTargetBudget.setEnable(true);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(false,"대상예산");$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);$.cmbPromoCode.setAllowBlank(!bPromoChk);$.cmbPrProductName.setAllowBlank(!bPromoChk);var strQuery=" and product_code = '"+$.grdList.getValue($.rId,"product_code")+"' and b.marketing_dept_yn = 'Y'";$.cmbTargetMkt.clear();var ds=bizComponentData2($,"Q4","L_CRM0054",strQuery,"","");setComboBind([$.cmbTargetMkt],ds)}else{if($.cmbCancelType.getValue()=="40"){$.lblChangeAmt.setText("이관금액");$.speChangeAmt.setEnable(true);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.spePlanAmt2.setValue($.spePlanAmt.getValue());$.speAvalAmt2.setValue($.speAvalAmt.getValue());$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteSidoguNameList.setEnable(false);$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(false,"대상부서");$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(false,"대상예산");$.cmbPrProductName.setEnable(true);$.cmbPromoCode.setAllowBlank(!bPromoChk);$.cmbPrProductName.setAllowBlank(!bPromoChk);$.lblTargetCompanyNameList.setVisible(false);$.lblTargetSidoguNameList.setVisible(false);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);var strTargetDept="";if(g_main.session.getValue("DeptCode")=="S410"){strTargetDept="S510"}else{if(g_main.session.getValue("DeptCode")=="S420"){strTargetDept="S520"}else{if(g_main.session.getValue("DeptCode")=="S440"){strTargetDept="S540"}else{if(g_main.session.getValue("DeptCode")=="S450"){strTargetDept="S550"}else{if(g_main.session.getValue("DeptCode")=="S510"){strTargetDept="S410"}else{if(g_main.session.getValue("DeptCode")=="S520"){strTargetDept="S420"}else{if(g_main.session.getValue("DeptCode")=="S540"){strTargetDept="S440"}else{if(g_main.session.getValue("DeptCode")=="S550"){strTargetDept="S450"}}}}}}}}var ds=bizComponentData2($,"Q1","L_CRM0051");setComboBind([$.cmbTargetMkt],ds);$.cmbTargetMkt.setValue(strTargetDept);var strProduct="";if($.grdList.getValue($.rId,"product_code")=="P04"){strProduct="P16"}else{if($.grdList.getValue($.rId,"product_code")=="P16"){strProduct="P04"}}}else{if($.cmbCancelType.getValue()=="50"){$.lblChangeAmt.setText("이관금액");$.speChangeAmt.setEnable(true);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.spePlanAmt2.setValue($.spePlanAmt.getValue());$.speAvalAmt2.setValue($.speAvalAmt.getValue());$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteSidoguNameList.setEnable(false);$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setReadOnly(true);$.cmbTargetMkt.setEnable(false);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(true);$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setEnable(false);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(true);$.lblTargetCompanyNameList.setVisible(true);$.lblTargetSidoguNameList.setVisible(true);$.lblTargetProductName.setVisible(false);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(true);$.cmbTargetCompanyNameList.setAllowBlank(false);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(true);$.cmbTargetSidoguNameList.setAllowBlank(false);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(false);$.cmbTargetProductName.setAllowBlank(true);$.cmbPromoCode.setAllowBlank(!bPromoChk);$.cmbPrProductName.setAllowBlank(!bPromoChk);var strQuery=" and a.product_code = '"+$.grdList.getValue($.rId,"product_code")+"' and a.plan_employee_id = '"+$.grdList.getValue($.rId,"plan_employee_id")+"' and company_id_list <> '"+$.grdList.getValue($.rId,"company_id_list")+"'";$.cmbTargetCompanyNameList.clear();var ds=bizComponentData2($,"Q4","L_CRM0289",strQuery,"","");setComboBind([$.cmbTargetCompanyNameList],ds);var strQuery2=" and a.product_code = '"+$.grdList.getValue($.rId,"product_code")+"' and a.plan_employee_id = '"+$.grdList.getValue($.rId,"plan_employee_id")+"' and sidogu_code_list <> '"+$.grdList.getValue($.rId,"sidogu_code_list")+"'";$.cmbTargetSidoguNameList.clear();var ds2=bizComponentData2($,"Q4","L_CRM0290",strQuery2,"","");setComboBind([$.cmbTargetSidoguNameList],ds2)}else{if($.cmbCancelType.getValue()=="60"){$.lblChangeAmt.setText("이관금액");$.speChangeAmt.setEnable(true);$.speChangeAmt.setValue(0);$.speChangeAmt.setAllowBlank(false);$.spePlanAmt2.setValue($.spePlanAmt.getValue());$.speAvalAmt2.setValue($.speAvalAmt.getValue());$.cmbPromoCode.setEnable(false);$.bteCompanyNameList.setEnable(false);$.bteSidoguNameList.setEnable(false);$.lblTargetMkt.setVisible(false);$.lblTargetBudget.setVisible(false);$.cmbTargetMkt.setVisible(false);$.cmbTargetBudget.setVisible(false);$.cmbTargetMkt.setReadOnly(true);$.cmbTargetMkt.setEnable(false);$.cmbTargetMkt.setValue("");$.cmbTargetMkt.setAllowBlank(true);$.cmbTargetBudget.setReadOnly(true);$.cmbTargetBudget.setEnable(false);$.cmbTargetBudget.setValue("");$.cmbTargetBudget.setAllowBlank(true);$.lblTargetCompanyNameList.setVisible(true);$.lblTargetSidoguNameList.setVisible(true);$.lblTargetProductName.setVisible(true);$.cmbTargetCompanyNameList.setValue("");$.cmbTargetCompanyNameList.setVisible(true);$.cmbTargetSidoguNameList.setValue("");$.cmbTargetSidoguNameList.setVisible(true);$.cmbTargetProductName.setValue("");$.cmbTargetProductName.setVisible(true);$.cmbTargetProductName.setAllowBlank(false);$.cmbPromoCode.setAllowBlank(!bPromoChk);$.cmbPrProductName.setAllowBlank(!bPromoChk);var strQuery=" and a.base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' and a.base_half = '"+$.cmbBaseDate.getValue().substring(4,5)+"' and a.plan_employee_id = '"+$.grdList.getValue($.rId,"plan_employee_id")+"'";$.cmbTargetCompanyNameList.clear();var ds=bizComponentData2($,"Q4","L_CRM0289",strQuery,"","");setComboBind([$.cmbTargetCompanyNameList],ds);var strQuery2=" and a.base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' and a.base_half = '"+$.cmbBaseDate.getValue().substring(4,5)+"' and a.plan_employee_id = '"+$.grdList.getValue($.rId,"plan_employee_id")+"'";$.cmbTargetSidoguNameList.clear();var ds2=bizComponentData2($,"Q4","L_CRM0290",strQuery2,"","");setComboBind([$.cmbTargetSidoguNameList],ds2);var strQuery3=" and base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' and base_half = '"+$.cmbBaseDate.getValue().substring(4,5)+"' and product_code <> '"+$.grdList.getValue($.rId,"product_code")+"' and plan_employee_id = '"+$.grdList.getValue($.rId,"plan_employee_id")+"'";$.cmbTargetProductName.clear();var ds=bizComponentData2($,"Q4","L_CRM0291",strQuery3,"","");setComboBind([$.cmbTargetProductName],ds)}}}}}}}else{if(id=="cmbTargetCompanyNameList"){if($.cmbTargetSidoguNameList.getValue()!=""){$.cmbTargetSidoguNameList.setValue("")}}else{if(id=="cmbTargetSidoguNameList"){if($.cmbTargetCompanyNameList.getValue()!=""){$.cmbTargetCompanyNameList.setValue("")}}else{if(id=="cmbTargetMkt"){$.cmbTargetBudget.clear();var strQuery=" where base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' AND base_half = '"+$.cmbBaseDate.getValue().substring(4,5)+"' AND dept_code = '"+$.cmbTargetMkt.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0078_2",strQuery,"","");setComboBind([$.cmbTargetBudget],ds);if($.cmbCancelType.getValue()=="40"){var strProduct="";if($.grdList.getValue($.rId,"product_code")=="P04"){strProduct="P16"}else{if($.grdList.getValue($.rId,"product_code")=="P16"){strProduct="P04"}}$.cmbTargetBudget.setValue($.cmbTargetMkt.getValue()+$.grdList.getValue($.rId,"budget_code")+strProduct)}}}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){$.rId=rId;$.panDetail.clear();$.varCompanyId="";$.varLocationId="";$.varPayMe="";$.varBankAccount="";$.varBank="";$.varAccount="";$.varAcctName="";$.varBpName="";g_main.session.getValue("DeptCode");$.cmbPlanType.setValue($.grdList.getValue(rId,"plan_type"));if($.strplan_amt!=0){$.spePlanAmt.setValue($.strplan_amt);$.strplan_amt=0}else{$.spePlanAmt.setValue($.grdList.getValue(rId,"plan_amt"))}$.spePlanAmt2.setValue($.grdList.getValue(rId,"plan_amt"));$.speAvalAmt.setValue($.grdList.getValue(rId,"aval_amt"));$.speAvalAmt2.setValue($.grdList.getValue(rId,"aval_amt"));$.txtBudgetName.setValue($.grdList.getValue(rId,"budget_name"));$.cmbPromoCode.setValue($.grdList.getValue(rId,"promo_code"));$.cmbPrProductName.setValue($.grdList.getValue(rId,"product_code"));$.bteSidoguNameList.setText($.grdList.getValue(rId,"sidogu_name_list"));$.bteCompanyNameList.setText($.grdList.getValue(rId,"company_name_list"));$.bteSidoguNameList.setValue($.grdList.getValue(rId,"sidogu_code_list"));$.bteCompanyNameList.setValue($.grdList.getValue(rId,"company_id_list"));$.varLocationId=$.grdList.getValue(rId,"sidogu_code_list");$.varCompanyId=$.grdList.getValue(rId,"company_id_list");$.cmbCancelType.clear();var strQuery="";if((g_main.session.getValue("DeptCode")=="S410"||g_main.session.getValue("DeptCode")=="S420"||g_main.session.getValue("DeptCode")=="S440"||g_main.session.getValue("DeptCode")=="S450"||g_main.session.getValue("DeptCode")=="S510"||g_main.session.getValue("DeptCode")=="S520"||g_main.session.getValue("DeptCode")=="S540"||g_main.session.getValue("DeptCode")=="S550")&&$.grdList.getValue(rId,"plan_type")=="30"){strQuery=""}else{var strQuery=" and sub_code <> '40'"}var ds=bizComponentData2($,"Q4","L_CRM0044",strQuery,"","");setComboBind([$.cmbCancelType],ds);if($.grdList.getValue(rId,"promo_budget_yn")!=null&&$.grdList.getValue(rId,"promo_budget_yn")=="Y"){if($.cmbCancelType.getValue()=="10"){$.cmbPromoCode.setAllowBlank(true);$.cmbPrProductName.setAllowBlank(true)}else{$.cmbPromoCode.setAllowBlank(false,"판촉항목");$.cmbPrProductName.setAllowBlank(false,"품목")}$.lblPromoCode.setVisible(true);$.cmbPromoCode.setVisible(true);$.lblPrProductName.setVisible(true);$.cmbPrProductName.setVisible(true);if($.grdList.getValue(rId,"pr_product_code")!=null){if($.grdList.getValue(rId,"pr_product_code")==""){$.cmbPrProductName.setReadOnly(false)}else{$.cmbPrProductName.setReadOnly(true);$.cmbPrProductName.setValue($.grdList.getValue(rId,"pr_product_code"))}}}else{$.lblPromoCode.setVisible(false);$.cmbPromoCode.setVisible(false);$.cmbPromoCode.setValue("");$.cmbPromoCode.setAllowBlank(true);$.lblCompanyNameList.setVisible(false);$.bteCompanyNameList.setVisible(false);$.bteCompanyNameList.setValue("");$.lblSidoguNameList.setVisible(false);$.bteSidoguNameList.setVisible(false);$.bteSidoguNameList.setValue("");$.lblPrProductName.setVisible(false);$.cmbPrProductName.setVisible(false);$.cmbPrProductName.setValue("");$.cmbPrProductName.setAllowBlank(true)}if($.md!=""){$.strbudget_code=$.md.budget_code;$.strproduct_code=$.md.product_code;$.strplan_seq=$.md.plan_seq;$.strplan_amt=$.md.plan_amt;$.cmbCancelType.setValue($.md.cancel_type);$.cmbPromoCode.setValue($.md.promo_code);$.cmbPrProductName.setValue($.md.pr_product_code);$.varCompanyId=$.md.sidogu_code_list;$.bteCompanyNameList.setValue($.md.sidogu_name_list);$.varLocationId=$.md.company_id_list;$.bteSidoguNameList.setValue($.md.company_name_list);$.cmbTargetMkt.setValue($.md.target_mkt)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="speChangeAmt"){if($.grdList.getRowCount()<=0){return}if($.cmbCancelType.getValue()=="20"){$.spePlanAmt2.setValue(Number($.spePlanAmt.getValue())+Number($.speChangeAmt.getValue()));$.speAvalAmt2.setValue(Number($.speAvalAmt.getValue())+Number($.speChangeAmt.getValue()))}else{if($.cmbCancelType.getValue()=="30"||$.cmbCancelType.getValue()=="50"||$.cmbCancelType.getValue()=="60"){$.spePlanAmt2.setValue(Number($.spePlanAmt.getValue())-Number($.speChangeAmt.getValue()));$.speAvalAmt2.setValue(Number($.speAvalAmt.getValue())-Number($.speChangeAmt.getValue()))}}}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDoc"){if(btnId=="btnAdd"){$.popUpCallId="btnDocAdd";var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.wfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)&&saveWFBgtPlanCancel("N")){if($.varOpenType=="POP"){var param={wf_doc_id:$.wfDocId,doc_type:"70",doc_title:$.txtTitle.getValue()};g_popupStack.setData(param);g_popupStack.close()}else{var param={wf_doc_id:$.wfDocId,doc_type:"70"};g_main.openModelWithBusiness("crmWFGeneralProc",param)}}else{removeWFDocument($.wfDocId)}}}}else{if(id=="popCompanyListSub"){if($.popUpCallId=="bteCompanyNameList"){if(!popResult.company_id){$.varCompanyId="";$.bteCompany.setText("")}else{if($.varLocationId!=""&&$.bteLocation.getValue()!=""){$.varLocationId="";$.bteLocation.setValue("")}$.varCompanyId=popResult.company_id;$.bteCompany.setText(popResult.company_name)}}}else{if(id=="popSidogu"){if($.popUpCallId=="bteSidoguNameList"){if(!popResult.sidogu_code){$.varLocationId="";$.bteLocation.setText("")}else{if($.varCompanyId!=""&&$.bteCompany.getValue()!=""){$.varCompanyId="";$.bteCompany.setValue("")}$.varLocationId=popResult.sidogu_code;$.bteLocation.setText(popResult.sidogu_name)}}}else{if(id=="popDepositEmpSub"){if($.popUpCallId=="0010"){if(!popResult.code){$.varCardCode="";$.txtBankAccount.setValue("");$.varPayMe="";$.varBankAccount="";$.varBank="";$.varAccount="";$.varAcctName="";$.varBpName=""}else{$.varCardCode=popResult.code;$.txtBankAccount.setValue(popResult.bank_account);$.varPayMe=popResult.pay_me;$.varBankAccount=popResult.bank_account;$.varBank=popResult.bank;$.varAccount=popResult.account;$.varAcctName=popResult.acct_name;$.varBpName=popResult.emp_name}}}else{if(id=="popAccountCompany"){if($.popUpCallId=="0020"){if(!popResult.card_code){$.varCardCode="";$.txtBankAccount.setValue("");$.varPayMe="";$.varBankAccount="";$.varBank="";$.varAccount="";$.varAcctName="";$.varBpName=""}else{$.varCardCode=popResult.card_code;$.txtBankAccount.setValue(popResult.bank_account);$.varPayMe=popResult.pay_me;$.varBankAccount=popResult.bank_account;$.varBank=popResult.bank;$.varAccount=popResult.account;$.varAcctName=popResult.acct_name;$.varBpName=popResult.card_name}}}else{if(id=="popWithholdmentSub"){if($.popUpCallId=="0030"){if(!popResult.code){$.varCardCode="";$.txtBankAccount.setValue("");$.varPayMe="";$.varBankAccount="";$.varBank="";$.varAccount="";$.varAcctName="";$.varBpName=""}else{$.varCardCode=popResult.code;$.txtBankAccount.setValue(popResult.target_info2);$.varPayMe=popResult.pay_me;$.varBankAccount=popResult.bank_account;$.varBank=popResult.bank;$.varAccount=popResult.account;$.varAcctName=popResult.acct_name;$.varBpName=popResult.bp_name}}}else{if(id=="crmWFEndDocSub"){if($.popUpCallId=="btnDocAdd"){var rows=[];for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>