<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panALMsgDef=null;$.grdTreeMsgDef=null;$.btnComplete=null;$.btnCancel=null;$.varYear="";$.varHalf="";$.varProductCode="";$.varChannel="";$.varMsgGrade="";$.varMsgAL="";$.varPolicyIds="";$.varUpdateList=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmContact_AL_Policy_Q",[workType,$.varYear,$.varHalf,$.varProductCode,$.varChannel,$.varMsgGrade,$.varMsgAL,"|"+$.varPolicyIds+"|"]);return json}function searchALMsgDef(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function convertTreeToArray(rs){for(var i in rs){$.varPath=[];if(rs[i].parent_id!=0){getPath(rs,rs[i].parent_id);rs[i].path="|";for(var j in $.varPath){rs[i].path+=$.varPath[j]+"|"}}else{rs[i].path="|"+rs[i].policy_id+"|"}}return rs}function getPath(rs,pId){for(var i in rs){if(pId==rs[i].policy_id){$.varPath.push(rs[i].policy_id);if(rs[i].parent_id!=0){getPath(rs,rs[i].parent_id)}else{return}}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,490,590);$.panMain.setText("");$.panMain.setBottomLine(true);$.panALMsgDef=new FingerPanel(host,"panALMsgDef",0,0,485,540);$.panALMsgDef.setText("Adoption Ladder 메시지 정의");$.panALMsgDef.setBottomLine(false);$.grdTreeMsgDef=new FingerDataGrid(host,"grdTreeMsgDef",0,0,485,495);$.btnComplete=new FingerButton(host,"btnComplete",345,555,80,20);$.btnComplete.setText("확인");$.btnCancel=new FingerButton(host,"btnCancel",410,555,80,20);$.btnCancel.setText("취소");$.grdTreeMsgDef.setColumns([new FingerDataGridColumn("policy_id",99,"left","string","메시지ID",{hidden:true}),new FingerDataGridColumn("check_box",30,"center","checkbox","",{template:"tree"}),new FingerDataGridColumn("policy_type",60,"center","string","구분"),new FingerDataGridColumn("parent_id",99,"left","string","상위메시지ID",{hidden:true}),new FingerDataGridColumn("policy_title",170,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("policy_desc",207,"left","string","내용"),new FingerDataGridColumn("order_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","path",{hidden:true})]);$.grdTreeMsgDef.init({view:"treetable",treeKey:{id:"policy_id",parent:"parent_id"},scroll:"xy"});$.grdTreeMsgDef.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panALMsgDef);$.panMain.add($.btnCancel);$.panMain.add($.btnComplete);$.panALMsgDef.add($.grdTreeMsgDef);if($.p_argument){log($.p_argument);$.varYear=$.p_argument.year;$.varHalf=$.p_argument.half;$.varProductCode=$.p_argument.product_code;$.varChannel=$.p_argument.channel;$.varMsgGrade=$.p_argument.grade;$.varMsgAL=$.p_argument.al;$.varPolicyIds=$.p_argument.policy_ids;if($.varPolicyIds==""){searchALMsgDef("AL_MSG_DEF")}else{searchALMsgDef("AL_MSG_DEF")}}else{$.varYear="2016";$.varHalf="1";$.varProductCode="P21";$.varChannel="2";$.varMsgGrade="S";$.varMsgAL="40";searchALMsgDef("AL_MSG_DEF")}var ds=bizComponentData2($,"Q1","L_CRM0273");$.grdTreeMsgDef.setColumnDropDownList("policy_type",ds.resultList[0])};$.callback=function(type,ds){if(type=="AL_MSG_DEF"||type=="AL_MSG_FX"){if(ds.resultList[0].length>0){ds.resultList[0]=convertTreeToArray(ds.resultList[0]);for(var i in ds.resultList[0]){if($.varPolicyIds==""){ds.resultList[0][i].check_box="Y"}else{var path="|"+$.varPolicyIds+"|";if(path.indexOf("|"+ds.resultList[0][i].policy_id+"|")!=-1){ds.resultList[0][i].check_box="Y"}else{ds.resultList[0][i].check_box="N"}}}setDataGrid([$.grdTreeMsgDef],ds);$.grdTreeMsgDef.openNode("all")}else{$.grdTreeMsgDef.setData("")}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnComplete"){confirmBoxShow("해당 Adoption Ladder 메시지 정의 사용하시겠습니까?",function(){if(g_main.msgShare==true){var aRow=$.grdTreeMsgDef.getAllRows();var tempPlolicyId="";for(var i in aRow){if(aRow[i].check_box=="Y"){tempPlolicyId=tempPlolicyId+"|"+aRow[i].policy_id}}tempPlolicyId=tempPlolicyId.substring(1,tempPlolicyId.length);log(tempPlolicyId);param={policy_ids:tempPlolicyId};g_popupStack.setData(param);g_popupStack.close()}})}else{if(id=="btnCancel"){g_popupStack.close()}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteMsgParent"){if(!validateControls([$.cmbQProduct,$.cmbQType])){return}var param={product_code:$.cmbQProduct.getValue(),channel:$.cmbQType.getValue()};g_main.openPopup("popALMsgParentList.html","popALMsgParentList","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){if(id=="bteMsgParent"){if(value==""){$.varALMsgParentId=""}}};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chkALEntry"){if(value=="Y"){$.speALLFrom.setEnable(false);$.speALLTo.setEnable(false);$.speALUFrom.setEnable(false);$.speALUTo.setEnable(false);$.speALTFrom.setEnable(false);$.speALTTo.setEnable(false);$.speALAFrom.setEnable(false);$.speALATo.setEnable(false);$.txtALL.setEnable(true);$.txtALU.setEnable(true);$.txtALT.setEnable(true);$.txtALA.setEnable(true);$.txtALL.setAllowBlank(false,"Loyalty");$.txtALU.setAllowBlank(false,"User");$.txtALT.setAllowBlank(false,"Try");$.txtALA.setAllowBlank(false,"Awareness")}else{if(value=="N"){$.txtALL.setEnable(false);$.txtALU.setEnable(false);$.txtALT.setEnable(false);$.txtALA.setEnable(false);$.speALLFrom.setEnable(true);$.speALLTo.setEnable(true);$.speALUFrom.setEnable(true);$.speALUTo.setEnable(true);$.speALTFrom.setEnable(true);$.speALTTo.setEnable(true);$.speALAFrom.setEnable(true);$.speALATo.setEnable(true);$.speALLFrom.setAllowBlank(false,"Loyalty Min");$.speALLTo.setAllowBlank(false,"Loyalty Max");$.speALUFrom.setAllowBlank(false,"User Min");$.speALUTo.setAllowBlank(false,"User Max");$.speALTFrom.setAllowBlank(false,"Try Min");$.speALTTo.setAllowBlank(false,"Try Max");$.speALAFrom.setAllowBlank(false,"Awareness Min");$.speALATo.setAllowBlank(false,"Awareness Max")}}}};$.fingercombobox_change=function(id,value){if(id=="cmbQHalf"||id=="cmbQProduct"||id=="cmbQType"){if($.dteQYear.getValue()==""||$.cmbQHalf.getValue()==""||$.cmbQProduct.getValue()==""||$.cmbQType.getValue()==""){return}searchAll()}else{if(id=="cmbContS"){$.lblContS2.setText(value)}else{if(id=="cmbContK"){$.lblContK2.setText(value)}else{if(id=="cmbContA"){$.lblContA2.setText(value)}else{if(id=="cmbContG"){$.lblContG2.setText(value)}}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdTreeMsgDef"){if(cInd=="check_box"){if(!$.grdTreeMsgDef.getRowCount()){return}var aRow=$.grdTreeMsgDef.getAllRows();for(var i in aRow){if(aRow[i].check_box=="N"){rId=i}}var keyId=$.grdTreeMsgDef.getValue(rId,"policy_id");for(var i in aRow){if(aRow[i].policy_id==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].policy_id==aRow[i].policy_id){overlap++}}if(overlap>0){$.grdTreeMsgDef.setValue(i,"check_box","N");continue}else{log("2");$.varUpdateList.push({rowType:"D",policy_id:aRow[i].policy_id});$.grdTreeMsgDef.setValue(i,"check_box","N")}}else{log("3");$.grdTreeMsgDef.setValue(i,"check_box","N")}}}}}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdMsgList"){$.varMsgAL=$.grdMsgList.getValue(rId,"al");$.varMsgGrade=$.grdMsgList.getValue(rId,"key_id");searchALMsgDef("AL_MSG_DEF")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdTreeMsgDef"){if(cInd=="check_box"){if(nValue=="N"){if(!$.grdTreeMsgDef.getRowCount()){return}var aRow=$.grdTreeMsgDef.getAllRows();var keyId=$.grdTreeMsgDef.getValue(rId,"policy_id");for(var i in aRow){if(aRow[i].policy_id==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].policy_id==aRow[i].policy_id){overlap++}}if(overlap>0){$.grdTreeMsgDef.setValue(i,"check_box","N");continue}else{log("2");$.varUpdateList.push({rowType:"D",policy_id:aRow[i].policy_id});$.grdTreeMsgDef.setValue(i,"check_box","N")}}else{$.grdTreeMsgDef.setValue(i,"check_box","N")}}}}else{if(nValue=="Y"){var aRow1=$.grdTreeMsgDef.getAllRows();var keyId=$.grdTreeMsgDef.getValue(rId,"policy_id");var path=$.grdTreeMsgDef.getValue(rId,"path");for(var i in aRow1){if(aRow1[i].policy_id==keyId||path.indexOf("|"+aRow1[i].policy_id+"|")!=-1){var overlap=0;$.grdTreeMsgDef.setValue(i,"check_box","Y")}}}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="speContPatient"||id=="speContTarget"||id=="speContS"||id=="speContK"||id=="speContA"||id=="speContG"){calcContDef()}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panALMsgDef"){if(btnId=="btnDelete"){if(!$.grdTreeMsgDef.getRowCount()){return}var rId="";var aRow=$.grdTreeMsgDef.getAllRows();for(var i in aRow){if(aRow[i].check_box=="N"){rId=i}}var keyId=$.grdTreeMsgDef.getValue(rId,"policy_id");log(keyId);for(var i in aRow){if(aRow[i].policy_id==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].policy_id==aRow[i].policy_id){overlap++}}if(overlap>0){$.grdTreeMsgDef.setValue(i,"check_box","N");continue}else{$.varUpdateList.push({rowType:"D",policy_id:aRow[i].policy_id});$.grdTreeMsgDef.setValue(i,"check_box","N")}}else{$.grdTreeMsgDef.setValue(i,"check_box","N")}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popALMsgParentList"){if($.popUpCallId=="bteMsgParent"){if($.varALMsgId!=""){if($.varALMsgId==popResult.policy_id||(popResult.path).indexOf("|"+$.varALMsgId+"|")!=-1){MessageBoxShow("상위 메시지로 자신 또는 하위 메시지를 선택하실 수 없습니다.");return}}$.varALMsgParentId=popResult.policy_id;$.bteMsgParent.setValue(popResult.policy_title)}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){}};</script>