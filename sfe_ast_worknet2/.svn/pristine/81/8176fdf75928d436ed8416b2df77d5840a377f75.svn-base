<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panInfo=null;$.panDetail1=null;$.panDetail2=null;$.grdDetail1=null;$.grdDetail2=null;$.btnSearch=null;$.btnAdd=null;$.btnDelete=null;$.lblEmpId=null;$.lblEmpName=null;$.txtEmpId=null;$.txtEmpName=null;$.grdEmp=null;$.lblGroup=null;$.bteGroup=null;$.varEmpId="";$.varUpdateList=[];$.varPath=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_MOR3000_Q",[workType,workType=="USER"?$.varEmpId:$.txtEmpId.getValue(),$.txtEmpName.getValue()]);return json}function createJSON_S1(workType){var json=createExecuteParamInfo("P_MOR3000_S",[workType,$.bteGroup.getValue(),$.varEmpId,"#UserID#"]);return json}function createJSON_S2(workType){var json="";if($.varUpdateList.length<1){return}var rows=[];for(var i in $.varUpdateList){rows.push([$.varUpdateList[i].rowType,$.varUpdateList[i].KeyID,$.varEmpId,"","#UserID#"])}json=createExecuteParamInfo("P_MOR3000_S1",rows);return json}function searchMOR3000(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveMOR3000(){var json=createJSON_S1("U");if(json){var ds=callExecuteSync(["req",json],"U",$,false);if(ds.errorCode=="MSG0004"){if($.varUpdateList.length>0){saveMOR3000Sub("N")}else{searchMOR3000("USER")}}else{if(ds.errorCode=="MSG0030"){MessageBoxShow("수정도중 오류가 발생하였습니다.");return}}}}function saveMOR3000Sub(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds){if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"){$.varDeleteList=[];searchMOR3000("USER")}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("저장도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0031"){MessageBoxShow("삭제도중 오류가 발생하였습니다.");return}}}}else{$.varUpdateList=[];searchMOR3000("USER")}}}function convertTreeToArray(rs){for(var i in rs){$.varPath=[];if(rs[i].ParentID!=""){getPath(rs,rs[i].ParentID);rs[i].path="|";for(var j in $.varPath){rs[i].path+=$.varPath[j]+"|"}}else{rs[i].path="|"+rs[i].KeyID+"|"}}return rs}function getPath(rs,pID){for(var i in rs){if(pID==rs[i].KeyID){$.varPath.push(rs[i].KeyID);if(rs[i].ParentID!=""){getPath(rs,rs[i].ParentID)}else{return}}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,810);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,300,800);$.panQuery.setText("사원리스트");$.panQuery.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",310,0,890,105);$.panInfo.setText("소속 그룹 권한");$.panInfo.setBottomLine(false);$.panDetail1=new FingerPanel(host,"panDetail1",310,115,410,685);$.panDetail1.setText("전체 윤리 강령");$.panDetail1.setBottomLine(true);$.panDetail2=new FingerPanel(host,"panDetail2",790,115,410,685);$.panDetail2.setText("사용자 할당 윤리 강령");$.panDetail2.setBottomLine(true);$.grdDetail1=new FingerDataGrid(host,"grdDetail1",0,0,410,635);$.grdDetail2=new FingerDataGrid(host,"grdDetail2",0,0,410,635);$.btnSearch=new FingerButton(host,"btnSearch",220,-37.5,80,20);$.btnSearch.setText("조회");$.btnAdd=new FingerButton(host,"btnAdd",735,410,60,40);$.btnAdd.setText("▶");$.btnDelete=new FingerButton(host,"btnDelete",735,470,60,40);$.btnDelete.setText("◀");$.lblEmpId=new FingerLabel(host,"lblEmpId",0,10,100,20);$.lblEmpId.setText("사원아이디");$.lblEmpName=new FingerLabel(host,"lblEmpName",0,40,100,20);$.lblEmpName.setText("사원명");$.txtEmpId=new FingerEdit(host,"txtEmpId",105,10,160,20);$.txtEmpName=new FingerEdit(host,"txtEmpName",105,40,160,20);$.grdEmp=new FingerDataGrid(host,"grdEmp",0,80,300,675);$.lblGroup=new FingerLabel(host,"lblGroup",0,15,100,20);$.lblGroup.setText("그룹명");$.bteGroup=new FingerButtonEdit(host,"bteGroup",105,15,200,20);$.bteGroup.setText("");$.panInfo.addButtons(["btnSave"]);$.grdEmp.setColumns([new FingerDataGridColumn("Name",300,"left","string","Name",{template:"tree"}),new FingerDataGridColumn("Code",99,"left","string","Code",{hidden:true}),new FingerDataGridColumn("Type",99,"left","string","Type",{hidden:true})]);$.grdEmp.init({view:"treetable",treeKey:{id:"ID",parent:"ParentID"}});$.grdEmp.setBorder(false);$.grdDetail1.setColumns([new FingerDataGridColumn("KeyID",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("parentID",99,"left","string","상위윤령ID",{hidden:true}),new FingerDataGridColumn("title",390,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("sort_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("paht",99,"left","string","윤령순서",{hidden:true})]);$.grdDetail1.init({view:"treetable",treeKey:{id:"KeyID",parent:"ParentID"}});$.grdDetail1.setBorder(false);$.grdDetail2.setColumns([new FingerDataGridColumn("KeyID",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("parentID",99,"left","string","상위윤령ID",{hidden:true}),new FingerDataGridColumn("title",390,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("sort_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("paht",99,"left","string","윤령순서",{hidden:true})]);$.grdDetail2.init({view:"treetable",treeKey:{id:"KeyID",parent:"ParentID"}});$.grdDetail2.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panInfo);$.panMain.add($.panDetail1);$.panMain.add($.panDetail2);$.panMain.add($.btnDelete);$.panMain.add($.btnAdd);$.panQuery.add($.btnSearch);$.panQuery.add($.lblEmpId);$.panQuery.add($.lblEmpName);$.panQuery.add($.txtEmpId);$.panQuery.add($.txtEmpName);$.panQuery.add($.grdEmp);$.panInfo.add($.lblGroup);$.panInfo.add($.bteGroup);$.panDetail1.add($.grdDetail1);$.panDetail2.add($.grdDetail2);searchMOR3000("ALL");relocateChildIndexInPanel([$.panQuery,$.panInfo])};$.callback=function(type,ds){if(type=="ALL"){setDataGrid([$.grdEmp],ds);if(ds.resultList[0].length<=0){return}if($.varEmpId!=""){$.grdEmp.selectRow($.grdEmp.getGridRowIndex("Code",$.varEmpId,0))}else{$.grdEmp.selectRow(0)}$.grdEmp.openNode("all");for(var i in ds.resultList[1]){ds.resultList[1][i].KeyID=ds.resultList[1][i].moral_id;ds.resultList[1][i].ParentID=ds.resultList[1][i].parent_moral_id}ds.resultList[1]=convertTreeToArray(ds.resultList[1]);setDataGrid([null,$.grdDetail1],ds);$.grdDetail1.openNode("all")}else{if(type=="USER"){if(ds.resultList[0].length<=0||ds.resultList[1].length<=0){$.bteGroup.setValue("");$.bteGroup.setText("");$.grdDetail2.setData("");return}var rs=ds.resultList[0][0];$.bteGroup.setValue(rs.group_id);$.bteGroup.setText(rs.group_name);for(var i in ds.resultList[1]){ds.resultList[1][i].KeyID=ds.resultList[1][i].moral_id;ds.resultList[1][i].ParentID=ds.resultList[1][i].parent_moral_id}ds.resultList[1]=convertTreeToArray(ds.resultList[1]);setDataGrid([null,$.grdDetail2],ds);$.grdDetail2.openNode("all")}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){$.varEmpId="";searchMOR3000("ALL")}else{if(id=="btnAdd"){var aRow1=$.grdDetail1.getAllRows(),aRow2=$.grdDetail2.getAllRows();var rId=$.grdDetail1.getSelectedRowIdx();if(!rId){return}var keyId=$.grdDetail1.getValue(rId,"KeyID");var path=$.grdDetail1.getValue(rId,"path");for(var i in aRow1){if(aRow1[i].KeyID==keyId||path.indexOf("|"+aRow1[i].KeyID+"|")!=-1||aRow1[i].path.indexOf("|"+keyId+"|")!=-1){var overlap=0;if(aRow2.length>0){for(var j in aRow2){if(aRow1[i].KeyID==aRow2[j].KeyID){overlap++}}}if(overlap>0){continue}aRow2.push({rowType:"N",ParentID:aRow1[i].ParentID,KeyID:aRow1[i].KeyID,title:aRow1[i].title,sort_seq:aRow1[i].sort_seq,path:aRow1[i].path});$.varUpdateList.push({rowType:"N",KeyID:aRow1[i].KeyID})}}$.grdDetail2.setData(aRow2);$.grdDetail2.openNode("all")}else{if(id=="btnDelete"){var rId=$.grdDetail2.getSelectedRowIdx();if(!rId){return}var keyId=$.grdDetail2.getValue(rId,"KeyID");var aRow=$.grdDetail2.getAllRows();for(var i in aRow){if(aRow[i].KeyID==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].KeyID==aRow[i].KeyID){overlap++}}if(overlap>0){$.grdDetail2.deleteCurrentRow();continue}else{$.varUpdateList.push({rowType:"D",KeyID:aRow[i].KeyID});$.grdDetail2.deleteCurrentRow()}}else{$.grdDetail2.deleteCurrentRow()}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteGroup"){var param={};g_main.openPopup("popAuthList.html","popAuthList","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdEmp"){if($.grdEmp.getValue(rId,"Type")=="DEPT"){$.varEmpId="";$.bteGroup.setValue("");$.bteGroup.setText("");$.grdDetail2.setData("");$.bteGroup.setEnable(false);$.btnAdd.setEnable(false);$.btnDelete.setEnable(false)}else{$.varEmpId=$.grdEmp.getValue(rId,"Code");$.bteGroup.setEnable(true);$.btnAdd.setEnable(true);$.btnDelete.setEnable(true);searchMOR3000("USER")}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txtEmpId"||id=="txtEmpName")&&value=="13"){searchMOR3000("ALL")}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnSave"){saveMOR3000($.varEmpId!=""?"U":"N")}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popAuthList"){if($.popUpCallId=="bteGroup"){$.bteGroup.setValue(popResult.group_id);$.bteGroup.setText(popResult.group_name)}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>