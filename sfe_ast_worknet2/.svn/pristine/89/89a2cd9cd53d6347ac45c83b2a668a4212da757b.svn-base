<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.panLeft=null;$.panLeftTop=null;$.panRight=null;$.panDesc=null;$.grdDesc=null;$.lblDeptName=null;$.lblEmpName=null;$.memMsg=null;$.txtDeptName=null;$.txtEmpName=null;$.grdFile=null;$.grdDoc=null;$.varWfDocId="";$.varWfType="";$.varOriginWfDocId="";function createJSON_S(workType){var data=$.grdDesc.getAllRows();var json=createExecuteParamInfo("P_crmWFOverTimeReq_S",[workType,$.varWfDocId,"",Number(data[0].plan_hour_hh||0)+Number(data[0].plan_hour_mm||0),data[0].total_time,data[0].actual_total_time,data[0].aval_time]);return json}function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFOverTimeReq"]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_crmWFOverTimeCalc_Q",[workType,"#UserID#"]);return json}function saveWFOverTimeReq(btnId){if(!validateControls([$.txtTitle])){return}if($.grdDesc.getRowCount()<1){MessageBoxShow("저장할 근무내역이 없습니다. 입력하여 주십시요.");return}if(btnId=="btnSubmit"){for(var i=0;i<$.grdDesc.getRowCount();i++){var week=$.grdDesc.getValue(i).week;var plan_hour=$.grdDesc.getValue(i).plan_hour;if(!week){MessageBoxShow("요일을 선택해 주십시오.");return}else{if(!plan_hour){MessageBoxShow("계획시간을 입력해 주십시오");return}}}var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFOverTimeReq"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if(btnId=="btnTmpSave"){if(saveWFDocument("","N")){saveGian("N")}}}}function saveGian(workType){var json=createJSON_S("N");callQuery(["req",json],"N",$)}function searchWFDocument(workType){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.businessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){log("문서 저장시 오류 발생");return false}if(ds.returnStr){$.varWfDocId=ds.returnStr;log("$.varWfDocId : "+$.varWfDocId)}return true}function getWeekday(sDate){log(sDate);var yy=parseInt(sDate.substr(0,4),10);var mm=sDate.length==8?parseInt(sDate.substr(4,2),10):parseInt(sDate.substr(4,2),10);var dd=sDate.length==8?parseInt(sDate.substr(6),10):parseInt(sDate.substr(8),10);var d=new Date(yy,mm-1,dd);var weekday=[];weekday[0]="0";weekday[1]="1";weekday[2]="2";weekday[3]="3";weekday[4]="4";weekday[5]="5";weekday[6]="6";return weekday[d.getDay()]}function moveWFGeneralProc(){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function parserDate(start_hour,end_hour,calc){var parser=webix.Date.strToDate("%H:%i");var nTotalSec=(parser(end_hour)-parser(start_hour))/1000;var nHour=parseInt(nTotalSec/3600);var nMin=parseInt((nTotalSec%3600)/60);nHour=(nHour<10?"0":"")+nHour;nMin=(nMin<10?"0":"")+nMin;return[nHour,nMin,(nHour+":"+nMin),nTotalSec]}function show_timespan(rId,data,midnight){var str="";if(midnight){str=(Number(data[0])+1)+"시간 "+data[1]+"분"}else{str=data[0]+"시간 "+data[1]+"분"}log(str);$.grdDesc.setValue(rId,"over_time",str)}function calcMilSec(s_value,e_value,f_value){log(s_value);log(e_value);var nTotalSec=Number(s_value)+Number(e_value);if(f_value){nTotalSec+=Number(f_value)}var nHour=parseInt(nTotalSec/3600);var nMin=parseInt((nTotalSec%3600)/60);nHour=(nHour<10?"0":"")+nHour;nMin=(nMin<10?"0":"")+nMin;return[nHour,nMin,(nHour+":"+nMin),nTotalSec]}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function searchOverTime(workType){var json=createJSON_Q1(workType);var ds=callQuerySync(["req",json],$);log(ds);if(ds&&ds.resultList[0]){var totalTime=ds.resultList[0][0].total_time;var actualTotalTime=ds.resultList[0][0].actual_total_time;var avalTime=ds.resultList[0][0].aval_time;$.grdDesc.addRow({total_time:totalTime,actual_total_time:actualTotalTime,aval_time:avalTime});applyTimeCalc(avalTime)}}function applyTimeCalc(time){var hourComboList=[];var miComboList=[{sub_code:"0.5",code_name:"30"}];for(var i=1;i<=time;i++){hourComboList.push({sub_code:i,code_name:i})}if(time){$.grdDesc.setColumnDropDownList("plan_hour_hh",hourComboList,null,true);$.grdDesc.setColumnDropDownList("plan_hour_mm",miComboList,null,true)}else{$.grdDesc.setValue(0,"plan_hour_hh_readonly",true);$.grdDesc.setValue(0,"plan_hour_mm_readonly",true)}}function gridChk(){var rId=$.grdDesc.getSelectedRowIdx();var rowData=$.grdDesc.getValue(rId);if(!rowData.plan_hour_hh&&!rowData.plan_hour_mm){MessageBoxShow("수당 신청 시간을 입력해 주세요.");return false}var avalTime=Number(rowData.aval_time)*60;var hh=Number(rowData.plan_hour_hh||0)*60;var mm=Number(rowData.plan_hour_mm||0);if(avalTime<(hh+mm)){MessageBoxShow("수당신청 총 시간은<br>잔여시간을 초과할 수 없습니다.");return false}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1170);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,410);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,485,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,880,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,880,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.panLeft=new FingerPanel(host,"panLeft",0,0,690,365);$.panLeft.setText("");$.panLeft.setBottomLine(true);$.panLeftTop=new FingerPanel(host,"panLeftTop",0,0,690,55);$.panLeftTop.setText("");$.panLeftTop.setBottomLine(true);$.panRight=new FingerPanel(host,"panRight",700,0,500,365);$.panRight.setText("");$.panRight.setBottomLine(true);$.panDesc=new FingerPanel(host,"panDesc",0,60,690,300);$.panDesc.setText("연장근무수당신청");$.panDesc.setBottomLine(true);$.grdDesc=new FingerDataGrid(host,"grdDesc",0,0,690,255);$.lblDeptName=new FingerLabel(host,"lblDeptName",0,15,100,20);$.lblDeptName.setText("소속");$.lblEmpName=new FingerLabel(host,"lblEmpName",260,15,100,20);$.lblEmpName.setText("성명");$.memMsg=new FingerMemoEdit(host,"memMsg",0,0,495,360);$.txtDeptName=new FingerEdit(host,"txtDeptName",110,15,140,20);$.txtEmpName=new FingerEdit(host,"txtEmpName",370,15,140,20);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.panTitle.setBorder(true);$.panLeftTop.setBorder(true);$.panWFMain.setBorder(false);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.memMsg.setReadOnly(true);$.txtDeptName.setReadOnly(true);$.txtEmpName.setReadOnly(true);$.grdDesc.setColumns([new FingerDataGridColumn("total_time",137,"right","string",[{text:"<br>연장/휴일(이동)<br>/야간근로 총시간",rowspan:2,css:"multi_h_line"}],{readonly:true}),new FingerDataGridColumn("actual_total_time",134,"right","string",[{text:"* 사용가능 총 시간",rowspan:2}],{readonly:true}),new FingerDataGridColumn("aval_time",134,"right","string",[{text:"잔여 시간",rowspan:2}],{readonly:true}),new FingerDataGridColumn("plan_hour_hh",134,"right","string",[{text:"수당 신청 시간",colspan:2},"시간(H)"]),new FingerDataGridColumn("plan_hour_mm",134,"right","string",["","분(M)"])]);$.grdDesc.init({panel:$.panVeichle,nonExcel:true,scroll:"xy",eventCellReadOnly:true,headerRowHeight:35});$.grdDesc.setEditable(true);$.grdDesc.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.txtTitle.setAllowBlank(false,"문서제목");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.panLeft);$.panWFMain.add($.panRight);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panLeft.add($.panLeftTop);$.panLeft.add($.panDesc);$.panLeftTop.add($.lblDeptName);$.panLeftTop.add($.lblEmpName);$.panLeftTop.add($.txtDeptName);$.panLeftTop.add($.txtEmpName);$.panRight.add($.memMsg);$.panDesc.add($.grdDesc);$.txtDeptName.setDefaultValue(g_main.session.getValue("DeptName"));$.txtEmpName.setDefaultValue(g_main.session.getValue("UserName"));$.panLeftTop.clear();var strMsg="결재 완료된 시간 외 초과근무 지시서를 반드시 참조결재로 첨부하시기 바랍니다.";strMsg+="\n브로셔 및 스케줄 스캔해서 첨부 요망";strMsg+="\n\n작성시 유의사항";strMsg+="\n\n가. 근로기준법 제53조 1항에 의거 주 40시간을 초과한 연장(휴일)근로에 대해서는 1주에 12시간을 한도로 운용할 수 있습니다.";strMsg+="\n\n나. 취업규칙 제29조에 의거 12:00~13:00, 18:00~19:00은 휴게시간으로 초과(연장) 근무수당 지급 시간에서 제외됩니다.";strMsg+="\n\n다. 위 양식은 시간외 초과  근무가 발생했을 때 업무내용을 시간대별로 작성해서 제출하셔야 합니다.";strMsg+="\n\n라. 이 양식은 시간외 근무가 지속될 때 평상 근무시간대의 업무를 파악하여 수당지급 기준자료로 활용해야 하므로 불편하시더라도 필히 작성하여 주시기 바랍니다.";strMsg+="\n";strMsg+="\n* 근무시간 작성 시 30분 단위일 경우 0.5로 작성해 주시기 바랍니다.";$.memMsg.setValue(strMsg);searchWFDocument();searchOverTime("Q")};$.callback=function(type,ds){if(type=="Q3"){$.businessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue(ds.resultList[0][0].business_title)}else{if(type=="N"){moveWFGeneralProc()}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);applyTimeCalc(args[6][0].aval_time);setDataGrid([$.grdDesc],args[6],true)}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSubmit"){if(!gridChk()){return}saveWFOverTimeReq(id)}else{if(id=="btnTmpSave"){if(!gridChk()){return}saveWFOverTimeReq(id)}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdDesc"){var grdRow=$.grdDesc.getValue(rId);grdRow.week_readonly=true}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdDesc"){if(cInd=="plan_hour_hh"||cInd=="plan_hour_mm"){var rowData=$.grdDesc.getValue(rId);var avalTime=Number(rowData.aval_time)*60;var hh=Number(rowData.plan_hour_hh)*60;var mm=Number(rowData.plan_hour_mm);if(avalTime<(hh+mm)){MessageBoxShow("수당신청 총 시간은<br>잔여시간을 초과할 수 없습니다.");$.grdDesc.setValue(rId,cInd,oValue||"")}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popModAppr"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveGian("N")}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>