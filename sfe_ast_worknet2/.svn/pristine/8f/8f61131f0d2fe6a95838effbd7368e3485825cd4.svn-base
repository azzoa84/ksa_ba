<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.lblFy=null;$.dteFy=null;$.lblVersion=null;$.cmbVersion=null;$.lblBrand=null;$.mtBrand=null;$.radioAmount=null;$.radioAmt=null;$.radioTotal=null;$.lblDisplay=null;$.chkHalfSum=null;$.chkYearSum=null;$.chkRate=null;$.btnSearch=null;$.panSales=null;$.grdSales=null;$.radioMonthly=null;$.radioYear=null;$.lblSum=null;$.lblInfo=null;$.radioNumberId="TOTAL";$.radioSumId="BTN_MONTHLY";$.editYn="N";$.superAmdinYn="N";$.workType="";$.isExcelUpload=false;$.popData=[];$.fcstColumns=[];$.comboApprStatus=[];$.calcFn={};$.colNameList=[];$.halfColNameList=[];$.fcstList=[];$.nowFyCol={};$.selVersion="";$.bgtType="";$.unitAmt=null;function createJSON_Q(workType,arr){var json=createExecuteParamInfo("P_bgtSalesManagerExF_Q",[workType,($.dteFy.getValue()||""),"",($.cmbVersion.getValue()||""),($.mtBrand.getSelectedCodeList()||""),$.radioNumberId,"INPUT","#UserID#"]);return json}function createJSON_Q1(workType,arr){var json=createExecuteParamInfo("P_bgtSalesManager_Q",[workType,arr[0],arr[1],arr[2],arr[3],"","","","","","","","#UserID#"]);return json}function createJSON_S(workType){var dt=$.grdSales.getAllRows();var json="";var rows=[];var iLen=dt.length;for(var i=0;i<iLen;i++){var rowData=dt[i];if(rowData.gubun=="QTY"&&rowData.product_code){rows.push([workType,rowData.artifact_id,rowData.ver_code,rowData.report_id,rowData.row_seq,rowData.product_code,getSaveRowData(rowData),"#UserID#"])}}json=createExecuteParamInfo("P_bgtSalesManagerExF_S",rows);return json}function createJSON_S1(workType){var json=createExecuteParamInfo("P_bgtSalesManagerExF_S",[workType,"",$.selVersion,"",0,"","","#UserID#"]);return json}function searchExD(workType){var json=createJSON_Q(workType);var ds=callQuerySync(["req",json],"SALES_EXD");return ds}function searchFCST(workType){var json=createJSON_Q(workType);var ds=callQuerySync(["req",json],"SALES_FCST");return ds}function searchBudgetVersion(workType){var json=createJSON_Q(workType);callQuery(["req",json],"SALES_VERSION",$)}function searchBrand(workType){var json=createJSON_Q(workType);callQuery(["req",json],"SALES_BRAND",$)}function searchList(workType,arr){if(!$.panTop.validateControls()){return}var json=createJSON_Q(workType,arr);callQuery(["req",json],"SALES_LIST",$)}function searchUnitAmt(workType,arr){var json=createJSON_Q1(workType,arr);var ds=callQuerySync(["req",json],$);var amt=null;if(ds&&ds.errorCode=="MSG0001"){amt=ds.resultList[0][0].amt}return amt}function saveList(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],"SALES_SAVE",$)}}function deleteList(workType){var json=createJSON_S1(workType);if(json){callExecute(["req",json],"SALES_DELETE",$)}}function initView(){$.radioAmount.setValue("수량");$.radioAmt.setValue("금액");$.radioTotal.setValue("전체");setArrayRadio([$.radioAmount,$.radioAmt,$.radioTotal]);setArrayClickUrl([$.radioAmount],"QTY");setArrayClickUrl([$.radioAmt],"AMT");setArrayClickUrl([$.radioTotal],"TOTAL");setArrayRadioColor([$.radioAmount],"#FFFFFF","#333333");setArrayRadioColor([$.radioAmt],"#FFFFFF","#333333");setArrayRadioColor([$.radioTotal],"#DA1E48","#FFFFFF");$.radioMonthly.setValue("Monthly");$.radioYear.setValue("Year Total");setArrayRadio([$.radioMonthly,$.radioYear]);setArrayClickUrl([$.radioMonthly],"BTN_MONTHLY");setArrayClickUrl([$.radioYear],"BTN_YEAR");setArrayRadioColor([$.radioMonthly],"#DA1E48","#FFFFFF");setArrayRadioColor([$.radioYear],"#FFFFFF","#333333");$.comboApprStatus=bizComponentData2($,"Q1","L_BGT008|L_POR001")}function getFYDate(){var nowDate=getToday();var year=Number(nowDate.substr(0,4));var month=Number(nowDate.substr(4,2));if(month<4){$.dteFy.setValue(year-1)}else{$.dteFy.setValue(year)}}function settingGridRowSpan(){var iLen=$.grdSales.getRowCount();for(var i=0;i<iLen;i++){var rowData=$.grdSales.getValue(i);if(!rowData.product_code){$.grdSales.addSpan(rowData.id,"product_short_name",2,1,"TOTAL","grid-text-center")}}$.grdSales.extObj.refreshColumns()}function renderSearchData(ds){var colList=$.fcstList=ds.resultList[0];var cols=resetSearchGridColumns(colList,"");var dt=ds.resultList[1];var sub=ds.resultList[2];$.bgtType=ds.resultList[3][0].bgt_type;var iLen=dt.length;$.grdSales.resetColumns(cols);$.grdSales.setColumnDropDownList("gubun",$.comboApprStatus.resultList[1]);setDataGrid([$.grdSales],dt,true)}function resetSearchGridColumns(colList,type){$.grdSales.removeColumns();var cols=[];$.colNameList=[];$.halfColNameList=[];$.nowFyCol={};getBaseSearchColumnsQ1(cols);var iLen=colList.length;var iCount=1;var groupCnt=0;for(var i=0;i<iLen;i++){var rowData=colList[i];var columnId="";var columnTxt=filteringData("DATE",rowData.ym);var groupTxt="";var header=[];var fy='<span style="color: blue; font-weight: bold;">(FY'+rowData.fy.substr(2,2)+")</span>";var yy=rowData.yyyy.substr(2,2)+"년";var mm=Number(rowData.mm)+"월";var isNowFy=(rowData.fy==$.dteFy.getValue());if(rowData.spread=="MONTH"){groupCnt++;columnId="ym"+iCount+"_"+rowData.half_gubun;cols.push(new FingerDataGridColumn(columnId,58,"right","int","<br>"+yy+"<br>"+mm,{format:"int",cssFormat:setColumnAuthStyle,sort:null}));if(groupCnt==12){getBaseSearchColumnsQ2(cols,rowData.half_gubun,fy,isNowFy);groupCnt=0}}else{columnId="ym_"+rowData.half_gubun;groupTxt="FY"+columnTxt.substr(0,2);getBaseSearchColumnsQ3(cols,rowData.half_gubun,columnId,groupTxt,fy,isNowFy)}$.colNameList[i]=columnId;iCount++}return cols}$.dashboard_radio_click=function(id,value){if(id.indexOf("BTN")>-1){var bo=false;if(id=="BTN_MONTHLY"){setArrayRadioColor([$.radioMonthly],"#DA1E48","#FFFFFF");setArrayRadioColor([$.radioYear],"#FFFFFF","#333333")}else{if(id=="BTN_YEAR"){setArrayRadioColor([$.radioMonthly],"#FFFFFF","#333333");setArrayRadioColor([$.radioYear],"#DA1E48","#FFFFFF");bo=true}}monthlyVisibleColumn(bo);$.radioSumId=id}else{if(id=="QTY"){setArrayRadioColor([$.radioAmount],"#DA1E48","#FFFFFF");setArrayRadioColor([$.radioAmt],"#FFFFFF","#333333");setArrayRadioColor([$.radioTotal],"#FFFFFF","#333333")}else{if(id=="AMT"){setArrayRadioColor([$.radioAmount],"#FFFFFF","#333333");setArrayRadioColor([$.radioAmt],"#DA1E48","#FFFFFF");setArrayRadioColor([$.radioTotal],"#FFFFFF","#333333")}else{if(id=="TOTAL"){setArrayRadioColor([$.radioAmount],"#FFFFFF","#333333");setArrayRadioColor([$.radioAmt],"#FFFFFF","#333333");setArrayRadioColor([$.radioTotal],"#DA1E48","#FFFFFF")}}}$.radioNumberId=id;searchList("","")}};function displayGridRow(type,gubun){var dt=deepCopyObj($.grdSales.getAllRows());var filterData=dt.filter(function(o){return o.gubun==gubun});setDataGrid([$.grdSales],filterData,true)}function filteringData(type,value){var str="";if(type=="DATE"){var yyyy=value.substr(2,2);var mm=value.substr(4,2);if(mm=="YR"){mm=""}else{mm=Number(mm)+"월"}str=yyyy+"년 "+mm}return str}function brandChk(){var brandList=($.mtBrand.getSelectedCodeList()||"");if(!brandList){MessageBoxShow("브랜드를 선택해 주세요.");return false}return true}function getBaseSearchColumnsQ1(arr){var fy=$.dteFy.getValue();var yy=fy.toString().substr(2,2);var colName=["FY"+yy+"BUD","내부목표"];arr.push(new FingerDataGridColumn("row_disp_lv1",60,"left","string","품목명",{rowSpan:true,readonly:true,cssFormat:setColumnBaseColor,sort:null}));arr.push(new FingerDataGridColumn("row_disp_lv2",70,"left","string","회사",{rowSpan:true,readonly:true,cssFormat:setColumnBaseColor,sort:null}));arr.push(new FingerDataGridColumn("row_disp_lv3",80,"left","string","채널",{readonly:true,cssFormat:setColumnBaseColor,sort:null}));arr.push(new FingerDataGridColumn("gubun",50,"center","string","<br>수량<br>/금액",{readonly:true,cssFormat:setColumnBaseColor,sort:null}));arr.push(new FingerDataGridColumn("product_short_name",120,"left","string","제형/규격",{readonly:true,cssFormat:setColumnBaseColor,sort:null}));arr.push(new FingerDataGridColumn("sale_amt1",60,"right","int",[{text:"과거 소화실적",colspan:3},"FY"+(yy-3)],{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null}));arr.push(new FingerDataGridColumn("sale_amt2",60,"right","int",["","FY"+(yy-2)],{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null}));arr.push(new FingerDataGridColumn("sale_amt3",60,"right","int",["","FY"+(yy-1)],{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null}));arr.push(new FingerDataGridColumn("fy_target",80,"right","int",colName,{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null}))}function getBaseSearchColumnsQ2(arr,suffix,fy,isNowFy){suffix=suffix.substr(0,1)+"Y";$.halfColNameList.push({colId:"first_half_"+suffix,type:"M"});$.halfColNameList.push({colId:"second_half_"+suffix,type:"M"});$.halfColNameList.push({colId:"year_"+suffix,type:"M"});arr.push(new FingerDataGridColumn("first_half_"+suffix,80,"right","int","<br>"+fy+"<br>상반기",{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null,sideColumn:true}));arr.push(new FingerDataGridColumn("second_half_"+suffix,80,"right","int","<br>"+fy+"<br>하반기",{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null,sideColumn:true}));arr.push(new FingerDataGridColumn("year_"+suffix,80,"right","int","<br>"+fy+"<br>計",{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null,sideColumn:true}));if(isNowFy){$.nowFyCol={yearCol:"year_"+suffix,diffCol:"fy_diff",gubun:suffix.substr(0,1)};$.halfColNameList.push({colId:"fy_diff",type:"M"});arr.push(new FingerDataGridColumn("fy_diff",80,"right","int","<br>"+fy+"<br>차이",{readonly:true,format:"int",cssFormat:setColumnDisableColor,sort:null,sideColumn:true}))}}function getBaseSearchColumnsQ3(arr,suffix,columnId,groupTxt,fy,isNowFy){suffix=suffix.substr(0,1)+"Y";$.halfColNameList.push({colId:"year_"+columnId,type:"M"});arr.push(new FingerDataGridColumn("year_"+columnId,80,"right","int","<br>"+fy+"<br>計",{format:"int",cssFormat:setColumnAuthStyle,sort:null,sideColumn:true}));if(isNowFy){$.nowFyCol={yearCol:"year_"+columnId,diffCol:"fy_diff",gubun:columnId.substr(0,1)};$.halfColNameList.push({colId:"fy_diff",type:"M"});arr.push(new FingerDataGridColumn("fy_diff",80,"right","int","<br>"+fy+"<br>차이",{format:"int",cssFormat:setColumnDisableColor,sort:null,sideColumn:true}))}}function getBaseExcelColumns(arr){arr.push(new FingerDataGridColumn("row_disp_lv1",90,"center","string","품목명"));arr.push(new FingerDataGridColumn("row_disp_lv2",100,"center","string","회사"));arr.push(new FingerDataGridColumn("row_disp_lv3",100,"center","string","채널"));arr.push(new FingerDataGridColumn("gubun",80,"center","string","수량/금액"));arr.push(new FingerDataGridColumn("product_short_name",100,"center","string","제형/규격"))}function setColumnReadonly(rowData){var iLen=$.fcstColumns.length;for(var i=0;i<iLen;i++){var r=$.fcstColumns[i];if(r.mm=="YR"){rowData["year_ym_"+r.half_gubun+"_readonly"]=true}else{rowData["ym"+(i+1)+"_"+r.half_gubun+"_readonly"]=true}}}function getSaveRowData(rowData){var obj=Object.keys(rowData);var iLen=obj.length;var iCount=0;var arr=[];for(var i=0;i<iLen;i++){if(obj[i].indexOf("ym")>-1){arr[iCount]=(rowData[obj[i]]||"");iCount++}}return arr.join("|")}function getUnitAmt(productCode,cInd){var arr=[];var colId=cInd.replace("year_","");var index=$.colNameList.indexOf(colId);var row=$.fcstList[index];arr=[row.yyyy,row.mm,$.cmbVersion.getValue(),productCode];$.unitAmt=searchUnitAmt("Q_UNIT",arr)}function matchingExcelData(dt){var iLen=dt.length;var jLen=$.popData.length;for(var i=0;i<iLen;i++){for(var j=0;j<jLen;j++){var popData=$.popData[j];if(dt[i].row_disp_lv1==popData.row_disp_lv1&&dt[i].row_disp_lv2==popData.row_disp_lv2&&dt[i].row_disp_lv3==popData.row_disp_lv3&&dt[i].gubun=="QTY"){var obj=Object.keys(popData);var kLen=obj.length;for(var k=0;k<kLen;k++){if(obj[k].indexOf("ym")>-1&&popData[obj[k]]&&popData[obj[k]]!="-"){popData[obj[k]]=Number(popData[obj[k]].replace(",",""))}}popData.gubun="QTY";dt[i]=jQuery.extend(false,dt[i],popData)}}}}function chkInputAuth(rowData){if($.editYn=="N"){return false}if(rowData.company_type=="AKR_OS"||rowData.gubun=="AMT"||!rowData.product_code||rowData.row_type=="TOTAL_SUM"){return false}return true}function setColumnBaseColor(cellValue,rowItem,rowId,colId){return{background:"#FFFFFF !important"}}function setColumnAuthStyle(cellValue,rowItem,rowId,colId){var style={};if(chkInputAuth(rowItem)){style.background="#FFFFFF !important"}else{style.background="#f3f3f3 !important"}if(!rowItem.product_code){style.color="blue !important";style["font-weight"]="bold"}return style}function setColumnDisableColor(cellValue,rowItem,rowId,colId){var style={background:"#f3f3f3 !important"};if(!rowItem.product_code){style.color="blue !important";style["font-weight"]="bold"}return style}$.calcFn={bindGroupSum:function(dt,rowData,cInd){var iLen=dt.length;var lv1QtySum=0;var lv1AmtSum=0;var lv2QtySum=0;var lv2AmtSum=0;var lv1QtyRowIdx="";var lv1AmtRowIdx="";var lv2QtyRowIdx="";var lv2AmtRowIdx="";var productQtySum=0;var productAmtSum=0;var productQtyRowIdx="";var productAmtRowIdx="";var productlv1QtySum=0;var productlv1AmtSum=0;var productlv1QtyRowIdx="";var productlv1AmtRowIdx="";var productlv2QtySum=0;var productlv2AmtSum=0;var productlv2QtyRowIdx="";var productlv2AmtRowIdx="";var isLv1=false;var isLv2=false;var isProduct=false;var isLv1Product=false;var isLv2Product=false;for(var i=0;i<iLen;i++){var row=dt[i];if(row.company_type!="ARK_OS"&&row.row_type!="TOTAL_SUM"){if(row.product_code==rowData.product_code&&row.lv1_key==rowData.lv1_key){lv1QtySum+=(row.gubun=="QTY"?Number(row[cInd]):0);lv1AmtSum+=(row.gubun=="AMT"?Number(row[cInd]):0)}if(row.product_code==rowData.product_code&&row.lv2_key==rowData.lv2_key){lv2QtySum+=(row.gubun=="QTY"?Number(row[cInd]):0);lv2AmtSum+=(row.gubun=="AMT"?Number(row[cInd]):0)}if(row.row_seq==rowData.row_seq&&row.product_code){productQtySum+=(row.gubun=="QTY"?Number(row[cInd]):0);productAmtSum+=(row.gubun=="AMT"?Number(row[cInd]):0)}if(row.product_code){productlv1QtySum+=(row.gubun=="QTY"?Number(row[cInd]):0);productlv1AmtSum+=(row.gubun=="AMT"?Number(row[cInd]):0)}if(row.row_disp_lv2==rowData.row_disp_lv2&&row.product_code){productlv2QtySum+=(row.gubun=="QTY"?Number(row[cInd]):0);productlv2AmtSum+=(row.gubun=="AMT"?Number(row[cInd]):0)}}if(row.product_code==rowData.product_code&&row.company_type=="AKR_OS"){isLv1=true;if(row.gubun=="QTY"){lv1QtyRowIdx=row.id}else{if(row.gubun=="AMT"){lv1AmtRowIdx=row.id}}}if(row.product_code==rowData.product_code&&row.company_type!="AKR_OS"&&row.row_type=="TOTAL_SUM"){isLv2=true;if(row.gubun=="QTY"){lv2QtyRowIdx=row.id}else{if(row.gubun=="AMT"){lv2AmtRowIdx=row.id}}}if(row.row_seq==rowData.row_seq&&!row.product_code){isProduct=true;if(row.gubun=="QTY"){productQtyRowIdx=row.id}else{if(row.gubun=="AMT"){productAmtRowIdx=row.id}}}if(row.company_type=="AKR_OS"&&!row.product_code){isLv1Product=true;if(row.gubun=="QTY"){productlv1QtyRowIdx=row.id}else{if(row.gubun=="AMT"){productlv1AmtRowIdx=row.id}}}if(row.company_type!="AKR_OS"&&row.row_type=="TOTAL_SUM"&&!row.product_code){isLv2Product=true;if(row.gubun=="QTY"){productlv2QtyRowIdx=row.id}else{if(row.gubun=="AMT"){productlv2AmtRowIdx=row.id}}}}if(isLv1){$.grdSales.setValue(lv1QtyRowIdx,cInd,lv1QtySum||null);if($.radioNumberId!="QTY"){$.grdSales.setValue(lv1AmtRowIdx,cInd,lv1AmtSum||null)}}if(isLv2){$.grdSales.setValue(lv2QtyRowIdx,cInd,lv2QtySum||null);if($.radioNumberId!="QTY"){$.grdSales.setValue(lv2AmtRowIdx,cInd,lv2AmtSum||null)}}if(isProduct){$.grdSales.setValue(productQtyRowIdx,cInd,productQtySum||null);if($.radioNumberId!="QTY"){$.grdSales.setValue(productAmtRowIdx,cInd,productAmtSum||null)}}if(isLv1Product){$.grdSales.setValue(productlv1QtyRowIdx,cInd,productlv1QtySum||null);if($.radioNumberId!="QTY"){$.grdSales.setValue(productlv1AmtRowIdx,cInd,productlv1AmtSum||null)}}if(isLv2Product){$.grdSales.setValue(productlv2QtyRowIdx,cInd,productlv2QtySum||null);if($.radioNumberId!="QTY"){$.grdSales.setValue(productlv2AmtRowIdx,cInd,productlv2AmtSum||null)}}},bindNextRowAmt:function(dt,rowData,amtRowData,rId,cInd){var amt=(Number(rowData[cInd])*Number($.unitAmt)/1000000).toFixed(0);if(!Number(amt)){amt=null}$.grdSales.setValue(amtRowData.id,cInd,amt)},searchAmtRow:function(dt,rowData){var amtRow=dt.filter(function(o){return o.row_seq==rowData.row_seq&&o.product_code==rowData.product_code&&o.gubun=="AMT"});return amtRow[0]},bindHalfTotalRowSum:function(rowData,rId,gubun,suffix,type){var matchDateColList=$.colNameList.filter(function(o){return o.substr(o.length-2,1)==gubun});var firstHalfSum=null;var secondHalfSum=null;var yearSum=null;var sumList=this.calcHalfSum(matchDateColList,rId);firstHalfSum=sumList[0];secondHalfSum=sumList[1];yearSum=(firstHalfSum+secondHalfSum)||null;$.grdSales.setValue(rId,"first_half_"+suffix,firstHalfSum||null);$.grdSales.setValue(rId,"second_half_"+suffix,secondHalfSum||null);$.grdSales.setValue(rId,"year_"+suffix,yearSum||null)},calcHalfSum:function(colList,rId){var sum=[0,0];var len=colList.length;for(var i=0;i<len;i++){var col=colList[i];var suffix=col.substr(col.length-1,1);if(suffix=="F"){sum[0]+=Number($.grdSales.getValue(rId,col))}if(suffix=="S"){sum[1]+=Number($.grdSales.getValue(rId,col))}}return sum},bindRateGroup:function(dt,rowData,rId,gubun,suffix,isMultiProduct){var iLen=dt.length;var rate=null;var filterData=[];var lv1QtyRow={};var lv1AmtRow={};var cInd="year_"+suffix;var rateCol="t_rate_"+gubun+"Y";var isAkrOs=true;filterData=this.getFilterData(dt,"AKR_OS",isMultiProduct);if(!filterData.length){isAkrOs=false;filterData=this.getFilterData(dt,"GROUP_TOT",isMultiProduct)}if(filterData.length){lv1QtyRow=filterData[0];if($.radioNumberId!="QTY"){lv1AmtRow=filterData[1]}for(var i=0;i<iLen;i++){var rowData=dt[i];var totSum=0;var calcYn="N";if(rowData.company_type!="AKR_OS"&&rowData.row_type!="TOTAL_SUM"){totSum=(rowData.gubun=="QTY"?Number(lv1QtyRow[cInd]):Number(lv1AmtRow[cInd]));if(isMultiProduct){if(!rowData.product_code){calcYn="Y"}}else{calcYn="Y"}if(calcYn=="Y"){rate=Number(rowData[cInd])/totSum;$.grdSales.setValue(rowData.id,rateCol,rate||null)}}}}if($.grdSales.getValue(lv1QtyRow.id,cInd)){$.grdSales.setValue(lv1QtyRow.id,rateCol,1)}if($.radioNumberId!="QTY"&&$.grdSales.getValue(lv1AmtRow.id,cInd)){$.grdSales.setValue(lv1AmtRow.id,rateCol,1)}if(isAkrOs){var qtyRate=0;var amtRate=0;var rowDispLv2="";filterData=this.getFilterData(dt,"GROUP_TOT",isMultiProduct);if(filterData.length){rowDispLv2=filterData[0].row_disp_lv2;for(var i=0;i<iLen;i++){var rowData=dt[i];if(rowData.company_type!="AKR_OS"&&rowData.row_type!="TOTAL_SUM"&&rowData.row_disp_lv2==rowDispLv2){if(isMultiProduct){if(!rowData.product_code){calcYn="Y"}}else{calcYn="Y"}if(calcYn=="Y"){if(rowData.gubun=="QTY"){qtyRate+=Number(rowData[rateCol])}else{amtRate+=Number(rowData[rateCol])}}}}$.grdSales.setValue(filterData[0].id,rateCol,qtyRate||null);$.grdSales.setValue(filterData[1].id,rateCol,amtRate||null)}}},getFilterData:function(dt,type,isMultiProduct){var filterData=[];if(type=="AKR_OS"){if(isMultiProduct){filterData=dt.filter(function(o){return o.company_type=="AKR_OS"&&!o.product_code})}else{filterData=dt.filter(function(o){return o.company_type=="AKR_OS"})}}else{if(isMultiProduct){filterData=dt.filter(function(o){return o.company_type!="AKR_OS"&&o.row_type=="TOTAL_SUM"&&!o.product_code})}else{filterData=dt.filter(function(o){return o.company_type!="AKR_OS"&&o.row_type=="TOTAL_SUM"})}}return filterData}};function summaryVisibleColumn(col,val){var bo=(val=="Y"?false:true);var iLen=$.halfColNameList.length;for(var i=0;i<iLen;i++){var colId=$.halfColNameList[i].colId;if(colId.indexOf(col)>-1){$.grdSales.setColumnHidden(colId,bo)}}}function monthlyVisibleColumn(bo){var iLen=$.colNameList.length;for(var i=0;i<iLen;i++){var colId=$.colNameList[i];var suffix=colId.substr(colId.length-1,1);if(suffix!="Y"){$.grdSales.setColumnHidden(colId,bo)}}}function setPanelButtonDisplay(){var bo=($.editYn=="N"?false:true);if($.editYn=="N"){$.panSales.disableButton(["btnSave","btnClear"])}else{$.panSales.enableButton(["btnSave","btnClear"])}$.btnExcelDownload.setEnable(bo);$.btnExcelUpload.setEnable(bo)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,905);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,145);$.panTop.setText("");$.panTop.setBottomLine(true);$.lblFy=new FingerLabel(host,"lblFy",0,15,100,20);$.lblFy.setText("연도");$.dteFy=new FingerDateEdit(host,"dteFy",105,15,152,20);$.lblVersion=new FingerLabel(host,"lblVersion",255,15,100,20);$.lblVersion.setText("버전");$.cmbVersion=new FingerComboBox(host,"cmbVersion",360,15,140,20);$.lblBrand=new FingerLabel(host,"lblBrand",505,15,100,20);$.lblBrand.setText("품목");$.mtBrand=new FingerMultiSelect(host,"mtBrand",610,15,225,110);$.radioAmount=new FingerHTMLView(host,"radioAmount",105,50,50,20);$.radioAmt=new FingerHTMLView(host,"radioAmt",155,50,50,20);$.radioTotal=new FingerHTMLView(host,"radioTotal",205,50,50,20);$.lblDisplay=new FingerLabel(host,"lblDisplay",0,50,100,20);$.lblDisplay.setText("수량/금액표시");$.chkHalfSum=new FingerCheckBox(host,"chkHalfSum",100,85,115,20);$.chkHalfSum.setText("반기(합)표시");$.chkYearSum=new FingerCheckBox(host,"chkYearSum",240,85,115,20);$.chkYearSum.setText("연도(합)표시");$.chkRate=new FingerCheckBox(host,"chkRate",380,85,115,20);$.chkRate.setText("비중/성장률");$.btnSearch=new FingerButton(host,"btnSearch",875,15,80,20);$.btnSearch.setText("조회");$.panSales=new FingerPanel(host,"panSales",0,155,1200,720);$.panSales.setText("매상예산");$.panSales.setBottomLine(true);$.grdSales=new FingerDataGrid(host,"grdSales",0,0,1200,675);$.radioMonthly=new FingerHTMLView(host,"radioMonthly",360,50,75,20);$.radioYear=new FingerHTMLView(host,"radioYear",435,50,95,20);$.lblSum=new FingerLabel(host,"lblSum",255,50,100,20);$.lblSum.setText("월별/연도");$.lblInfo=new FingerLabel(host,"lblInfo",900,171,110,20);$.lblInfo.setText("(* 금액 : 백만원)");$.panTop.setBorder(true);$.panSales.addButtons(["btnSave"]);$.panSales.addButton("btnClear","초기화");$.panSales.setButtonAction("btnClear","custom",80);$.dteFy.setDateFormat("yyyy");$.dteFy.setAllowBlank(false,"연도");$.cmbVersion.setAllowBlank(false,"버전");$.cmbVersion.setEmptyRow(true);$.cmbVersion.setColumnConfig([{id:"sub_code",width:110},{id:"code_name",width:130},{id:"extra_field1",width:0.1},{id:"extra_field2",width:0.1},{id:"extra_field3",width:0.1}]);$.mtBrand.setTitle("전체");$.grdSales.setColumns([]);$.grdSales.init({scroll:"xy",leftSplit:5,select:"cell",headerRowHeight:40});$.grdSales.setBorder(false);$.grdSales.setEditable(true);$.chkHalfSum.setValue("Y");$.chkYearSum.setValue("Y");$.chkRate.setValue("Y");$.chkRate.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panSales);$.panTop.add($.lblFy);$.panTop.add($.dteFy);$.panTop.add($.lblVersion);$.panTop.add($.cmbVersion);$.panTop.add($.lblBrand);$.panTop.add($.mtBrand);$.panTop.add($.lblDisplay);$.panTop.add($.radioAmount);$.panTop.add($.radioAmt);$.panTop.add($.radioTotal);$.panTop.add($.chkHalfSum);$.panTop.add($.chkYearSum);$.panTop.add($.chkRate);$.panTop.add($.btnSearch);$.panTop.add($.radioMonthly);$.panTop.add($.radioYear);$.panTop.add($.lblSum);$.panSales.add($.grdSales);getFYDate();initView();searchBrand("Q_BRAND")};$.callback=function(type,ds){if(type=="SALES_VERSION"){$.cmbVersion.clear();if(ds&&ds.errorCode=="MSG0001"){setComboBind([$.cmbVersion],ds)}}else{if(type=="SALES_BRAND"){$.mtBrand.setData1(ds.resultList[0],"product_code","product_name")}else{if(type=="SALES_LIST"){$.fcstColumns=ds.resultList[0];renderSearchData(ds);$.grdSales.setRowSpanCustom("row_disp_lv2");$.selVersion=$.cmbVersion.getValue()}else{if(type=="SALES_SAVE"){if(ds){MessageBoxShow("저장 되었습니다.");searchList("Q","")}}else{if(type=="SALES_DELETE"){if(ds){MessageBoxShow("삭제 되었습니다.");searchList("Q","")}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList("Q","")}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chkHalfSum"){summaryVisibleColumn("half",value)}else{if(id=="chkYearSum"){summaryVisibleColumn("year",value)}else{if(id=="chkRate"){summaryVisibleColumn("rate",value)}}}};$.fingercombobox_change=function(id,value){if(id=="cmbVersion"){if(value){$.editYn=$.cmbVersion.getValue("extra_field1");$.superAmdinYn=$.cmbVersion.getValue("extra_field3")}else{$.editYn="N"}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteFy"){if(!value){return}searchBudgetVersion("Q_VER")}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdSales"){var rowData=$.grdSales.getValue(rId);if(!chkInputAuth(rowData)){setColumnReadonly(rowData)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdSales"){if(cInd.indexOf("ym")>-1){var inputData=nValue.toString();if(isNaN(inputData)){$.grdSales.setValue(rId,cInd,oValue==""?"":oValue);return}else{$.grdSales.setValue(rId,cInd,Math.floor(nValue))}var dt=$.grdSales.getAllRows();var rowData=$.grdSales.getValue(rId);var filterData=dt.filter(function(o){return o.row_disp_lv1==rowData.row_disp_lv1});var amtRowData=$.calcFn.searchAmtRow(filterData,rowData);var isMultiProduct=(rowData.row_seq_group_cnt>2?true:false);getUnitAmt(rowData.product_code,cInd);if($.radioNumberId!="QTY"){$.calcFn.bindNextRowAmt(filterData,rowData,amtRowData,rId,cInd)}$.calcFn.bindGroupSum(filterData,rowData,cInd);var len=cInd.length;var gubun=cInd.substr(len-2,1);var suffix="";if(cInd.indexOf("year")>-1){suffix="ym_"+gubun+"Y"}else{suffix=gubun+"Y";$.calcFn.bindHalfTotalRowSum(rowData,rId,gubun,suffix,"QTY");if($.radioNumberId!="QTY"){$.calcFn.bindHalfTotalRowSum(amtRowData,amtRowData.id,gubun,suffix,"AMT")}$.calcFn.bindGroupSum(filterData,rowData,"first_half_"+suffix);$.calcFn.bindGroupSum(filterData,rowData,"second_half_"+suffix);$.calcFn.bindGroupSum(filterData,rowData,"year_"+suffix)}if(gubun==$.nowFyCol.gubun){var iLen=filterData.length;for(var i=0;i<iLen;i++){var row=filterData[i];var id=row.id;var targetVal=Number($.grdSales.getValue(id,"fy_target"))||0;var nowVal=Number($.grdSales.getValue(id,$.nowFyCol.yearCol))||0;var diff=(!targetVal||!nowVal?null:(nowVal-targetVal));$.grdSales.setValue(id,$.nowFyCol.diffCol,diff)}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panSales"){$.grdSales.editStop();if($.grdSales.getRowCount()<1){MessageBoxShow("저장할 내역이 없습니다.");return}if(btnId=="btnSave"){confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){var workType=($.bgtType=="D"?"N":"N_D");saveList(workType)}})}else{if(btnId=="btnClear"){confirmBoxShow("초기화 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("D")}})}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>