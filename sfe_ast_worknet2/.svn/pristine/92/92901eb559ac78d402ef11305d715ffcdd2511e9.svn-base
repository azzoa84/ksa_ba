<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panInfo=null;$.lblDept=null;$.cmbDept=null;$.lblEmp=null;$.cmbEmp=null;$.lblRequestId=null;$.txtRequestId=null;$.lblType=null;$.rdoType=null;$.lblTitle=null;$.txtTitle=null;$.panManagerOpinion=null;$.memdescr=null;$.lbldescr=null;$.memMangerOpinion=null;$.panHeadOpinion=null;$.memHeadOpinion=null;$.panCPOpinion=null;$.memCPOpinion=null;$.panFile=null;$.grdFile=null;$.btnSaveMgrOpinion=null;$.btnMgrApprove=null;$.btncomplete=null;$.btnSaveHeadOpinion=null;$.btnHeadApprove=null;$.btnNeedMore=null;$.btnCPComplete=null;$.btnSaveCPOpinion=null;$.panGuideLine=null;$.lblGuide=null;$.cmbGuideType=null;$.btnViewGuideLine=null;$.btnCommittee=null;function cmbDeptChange(){var strQuery=" and dept_code = '"+$.cmbDept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cmbEmp.clear();$.cmbEmp.setColumn("employee_id","emp_name");setComboBind([$.cmbEmp],ds)}function checkAuthority(){if(g_main.session.getValue("EmpCode")==$.cmbEmp.getValue()){$.txtTitle.setReadOnly(false);$.memdescr.setReadOnly(false);$.panInfo.enableButton(["all"]);$.txtTitle.setAllowBlank(false,"안건제목");$.memdescr.setAllowBlank(false,"상세내용")}if((g_main.session.getValue("EmpCode")==$.manager_id)&&(g_main.session.getValue("EmpCode")!=$.cmbEmp.getValue())&&$.manager_status!="50"){$.memMangerOpinion.setReadOnly(false);$.btnSaveMgrOpinion.setEnable(true);$.btnMgrApprove.setEnable(true)}if(g_main.session.getValue("EmpCode")==$.head_id&&$.manager_status=="50"){$.memHeadOpinion.setReadOnly(false);$.btncomplete.setEnable(true);$.btnSaveHeadOpinion.setEnable(true);$.btnHeadApprove.setEnable(true);if(g_main.session.getValue("EmpCode")==$.manager_id){$.memHeadOpinion.setReadOnly(true);$.btncomplete.setEnable(false);$.btnSaveHeadOpinion.setEnable(false);$.btnHeadApprove.setEnable(false)}}if(g_main.session.getValue("EmpCode")==$.answerer_id){$.memCPOpinion.setReadOnly(false);$.btnNeedMore.setEnable(true);$.btnCPComplete.setEnable(true);$.btnSaveCPOpinion.setEnable(true);$.btnCommittee.setEnable(true)}}function createJSON_S(workType){var fileyn="N";var strserver_path="";var strserver_fname="";var strlocal_fname="";var strseq="";var strcreate_user="";if($.grdFile.getSelectedRowIdx()>=0){for(var i=0;i<$.grdFile.getRowCount();i++){if(i>0){strserver_path+="|";strserver_fname+="|";strlocal_fname+="|";strseq+="|";strcreate_user+="|"}strserver_path+=$.grdFile.getValue(i,"server_path");strserver_fname+=$.grdFile.getValue(i,"server_fname");strlocal_fname+=$.grdFile.getValue(i,"local_fname");strseq+=$.grdFile.getValue(i,"seq");strcreate_user+=$.grdFile.getValue(i,"upload_userid");fileyn="Y"}}var json=createExecuteParamInfo("P_crmCommunicationProcContent_S",[workType,workType=="N"?"":$.txtRequestId.getValue(),$.cmbDept.getValue(),$.cmbEmp.getValue(),$.rdoType.getValue(),$.txtTitle.getValue(),$.memdescr.getValue(),$.memMangerOpinion.getValue(),$.memHeadOpinion.getValue(),$.memCPOpinion.getValue(),fileyn,strserver_path,strserver_fname,strlocal_fname,strseq,strcreate_user,g_main.session.getValue("DeptCode"),g_main.session.getValue("EmpCode")]);return json}function saveCrmCommunicationProcContent(workType){if(!validateControls([$.txtTitle,$.memdescr])){return}var json=createJSON_S(workType);callQuery(["req",json],workType,$)}function saveCommunication(){if(!validateControls([$.txtTitle,$.memdescr])){return}var workType="";if($.txtRequestId.getValue()==""){workType="N"}else{workType="U"}var json=createJSON_S(workType);callQuery(["req",json],workType,$)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1115,740);$.panMain.setText("");$.panMain.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",0,0,950,300);$.panInfo.setText("기초 정보");$.panInfo.setBottomLine(true);$.lblDept=new FingerLabel(host,"lblDept",0,10,100,20);$.lblDept.setText("소속부서");$.cmbDept=new FingerComboBox(host,"cmbDept",105,10,140,20);$.lblEmp=new FingerLabel(host,"lblEmp",240,10,100,20);$.lblEmp.setText("기안자");$.cmbEmp=new FingerComboBox(host,"cmbEmp",345,10,140,20);$.lblRequestId=new FingerLabel(host,"lblRequestId",465,10,100,20);$.lblRequestId.setText("번호");$.txtRequestId=new FingerEdit(host,"txtRequestId",570,10,140,20);$.lblType=new FingerLabel(host,"lblType",0,40,100,20);$.lblType.setText("신청구분");$.rdoType=new FingerRadioBox(host,"rdoType",105,40,140,20);$.lblTitle=new FingerLabel(host,"lblTitle",0,70,100,20);$.lblTitle.setText("안건제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,70,440,20);$.panManagerOpinion=new FingerPanel(host,"panManagerOpinion",555,53,395,190);$.panManagerOpinion.setText("팀,소장 의견");$.panManagerOpinion.setBottomLine(true);$.memdescr=new FingerMemoEdit(host,"memdescr",105,100,435,140);$.lbldescr=new FingerLabel(host,"lbldescr",0,100,100,20);$.lbldescr.setText("상세내용");$.memMangerOpinion=new FingerMemoEdit(host,"memMangerOpinion",0,0,390,140);$.panHeadOpinion=new FingerPanel(host,"panHeadOpinion",0,310,550,190);$.panHeadOpinion.setText("부서장 의견");$.panHeadOpinion.setBottomLine(true);$.memHeadOpinion=new FingerMemoEdit(host,"memHeadOpinion",0,0,545,140);$.panCPOpinion=new FingerPanel(host,"panCPOpinion",560,310,555,190);$.panCPOpinion.setText("CP팀장 의견");$.panCPOpinion.setBottomLine(true);$.memCPOpinion=new FingerMemoEdit(host,"memCPOpinion",0,0,550,140);$.panFile=new FingerPanel(host,"panFile",0,515,1115,210);$.panFile.setText("첨부파일");$.panFile.setBottomLine(true);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,1115,165);$.btnSaveMgrOpinion=new FingerButton(host,"btnSaveMgrOpinion",210,-37.5,100,20);$.btnSaveMgrOpinion.setText("의견저장");$.btnMgrApprove=new FingerButton(host,"btnMgrApprove",292.5,-37.5,100,20);$.btnMgrApprove.setText("승인");$.btncomplete=new FingerButton(host,"btncomplete",260,-37.5,120,20);$.btncomplete.setText("내부협의완료");$.btnSaveHeadOpinion=new FingerButton(host,"btnSaveHeadOpinion",365,-37.5,100,20);$.btnSaveHeadOpinion.setText("의견저장");$.btnHeadApprove=new FingerButton(host,"btnHeadApprove",450,-37.5,100,20);$.btnHeadApprove.setText("승인");$.btnNeedMore=new FingerButton(host,"btnNeedMore",265,-37.5,120,20);$.btnNeedMore.setText("추가검토필요");$.btnCPComplete=new FingerButton(host,"btnCPComplete",370,-37.5,100,20);$.btnCPComplete.setText("협의완료");$.btnSaveCPOpinion=new FingerButton(host,"btnSaveCPOpinion",455,-37.5,100,20);$.btnSaveCPOpinion.setText("의견저장");$.panGuideLine=new FingerPanel(host,"panGuideLine",960,45,155,255);$.panGuideLine.setText("");$.panGuideLine.setBottomLine(true);$.lblGuide=new FingerLabel(host,"lblGuide",15,30,100,20);$.lblGuide.setText("GuideLine");$.cmbGuideType=new FingerComboBox(host,"cmbGuideType",5,60,140,20);$.btnViewGuideLine=new FingerButton(host,"btnViewGuideLine",15,90,140,20);$.btnViewGuideLine.setText("내용보기");$.btnCommittee=new FingerButton(host,"btnCommittee",15,220,140,20);$.btnCommittee.setText("Committee완료");$.panInfo.addButtons(["btnDelete","btnSave"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panGuideLine.setBorder(true);$.rdoType.addButtons([{sub_code:"CP",code_name:"CP"}]);$.cmbGuideType.setEmptyRow(true);$.panManagerOpinion.setBorder(false);$.panHeadOpinion.setBorder(false);$.panCPOpinion.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("seq",0,"left","string","연번",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("file_type",215,"left","string","자료유형"),new FingerDataGridColumn("local_fname",665,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("upload_user",215,"left","string","올린이"),new FingerDataGridColumn("upload_userid",90,"left","string","올린이사번",{hidden:true})]);$.grdFile.init({isFilter:false});$.grdFile.setEditable(false);$.cmbDept.setEnable(false);$.cmbEmp.setEnable(false);$.txtRequestId.setReadOnly(true);$.rdoType.setEnable(false);$.panInfo.disableButton(["all"]);$.txtTitle.setReadOnly(true);$.memdescr.setReadOnly(true);$.memMangerOpinion.setReadOnly(true);$.btnSaveMgrOpinion.setEnable(false);$.btnMgrApprove.setEnable(false);$.memHeadOpinion.setReadOnly(true);$.btncomplete.setEnable(false);$.btnSaveHeadOpinion.setEnable(false);$.btnHeadApprove.setEnable(false);$.memCPOpinion.setReadOnly(true);$.btnNeedMore.setEnable(false);$.btnCPComplete.setEnable(false);$.btnSaveCPOpinion.setEnable(false);$.btnCommittee.setEnable(false);$.rdoType.setValue("CP");$.txtTitle.setAllowBlank(false,"안건제목");$.memdescr.setAllowBlank(false,"상세내용");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panInfo);$.panMain.add($.panHeadOpinion);$.panMain.add($.panCPOpinion);$.panMain.add($.panFile);$.panMain.add($.panGuideLine);$.panInfo.add($.lblDept);$.panInfo.add($.cmbDept);$.panInfo.add($.lblEmp);$.panInfo.add($.cmbEmp);$.panInfo.add($.lblRequestId);$.panInfo.add($.txtRequestId);$.panInfo.add($.lblType);$.panInfo.add($.rdoType);$.panInfo.add($.lblTitle);$.panInfo.add($.txtTitle);$.panInfo.add($.panManagerOpinion);$.panInfo.add($.lbldescr);$.panInfo.add($.memdescr);$.panManagerOpinion.add($.memMangerOpinion);$.panManagerOpinion.add($.btnSaveMgrOpinion);$.panManagerOpinion.add($.btnMgrApprove);$.panHeadOpinion.add($.memHeadOpinion);$.panHeadOpinion.add($.btncomplete);$.panHeadOpinion.add($.btnSaveHeadOpinion);$.panHeadOpinion.add($.btnHeadApprove);$.panCPOpinion.add($.memCPOpinion);$.panCPOpinion.add($.btnNeedMore);$.panCPOpinion.add($.btnCPComplete);$.panCPOpinion.add($.btnSaveCPOpinion);$.panFile.add($.grdFile);$.panGuideLine.add($.lblGuide);$.panGuideLine.add($.cmbGuideType);$.panGuideLine.add($.btnViewGuideLine);$.panGuideLine.add($.btnCommittee);var ds=bizComponentData2($,"Q1","L_CRM0051|L_CRM0226|L_CRM0219");$.cmbDept.setColumn("dept_code","dept_name");setComboBind([$.cmbDept,$.cmbGuideType],ds);$.grdFile.setColumnDropDownList("upload_user",ds.resultList[2],{key:"employee_id",name:"emp_name"});if($.p_argument){if($.p_argument[0][0].request_id!=""&&$.p_argument[0][0].new_yn=="N"){$.txtRequestId.setValue($.p_argument[0][0].request_id);$.cmbDept.setValue($.p_argument[0][0].req_dept);cmbDeptChange();$.cmbEmp.setValue($.p_argument[0][0].req_user);$.rdoType.setValue($.p_argument[0][0].request_type);$.txtTitle.setValue($.p_argument[0][0].issue_title);$.memdescr.setValue($.p_argument[0][0].descr);$.memMangerOpinion.setValue($.p_argument[0][0].manager_opinion);$.manager_id=$.p_argument[0][0].manager_id;$.manager_name=$.p_argument[0][0].manager_name;$.manager_status=$.p_argument[0][0].manager_status;$.memHeadOpinion.setValue($.p_argument[0][0].head_opinion);$.head_id=$.p_argument[0][0].head_id;$.head_name=$.p_argument[0][0].head_name;$.head_status=$.p_argument[0][0].head_status;$.memCPOpinion.setValue($.p_argument[0][0].answerer_opinion);$.answerer_id=$.p_argument[0][0].answerer_id;$.answerer_name=$.p_argument[0][0].answerer_name;$.answerer_status=$.p_argument[0][0].answerer_status;if($.p_argument[1].length>0){setDataGrid([$.grdFile],$.p_argument[1],true)}checkAuthority()}}else{$.cmbDept.setValue(g_main.session.getValue("DeptCode"));cmbDeptChange();$.cmbEmp.setValue(g_main.session.getValue("EmpCode"));$.txtTitle.setReadOnly(false);$.memdescr.setReadOnly(false);$.txtTitle.setAllowBlank(false,"안건제목");$.memdescr.setAllowBlank(false,"상세내용");$.panInfo.enableButton(["all"])}};$.callback=function(type,ds){if(type=="D"){g_popupStack.close()}else{if(type=="N"){g_popupStack.close()}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSaveMgrOpinion"){saveCrmCommunicationProcContent("SaveMgrOpinion")}else{if(id=="btnMgrApprove"){saveCrmCommunicationProcContent("MgrApprove")}else{if(id=="btncomplete"){saveCrmCommunicationProcContent("Complete")}else{if(id=="btnSaveHeadOpinion"){saveCrmCommunicationProcContent("SaveHeadOpinion")}else{if(id=="btnHeadApprove"){saveCrmCommunicationProcContent("HeadApprove")}else{if(id=="btnNeedMore"){saveCrmCommunicationProcContent("NeedMore")}else{if(id=="btnCPComplete"){saveCrmCommunicationProcContent("CPComplete")}else{if(id=="btnSaveCPOpinion"){saveCrmCommunicationProcContent("SaveCPOpinion")}else{if(id=="btnCommittee"){saveCrmCommunicationProcContent("Committee")}else{if(id=="btnViewGuideLine"){if($.cmbGuideType.getValue()==""){return}var strFileName=$.cmbGuideType.getText()+".pdf";g_fileBrowser.download(getServerFileUrl("CPFiles/Guideline/"+strFileName))}}}}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){cmbDeptChange()}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnSave"){saveCommunication()}else{if(btnId=="btnDelete"){saveCrmCommunicationProcContent("D")}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}for(var i=0;i<fileList.length;i++){fileList[i]["seq"]=(i+1);fileList[i]["upload_user"]=$.cmbEmp.getValue();fileList[i]["upload_userid"]=$.cmbEmp.getValue()}$.grdFile.addRows(fileList)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요",function(){if(g_main.msgShare==true){if(result){MessageBoxShow("파일이 삭제 되었습니다.");$.grdFile.deleteRow(rId);if($.grdFile.getRowCount()>0){for(var i=0;i<$.grdFile.getRowCount();i++){$.grdFile.setValue(i,"seq",i+1)}}}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>