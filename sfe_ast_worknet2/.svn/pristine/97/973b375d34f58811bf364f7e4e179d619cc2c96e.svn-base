<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.btnFileAdd=null;$.btnFileDelete=null;$.btnDocAdd=null;$.btnDocDelete=null;$.ediDetail=null;$.grdList=null;$.cmbYear=null;$.cmbMonth=null;$.lblComment=null;$.lblex=null;$.grdFile=null;$.grdDoc=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmCarryPcVerify"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmCarryPcVerify_Q",[workType,"#DeptCode#"]);return json}function createJSON_S(workType){var count=$.grdList.getRowCount()-1;var json=createExecuteParamInfo("P_crmCarryPcVerify_S",[workType,$.wfDocId,$.cmbYear.getValue(),$.cmbMonth.getValue(),"#DeptCode#",0<=count?$.grdList.getValue(0,"employee_id"):"",1<=count?$.grdList.getValue(1,"employee_id"):"",2<=count?$.grdList.getValue(2,"employee_id"):"",3<=count?$.grdList.getValue(3,"employee_id"):"",4<=count?$.grdList.getValue(4,"employee_id"):"",5<=count?$.grdList.getValue(5,"employee_id"):"",6<=count?$.grdList.getValue(6,"employee_id"):"",7<=count?$.grdList.getValue(7,"employee_id"):"",8<=count?$.grdList.getValue(8,"employee_id"):"",9<=count?$.grdList.getValue(9,"employee_id"):"",0<=count?$.grdList.getValue(0,"pc_chk"):"",1<=count?$.grdList.getValue(1,"pc_chk"):"",2<=count?$.grdList.getValue(2,"pc_chk"):"",3<=count?$.grdList.getValue(3,"pc_chk"):"",4<=count?$.grdList.getValue(4,"pc_chk"):"",5<=count?$.grdList.getValue(5,"pc_chk"):"",6<=count?$.grdList.getValue(6,"pc_chk"):"",7<=count?$.grdList.getValue(7,"pc_chk"):"",8<=count?$.grdList.getValue(8,"pc_chk"):"",9<=count?$.grdList.getValue(9,"pc_chk"):"",0<=count?$.grdList.getValue(0,"tablet_chk"):"",1<=count?$.grdList.getValue(1,"tablet_chk"):"",2<=count?$.grdList.getValue(2,"tablet_chk"):"",3<=count?$.grdList.getValue(3,"tablet_chk"):"",4<=count?$.grdList.getValue(4,"tablet_chk"):"",5<=count?$.grdList.getValue(5,"tablet_chk"):"",6<=count?$.grdList.getValue(6,"tablet_chk"):"",7<=count?$.grdList.getValue(7,"tablet_chk"):"",8<=count?$.grdList.getValue(8,"tablet_chk"):"",9<=count?$.grdList.getValue(9,"tablet_chk"):""]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmWFVacationReq_S",[workType,$.wfDocId,$.dteStartDate.getValue(),$.dteEndDate.getValue(),"","","","","","#DeptCode#","#UserID#",""]);return json}function searchWFDocument(workType){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchCarryPcVerify(workType){var json=createJSON_Q2("Q");return callQuerySync(["req",json],"Q")}function searchStart(workType){var json=createJSON_Q2("Q");callQuery(["req",json],"Q2",$)}function saveCarryPcVerify(workType){var json=createJSON_S("S");callExecute(["req",json],"S",$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.businessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.ediDetail,$.wfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.wfDocId=ds.returnStr}return true}function getToday(bool){var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if((""+month).length==1){month="0"+month}if((""+day).length==1){day="0"+day}if(bool){return year}else{return month}}function dateChange(){var today=new Date();var dateString=$.dteEndDate.getText();var dateString2=$.dteStartDate.getText();var dateArray=dateString.split("-");var dateArray2=dateString2.split("-");var dateObj=new Date(dateArray[0],Number(dateArray[1])-1,dateArray[2]);var dateObj2=new Date(dateArray2[0],Number(dateArray2[1])-1,dateArray2[2]);var betweenDay=(dateObj.getTime()-dateObj2.getTime())/1000/60/60/24;$.txtVacDay.setValue(String.format("{0}일",(betweenDay+1).toString()))}String.format=function(){var theString=arguments[0];for(var i=1;i<arguments.length;i++){var regEx=new RegExp("\\{"+(i-1)+"\\}","gm");theString=theString.replace(regEx,arguments[i])}return theString};function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1310);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,555);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,630,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,1025,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,1025,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.btnFileAdd=new FingerButton(host,"btnFileAdd",215,-37.5,120,20);$.btnFileAdd.setText("파일추가");$.btnFileDelete=new FingerButton(host,"btnFileDelete",320,-37.5,120,20);$.btnFileDelete.setText("파일삭제");$.btnDocAdd=new FingerButton(host,"btnDocAdd",525,-37.5,120,20);$.btnDocAdd.setText("문서추가");$.btnDocDelete=new FingerButton(host,"btnDocDelete",630,-37.5,120,20);$.btnDocDelete.setText("문서삭제");$.ediDetail=new FingerWebEditor(host,"ediDetail",0,0,1200,310);$.grdList=new FingerDataGrid(host,"grdList",0,45,1200,365);$.cmbYear=new FingerComboBox(host,"cmbYear",20,10,140,20);$.cmbMonth=new FingerComboBox(host,"cmbMonth",165,10,140,20);$.lblComment=new FingerLabel(host,"lblComment",20,435,600,25);$.lblComment.setText("본인은 한국아스텔라스제약의 정보관리규정을 철저히 준수할 것이며,");$.lblex=new FingerLabel(host,"lblex",20,455,600,25);$.lblex.setText("회사의 [법인PC]의 분실 및 파손유무의 확인을 성실히 수행할 것을 서약합니다.");$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.panTitle.setBorder(true);$.txtTitle.setAllowBlank(false,"문서제목");$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("dept_name",400,"left","string","소속부서"),new FingerDataGridColumn("dept_code",730,"left","string","성명"),new FingerDataGridColumn("emp_name",400,"left","string","성명"),new FingerDataGridColumn("employee_id",660,"left","string","성명"),new FingerDataGridColumn("pc_chk",380,"center","checkbox","PC소지여부"),new FingerDataGridColumn("tablet_chk",260,"center","checkbox","Tablet PC 소지여부",{hidden:true})]);$.grdList.init();$.grdList.setColumnHidden(["dept_code","employee_id"],true);$.grdList.setEditable(false);$.lblComment.setAlign("left");$.lblex.setAlign("left");$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.btnFileAdd.setVisible(false);$.btnFileDelete.setVisible(false);$.btnDocAdd.setVisible(false);$.btnDocDelete.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.grdList);$.panWFMain.add($.cmbYear);$.panWFMain.add($.cmbMonth);$.panWFMain.add($.lblComment);$.panWFMain.add($.lblex);$.panWFDetail.add($.ediDetail);$.panFile.add($.btnFileAdd);$.panFile.add($.btnFileDelete);$.panFile.add($.grdFile);$.panDoc.add($.btnDocAdd);$.panDoc.add($.btnDocDelete);$.panDoc.add($.grdDoc);relocateChildIndexInPanel([$.panWFMain]);searchWFDocument();var ds=searchCarryPcVerify();var vd=[];for(var i=0;i<ds.resultList[1].length;i++){if(ds.resultList[1][i].emp_name!=""&&ds.resultList[1][i].employee_id!=""){var tmp={};tmp[("dept_name")]=ds.resultList[0][0].dept_name;tmp[("dept_code")]=ds.resultList[0][0].dept_code;tmp[("emp_name")]=ds.resultList[1][i].emp_name;tmp[("employee_id")]=ds.resultList[1][i].employee_id;tmp[("pc_chk")]="Y";tmp[("tablet_chk")]="N";vd.push(tmp)}}setDataGrid([$.grdList],vd,true);$.wfDocId="";var ds=bizComponentData2($,"Q2","L_CRM0119");setComboBind([$.cmbYear],ds);var ds2=bizComponentData2($,"Q1","L_HRA038");setComboBind([$.cmbMonth],ds2);$.cmbYear.setValue(getToday(true));$.cmbMonth.setValue(getToday())};$.callback=function(type,ds){if(type=="Q3"){$.businessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue("["+g_main.session.getValue("DeptName")+"]"+ds.resultList[0][0].business_title)}else{if(type=="S"){var param={wf_doc_id:$.wfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.wfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.ediDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6];$.cmbYear.setValue(args[6][0].base_year);$.cmbMonth.setValue(args[6][0].base_month);for(var i=0;i<$.grdList.getRowCount();i++){if(md[i].pc_yn=="N"){$.grdList.setValue(i,"pc_chk","N")}}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!validateControls([$.txtTitle])){return}var param={wf_doc_id:$.wfDocId,wf_form_id:"crmCarryPcVerify"};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){var returntemp="N";if(!validateControls([$.txtTitle])){return}saveWFDocument("","N");saveCarryPcVerify()}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(id=="btnDocDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}else{if(id=="btnFileAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnFileDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDoc"){if(btnId=="btnAdd"){$.popUpCallId="btnDocAdd";var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.wfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveCarryPcVerify()}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){}};</script>