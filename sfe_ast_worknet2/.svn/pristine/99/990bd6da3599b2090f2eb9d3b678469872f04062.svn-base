<script>function Main(){var $=this;$.host=null;$.txtTitle01=null;$.cmbDept=null;$.cmbEmp=null;$.panQuery=null;$.panMatch=null;$.applyStartDt=null;$.applyEndDt=null;$.lbl01=null;$.lblTitleApplyDt=null;$.lblReas=null;$.txtReason=null;$.cmbDept02=null;$.cmbEmp02=null;$.panList=null;$.grdList=null;$.btnSearch=null;$.panMain=null;$.lblDept=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmArbitrary_Q",[workType,$.cmbEmp.getValue()]);return json}function createJSON_S(workType){log($.applyStartDt.getValue());var json=createExecuteParamInfo("P_crmArbitrary_S",[workType,$.cmbEmp.getValue(),$.applyStartDt.getValue(),$.applyEndDt.getValue(),$.cmbEmp02.getValue(),$.txtReason.getValue(),"#UserID#"]);return json}function searchList(){if(!validateControls([$.cmbEmp])){return}var json=createJSON_Q("Q");callQuery(["req",json],"Q_GRID",$)}function dataSelect(){if($.varRowIdx==null){return}$.applyStartDt.setValue(getFormatDate($.grdList.getValue($.varRowIdx,"start_date"),"yyyyMMdd"));$.applyEndDt.setValue(getFormatDate($.grdList.getValue($.varRowIdx,"end_date"),"yyyyMMdd"));$.cmbDept02.setValue($.grdList.getValue($.varRowIdx,"dept_code"));$.cmbEmp02.setValue($.grdList.getValue($.varRowIdx,"ab_employee_id"));$.txtReason.setValue($.grdList.getValue($.varRowIdx,"descr"));$.workType=$.grdList.getRowStatus($.varRowIdx);$.applyStartDt.setEnable(false)}function saveArbitrary(workType){if(!$.panQuery.validateControls()||!$.panMatch.validateControls()){return}if($.applyStartDt.getValue()>$.applyEndDt.getValue()){MessageBoxShow("종료일자가 시작일자 보다 작습니다.");return}var json=createJSON_S(workType);callExecute(["req",json],workType,$)}function changeDeptCode(){var strQuery=" and dept_code ='"+$.cmbDept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cmbEmp.clear();$.cmbEmp.setColumn("employee_id","emp_name");setComboBind([$.cmbEmp],ds)}$.init=function(host,args){$.txtTitle01=new FingerLabel(host,"txtTitle01",0,15,100,20);$.txtTitle01.setText("사   원");$.cmbDept=new FingerComboBox(host,"cmbDept",107,15,180,20);$.cmbEmp=new FingerComboBox(host,"cmbEmp",285,15,120,20);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panMatch=new FingerPanel(host,"panMatch",0,70,1200,140);$.panMatch.setText("대결정보");$.panMatch.setBottomLine(true);$.applyStartDt=new FingerDateEdit(host,"applyStartDt",125,15,140,20);$.applyEndDt=new FingerDateEdit(host,"applyEndDt",285,15,140,20);$.lbl01=new FingerLabel(host,"lbl01",248,15,35,19);$.lbl01.setText("~");$.lblTitleApplyDt=new FingerLabel(host,"lblTitleApplyDt",5,15,100,20);$.lblTitleApplyDt.setText("적용일");$.lblReas=new FingerLabel(host,"lblReas",5,50,100,20);$.lblReas.setText("사유");$.txtReason=new FingerEdit(host,"txtReason",125,50,755,20);$.cmbDept02=new FingerComboBox(host,"cmbDept02",586,15,180,20);$.cmbEmp02=new FingerComboBox(host,"cmbEmp02",763,15,120,20);$.panList=new FingerPanel(host,"panList",0,220,1200,500);$.panList.setText("대결내역");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,455);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.panMain=new FingerPanel(host,"panMain",0,0,1200,730);$.panMain.setText("");$.panMain.setBottomLine(true);$.lblDept=new FingerLabel(host,"lblDept",480,15,100,20);$.lblDept.setText("대결자");$.panQuery.setBorder(true);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("employee_id",150,"left","string","사원"),new FingerDataGridColumn("start_date",190,"left","string","적용시작일",{format:"ymd"}),new FingerDataGridColumn("end_date",150,"left","string","적용종료일",{format:"ymd"}),new FingerDataGridColumn("dept_code",200,"left","string","부서"),new FingerDataGridColumn("ab_employee_id",150,"left","string","대결자"),new FingerDataGridColumn("descr",240,"left","string","사유"),new FingerDataGridColumn("create_time",150,"left","date","생성일자",{format:"ymd hh:mm:ss"}),new FingerDataGridColumn("update_time",153,"left","date","수정일자",{format:"ymd hh:mm:ss"})]);$.grdList.init({panel:$.panList});$.grdList.setColumnHidden(["dept_code"],true);$.grdList.setBorder(true);$.applyStartDt.setMinDate(getToday(""));$.cmbEmp.setAllowBlank(false,"사원명");$.applyStartDt.setAllowBlank(false,"시작일");$.applyEndDt.setAllowBlank(false,"종료일");$.cmbEmp02.setAllowBlank(false,"사원명");var ds1=bizComponentData2($,"Q3","L_CRM0052");$.grdList.setColumnDropDownList("employee_id",ds1.resultList[0],{key:"employee_id",name:"emp_name"});$.grdList.setColumnDropDownList("ab_employee_id",ds1.resultList[0],{key:"employee_id",name:"emp_name"});$.panMatch.addButton("btnDelete","삭제");$.panMatch.addButton("btnSave","저장");$.panMatch.addButton("btnNew","신규");$.panMatch.setButtonAction("btnNew","new");$.panMatch.setButtonAction("btnSave","save");$.panMatch.setButtonAction("btnDelete","delete");$.host=host;$.args=args};$.start=function(){$.panQuery.add($.txtTitle01);$.panQuery.add($.cmbDept);$.panQuery.add($.cmbEmp);$.panQuery.add($.btnSearch);$.panMatch.add($.applyStartDt);$.panMatch.add($.applyEndDt);$.panMatch.add($.lbl01);$.panMatch.add($.lblTitleApplyDt);$.panMatch.add($.lblReas);$.panMatch.add($.txtReason);$.panMatch.add($.cmbDept02);$.panMatch.add($.cmbEmp02);$.panMatch.add($.lblDept);$.panList.add($.grdList);$.panMain.add($.panQuery);$.panMain.add($.panMatch);$.panMain.add($.panList);$.workType="";$.cmbDept.setEmptyRow(true);$.cmbEmp.setEmptyRow(true);$.cmbDept02.setEmptyRow(true);$.cmbEmp02.setEmptyRow(true);var ds=bizComponentData2($,"Q1","L_CRM0051");$.cmbDept.setColumn("dept_code","dept_name");setComboBind([$.cmbDept],ds);$.cmbDept02.setColumn("dept_code","dept_name");setComboBind([$.cmbDept02],ds);if(g_main.session.obj.SystemDeveloper=="Y"){$.cmbDept.setValue(g_main.session.getValue("DeptCode"));$.cmbEmp.setValue(g_main.session.getValue("EmpCode"))}else{$.cmbDept.setValue(g_main.session.getValue("DeptCode"));$.cmbEmp.setValue(g_main.session.getValue("EmpCode"));$.cmbDept.setEnable(false);$.cmbEmp.setEnable(false)}searchList()};$.callback=function(type,ds){if(type=="Q_GRID"){for(var i=0;i<ds.resultList[1].length;i++){if(ds.resultList[1][i].start_date!=""){ds.resultList[1][i].start_date=ds.resultList[1][i].start_date.substring(0,4)+"-"+ds.resultList[1][i].start_date.substring(4,6)+"-"+ds.resultList[1][i].start_date.substring(6,8)}if(ds.resultList[1][i].end_date!=""){ds.resultList[1][i].end_date=ds.resultList[1][i].end_date.substring(0,4)+"-"+ds.resultList[1][i].end_date.substring(4,6)+"-"+ds.resultList[1][i].end_date.substring(6,8)}ds.resultList[1][i].create_time=String(Number(ds.resultList[1][i].create_time.year+1900))+"-"+(String(ds.resultList[1][i].create_time.month).length==1?"0"+ds.resultList[1][i].create_time.month:ds.resultList[1][i].create_time.month)+"-"+(String(ds.resultList[1][i].create_time.date).length==1?"0"+ds.resultList[1][i].create_time.date:ds.resultList[1][i].create_time.date)+" "+ds.resultList[1][i].create_time.hours+":"+ds.resultList[1][i].create_time.minutes+":"+ds.resultList[1][i].create_time.seconds;if(ds.resultList[1][i].update_time!=""){ds.resultList[1][i].update_time=String(Number(ds.resultList[1][i].update_time.year+1900))+"-"+(String(ds.resultList[1][i].update_time.month).length==1?"0"+ds.resultList[1][i].update_time.month:ds.resultList[1][i].update_time.month)+"-"+(String(ds.resultList[1][i].update_time.date).length==1?"0"+ds.resultList[1][i].update_time.date:ds.resultList[1][i].update_time.date)+" "+ds.resultList[1][i].update_time.hours+":"+ds.resultList[1][i].update_time.minutes+":"+ds.resultList[1][i].update_time.seconds}}setDataGrid([$.grdList],ds.resultList[1],true);if(ds.resultList[1].length>0){$.grdList.selectRow(0)}else{$.grdList.extObj.clearAll();$.grdList.setDisplayPanelRowCount("0")}}else{if(type=="N"||type=="U"||type=="D"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{if(ds.errorCode=="MSG0004"){MessageBoxShow("정상적으로 수정되었습니다.")}else{if(ds.errorCode=="MSG0003"){MessageBoxShow("정상적으로 삭제되었습니다.")}else{if(ds.errorCode=="MSG0002"){MessageBoxShow("정상적으로 등록되었습니다.")}}}}searchList()}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){changeDeptCode()}else{if(id=="cmbDept02"){var strQuery=" and dept_code ='"+$.cmbDept02.getValue()+"' and employee_id <> '"+$.cmbEmp.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cmbEmp02.clear();$.cmbEmp02.setColumn("employee_id","emp_name");setComboBind([$.cmbEmp02],ds)}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){$.varRowIdx=rId;dataSelect()}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panMatch"){if(btnId=="btnNew"){$.panMatch.clear();$.applyStartDt.setEnable(true);$.workType="N"}else{if(btnId=="btnSave"){if($.grdList.getRowCount()<=0){$.workType="N"}if($.workType!="N"){$.workType=$.grdList.getRowStatus($.varRowIdx)}saveArbitrary($.workType)}else{if(btnId=="btnDelete"){confirmBoxShow("["+$.applyStartDt.getValue()+" ~ "+$.applyEndDt.getValue()+"]의 기간의 </br>대결설정을 삭제 하시겠습니까?",function(){if(g_main.msgShare==true){saveArbitrary("D")}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>