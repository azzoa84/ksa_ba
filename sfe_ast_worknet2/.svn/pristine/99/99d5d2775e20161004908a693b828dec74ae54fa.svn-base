<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panMember=null;$.panConfMain=null;$.panConfMainInfo=null;$.panFile=null;$.grdConfTitle=null;$.grdMember=null;$.grdConfMain=null;$.lblSeq=null;$.lblConfDate=null;$.lblWhere=null;$.lblCreateUser=null;$.lblMember=null;$.lblTitle=null;$.lblRemark=null;$.lblFollowup=null;$.lblEtc=null;$.txtSeq=null;$.dteConfDate=null;$.cmbWhere=null;$.txtCreateUser=null;$.txtTitle=null;$.memMember=null;$.memRemark=null;$.memFollowup=null;$.panConfTitle=null;$.lblDate=null;$.lblConfName2=null;$.lblCreater=null;$.txtConfName2=null;$.bteCreater=null;$.btnSearch=null;$.dteStartDate=null;$.dteEndDate=null;$.lblWave=null;$.grdFile=null;$.panQuery=null;$.fileUpload=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmConf_List_Q2",[workType,$.bteCreater.getValue()||"",$.dteStartDate.getValue()||"",$.dteEndDate.getValue()||"",$.txtConfName2.getText()||"","#UserID#"]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_crmConf_member_Q",[workType,$.varConfId]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmConf_main_Q",[workType,$.varConfId]);return json}function createJSON_Q3(workType){var json=createExecuteParamInfo("P_crmConf_file_Q",[workType,$.varConfMainId]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmConf_List_S",[workType,"","","#UserID#",$.varConfId,""]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmConf_member_S",[workType,$.varConfId,$.varMemSeq,"#UserID#","",""]);return json}function createJSON_S3(workType){var json=createExecuteParamInfo("P_crmConf_main_S",[workType,$.varConfId,(workType!="S"?$.varConfMainId:""),extFormat($.dteConfDate.getText(),"yyyyMMdd"),$.memMember.getValue(),$.cmbWhere.getValue(),$.txtTitle.getText(),$.memRemark.getValue(),$.memFollowup.getValue(),"#UserID#"]);return json}function createJSON_S4(workType){var aRows=$.grdFile.getAllRows();var seq="",local_fname="",server_fname="",server_path="";for(var i in aRows){seq+=((seq?"|":"")+i);local_fname+=((local_fname?"|":"")+aRows[i].local_fname);server_fname+=((server_fname?"|":"")+aRows[i].server_fname);server_path+=((server_path?"|":"")+"/ServerFiles/ConfFiles")}var json=createExecuteParamInfo("P_crmConf_file_S",[workType,$.varConfMainId,"Y",seq,server_path,server_fname,local_fname,"#UserID#"]);return json}function initConditions(){$.varConfId="";$.varConfMainId=""}function setDefaultValue(){$.txtSeq.setValue("");$.dteConfDate.setValue("");$.cmbWhere.setValue("");$.txtCreateUser.setValue("");$.memMember.setValue("");$.txtTitle.setValue("");$.memRemark.setValue("");$.memFollowup.setValue("")}function searchConfList(){if($.bteCreater.getText()==""){$.bteCreater.setValue("")}var json=createJSON_Q("Q");callQuery(["req",json],"Q_C",$)}function searchMemeber(){var json=createJSON_Q1("Q");callQuery(["req",json],"Q_M",$)}function searchConfMain(){var json=createJSON_Q2("Q");callQuery(["req",json],"Q_C_M",$)}function searchConfFileList(){var json=createJSON_Q3("Q");callQuery(["req",json],"Q_C_F",$)}function saveConfTitle(workType){var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],"S");if(ds.errorCode=="MSG0001"||ds.errorCode=="MSG0006"){$.varConfId="";searchConfList()}}function saveMember(workType){var json=createJSON_S2(workType);var ds=callExecuteSync(["req",json],"S");if(ds.errorCode!="MSG0001"||ds.errorCode=="MSG0006"){MessageBoxShow("공유대상 삭제중 오류")}}function saveConfMain(workType){var json=createJSON_S3(workType);var ds=callExecuteSync(["req",json],"S");if(ds.errorCode=="MSG0001"||ds.errorCode=="MSG0006"){if(workType=="S"){$.varConfMainId=ds.returnStr}if($.grdFile.getAllRows().length>0){saveFiles()}else{setDefaultValue();searchConfList()}}}function saveFiles(){var json=createJSON_S4("M");var ds=callExecuteSync(["req",json],"M",$);if(ds.errorCode=="MSG0001"){setDefaultValue();searchConfList()}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1330);$.panMain.setText("");$.panMain.setBottomLine(true);$.panMember=new FingerPanel(host,"panMember",885,65,315,380);$.panMember.setText("공유대상자");$.panMember.setBottomLine(false);$.panConfMain=new FingerPanel(host,"panConfMain",0,460,1200,345);$.panConfMain.setText("회의록/보고서 목록");$.panConfMain.setBottomLine(true);$.panConfMainInfo=new FingerPanel(host,"panConfMainInfo",0,820,840,500);$.panConfMainInfo.setText("회의록/보고서 작성");$.panConfMainInfo.setBottomLine(false);$.panFile=new FingerPanel(host,"panFile",850,820,350,500);$.panFile.setText("파일리스트");$.panFile.setBottomLine(true);$.grdConfTitle=new FingerDataGrid(host,"grdConfTitle",0,0,875,335);$.grdMember=new FingerDataGrid(host,"grdMember",0,0,315,335);$.grdConfMain=new FingerDataGrid(host,"grdConfMain",0,0,1200,300);$.lblSeq=new FingerLabel(host,"lblSeq",45,10,40,20);$.lblSeq.setText("회차");$.lblConfDate=new FingerLabel(host,"lblConfDate",105,10,80,20);$.lblConfDate.setText("회의일자");$.lblWhere=new FingerLabel(host,"lblWhere",280,10,80,20);$.lblWhere.setText("장소");$.lblCreateUser=new FingerLabel(host,"lblCreateUser",515,10,60,20);$.lblCreateUser.setText("작성");$.lblMember=new FingerLabel(host,"lblMember",0,40,80,20);$.lblMember.setText("회의참석");$.lblTitle=new FingerLabel(host,"lblTitle",0,135,80,20);$.lblTitle.setText("회의주제");$.lblRemark=new FingerLabel(host,"lblRemark",0,160,80,20);$.lblRemark.setText("회의결과");$.lblFollowup=new FingerLabel(host,"lblFollowup",0,300,80,20);$.lblFollowup.setText("후속작업");$.lblEtc=new FingerLabel(host,"lblEtc",470,420,350,20);$.lblEtc.setText("회의록/보고서를 저장하시면 파일을 첨부할 수 있습니다.");$.txtSeq=new FingerEdit(host,"txtSeq",15,10,30,20);$.dteConfDate=new FingerDateEdit(host,"dteConfDate",190,10,100,20);$.cmbWhere=new FingerComboBox(host,"cmbWhere",365,10,150,20);$.txtCreateUser=new FingerEdit(host,"txtCreateUser",580,10,170,20);$.txtTitle=new FingerEdit(host,"txtTitle",85,135,735,20);$.memMember=new FingerMemoEdit(host,"memMember",85,45,730,80);$.memRemark=new FingerMemoEdit(host,"memRemark",85,165,730,130);$.memFollowup=new FingerMemoEdit(host,"memFollowup",85,305,730,80);$.panConfTitle=new FingerPanel(host,"panConfTitle",0,65,875,380);$.panConfTitle.setText("회의/보고 리스트");$.panConfTitle.setBottomLine(true);$.lblDate=new FingerLabel(host,"lblDate",0,15,100,20);$.lblDate.setText("일자");$.lblConfName2=new FingerLabel(host,"lblConfName2",650,15,100,20);$.lblConfName2.setText("회의/보고명");$.lblCreater=new FingerLabel(host,"lblCreater",340,15,100,20);$.lblCreater.setText("작성자");$.txtConfName2=new FingerEdit(host,"txtConfName2",755,15,240,20);$.bteCreater=new FingerButtonEdit(host,"bteCreater",445,15,180,20);$.bteCreater.setText("");$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.dteStartDate=new FingerDateEdit(host,"dteStartDate",105,15,110,20);$.dteEndDate=new FingerDateEdit(host,"dteEndDate",240,15,110,20);$.lblWave=new FingerLabel(host,"lblWave",215,15,20,20);$.lblWave.setText("~");$.grdFile=new FingerDataGrid(host,"grdFile",0,0,350,455);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.fileUpload=new FingerFilePanel(host,"fileUpload",5,15,335,20);$.panQuery.setBorder(true);$.panConfTitle.addButtons(["btnDelete","btnSave","btnNew"]);$.panMember.addButtons(["btnDelete"]);$.panConfMainInfo.addButtons(["btnDelete","btnSave","btnNew"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.grdConfTitle.colIdx=$.grdConfTitle.setColumns([new FingerDataGridColumn("conf_id",99,"left","string","회의ID",{hidden:true}),new FingerDataGridColumn("conf_name",505,"left","string","회의/보고명"),new FingerDataGridColumn("recent_do_date",120,"center","string","최근회의일자"),new FingerDataGridColumn("create_user",99,"left","string","생성자",{hidden:true}),new FingerDataGridColumn("emp_name",229,"center","string","생성자"),new FingerDataGridColumn("conf_yyyy",99,"center","string","기준년도",{hidden:true}),new FingerDataGridColumn("conf_gubn",99,"center","string","구분",{hidden:true})]);$.grdConfTitle.init({panel:$.panConfTitle});$.grdConfTitle.setBorder(false);$.grdMember.colIdx=$.grdMember.setColumns([new FingerDataGridColumn("member_id",100,"left","string","공유대상ID"),new FingerDataGridColumn("member_name",189,"left","string","공유대상"),new FingerDataGridColumn("dept_code",99,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("employee_id",99,"left","string","사원코드",{hidden:true}),new FingerDataGridColumn("member_seq",99,"center","string","맴버시퀀스",{hidden:true})]);$.grdMember.init({panel:$.panMember,nonExcel:true,scroll:"xy"});$.grdMember.setBorder(false);$.grdConfMain.colIdx=$.grdConfMain.setColumns([new FingerDataGridColumn("seq",50,"center","string","회차"),new FingerDataGridColumn("conf_main_id",99,"left","string","회의록ID",{hidden:true}),new FingerDataGridColumn("conf_do_date",100,"center","string","일자"),new FingerDataGridColumn("conf_title",180,"left","string","주제"),new FingerDataGridColumn("conf_remark",420,"left","string","회의결과"),new FingerDataGridColumn("conf_followup",420,"left","string","후속작업"),new FingerDataGridColumn("create_user",99,"left","string","생성자",{hidden:true}),new FingerDataGridColumn("create_time",99,"left","string","작성시간",{hidden:true}),new FingerDataGridColumn("conf_where",120,"left","string","장소"),new FingerDataGridColumn("emp_name",150,"left","string","작성자"),new FingerDataGridColumn("conf_member",150,"left","string","참석자")]);$.grdConfMain.init({panel:$.panConfMain,scroll:"xy"});$.grdConfMain.setBorder(false);$.grdFile.colIdx=$.grdFile.setColumns([new FingerDataGridColumn("seq",99,"center","string","일련번호",{hidden:true}),new FingerDataGridColumn("server_path",99,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("server_fname",99,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("local_fname",329,"left","string","파일명",{isLink:true,pathLinkCols:["server_path","server_fname"]})]);$.grdFile.init({panel:$.panFile,nonExcel:true,scroll:"xy",isFilter:false});$.grdFile.setBorder(false);$.txtSeq.setReadOnly(true);$.txtCreateUser.setReadOnly(true);$.bteCreater.setReadOnly(false);$.fileUpload.setVisible(false);$.dteConfDate.setAllowBlank(false,"회의일자");$.cmbWhere.setAllowBlank(false,"회의장소");initConditions();$.host=host;$.args=args};$.start=function(){$.panMain.add($.panConfTitle);$.panMain.add($.panMember);$.panMain.add($.panConfMain);$.panMain.add($.panConfMainInfo);$.panMain.add($.panQuery);$.panMain.add($.panFile);$.panMember.add($.grdMember);$.panConfMain.add($.grdConfMain);$.panConfMainInfo.add($.lblSeq);$.panConfMainInfo.add($.lblConfDate);$.panConfMainInfo.add($.lblCreateUser);$.panConfMainInfo.add($.lblWhere);$.panConfMainInfo.add($.lblMember);$.panConfMainInfo.add($.lblTitle);$.panConfMainInfo.add($.lblRemark);$.panConfMainInfo.add($.lblFollowup);$.panConfMainInfo.add($.lblEtc);$.panConfMainInfo.add($.txtSeq);$.panConfMainInfo.add($.dteConfDate);$.panConfMainInfo.add($.cmbWhere);$.panConfMainInfo.add($.txtCreateUser);$.panConfMainInfo.add($.txtTitle);$.panConfMainInfo.add($.memMember);$.panConfMainInfo.add($.memRemark);$.panConfMainInfo.add($.memFollowup);$.panFile.add($.grdFile);$.panFile.add($.fileUpload);$.panConfTitle.add($.grdConfTitle);$.panQuery.add($.lblWave);$.panQuery.add($.dteEndDate);$.panQuery.add($.dteStartDate);$.panQuery.add($.bteCreater);$.panQuery.add($.txtConfName2);$.panQuery.add($.btnSearch);$.panQuery.add($.lblCreater);$.panQuery.add($.lblConfName2);$.panQuery.add($.lblDate);searchConfList();var ds=bizComponentData2($,"Q2","L_CRM212");setComboBind([$.cmbWhere],ds);relocateChildIndexInPanel([$.panQuery,$.panConfMainInfo])};$.callback=function(type,ds){if(type=="Q_C"){setDataGrid([$.grdConfTitle],ds);if($.varConfId){$.grdConfTitle.selectRow($.grdConfTitle.getGridRowIndex("conf_id",$.varConfId))}else{$.grdConfTitle.selectRow(0)}}else{if(type=="Q_M"){setDataGrid([$.grdMember],ds)}else{if(type=="Q_C_M"){setDataGrid([$.grdConfMain],ds);if(ds.resultList[0].length>0){$.grdConfMain.selectRow(0)}}else{if(type=="Q_C_F"){setDataGrid([$.grdFile],ds)}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchConfList()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteCreater"){var param={employee_id:$.bteCreater.getValue()||"",emp_name:$.bteCreater.getText()||""};g_main.openPopup("popEmp.html","popEmp","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdConfTitle"){if($.grdConfTitle.getRowCount()<=0){return}$.varConfId=$.grdConfTitle.getValue(rId,"conf_id");$.varConfMainId="";if($.grdConfTitle.getValue(rId,"create_user")!=g_main.session.getValue("UserID")){$.panConfTitle.disableButton(["btnSave","btnDelete"]);$.panMember.disableButton("all");$.panConfMainInfo.disableButton(["btnSave","btnDelete"]);$.panFile.disableButton(["btnDelete","btnAdd"])}else{$.panConfTitle.enableButton("all");$.panMember.enableButton(["btnDelete"]);$.panConfMainInfo.enableButton("all");$.panFile.enableButton(["btnDelete","btnAdd"])}var confType=$.grdConfTitle.getValue(rId,"conf_gubn");if(confType=="보고"){$.grdConfMain.setColumnHidden(["conf_title","conf_followup"],true);$.grdConfMain.setColumnText("conf_remark","후속작업");$.lblConfDate.setText("보고일자");$.lblMember.setText("보고참석");$.lblRemark.setText("후속작업");$.lblFollowup.setVisible(false);$.memFollowup.setVisible(false);$.lblTitle.setVisible(false);$.txtTitle.setVisible(false);$.memRemark.setValue("없음")}else{$.grdConfMain.setColumnHidden(["conf_title","conf_followup"],false);$.grdConfMain.setColumnText("conf_remark","회의결과");$.lblConfDate.setText("회의일자");$.lblMember.setText("회의참석");$.lblRemark.setText("회의결과");$.lblFollowup.setVisible(true);$.memFollowup.setVisible(true);$.lblTitle.setVisible(true);$.txtTitle.setVisible(true)}$.grdConfMain.setData("");$.grdMember.setData("");$.grdFile.setData("");setDefaultValue();searchMemeber();searchConfMain()}else{if(id=="grdConfMain"){if($.grdConfMain.getRowCount()<=0){return}$.varConfMainId=$.grdConfMain.getValue(rId,"conf_main_id");$.txtSeq.setValue($.grdConfMain.getValue(rId,"seq"));$.dteConfDate.setValue(unmask($.grdConfMain.getValue(rId,"conf_do_date")));$.cmbWhere.setValue($.grdConfMain.getValue(rId,"conf_where"));$.txtCreateUser.setValue($.grdConfMain.getValue(rId,"emp_name"));$.memMember.setValue($.grdConfMain.getValue(rId,"conf_member"));$.txtTitle.setValue($.grdConfMain.getValue(rId,"conf_title"));$.memRemark.setValue($.grdConfMain.getValue(rId,"conf_remark"));$.memFollowup.setValue($.grdConfMain.getValue(rId,"conf_followup"));searchConfFileList()}else{if(id=="grdMember"){if($.grdMember.getRowCount()<=0){return}$.varMemSeq=$.grdMember.getValue(rId,"member_seq")}}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if(value=="13"&&id=="txtConfName2"){searchConfList()}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panConfTitle"){if(btnId=="btnNew"){$.popUpCallId="btnNewSave";var param={conf_id:"",conf_yyyy:"",conf_gubn:"",conf_name:""};g_main.openPopup("popSaveConfReport.html","popSaveConfReport","회의/보고 등록",660,600,"","",param,"","")}else{if(btnId=="btnSave"){$.popUpCallId="btnNewSave";var rId=$.grdConfTitle.getSelectedRowIdx();var param={conf_id:$.varConfId||"",conf_yyyy:$.grdConfTitle.getValue(rId,"conf_yyyy"),conf_gubn:$.grdConfTitle.getValue(rId,"conf_gubn"),conf_name:$.grdConfTitle.getValue(rId,"conf_name")};g_main.openPopup("popSaveConfReport.html","popSaveConfReport","회의/보고 등록",660,600,"","",param,"","")}else{if(btnId=="btnDelete"){if($.varConfId==""){return}var rId=$.grdConfTitle.getSelectedRowIdx();if(rId>=0){confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveConfTitle("D")}})}}}}}else{if(panelId=="panMember"){if(btnId=="btnDelete"){var rId=$.grdMember.getSelectedRowIdx();if(rId>=0){confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveMember("D");$.grdMember.deleteRow(rId)}})}}}else{if(panelId=="panConfMainInfo"){if(btnId=="btnNew"){$.varConfMainId="";setDefaultValue();$.txtCreateUser.setText(g_main.session.getValue("UserName")+"("+g_main.session.getValue("DeptName")+")")}else{if(btnId=="btnSave"){if(!validateControls([$.dteConfDate,$.cmbWhere])){return}var workType=($.varConfMainId!=""?"M":"S");saveConfMain(workType)}else{if(btnId=="btnDelete"){if($.varConfMainId!=""){confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveConfMain("D")}})}}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("ConfFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare){$.grdFile.deleteCurrentRow()}})}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popEmp"){if($.popUpCallId=="bteCreater"){$.bteCreater.setValue(popResult.employee_id);$.bteCreater.setText(popResult.emp_name)}}else{if(id=="popSaveConfReport"){if($.popUpCallId=="btnNewSave"){$.varConfId=popResult.conf_id;$.panQuery.clear();searchConfList()}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerscheduler_view_display=function(id,view){};$.fingertree_refresh=function(id){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){}};</script>