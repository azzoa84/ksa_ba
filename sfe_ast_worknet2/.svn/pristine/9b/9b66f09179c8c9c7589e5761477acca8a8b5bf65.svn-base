<script>function Main(){var $=this;$.host=null;$.panMain=null;$.htmlImgView=null;$.panTop=null;$.btnLeft=null;$.btnRight=null;$.htmlPage=null;$.lblConnectName=null;$.cmbConnectName=null;$.btnSave=null;$.btnClose=null;$.nowPage=1;$.saveContactList=[];$.pageNumberList=[];$.varId="";$.setScrollFixedBottom=function(){var e=document.getElementById($.varId);e.scrollTop=e.scrollHeight;e.scrollLeft=e.scrollWidth;delete e};function changePage(nowPage){$.htmlPage.setHTML(nowPage+" / "+$.p_argument.imgUrlList.length);jQuery("#popCPAgreementImgViewImage").attr("src",getServerFileUrl($.p_argument.imgUrlList[nowPage-1]));var bResult=false;for(var i=0;i<$.saveContactList.length;i++){if($.nowPage==$.saveContactList[i].pageNum){$.cmbConnectName.setValue($.saveContactList[i].contactId);bResult=true;break}}if(!bResult){$.cmbConnectName.setValue("")}}function matchingAgreementImg(value){for(var i=0;i<$.saveContactList.length;i++){if($.nowPage==$.saveContactList[i].pageNum){$.cmbConnectName.setSelectedItemAddCss([$.saveContactList[i].id]);$.cmbConnectName.setValueByColumn($.saveContactList[i].id,"check_yn",createCheckBox(false));$.saveContactList.splice(i,1);break}}var page=-1;for(var i=0;i<$.saveContactList.length;i++){if($.saveContactList[i].contactId==value){page=i;break}}if(page>-1){$.saveContactList[page].pageNum=$.nowPage}else{$.saveContactList.push({contactId:value,pageNum:$.nowPage,fileName:$.p_argument.imgNameList[$.nowPage-1],serverPath:$.p_argument.serverPath,contactName:$.cmbConnectName.getValue("contact_name"),companyName:$.cmbConnectName.getValue("company_name"),id:$.cmbConnectName.getSelectedRowId()});$.cmbConnectName.setValueByColumn($.cmbConnectName.getSelectedRowId(),"check_yn",createCheckBox(true))}setSelectComboColor()}function setSelectComboColor(){var idList=[];for(var i=0;i<$.saveContactList.length;i++){idList.push($.saveContactList[i].id)}$.cmbConnectName.setSelectedItemAddCss(idList,"font-color-blue")}function createCheckBox(value){var html="";if(value){html="<input type='checkbox' checked disabled=true>"}else{html="<input type='checkbox' disabled=true>"}return html}function arrayDiff(){var originalArr=$.pageNumberList;var compArr=[];for(var i=0;i<$.saveContactList.length;i++){compArr.push($.saveContactList[i].pageNum)}return originalArr.filter(function(i){return compArr.indexOf(i)<0})}function createImgTag(){var img=document.createElement("img");img.id="popCPAgreementImgViewImage";img.onload=$.setScrollFixedBottom;img.alt="동의서";$.htmlImgView.setHTML('<div id="agreementImg"></div>');var e=document.getElementById("agreementImg");e.appendChild(img)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,850,800);$.panMain.setText("");$.panMain.setBottomLine(true);$.htmlImgView=new FingerHTMLView(host,"htmlImgView",0,65,850,680);$.panTop=new FingerPanel(host,"panTop",0,0,850,55);$.panTop.setText("");$.panTop.setBottomLine(true);$.btnLeft=new FingerButton(host,"btnLeft",25,15,50,20);$.btnLeft.setText("◀");$.btnRight=new FingerButton(host,"btnRight",145,15,50,20);$.btnRight.setText("▶");$.htmlPage=new FingerHTMLView(host,"htmlPage",59,15,80,24);$.lblConnectName=new FingerLabel(host,"lblConnectName",225,15,200,20);$.lblConnectName.setText("* 선택한 의료인으로 동의서 연결");$.cmbConnectName=new FingerComboBox(host,"cmbConnectName",430,15,245,20);$.btnSave=new FingerButton(host,"btnSave",750,15,100,20);$.btnSave.setText("선택완료");$.btnClose=new FingerButton(host,"btnClose",780,765,80,20);$.btnClose.setText("닫기");$.panTop.setBorder(true);$.htmlPage.setStyle("border","1px solid");$.htmlPage.setStyle("text-align","center");$.htmlPage.setStyle("font-weight","600");$.htmlPage.setStyle("line-height","24px");$.btnSave.setClass("btn_save");$.cmbConnectName.setEmptyRow(true);$.cmbConnectName.setColumn("contact_id","contact_name");$.cmbConnectName.setColumnConfig([{id:"check_yn",width:80,css:"align_center"},{id:"contact_id",width:0},{id:"company_name",width:200},{id:"contact_name",width:0},{id:"upload_yn",width:80},]);$.htmlImgView.setBorder(true);$.htmlImgView.setHorizontalScroll(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.btnClose);$.panMain.add($.htmlImgView);$.panTop.add($.btnLeft);$.panTop.add($.btnRight);$.panTop.add($.htmlPage);$.panTop.add($.lblConnectName);$.panTop.add($.cmbConnectName);$.panTop.add($.btnSave);if($.p_argument){createImgTag();$.varId=$.htmlImgView.getRealId();if($.p_argument.imgUrlList&&$.p_argument.imgUrlList.length){changePage($.nowPage);for(var i=0;i<$.p_argument.imgUrlList.length;i++){$.pageNumberList.push(i+1)}}if($.p_argument.contactList&&$.p_argument.contactList.length){var dt=$.p_argument.contactList;var data={};data.resultList=[];var arr=[];for(var i in dt){arr.push({check_yn:createCheckBox(false),contact_id:dt[i].contact_id,company_name:dt[i].company_name,contact_name:dt[i].contact_name,upload_yn:dt[i].upload_yn});data.resultList.push(arr)}setComboBind([$.cmbConnectName],data)}}};$.callback=function(type,ds){};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnLeft"){var beforePage=$.nowPage-1;if(beforePage<1){MessageBoxShow("처음 페이지 입니다.");return}else{$.nowPage=beforePage;changePage($.nowPage)}}else{if(id=="btnRight"){var afterPage=$.nowPage+1;if(afterPage>$.p_argument.imgUrlList.length){MessageBoxShow("마지막 페이지 입니다.");return}else{$.nowPage=afterPage;changePage($.nowPage)}}else{if(id=="btnClose"){g_popupStack.close()}else{if(id=="btnSave"){var diff=arrayDiff();if(diff.length>0){var msg="";for(var i=0;i<diff.length;i++){msg+=diff[i];if(i!=diff.length-1){msg+=", "}}msg+=" 번 페이지에 서명자가 연결 되지 않았습니다.<br>확인 해 주시기 바랍니다.";var w=diff.length*10+300+"px";webix.alert({ok:"확인",text:msg,width:w});return}else{var msg='각 페이지별로 연결된 동의서 서명인을 최종 확인해 주세요.<br>(* "예"을 누르면 해당 의료인의 개별 동의서로 업로드 됩니다.)<br><br>';$.saveContactList.sort(function(a,b){return a.pageNum<b.pageNum?-1:a.pageNum>b.pageNum?1:0});for(var i=0;i<$.saveContactList.length;i++){var rData=$.saveContactList[i];msg+=rData.pageNum+" - "+rData.contactName+" ("+rData.companyName+")";if(i!=$.saveContactList.length-1){msg+="<br>"}}var h=$.saveContactList.length*10+200;confirmBoxShow(msg,function(){if(g_main.msgShare==true){var share={};share.saveContactList=$.saveContactList;g_popupStack.setData(share);g_popupStack.close()}},h,500)}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbConnectName"){if(!value){if($.saveContactList.length){var bResult=-1;for(var i=0;i<$.saveContactList.length;i++){if($.saveContactList[i].pageNum==$.nowPage){bResult=i;break}}if(bResult>-1){$.cmbConnectName.setSelectedItemAddCss([$.saveContactList[bResult].id]);$.cmbConnectName.setValueByColumn($.saveContactList[bResult].id,"check_yn",createCheckBox(false));$.saveContactList.splice(bResult,1)}}return}if($.cmbConnectName.getValue("upload_yn")=="Y"){var bResult=false;for(var i=0;i<$.saveContactList.length;i++){if($.saveContactList[i].contactId==value){bResult=true;break}}if(!bResult){var msg=$.cmbConnectName.getValue("company_name")+" "+$.cmbConnectName.getValue("contact_name")+" 의료인에 등록된 동의서가 이미 존재합니다.<br>현재 선택한 동의서로 변경하시겠습니까?";confirmBoxShow(msg,function(){if(g_main.msgShare==true){}else{$.cmbConnectName.setValue("");return}},150,440)}}matchingAgreementImg(value)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>