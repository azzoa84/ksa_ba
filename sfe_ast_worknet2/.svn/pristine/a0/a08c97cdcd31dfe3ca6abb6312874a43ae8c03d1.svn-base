<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.panMyVacation=null;$.lblRemainHoliday=null;$.lblRemainCompHoliday=null;$.lblFinalHoliday=null;$.txtRemainHoliday=null;$.txtRemainCompHoliday=null;$.txtFinalHoliday=null;$.grdList2=null;$.lblDept=null;$.lblEmp=null;$.lblLable1=null;$.lblLabel2=null;$.lblLabel3=null;$.lblLabel4=null;$.txtDept=null;$.txtEmp=null;$.grdList1=null;$.grdFile=null;$.grdDoc=null;$.varWFDocId="";$.varBusinessId="";$.varWFType="";$.varOldValue="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFPaidHolidayPlan"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmMyVacation_Q",[workType,"#UserID#"]);return json}function createJSON_S(workType){var rowCount=$.grdList1.getRowCount();var json=createExecuteParamInfo("P_crmWFPaidHloidayPlan_S",[workType,$.varWfDocId,"#DetpCode#","#UserID#",$.varRemainHoliday,$.varRemainCompHoliday,$.varFinalHoliday,rowCount>=1?$.grdList1.getValue(0,"date"):"",rowCount>=2?$.grdList1.getValue(1,"date"):"",rowCount>=3?$.grdList1.getValue(2,"date"):"",rowCount>=4?$.grdList1.getValue(3,"date"):"",rowCount>=5?$.grdList1.getValue(4,"date"):"",rowCount>=6?$.grdList1.getValue(5,"date"):"",rowCount>=7?$.grdList1.getValue(6,"date"):"",rowCount>=8?$.grdList1.getValue(7,"date"):"",rowCount>=9?$.grdList1.getValue(8,"date"):"",rowCount>=10?$.grdList1.getValue(9,"date"):"",rowCount>=11?$.grdList1.getValue(10,"date"):"",rowCount>=12?$.grdList1.getValue(11,"date"):"",rowCount>=13?$.grdList1.getValue(12,"date"):"",rowCount>=14?$.grdList1.getValue(13,"date"):"",rowCount>=15?$.grdList1.getValue(14,"date"):"",rowCount>=16?$.grdList1.getValue(15,"date"):"",rowCount>=17?$.grdList1.getValue(16,"date"):"",rowCount>=18?$.grdList1.getValue(17,"date"):"",rowCount>=1?$.grdList1.getValue(0,"half"):"False",rowCount>=2?$.grdList1.getValue(1,"half"):"False",rowCount>=3?$.grdList1.getValue(2,"half"):"False",rowCount>=4?$.grdList1.getValue(3,"half"):"False",rowCount>=5?$.grdList1.getValue(4,"half"):"False",rowCount>=6?$.grdList1.getValue(5,"half"):"False",rowCount>=7?$.grdList1.getValue(6,"half"):"False",rowCount>=8?$.grdList1.getValue(7,"half"):"False",rowCount>=9?$.grdList1.getValue(8,"half"):"False",rowCount>=10?$.grdList1.getValue(9,"half"):"False",rowCount>=11?$.grdList1.getValue(10,"half"):"False",rowCount>=12?$.grdList1.getValue(11,"half"):"False",rowCount>=13?$.grdList1.getValue(12,"half"):"False",rowCount>=14?$.grdList1.getValue(13,"half"):"False",rowCount>=15?$.grdList1.getValue(14,"half"):"False",rowCount>=16?$.grdList1.getValue(15,"half"):"False",rowCount>=17?$.grdList1.getValue(16,"half"):"False",rowCount>=18?$.grdList1.getValue(17,"half"):"False"]);return json}function searchWFDocument(){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchMyVacation(workType){var json=createJSON_Q2(workType);callQuery(["req",json],workType,$)}function saveWFPainHolidayPlan(){var json=createJSON_S("N");var ds=callExecuteSync(["req",json],"N",$,false);var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function getWeekday(sDate){sDate=unmask(sDate).substring(0,8);var yy=parseInt(sDate.substr(0,4),10);var mm=parseInt(sDate.substr(4,2),10);var dd=parseInt(sDate.substr(6),10);var d=new Date(yy,mm-1,dd);var weekday=[];weekday[0]="일요일";weekday[1]="월요일";weekday[2]="화요일";weekday[3]="수요일";weekday[4]="목요일";weekday[5]="금요일";weekday[6]="토요일";return weekday[d.getDay()]}function weekChk(){var data=$.grdList1.getAllRows();for(var i in data){if(data[i].day=="토요일"||data[i].day=="일요일"){MessageBoxShow("토요일 또는 일요일이 연차계획 휴무일로 지정되었습니다.");return false}}return true}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1270);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,500);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,585,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,980,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,980,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.panMyVacation=new FingerPanel(host,"panMyVacation",880,3,315,445);$.panMyVacation.setText("잔여 연차휴가");$.panMyVacation.setBottomLine(true);$.lblRemainHoliday=new FingerLabel(host,"lblRemainHoliday",35,10,100,20);$.lblRemainHoliday.setText("현재 잔여 연차");$.lblRemainCompHoliday=new FingerLabel(host,"lblRemainCompHoliday",35,40,100,20);$.lblRemainCompHoliday.setText("잔여 전사 휴가");$.lblFinalHoliday=new FingerLabel(host,"lblFinalHoliday",35,70,100,20);$.lblFinalHoliday.setText("최종 잔여 연차");$.txtRemainHoliday=new FingerEdit(host,"txtRemainHoliday",145,10,140,20);$.txtRemainCompHoliday=new FingerEdit(host,"txtRemainCompHoliday",145,40,140,20);$.txtFinalHoliday=new FingerEdit(host,"txtFinalHoliday",145,70,140,20);$.grdList2=new FingerDataGrid(host,"grdList2",5,105,305,285);$.lblDept=new FingerLabel(host,"lblDept",0,10,100,20);$.lblDept.setText("소속부서");$.lblEmp=new FingerLabel(host,"lblEmp",285,10,100,20);$.lblEmp.setText("신청인");$.lblLable1=new FingerLabel(host,"lblLable1",20,60,480,20);$.lblLable1.setText("잔여연차휴가일수 통지 및 휴가사용시기 지정 촉구 [근로기준법 제 61조 관련]");$.lblLabel2=new FingerLabel(host,"lblLabel2",20,90,520,20);$.lblLabel2.setText("아래 작성하진 연차휴가 계획은 단순예정일로 휴가사용 실정에는 반영되지 않습니다.");$.lblLabel3=new FingerLabel(host,"lblLabel3",20,115,450,20);$.lblLabel3.setText("연차휴가 사용희망 시에는 별도로 휴가신청서를 작성해 주시기 바랍니다.");$.lblLabel4=new FingerLabel(host,"lblLabel4",0,255,875,20);$.lblLabel4.setText("잔여 연차가 1일 미만인 경우 대상자가 아닙니다.");$.txtDept=new FingerEdit(host,"txtDept",105,10,140,20);$.txtEmp=new FingerEdit(host,"txtEmp",390,10,140,20);$.grdList1=new FingerDataGrid(host,"grdList1",0,155,870,300);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,230);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,230);$.panTitle.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.txtDept.setValue(g_main.session.obj.DeptName);$.txtEmp.setValue(g_main.session.obj.UserName);$.txtDept.setReadOnly(true);$.txtEmp.setReadOnly(true);$.txtRemainHoliday.setReadOnly(true);$.txtRemainCompHoliday.setReadOnly(true);$.txtFinalHoliday.setReadOnly(true);$.lblLable1.setAlign("left");$.lblLabel2.setAlign("left");$.lblLabel3.setAlign("left");$.lblLabel4.setAlign("center");colMap=$.grdList1.setColumns([new FingerDataGridColumn("date",290,"center","date","일자",{format:"ymd"}),new FingerDataGridColumn("day",290,"center","string","요일",{readonly:true}),new FingerDataGridColumn("halfYn",273,"center","string","연차차감일수",{readonly:true}),new FingerDataGridColumn("half",273,"center","string","연차여부",{hidden:true})]);$.grdList1.init();$.grdList1.setEditable(true);$.grdList1.setBorder(false);colMap=$.grdList2.setColumns([new FingerDataGridColumn("HolidayDate",100,"center","string","일자",{format:"s_ymd"}),new FingerDataGridColumn("HolidayDay",100,"center","string","요일"),new FingerDataGridColumn("HolidayInfo",100,"left","string","내용")]);$.grdList2.init();$.grdList2.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.panMyVacation);$.panWFMain.add($.lblDept);$.panWFMain.add($.lblEmp);$.panWFMain.add($.lblLable1);$.panWFMain.add($.lblLabel2);$.panWFMain.add($.lblLabel3);$.panWFMain.add($.lblLabel4);$.panWFMain.add($.txtDept);$.panWFMain.add($.txtEmp);$.panWFMain.add($.grdList1);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panMyVacation.add($.lblRemainHoliday);$.panMyVacation.add($.lblRemainCompHoliday);$.panMyVacation.add($.lblFinalHoliday);$.panMyVacation.add($.txtRemainHoliday);$.panMyVacation.add($.txtRemainCompHoliday);$.panMyVacation.add($.txtFinalHoliday);$.panMyVacation.add($.grdList2);searchWFDocument();searchMyVacation("Q1");searchMyVacation("Q2")};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue(result.business_title)}else{if(type=="Q1"){var result=ds.resultList[0][0];$.varRemainHoliday=result.RemainHoliday;$.varRemainCompHoliday=result.RemainCompHoliday;$.varFinalHoliday=result.FinalHoliday;$.txtRemainHoliday.setValue(result.RemainHoliday+"일");$.txtRemainCompHoliday.setValue(result.RemainCompHoliday+"일");$.txtFinalHoliday.setValue(result.FinalHoliday+"일");if(result.FinalHoliday>0){$.lblLabel4.setVisible(false);for(var i=0;i<Math.floor(result.FinalHoliday);i++){$.grdList1.addRow({date:getToday("-"),day:getWeekday(getToday("")),halfYn:"1",half:"False"})}if(result.FinalHoliday%1!=0){$.grdList1.addRow({date:getToday("-"),day:getWeekday(getToday("")),halfYn:"0.5",half:"Y"},20)}}else{$.grdList1.setVisible(false);$.lblLabel4.setVisible(true)}}else{if(type=="Q2"){if(ds&&ds.resultList[0].length>0){for(var i in ds.resultList[0]){ds.resultList[0][i].HolidayDay=getWeekday(ds.resultList[0][i].HolidayDate)}}setDataGrid([$.grdList2],ds)}else{if(type=="N"){searchMyVacation()}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if($.grdList1.getRowCount()<=0){return}if(!weekChk()){return}var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFPaidHolidayPlan"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){if($.grdList1.getRowCount()<=0){return}if(!weekChk()){return}if(saveWFDocument("","N")){saveWFPainHolidayPlan()}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){if(cInd=="dept_name"||cInd=="emp_name"){$.popUpCallId="grdList";var param={emp_name:""};g_main.openPopup("popEmp.html","popEmp","사원팝업",750,500,"","",param,"","")}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList1"){if(cInd=="date"){if($.varOldValue==nValue){return}if(getToday("").substr(4,2)>4){if(unmask(nValue.substr(0,10))>(Number(getToday("").substr(0,4))+1)+"0331"){MessageBoxShow(Number(getToday("").substr(0,4))+1+"-03-31일 이내로 선택해 주십시오.");$.varOldValue=oValue;$.grdList1.setValue(rId,"date",oValue);return}}else{if(unmask(nValue.substr(0,10))>(Number(getToday("").substr(0,4))+1)+"0331"){MessageBoxShow(getToday("").substr(0,4)+"-03-31일 이내로 선택해 주십시오.");$.varOldValue=oValue;$.grdList1.setValue(rId,"date",oValue);return}}$.grdList1.setValue(rId,"day",getWeekday(nValue))}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnNew"){$.grdList.addRow()}else{if(btnId=="btnDelete"){var rId=$.grdList.getSelectedRowIdx();$.grdList.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popEmp"){if($.popUpCallId=="grdList"){var rId=$.grdList.getSelectedRowIdx();$.grdList.setValue(rId,"dept_code",popResult.dept_code);$.grdList.setValue(rId,"dept_name",popResult.dept_name);$.grdList.setValue(rId,"employee_id",popResult.employee_id);$.grdList.setValue(rId,"emp_name",popResult.emp_name)}}else{if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveWFPainHolidayPlan()}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popWFGoAboardSub"){if($.popUpCallId=="bteSubject"){$.varSubWfDocId=popResult.wf_doc_id;$.bteSubject.setValue(popResult.subject)}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){}};</script>