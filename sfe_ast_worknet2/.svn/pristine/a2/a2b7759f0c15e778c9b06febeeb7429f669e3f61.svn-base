<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.lblYyyy=null;$.cmbYyyy=null;$.lblDept=null;$.cmbDept=null;$.lblProduct=null;$.cmbProduct=null;$.btnSearch=null;$.panList=null;$.grdList=null;$.lblStrategy=null;$.cmbStrategy=null;$.panDetail=null;$.htmlDetail=null;$.lblMonth=null;$.cmbMonth=null;$.grdExcel=null;$.session=g_main.session.obj;$.colors=["#21B6A8","#177F75","#4285F4","#B6212D"];$.CHART_WIDTH=1075;$.CHART_HEIGHT=308;$.varYYYY="";$.varDeptCode="";$.varStrategy="";$.varKpi="";$.varChannel="";$.varDataSource="";$.varDataSourceStandard="";$.varGroupId="";$.varChartId="";$.varGridId="";$.varHeight=0;$.isFirst=true;$.varDt=[];$.varYYYY=getToday().substr(0,4);$.varMM=getToday().substr(4,2);$.specialValueType="AMOUNT";$.varListData=[];function createJSON_Q(workType){var strategy="";var kpiDescription="";var channel="";var dataSource="";var dataSourceStandard="";var yyyy=$.cmbYyyy.getValue();var deptCode=$.cmbDept.getValue();if(workType=="Q_ALL"||workType=="Q_DETAIL"){strategy=$.cmbStrategy.getValue("strategy")||""}else{if(workType=="Q_CHART"){strategy=$.varStrategy;kpiDescription=$.varKpi;channel=$.varChannel;dataSource=$.varDataSource;dataSourceStandard=$.varDataSourceStandard}else{if(workType=="Q_M"){deptCode=($.cmbDept.getValue()||$.varDeptCode);yyyy=$.cmbYyyy.getValue()||""}}}var json=createExecuteParamInfo("P_crmMKTKPI_Q",[workType,"","",yyyy,$.cmbMonth.getValue()||"",deptCode,0,$.cmbProduct.getValue("product_code")||"",strategy,kpiDescription,dataSource,dataSourceStandard,channel,"#UserID#"]);return json}function searchList(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function seachProductList(workType){var json=createJSON_Q(workType);var ds=callQuerySync(["req",json],$);$.cmbProduct.clear();setComboBind([$.cmbProduct],ds);if($.varProductCode){$.cmbProduct.setValue($.varProductCode)}}function searchMaxInputMonth(workType){var json=createJSON_Q("Q_M");var ds=callQuerySync(["req",json],$);if(ds.resultList[0].length){var monthArr=["04","05","06","07","08","09","10","11","12","01","02","03"];var yyyy=ds.resultList[1][0].yyyy;var seq=0;var dt=ds.resultList[0][0];var objData=Object.keys(dt);for(var i=0;i<objData.length;i++){var column=objData[i];if(!dt[column]){seq=i-1;break}}if(ds.resultList[2][0].cnt){if(seq>8){yyyy=Number(yyyy)+1}$.cmbYyyy.setValue(yyyy.toString());if(seq>0){$.cmbMonth.setValue(monthArr[seq])}else{$.cmbMonth.setValue("04")}}else{if(!$.cmbYyyy.getValue()){$.cmbYyyy.setValue($.varYYYY)}if(!$.cmbMonth.getValue()){$.cmbMonth.setValue($.varMM)}var compYYYY=Number($.cmbYyyy.getValue());var compMM=Number($.cmbMonth.getValue());if(compMM==1||compMM==2||compMM==3){compYYYY-=1}MessageBoxShow(compYYYY+"년도에 입력한 KPI 가 없습니다.")}}else{$.cmbYyyy.setValue($.varYYYY);$.cmbMonth.setValue($.varMM)}}function initView(){$.varCodeArr=[{sub_code:"10",code_name:"당월"},{sub_code:"20",code_name:"누적"},];$.varDs=bizComponentData2($,"Q1","S_999|L_CRM0037|L_CRM280");if($.varDs.resultList[0]&&$.varDs.resultList[0].length){var afterYear=Number($.varDs.resultList[0][0].base_yyyy)+1;$.varDs.resultList[0].unshift({base_yyyy:afterYear,name:afterYear+"년"});setComboBind([$.cmbYyyy,$.cmbMonth,$.cmbDept],$.varDs);var deptCode=$.session.DeptCode;var compDeptCode=deptCode.substr(0,2);if(compDeptCode=="F2"||compDeptCode=="F3"){$.varDeptCode=compDeptCode+"00";searchMaxInputMonth("Q_M");changeFYColumnList();$.cmbDept.setValue($.varDeptCode)}else{$.cmbYyyy.setValue($.varYYYY);$.cmbMonth.setValue($.varMM);changeFYColumnList()}var json=createJSON_Q("Q_MONTH");var ds=callQuerySync(["req",json],$);$.varMonthList=ds.resultList[0];changeMonthColumnList($.varMonthList)}else{MessageBoxShow("화면 로드 중 오류가 발생하였습니다.<br>관리자에게 문의하여 주십시오.");return}$.grdList.setColumnDropDownList("result_type",$.varCodeArr);$.htmlDetail.removeStyle("overflow");setPanelStyle(false);$.isFirst=false}function changeMonthColumnList(dt){if(dt.length){var monthList=dt;for(var i=0;i<monthList.length;i++){$.grdList.setColumnText("month"+(i+1),monthList[i].month_name,2);$.grdExcel.setColumnText("month"+(i+1),monthList[i].month_name,2)}}}function changeFYColumnList(){var yyyyStr=$.cmbYyyy.getValue();var year=Number(yyyyStr.toString().substr(2,2));var month=Number($.cmbMonth.getValue());if(month==1||month==2||month==3){year-=1}var str="FY"+year;$.grdList.setColumnText("result_type",str+" 전체",1);$.grdList.setColumnText("now_fy","FY"+(year-1),1);$.grdList.setColumnText("target_fy","FY"+year+" Target",1);$.grdExcel.setColumnText("result_type",str+" 전체",1);$.grdExcel.setColumnText("now_fy","FY"+(year-1),1);$.grdExcel.setColumnText("target_fy","FY"+year+" Target",1)}function initData(){$.varYYYY="";$.varDeptCode="";$.varProductCode="";$.varStrategy="";$.varKpi="";$.varChannel="";$.varGroupId="";$.varChartId="";$.varGridId=""}$.chartObj={columnOptions:createHighChartProperties({chart:{width:$.CHART_WIDTH,height:$.CHART_HEIGHT},title:{text:null},xAxis:{categories:[],label:{enabled:true}},credits:{enabled:false},series:[],tooltip:{style:{fontWeight:"bold",fontSize:"14px"},formatter:function(){var str="";var title="";if(this.key=="nowFY"||this.key=="targetFY"){title=this.point.title}else{title=this.series.name}if(this.point.valueType==$.specialValueType){str+=numberComma(this.y)+"<br/>"}else{str+=this.y.toFixed(2)+(this.point.valueName||"")+"<br/>"}if(this.point.dispText){str+='<span style="color: white;">space</span><br/>';str+=this.point.dispText}return str}},legend:{enabled:true,align:"center",verticalAlign:"bottom"},plotOptions:{column:{pointPadding:0.2,borderWidth:0}}}),create:function(id,options){var opt=this.columnOptions;if(opt){jQuery("#"+id).highcharts(Highcharts.merge(opt,options))}},destroy:function(id){if(jQuery("#"+id).highcharts()){jQuery("#"+id).highcharts().destroy()}},render:function(id,dt){this.destroy(id);var fyData=dt[0]?dt[0][0]:"";var vType=fyData.value_type||"";var vName=fyData.value_name||"";if(fyData.value_type==$.specialValueType){vName="COMMA"}var dataArr=dt[1];var titleArr=dt[2];var cateArr=[];var seriesNowArr=[];var seriesTargetArr=[];var seriesNameArr=[];var nowFYDataArr=[];var targetFYDataArr=[];var arrSeries=[];var maxValue=0;var minValue=9999999999;for(var i=0;i<titleArr.length;i++){cateArr.push(titleArr[i].month_name);if(fyData.now_fy){nowFYDataArr.push({y:fyData.now_fy,dispText:fyData.now_fy_text||"",valueName:vName,valueType:vType})}if(fyData.target_fy){targetFYDataArr.push({y:fyData.target_fy,dispText:fyData.target_fy_text||"",valueName:vName,valueType:vType})}}maxValue=Math.max(Number(fyData.now_fy),Number(fyData.target_fy));if(Number(fyData.now_fy)&&!Number(fyData.target_fy)){minValue=Number(fyData.now_fy)}else{if(!Number(fyData.now_fy)&&Number(fyData.target_fy)){minValue=Number(fyData.target_fy)}else{if(Number(fyData.now_fy)&&Number(fyData.target_fy)){minValue=Math.min(Number(fyData.now_fy),Number(fyData.target_fy))}}}if(dataArr&&dataArr.length){for(var i=0;i<dataArr.length;i++){var monthObj=Object.keys(dataArr[i]);var iCount=1;if(dataArr[i].result_type=="10"){for(var j=0;j<monthObj.length;j++){if(monthObj[j].indexOf("month")>-1&&monthObj[j].length<10){seriesNowArr.push({y:dataArr[i][monthObj[j]]||null,resultType:dataArr[i].result_type,dispText:dataArr[i]["month_disp_text"+iCount]||"",valueName:vName,valueType:vType});maxValue=Math.max(Number(dataArr[i][monthObj[j]]),maxValue);if(dataArr[i][monthObj[j]]){minValue=Math.min(Number(dataArr[i][monthObj[j]]),minValue)}iCount++}}}else{for(var j=0;j<monthObj.length;j++){if(monthObj[j].indexOf("month")>-1&&monthObj[j].length<10){seriesTargetArr.push({y:dataArr[i][monthObj[j]]||null,resultType:dataArr[i].result_type,dispText:dataArr[i]["month_disp_text"+iCount]||"",valueName:vName,valueType:vType});maxValue=Math.max(Number(dataArr[i][monthObj[j]]),maxValue);if(dataArr[i][monthObj[j]]){minValue=Math.min(Number(dataArr[i][monthObj[j]]),minValue)}iCount++}}}}arrSeries.push({type:"column",name:"당월",data:seriesNowArr,yAxis:0,color:$.colors[0]});arrSeries.push({name:"누적",data:seriesTargetArr,yAxis:1,color:$.colors[1]})}if(fyData){var yyyyStr=$.cmbYyyy.getValue();var year=Number(yyyyStr.toString().substr(2,2));var month=Number($.cmbMonth.getValue());if(month==1||month==2||month==3){year-=1}if(nowFYDataArr.length){arrSeries.push({type:"line",dashStyle:"shortdash",name:"FY"+(year-1),yAxis:2,data:nowFYDataArr,color:$.colors[2],marker:{enabled:false}})}if(targetFYDataArr.length){arrSeries.push({type:"line",dashStyle:"shortdash",name:"FY"+year+" Target",yAxis:2,data:targetFYDataArr,color:$.colors[3],marker:{enabled:false}})}}if(minValue==9999999999){minValue=0}else{minValue=minValue-(maxValue-minValue)}if(minValue<0){minValue=0}var options={xAxis:{categories:cateArr},yAxis:[{min:minValue,max:maxValue,title:{text:null},labels:{format:"{value:.,0f}"+(vName=="COMMA"?"":vName)}},{min:minValue,max:maxValue,title:{text:null},labels:{enabled:false},market:{lineWidth:1},opposite:true},{min:minValue,max:maxValue,labels:{enabled:false},title:{text:null}}],series:arrSeries};this.create(id,options)}};function setDataHtml(ds){initData();var strategyArr=[];var kpiArr=[];var channelArr=[];var kpiCount=1;var html="";if(ds){strategyArr=ds.resultList[0];kpiArr=ds.resultList[1];channelArr=ds.resultList[2];if(strategyArr.length){html='<div class="m-kpi">';for(var i=0;i<strategyArr.length;i++){var strategyRowData=strategyArr[i];html+='<div class="m-panel"';if(i==0){html+=' style="margin-top: 0;"'}html+=">";html+='<div class="top">';html+='<i class="fas fa-angle-right"></i>';html+=strategyRowData.strategy;html+="</div>";for(var ii=0;ii<kpiArr.length;ii++){var kpiRowData=kpiArr[ii];if(strategyRowData.strategy==kpiRowData.strategy){html+='<div class="contents">';html+='<div class="flex-box">';html+='<div class="left">';html+=kpiRowData.kpi_description;html+="</div>";html+='<div class="right">';for(var iii=0;iii<channelArr.length;iii++){var channelRowData=channelArr[iii];if(kpiRowData.strategy==channelRowData.strategy&&kpiRowData.kpi_description==channelRowData.kpi_description){html+='<div class="m-box" data-group-id="mktChannelGroup'+kpiCount+'" data-grid-id="mktChannelGrid'+kpiCount+'" data-chart-id="mktChannelChart'+kpiCount+'" data-strategy="'+channelRowData.strategy+'" data-kpi="'+channelRowData.kpi_description+'" data-source="'+channelRowData.data_source+'" data-source-std="'+channelRowData.data_source_standard+'" data-channel="'+channelRowData.channel+'">';html+="<p>"+channelRowData.channel+"</p>";html+='<div class="box-titles">';html+="<span>Target</span>";html+="<span>당월</span>";html+="<span>누적</span>";html+="</div>";html+='<div class="percentage">';if(channelRowData.value_type&&channelRowData.value_type==$.specialValueType){html+='<span class="left-color">'+(channelRowData.target_fy?numberComma(channelRowData.target_fy):"-")+"</span>";html+='<span class="middle-color">'+(channelRowData.now_month?numberComma(channelRowData.now_month):"-")+"</span>";html+='<span class="right-color">'+(channelRowData.arr_month?numberComma(channelRowData.arr_month):"-")+"</span>"}else{var valueName=channelRowData.value_name||"";html+='<span class="left-color">'+(channelRowData.target_fy?channelRowData.target_fy+valueName:"-")+"</span>";html+='<span class="middle-color">'+(channelRowData.now_month?channelRowData.now_month+valueName:"-")+"</span>";html+='<span class="right-color">'+(channelRowData.arr_month?channelRowData.arr_month+valueName:"-")+"</span>"}html+="</div>";html+="</div>"}}html+="</div>";html+="</div>";html+='<div id="mktChannelGroup'+kpiCount+'" class="group-box">';html+='<div id="mktChannelChart'+kpiCount+'" class="chart-box"></div>';html+='<div id="mktChannelGrid'+kpiCount+'" class="grid-box"></div>';html+="</div>";html+="</div>";kpiCount++}}html+="</div>"}}}html+="</div>";$.htmlDetail.setHTML(html);$.varHeight=jQuery(".m-kpi").height();setPanelStyle(false);if(!$.varHeight&&!$.isFirst){$.htmlDetail.setHTML('<div style="height: 40px; line-height: 40px; font-size: 20px; text-align: center;">조회된 내역이 없습니다.</div>')}jQuery(".m-box").click(function(){if(!$.panTop.validateControls()){return}var th=jQuery(this);initData();$.varStrategy=th.attr("data-strategy");$.varKpi=th.attr("data-kpi");$.varDataSource=th.attr("data-source");$.varDataSourceStandard=th.attr("data-source-std");$.varChannel=th.attr("data-channel");$.varGroupId=th.attr("data-group-id");$.varChartId=th.attr("data-chart-id");$.varGridId=th.attr("data-grid-id");jQuery(".m-box").removeClass("active");th.addClass("active");searchList("Q_CHART");return;var ds={errorCode:"MSG0001",returnStr:"",errorMsg:"",resultList:[[{channel:"All",now_fy:33.96,now_fy_text:"FY17 기타",target_fy:34.05,target_fy_text:"FY18 타겟<br>"}],[{result_type:"10",month1:12,month_disp_text1:"",month2:14,month_disp_text2:"",month3:16,month_disp_text3:"",month4:0,month_disp_text4:"",month5:0,month_disp_text5:"",month6:0,month_disp_text6:"",month7:21,month_disp_text7:"",month8:22,month_disp_text8:"",month9:0,month_disp_text9:"",month10:0,month_disp_text10:"",month11:0,month_disp_text11:"",month12:0,month_disp_text12:""},{result_type:"20",month1:12,month_disp_text1:"",month2:14,month_disp_text2:"",month3:16,month_disp_text3:"",month4:0,month_disp_text4:"",month5:0,month_disp_text5:"",month6:0,month_disp_text6:"",month7:24,month_disp_text7:"",month8:25,month_disp_text8:"",month9:0,month_disp_text9:"",month10:0,month_disp_text10:"",month11:0,month_disp_text11:"",month12:0,month_disp_text12:""}],[{month_name:"Apr",half:"1"},{month_name:"May",half:"1"},{month_name:"Jun",half:"1"},{month_name:"Jul",half:"1"},{month_name:"Aug",half:"1"},{month_name:"Sep",half:"1"},{month_name:"Oct",half:"2"},{month_name:"Nov",half:"2"},{month_name:"Dec",half:"2"},{month_name:"Jan",half:"2"},{month_name:"Feb",half:"2"},{month_name:"Mar",half:"2"}]]};$.chartObj.render($.varChartId,ds.resultList);setHTMLGrid($.varGridId,ds.resultList);jQuery(".group-box").hide(500);jQuery("#"+$.varGroupId).show(500);setPanelStyle(true)})}function setHTMLGrid(id,dt){var headerArr=["FY17","FY18<br>target"];var fyDataArr=dt[0];var valueName=(fyDataArr[0]?fyDataArr[0].value_name:"");var dataArr=dt[1];var titleArr=dt[2];var lineCnt=2;for(var i=0;i<titleArr.length;i++){headerArr.push(titleArr[i].month_name)}var yyyyStr=$.cmbYyyy.getValue();var year=Number(yyyyStr.toString().substr(2,2));var month=Number($.cmbMonth.getValue());if(month==1||month==2||month==3){year-=1}var tag="";tag+="<table>";tag+="<tr>";tag+=createThTag("FY"+(year-1));tag+=createThTag("FY"+year+"<br>Target");tag+=createThTag("당월/<br>누적",82);for(var i=0;i<titleArr.length;i++){tag+="<th>"+titleArr[i].month_name+"</th>"}tag+="</tr>";for(var i=0;i<lineCnt;i++){tag+="<tr>";if(i==0){var nowFy="";var targetFy="";if(fyDataArr.length){nowFy=fyDataArr[0].now_fy||0;targetFy=fyDataArr[0].target_fy||0}if(valueName==","){tag+=createTdTag(nowFy?numberComma(nowFy):"-",2);tag+=createTdTag(targetFy?numberComma(targetFy):"-",2)}else{tag+=createTdTag(nowFy?nowFy+valueName:"-",2);tag+=createTdTag(targetFy?targetFy+valueName:"-",2)}}tag+=createTdTag(i==0?"당월":"누적");if(dataArr.length){var rowObj=Object.keys(dataArr[i]);for(var j=0;j<rowObj.length;j++){if(rowObj[j].indexOf("month")>-1&&rowObj[j].length<10){var monthValue=dataArr[i][rowObj[j]]||0;if(monthValue){if(valueName==","){tag+=createTdTag(numberComma(monthValue))}else{tag+=createTdTag(monthValue+valueName)}}else{tag+=createTdTag("-")}}}}else{for(var j=0;j<titleArr.length;j++){tag+=createTdTag("-")}}tag+="</tr>"}tag+="</table>";jQuery("#"+id).html(tag)}function createThTag(value,width){if(width){return'<th style="width: '+width+'px;">'+value+"</th>"}else{return"<th>"+value+"</th>"}}function createTdTag(value,rowSpanCnt){var cnt=rowSpanCnt||1;return'<td rowspan="'+cnt+'">'+value+"</td>"}function setPanelStyle(isChart){var height=(isChart?$.varHeight+477:$.varHeight);$.panDetail.setSize(null,height+85);$.panList.setProperty(0,height+165);$.panMain.setProperty(0,0,null,height+920,true)}function numberComma(item){var str=String(item);var split=str.split(".");if(split.length>1){return split[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+"."+split[1]}else{return split[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")}}webix.extend(webix.ui.datatable,{autoAdjustRowHeight:function(id,silent,rId){function processRow(that,obj){var h=[that.config.rowHeight],config;for(var i=0;i<id.length;i++){config=that.getColumnConfig(id[i]);d.style.width=config.width+"px";d.innerHTML=obj[id[i]];h.push(d.scrollHeight)}obj.$height=Math.max.apply(null,h)}if(typeof id=="string"){id=[id]}var d=webix.html.create("DIV",{"class":"webix_table_cell webix_measure_size webix_cell"},"");d.style.cssText="height:1px; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;";this.$view.appendChild(d);if(rId){var obj=this.getItem(rId);processRow(this,obj)}else{this.data.each(function(obj){processRow(this,obj)},this)}d=webix.html.remove(d);if(!silent){this.refresh()}}});function setCustomCellStyle(a,b,c,d){return{"word-break":"break-all"}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,875);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,55);$.panTop.setText("");$.panTop.setBottomLine(true);$.lblYyyy=new FingerLabel(host,"lblYyyy",0,15,100,20);$.lblYyyy.setText("년도");$.cmbYyyy=new FingerComboBox(host,"cmbYyyy",105,15,85,20);$.lblDept=new FingerLabel(host,"lblDept",290,15,100,20);$.lblDept.setText("부서");$.cmbDept=new FingerComboBox(host,"cmbDept",395,15,140,20);$.lblProduct=new FingerLabel(host,"lblProduct",505,15,100,20);$.lblProduct.setText("품목");$.cmbProduct=new FingerComboBox(host,"cmbProduct",610,15,95,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.panList=new FingerPanel(host,"panList",0,165,1200,700);$.panList.setText("KPI 내역");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,655);$.lblStrategy=new FingerLabel(host,"lblStrategy",675,15,100,20);$.lblStrategy.setText("전략");$.cmbStrategy=new FingerComboBox(host,"cmbStrategy",780,15,320,20);$.panDetail=new FingerPanel(host,"panDetail",0,65,1200,100);$.panDetail.setText("KPI 현황");$.panDetail.setBottomLine(true);$.htmlDetail=new FingerHTMLView(host,"htmlDetail",0,0,1200,50);$.lblMonth=new FingerLabel(host,"lblMonth",150,15,100,20);$.lblMonth.setText("월");$.cmbMonth=new FingerComboBox(host,"cmbMonth",255,15,65,20);$.grdExcel=new FingerDataGrid(host,"grdExcel",0,0,20,20);$.panTop.setBorder(true);$.panList.addButton("btnExcelDown","엑셀다운로드");$.panList.setButtonAction("btnExcelDown","excel_down");$.cmbYyyy.setEmptyRow(true);$.cmbDept.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbStrategy.setEmptyRow(true);$.cmbYyyy.setColumn("base_yyyy","name");$.cmbProduct.setColumn("seq","product_code");$.cmbDept.setColumn("dept_code","dept_name");$.cmbStrategy.setColumn("seq","strategy");$.cmbYyyy.setAllowBlank(false,"년도");$.cmbMonth.setAllowBlank(false,"월");$.cmbDept.setAllowBlank(false,"부서");$.cmbProduct.setAllowBlank(false,"품목");$.cmbStrategy.setColumnConfig([{id:"seq",width:70},{id:"strategy",width:490}]);$.cmbProduct.setColumnConfig([{id:"seq",width:70},{id:"product_code",width:190}]);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("product_code",70,"center","multi_line_edit",[{text:"Product",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("strategy",180,"center","multi_line_edit",[{text:"Strategy",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("kpi_description",180,"center","multi_line_edit",[{text:"KPI description",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("data_source",150,"center","multi_line_edit",[{text:"Data Source",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("data_source_standard",200,"center","multi_line_edit",[{text:"Data Source/기준",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("channel",100,"center","multi_line_edit",[{text:"Channel",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("now_fy",70,"center","string",[{text:"FY17",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("target_fy",70,"center","string",[{text:"FY17",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("result_type",70,"center","string",[{text:"FY18(상)",colspan:13},""],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month1",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month2",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month3",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month4",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month5",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month6",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month7",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month8",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month9",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month10",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month11",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month12",70,"center","string",["",{text:""}],{verticalMiddle:true,sort:null})]);$.grdList.init({scroll:"xy",headerRowHeight:40,leftSplit:3});$.grdList.setBorder(false);$.grdList.setEditable(false);$.grdList.setGridMultiLineAutoHeight();$.grdExcel.colIdx=$.grdExcel.setColumns([new FingerDataGridColumn("product_code",90,"center","string",[{text:"Product",rowspan:3},"",""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("strategy",200,"center","multi_line_edit",[{text:"Strategy",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("kpi_description",200,"center","multi_line_edit",[{text:"KPI description",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("data_source",150,"center","multi_line_edit",[{text:"Data Source",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("data_source_standard",200,"center","multi_line_edit",[{text:"Data Source/기준",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("channel",150,"center","string",[{text:"Channel",rowspan:3},"",""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("now_fy",70,"center","string",[{text:"FY17",colspan:2},{text:"수치",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("now_fy_text",70,"center","multi_line_edit",["",{text:"<br>기타<br>(표시)",css:"multi_h_line",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("target_fy",70,"center","string",[{text:"FY17",colspan:2},{text:"수치",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("target_fy_text",70,"center","multi_line_edit",["",{text:"<br>기타<br>(표시)",css:"multi_h_line",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("result_type",70,"center","string",[{text:"FY18(상)",colspan:25},{text:"",rowspan:2},""],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month1",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp1",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month2",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp2",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month3",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp3",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month4",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp4",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month5",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp5",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month6",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp6",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month7",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp7",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month8",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp8",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month9",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp9",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month10",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp10",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month11",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp11",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month12",70,"center","string",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month_disp12",70,"center","multi_line_edit",["","",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,sort:null})]);$.grdExcel.init({headerRowHeight:40});$.grdExcel.setGridMultiLineAutoHeight();$.grdExcel.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panList);$.panMain.add($.panDetail);$.panMain.add($.grdExcel);$.panTop.add($.cmbProduct);$.panTop.add($.lblProduct);$.panTop.add($.cmbDept);$.panTop.add($.lblDept);$.panTop.add($.cmbYyyy);$.panTop.add($.lblYyyy);$.panTop.add($.btnSearch);$.panTop.add($.cmbStrategy);$.panTop.add($.lblStrategy);$.panTop.add($.cmbMonth);$.panTop.add($.lblMonth);$.panList.add($.grdList);$.panDetail.add($.htmlDetail);initView()};$.callback=function(type,ds){if(type=="Q_ALL"){log(ds);if(ds&&ds.resultList[0].length){for(var i=0;i<ds.resultList[0].length;i++){var rowData=ds.resultList[0][i];var objData=Object.keys(rowData);for(var j=0;j<objData.length;j++){if((objData[j].indexOf("month")>-1&&objData[j].length<8)||objData[j]=="now_fy"||objData[j]=="target_fy"){var value=ds.resultList[0][i][objData[j]]||0;if(value){if(ds.resultList[0][i].value_type&&ds.resultList[0][i].value_type==$.specialValueType){ds.resultList[0][i][objData[j]]=numberComma(Number(value||0))}else{ds.resultList[0][i][objData[j]]=Number(value)+(ds.resultList[0][i].value_name||"")}}else{ds.resultList[0][i][objData[j]]="-"}}}}}$.varListData=ds;setDataGrid([$.grdList],ds);if($.grdList.getRowCount()){setTimeout(function(){var colListArr=["product_code","strategy","kpi_description","data_source","data_source_standard","channel","now_fy","target_fy"];$.grdList.setRowSpanCustom(colListArr,"grid-text-center");$.grdList.selectRow(0);$.grdList.clearSelect()},20)}$.varMonthList=ds.resultList[1]}else{if(type=="Q_DETAIL"){setDataHtml(ds)}else{if(type=="Q_CHART"){log(ds);$.chartObj.render($.varChartId,ds.resultList);setHTMLGrid($.varGridId,ds.resultList);jQuery(".group-box").hide(500);jQuery("#"+$.varGroupId).show(500);setPanelStyle(true)}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){if(!$.panTop.validateControls()){return}searchList("Q_ALL");searchList("Q_DETAIL")}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbYyyy"||id=="cmbMonth"||id=="cmbDept"||id=="cmbProduct"){$.cmbStrategy.clear();if(!value){return}if(id=="cmbYyyy"||id=="cmbMonth"||id=="cmbDept"){if(id=="cmbDept"&&!$.isFirst){searchMaxInputMonth("Q_M")}$.varProductCode="";seachProductList("Q_PRODUCT")}var json=createJSON_Q("Q_STRY");var ds=callQuerySync(["req",json],$);setComboBind([$.cmbStrategy],ds);if(id=="cmbProduct"){$.varProductCode=value}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnExcelDown"){if(!$.grdList.getRowCount()){MessageBoxShow("엑셀로 출력할 데이터가 없습니다.");return}setDataGrid([$.grdExcel],$.varListData);var colArr=["team_name","product_code","strategy","kpi_description","data_source","data_source_standard","channel","now_fy","now_fy_text","target_fy","target_fy_text"];$.grdExcel.setRowSpanCustom(colArr,"grid-text-center");var xlsCols=[];var cols=$.grdExcel.columns;var type="";for(var i in cols){type=(cols[i].type=="multi_line_edit"?"string":cols[i].type);xlsCols.push({header:cols[i].header,datatype:cols[i].type,datafield:cols[i].id,width:(cols[i].width+"px"),ishidden:(cols[i].excelHidden===true?true:(cols[i].hidden?true:false)),docNum:(cols[i].docNum?true:false),instId:(cols[i].instId?true:false),tableBorder:(cols[i].borderCss?true:false),rowSpan:(cols[i].rowSpan||cols[i].hiddenRowSpan?true:false),multiSpan:(cols[i].multiSpan?true:false)})}for(var i=0;i<xlsCols.length;i++){var headerList=xlsCols[i].header;for(var j=0;j<headerList.length;j++){if(headerList[j]){var count=(headerList[j].text.match(/<br>/g)||[]).length;if(count>1){headerList[j].text=headerList[j].text.replace("<br>","")}headerList[j].text=headerList[j].text.replace("<br>","<br style='mso-data-placement: same-cell'>")}}}var xlsDataSet=$.grdExcel.getExcelRows();for(var i=0;i<xlsDataSet.length;i++){var rowData=xlsDataSet[i];for(var j=0;j<$.varCodeArr.length;j++){if(rowData.result_type==$.varCodeArr[j].sub_code){rowData.result_type=$.varCodeArr[j].code_name}}}var fileName="[MKT KPI]"+($.cmbYyyy.getValue("name")||"")+" "+($.cmbDept.getValue("dept_name")||"")+" "+($.cmbProduct.getValue("product_code")||"");excelexportjs({containerid:"dvjson",datatype:"jsoncss",dataset:xlsDataSet,columns:xlsCols,tableBorder:true,worksheetName:"Sheet1",xlsFileName:fileName})}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>