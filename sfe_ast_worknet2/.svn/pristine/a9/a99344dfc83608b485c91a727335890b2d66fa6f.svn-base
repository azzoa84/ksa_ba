<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.lblDate=null;$.lblAcc=null;$.cmbAcc=null;$.dteStart=null;$.dteEnd=null;$.btnSearch=null;$.grdList=null;$.lblWave=null;$.panList2=null;$.grdList2=null;$.tabMain=null;$.btnDelete=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmBankStatementReport_Q",[workType,$.cmbAcc.getValue(),$.dteStart.getValue()||"",$.dteEnd.getValue()||""]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_crmBankStatementReport_Q",[workType,$.cmbAcc.getValue(),$.dteStart.getValue()||"",$.dteEnd.getValue()||""]);return json}function searchList(){var json=createJSON_Q("Q");callQuery(["req",json],"Q",$)}function searchList2(){var json=createJSON_Q1("Q1");callQuery(["req",json],"Q1",$)}function fnSET_P_crmBankStatementReports_S(workType){var json=createJSON_S(workType);callQuery(["req",json],workType,$)}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmBankStatementReports_S",[workType,$.cmbAcc.getValue()]);return json}function exportToExcel(){var column=[{headertext:"거래일시",datatype:"string",datafield:"deal_date",width:"140px"},{headertext:"적요",datatype:"string",datafield:"essential",width:"140px"},{headertext:"입금액",datatype:"int",datafield:"deposit_amt",width:"140px"},{headertext:"출금액",datatype:"int",datafield:"withdrawal_amt",width:"140px"},{headertext:"내용",datatype:"string",datafield:"descr",width:"150px"},{headertext:"잔액",datatype:"int",datafield:"balance_amt",width:"140px"},{headertext:"거래점명",datatype:"string",datafield:"office_nm",width:"150px"}];var data=$.grdList.getAllRows();excelDown(data,column)}function exportToExcel2(){var column=[{headertext:"계좌유형",datatype:"string",datafield:"acct_type",width:"100px"},{headertext:"거래은행",datatype:"string",datafield:"bank_name",width:"140px"},{headertext:"계좌번호",datatype:"string",datafield:"acct_no",width:"140px"},{headertext:"최초잔액",datatype:"int",datafield:"base_amt",width:"140px"},{headertext:"입금",datatype:"int",datafield:"deposit_sum",width:"140px"},{headertext:"출금",datatype:"int",datafield:"withdrawal_sum",width:"140px"},{headertext:"최종잔액",datatype:"int",datafield:"current_amt",width:"140px"}];var data=$.grdList2.getAllRows();for(var i in data){if(!isNaN(data[i].acct_no)){data[i].acct_no="=TEXT("+data[i].acct_no+", 0)"}}excelDown(data,column)}function comma(num){var len,point,str;num=num+"";point=num.length%3;len=num.length;str=num.substring(0,point);while(point<len){if(str!=""){str+=","}str+=num.substring(point,point+3);point+=3}return str}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,765);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine();$.panList=new FingerPanel(host,"panList",0,0,1200,665);$.panList.setText("거래내역");$.panList.setBottomLine(true);$.lblDate=new FingerLabel(host,"lblDate",0,15,120,20);$.lblDate.setText("조회 기간");$.lblAcc=new FingerLabel(host,"lblAcc",500,15,100,20);$.lblAcc.setText("조회 계좌");$.cmbAcc=new FingerComboBox(host,"cmbAcc",610,15,250,20);$.dteStart=new FingerDateEdit(host,"dteStart",120,15,140,20);$.dteEnd=new FingerDateEdit(host,"dteEnd",290,15,140,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,620);$.lblWave=new FingerLabel(host,"lblWave",260,15,20,20);$.lblWave.setText("~");$.panList2=new FingerPanel(host,"panList2",0,0,1200,665);$.panList2.setText("예금증감내역");$.panList2.setBottomLine(true);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,1200,620);$.tabMain=new FingerTab(host,"tabMain",0,65,1200,700);$.btnDelete=new FingerButton(host,"btnDelete",1055,15,80,20);$.btnDelete.setText("삭제");var today=getToday("");$.dteStart.setValue(today);$.dteEnd.setValue(today);$.dteStart.setAllowBlank(false,"시작일");$.dteEnd.setAllowBlank(false,"종료일");$.cmbAcc.setAllowBlank(false,"조회계좌");$.cmbAcc.setColumn("bankaccount","AccountList");$.cmbAcc.setEmptyRow(true);$.btnDelete.setVisible(false);$.panQuery.setBorder(true);$.panList.addButton("btnExcelDown","엑셀다운로드");$.panList.setButtonAction("btnExcelDown","excel_down");$.panList2.addButton("btnExcelDown","엑셀다운로드");$.panList2.setButtonAction("btnExcelDown","excel_down");$.grdList.setColumns([new FingerDataGridColumn("deal_date",160,"left","date","거래일시"),new FingerDataGridColumn("essential",110,"center","string","적요"),new FingerDataGridColumn("deposit_amt",140,"right","int","입금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("withdrawal_amt",140,"right","int","출금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("descr",250,"left","string","내용"),new FingerDataGridColumn("balance_amt",150,"right","int","잔액",{format:"int"}),new FingerDataGridColumn("office_nm",130,"center","string","거래점명"),new FingerDataGridColumn("report",100,"center","string","레포트",{isLink:true})]);$.grdList.init({panel:$.panList,scroll:"xy",footer:true,nonExcel:true});$.grdList.setBorder(false);$.panList.setBorder(true);$.grdList2.setColumns([new FingerDataGridColumn("acct_type",160,"left","date","계좌유형"),new FingerDataGridColumn("bank_name",160,"center","string","거래은행"),new FingerDataGridColumn("acct_no",220,"left","string","계좌번호"),new FingerDataGridColumn("base_amt",160,"right","int","최초잔액",{format:"int"}),new FingerDataGridColumn("deposit_sum",160,"right","int","입금",{format:"int"}),new FingerDataGridColumn("withdrawal_sum",160,"right","int","출금",{format:"int"}),new FingerDataGridColumn("current_amt",160,"right","int","최종잔액",{format:"int"})]);$.grdList2.init({panel:$.panList2,nonExcel:true});$.grdList2.setBorder(false);$.panList2.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.tabMain);$.panQuery.add($.lblDate);$.panQuery.add($.lblAcc);$.panQuery.add($.cmbAcc);$.panQuery.add($.dteStart);$.panQuery.add($.dteEnd);$.panQuery.add($.btnSearch);$.panQuery.add($.lblWave);$.panQuery.add($.btnDelete);$.panList.add($.grdList);$.panList2.add($.grdList2);$.tabMain.addTab([{text:"계좌별 조회",body:$.panList,width:150},{text:"기간별 조회",body:$.panList2,width:150}]);var EmpCode=g_main.session.obj.EmpCode;if(EmpCode=="ka100162"||EmpCode=="ka080073"||EmpCode=="ka981029"||EmpCode=="AKR-T00008"||EmpCode=="ka070040"||EmpCode=="ka110192"){$.panList2.setVisible(true);$.btnDelete.setVisible(true);ds=bizComponentData2($,"Q1","L_CRM0261")}else{if(EmpCode=="ka021167"||EmpCode=="ka961016"||EmpCode=="ka080065"||EmpCode=="ka100136"){ds=bizComponentData2($,"Q4","L_CRM0261"," where bankaccount in ('140003098158')")}else{if(EmpCode=="ka041186"||EmpCode=="ka992005"){ds=bizComponentData2($,"Q4","L_CRM0261"," where bankaccount in ('140003098158','39891000704504','20020114981')")}else{ds=bizComponentData2($,"Q4","L_CRM0261"," where bankaccount in ('99999')")}}}setComboBind([$.cmbAcc],ds)};$.callback=function(type,ds){if(type=="Q"){convertJavaDateToJs(ds.resultList);for(var i=0;i<ds.resultList[0].length;i++){if(ds.resultList[0][i].deposit_amt==""){ds.resultList[0][i].deposit_amt=0}if(ds.resultList[0][i].withdrawal_amt==""){ds.resultList[0][i].withdrawal_amt=0}}setDataGrid([$.grdList],ds)}else{if(type=="Q1"){setDataGrid([$.grdList2],ds)}else{if(type=="D"){searchList();searchList2()}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList();searchList2()}else{if(id=="btnDelete"){if($.cmbAcc.getValue()!=""){confirmBoxShow("선택 된 계좌의 내역을 모두 삭제하시겠습니까?",function(){if(g_main.msgShare==true){fnSET_P_crmBankStatementReports_S("D")}})}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){searchList();searchList2()};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){if(cInd=="report"){var params={report:"report_transaction",isPrint:false};var data=[];params.data={Info:{deal_date:$.grdList.getValue($.grdList.getSelectedRowIdx(),"deal_date"),essential:$.grdList.getValue($.grdList.getSelectedRowIdx(),"essential"),deposit_amt:comma($.grdList.getValue($.grdList.getSelectedRowIdx(),"deposit_amt")),withdrawal_amt:comma($.grdList.getValue($.grdList.getSelectedRowIdx(),"withdrawal_amt")),descr:$.grdList.getValue($.grdList.getSelectedRowIdx(),"descr"),office_nm:$.grdList.getValue($.grdList.getSelectedRowIdx(),"office_nm"),account:$.cmbAcc.getValue(),bank_nm:$.cmbAcc.getText().substring(0,5)}};g_printBrowser.callPrint(params)}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnExcelDown"){exportToExcel()}}else{if(panelId=="panList2"){if(btnId=="btnExcelDown"){exportToExcel2()}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){if(id=="tabMain"){}};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>