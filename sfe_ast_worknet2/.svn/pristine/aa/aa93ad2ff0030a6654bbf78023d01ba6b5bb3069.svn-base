<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panList1=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.panList2=null;$.grdList2=null;$.btnEsero=null;$.panWFMain=null;$.cmbBase=null;$.grdList1=null;$.lblBudgetName=null;$.lblPromo=null;$.lblProduct=null;$.lblAvalAmt=null;$.lblUseAmt=null;$.lblReqAmt=null;$.lblCompany=null;$.lblRemark=null;$.lblSigungu=null;$.txtBudget=null;$.cmbPromo=null;$.cmbProduct=null;$.speAvalAmt=null;$.speUseAmt=null;$.speReqAmt=null;$.bteCompany=null;$.txtRemark=null;$.bteSigungu=null;$.btnCard=null;$.grdFile=null;$.grdDoc=null;$.lblGrapeFn=null;$.lblProject=null;$.lblStudy=null;$.cmbGrapeFn=null;$.cmbProject=null;$.cmbStudy=null;$.panGrape=null;$.panCP=null;$.lblCPDocNo=null;$.txtCPDocNo=null;$.btnCP=null;$.chkPresident=null;$.chkDeptManager=null;$.lblPresident=null;$.lblDeptManager=null;$.lblMktPolicy=null;$.cmbMktPolicy=null;$.btnDefineAccount=null;$.lblHelix=null;$.cmbHelix=null;$.varWfDocId="";$.varBusinessId="";$.varOriginWfDocId="";$.varWFType="";$.varBank="";$.varAccount="";$.varBankAccount="";$.varCompany="";$.varSigungu="";$.varCPId="";$.varORemark="";$.varReturnData={};$.varReturnBinding=false;$.strreceipt_type="";$.varOpenType="";$.grape_function_edit=false;$.ref_wf_doc_id="";$.varInstituteName="";$.strakr_clinical_no="";$.session=g_main.session.obj;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFBgtAft"]);return json}function createJSON_Q_CARD(workType){var json=createExecuteParamInfo("P_crmCardApprovalSub_Q",[workType,"#UserID#",$.varCPId]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmWFBudgetUse_Q",[workType,$.varWfDocId||"",$.cmbBase.getValue().substr(0,4),$.cmbBase.getValue().substr(4,1),"#DeptCode#","","",0,"","#UserID#"]);return json}function createJSON_Q3(workType,cardCode,cardName){var json=createExecuteParamInfo("P_vwB1_OCRD_Q",[workType,"S","230",cardCode,cardName]);return json}function createJSON_S(workType){var sumUseAmt=0,sumTaxAmt=0,sumDedAmt=0;var cRow=$.grdList2.getAllRows();for(var i in cRow){sumUseAmt+=Number(cRow[i].use_amt);sumTaxAmt+=Number(cRow[i].tax_amt);sumDedAmt+=Number(cRow[i].nodeduction_amt)}var json=createExecuteParamInfo("P_crmWFBgtAftD_S",[workType,$.varWfDocId,$.cmbBase.getValue().substr(0,4),$.cmbBase.getValue().substr(4,1),$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"dept_code")||"",$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"budget_code"),$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"product_code"),"50","",(sumUseAmt+sumDedAmt)||0,$.cmbPromo.getValue()||"",$.cmbProduct.getValue()||"","#UserID#",$.varSigungu||"",$.bteSigungu.getText(),$.varCompany||"",$.bteCompany.getText(),$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"assign_seq")||1,"#DeptCode#","#UserID#",$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"plan_seq")||1,1,"50",sumUseAmt||0,sumTaxAmt||0,sumDedAmt||0,$.txtRemark.getValue(),$.chkPresident.getValue(),$.chkDeptManager.getValue(),$.ref_wf_doc_id||"",1,$.varCPId||"",$.varStrCpCode||"","",$.strakr_clinical_no||"",$.varInstituteName||"",$.cmbGrapeFn.getValue("extra_field1")||"",$.cmbProject.getValue("code_name")||"",$.cmbProject.getValue("extra_field1")||"",$.cmbStudy.getValue("code_name")||"",$.cmbStudy.getValue("extra_field1")||"",$.cmbHelix.getValue("extra_field1")||"",$.cmbHelix.getValue("extra_field2")||"",$.cmbMktPolicy.getValue()||""]);return json}function createJSON_S2(workType){var json="";var cRow=$.grdList2.getAllRows();if(cRow.length<1){return}var rows=[];for(var i in cRow){rows.push([workType,$.varWfDocId,Number(i)+1,"#DeptCode#","#UserID#",cRow[i].receipt_type,unmask(cRow[i].use_date),"",cRow[i].use_amt||0,cRow[i].tax_amt||0,cRow[i].nodeduction_amt||0,cRow[i].deposit_emp_code||"",cRow[i].deposit_emp_name||"",cRow[i].account_comp_code||"",cRow[i].account_comp_name||"",cRow[i].VatBPNM1||"",cRow[i].VatRegN||"",cRow[i].use_remark||"",cRow[i].APPDAT||"",cRow[i].CARDNO||"",cRow[i].APPRNO||"",cRow[i].SAPCODE||"",cRow[i].VENKNM||"",cRow[i].pay_me||"",cRow[i].bank_account||"",cRow[i].bank||"",cRow[i].account||"",cRow[i].acct_name||"",cRow[i].grape_function||"",0,"#UserID#"])}json=createExecuteParamInfo("P_crmReceipt_S",rows);return json}function createJSON_S3(workType){var rId=$.grdList2.getSelectedRowIdx();var data=$.grdList2.getValue(rId);var json=createExecuteParamInfo("P_crmBCARDMAS_S",[workType,data.APPDAT,data.CARDNO,data.APPRNO,"","","","#UserID#"]);return json}function searchWFDocument(){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchCardApprovalSub_Q(){var json=createJSON_Q_CARD("Q_CP");callQuery(["req",json],"Q_CP",$)}function searchAdvence(){var json=createJSON_Q2("AFT");callQuery(["req",json],"AFT",$)}function searchDepositEmpCheck(cardCode,cardName){var json=createJSON_Q3("Q",cardCode,cardName);var ds=callExecuteSync(["req",json],"Q",$,false);if(ds.resultList[0].length>=1){return true}else{return false}}function saveBudgetAft(workType){var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],workType,$,false);var bResult=false;if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{bResult=true}}return bResult}function saveCardRe(workType){var json=createJSON_S3(workType);var ds=callExecuteSync(["req",json],workType,$,false);log(ds);if(ds){return true}}function saveReceipt(workType){var json=createJSON_S2(workType);var ds=callExecuteSync(["req",json],workType,$,false);var bResult=true;if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);bResult=false}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);bResult=false}}}else{bResult=false}log(bResult);return bResult}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function rowProperties(rId,val){switch(val){case"10":$.grdList2.setValue(rId,"modify_yn","Y");$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt",0);$.grdList2.setValue(rId,"deposit_emp_name_readonly",false);$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"SAPCODE_readonly",false);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false);break;case"20":$.grdList2.setValue(rId,"modify_yn","N");$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",true);break;case"30":if($.grdList2.getValue(rId,"modify_yn")=="Y"){$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",false);$.grdList2.setValue(rId,"nodeduction_amt_readonly",false);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false)}else{$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false)}break;case"40":$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false);break;case"50":$.grdList2.setValue(rId,"modify_yn","Y");$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",false);$.grdList2.setValue(rId,"nodeduction_amt_readonly",false);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",true);break}}function setPromoBudget(rId){if($.grdList1.getValue(rId,"promo_budget_yn")=="Y"){$.lblPromo.setVisible(true);$.cmbPromo.setVisible(true);$.lblProduct.setVisible(true);$.cmbProduct.setVisible(true);$.lblCompany.setVisible(true);$.bteCompany.setVisible(true);$.lblSigungu.setVisible(true);$.bteSigungu.setVisible(true);$.cmbPromo.setEnable(true);$.cmbProduct.setEnable(true);$.cmbPromo.setAllowBlank(false,"판촉항목");$.cmbProduct.setAllowBlank(false,"품목");if($.grdList1.getValue(rId,"product_code")!=null){if($.grdList1.getValue(rId,"product_code")==""){$.cmbProduct.setEnable(true)}else{$.cmbProduct.setEnable(false);$.cmbProduct.setValue($.grdList1.getValue(rId,"product_code"))}}$.panCP.setVisible(true)}else{$.lblPromo.setVisible(false);$.cmbPromo.setVisible(false);$.lblProduct.setVisible(false);$.cmbProduct.setVisible(false);$.lblCompany.setVisible(false);$.bteCompany.setVisible(false);$.lblSigungu.setVisible(false);$.bteSigungu.setVisible(false);$.cmbPromo.setAllowBlank(true,"판촉항목");$.cmbProduct.setAllowBlank(true,"품목");$.panCP.setVisible(false)}}function calcUseAmt(type){if(type=="S"){var useAmt=0,nodAmt=0;var cRow=$.grdList2.getAllRows();for(var i in cRow){useAmt+=Number(cRow[i].use_amt);nodAmt+=Number(cRow[i].nodeduction_amt)}$.speUseAmt.setValue(useAmt+nodAmt)}else{if(type=="D"){$.speUseAmt.setValue($.speUseAmt.getValue()-(Number($.grdList2.getValue($.grdList2.getSelectedRowIdx(),"use_amt"))+Number($.grdList2.getValue($.grdList2.getSelectedRowIdx(),"nodeduction_amt"))))}}}function chkCP(){var promo=$.cmbPromo.getValue();if($.grdList1.getValue($.grdList1.getSelectedRowIdx(),"promo_budget_yn")!="Y"){return true}if(promo=="0002"&&$.speUseAmt.getValue()==0){return true}if(promo=="0004"||promo=="0005"||promo=="0006"||promo=="0007"||promo=="0009"||promo=="0013"||promo=="0014"||promo=="0015"||promo=="0016"||promo=="0019"||promo=="0020"||promo=="0022"||promo=="0024"||promo=="0025"||promo=="0027"||promo=="0029"||promo=="0030"||promo=="0032"){return true}if($.txtCPDocNo.getValue()==""||!$.txtCPDocNo.getValue()){MessageBoxShow("CP정보가 선택(입력)되지 않았습니다.");return false}if(Number($.varNumCpAmt)!=0&&Math.abs(Number($.varNumCpAmt))!=Math.abs(Number($.speUseAmt.getValue()))&&(promo!="0001"&&promo!="0011"&&promo!="0008"&&promo!="0010"&&promo!="0012"&&promo!="0017"&&promo!="0018"&&promo!="0023"&&promo!="0026"&&promo!="0031"&&promo!="0033"&&promo!="0034")){MessageBoxShow("사용금액과 선택(입력)된 CP금액이 일치하지 않습니다.");return false}return true}function fnGetCPCode(value){var strResult="";switch(value){case"0001":strResult="CP02";break;case"0002":strResult="CP03";break;case"0003":strResult="CP07";break;case"0004":strResult="CP14";break;case"0005":strResult="";break;case"0006":strResult="";break;case"0007":strResult="";break;case"0008":strResult="CP04";break;case"0009":strResult="CP13";break;case"0010":strResult="CP08";break;case"0011":strResult="CP10";break;case"0012":strResult="CP23";break;case"0013":strResult="";break;case"0014":strResult="CP18";break;case"0015":strResult="";break;case"0016":strResult="";break;case"0017":strResult="CP05";break;case"0018":strResult="CP27";break;case"0019":strResult="CP17";break;case"0020":strResult="CP16";break;case"0021":strResult="CP15";break;case"0022":strResult="";break;case"0023":strResult="CP29";break;case"0026":strResult="CP04";break;case"0031":strResult="CP05";break;case"0033":strResult="CP33";break;case"0034":strResult="CP29";break;case"0035":strResult="CP38";break;default:strResult=value;break}return strResult}function chkReceipt(){var cRow=$.grdList2.getAllRows();var start=$.cmbBase.getValue("receipt_start_date");var end=$.cmbBase.getValue("receipt_end_date");for(var i in cRow){if(cRow[i].use_amt==0||cRow[i].use_amt==""){MessageBoxShow("영수증 사용금액은 0보다 큰 값을 입력하셔야 합니다.");return false}var use_date=unmask(cRow[i].use_date).substring(0,8);if(g_main.session.obj.UserID!="ka070050"){if(Number(use_date)<Number(start)||Number(use_date)>Number(end)){MessageBoxShow("반기에 해당하는 영수증 일자만 처리 가능합니다.");return false}}if(cRow[i].bank_account==""||cRow[i].bank==""||cRow[i].account==""||cRow[i].acct_name==""){MessageBoxShow("입금계좌 정보가 없습니다.");return false}if(cRow[i].receipt_type=="10"){var strdeposit_emp_name=cRow[i].deposit_emp_name;var strsepartor=strdeposit_emp_name.split("]");var strCardCode="";var strCardName="";if(strsepartor.length>=2){strCardCode=strsepartor[0].replace("[","");strCardName=(strsepartor.length>2?strsepartor[1]+"]":strsepartor[1])}if(cRow[i].deposit_emp_name==""||strCardCode==""||strCardName==""||!searchDepositEmpCheck(cRow[i].deposit_emp_code,cRow[i].deposit_emp_name)){MessageBoxShow("입금처로 등록되지 않은 사원코드 입니다. 재무회계팀에 확인 하시기 바랍니다.");return false}}else{if(cRow[i].receipt_type=="30"||cRow[i].receipt_type=="40"){if(cRow[i].account_comp_name==""||!cRow[i].account_comp_name){MessageBoxShow("영수증종류가 세금계산서, 계산서일 경우 회계거래처를 필수로 입력하셔야 합니다.");return false}}else{if(cRow[i].receipt_type=="50"){if(cRow[i].account_comp_name==""||!cRow[i].account_comp_name){MessageBoxShow("영수증종류가 카드매입일 경우 회계거래처를 필수로 입력하셔야 합니다.");return false}}}}}return true}function fnChkGrape(){var rId=$.grdList1.getSelectedRowIdx();var gr1Data=$.grdList1.getValue(rId);var gr2Data=$.grdList2.getAllRows();if(gr1Data.grape_yn&&gr1Data.grape_yn=="Y"){for(var i in gr2Data){if(!gr2Data[i].grape_function||gr2Data[i].grape_function==""){MessageBoxShow("Grape Function 은 필수 입력항목입니다.");return false}}}return true}function setGrape(rId){var rData=$.grdList1.getValue(rId);$.panGrape.setVisible(true);$.cmbGrapeFn.setVisible(false);$.lblGrapeFn.setVisible(false);$.grape_function_edit=false;$.cmbProject.setAllowBlank(true);$.cmbStudy.setAllowBlank(true);$.cmbHelix.setAllowBlank(true);for(var i=0;i<$.grdList2.getRowCount();i++){if(rData.grape_function_code!="E122"){$.grdList2.setValue(i,"grape_function",rData.grape_function_code)}else{$.grdList2.setValue(i,"grape_function","")}}if(rData.grape_yn&&rData.grape_yn=="Y"||(rData.grape_function_code&&rData.grape_function_code!="")){if(rData.grape_yn&&rData.grape_yn=="Y"){$.grape_function_edit=true}if(rData.grape_function_code&&rData.grape_function_code!=""){var ds="";if(rData.grape_function_code=="E122"){var subCode=" and extra_field1 in ('E123', 'E124')";ds=bizComponentData2($,"Q4","L_CRM0274",subCode)}else{ds=bizComponentData2($,"Q1","L_CRM0274")}$.grdList2.setColumnDropDownList("grape_function",ds.resultList[0])}}else{$.cmbGrapeFn.setVisible(false);$.lblGrapeFn.setVisible(false)}if(rData.project_yn&&rData.project_yn=="Y"){$.lblProject.setVisible(true);$.cmbProject.setVisible(true);$.cmbProject.setAllowBlank(false,"Project");if(rData.grape_function_code.substring(0,2)=="U1"){$.cmbProject.setValue("000100")}}else{$.lblProject.setVisible(false);$.cmbProject.setVisible(false);$.cmbProject.setAllowBlank(true)}if(rData.study_yn&&rData.study_yn=="Y"){$.lblStudy.setVisible(true);$.cmbStudy.setVisible(true);$.cmbStudy.setAllowBlank(false,"Study");if($.cmbStudy.getValue()){var subQuery=" and extra_field2 = '"+$.cmbStudy.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0276",$.cmbProject.getValue());setComboBind([$.cmbStudy],ds)}}else{$.lblStudy.setVisible(false);$.cmbStudy.setVisible(false);$.cmbStudy.setAllowBlank(true)}if(rData.helix_yn&&rData.helix_yn=="Y"){$.lblHelix.setVisible(true);$.cmbHelix.setVisible(true);$.cmbHelix.setAllowBlank(false,"Helix");if($.cmbHelix.getValue()){var subQuery="";var ds=bizComponentData2($,"Q4","L_CRM281",subQuery);setComboBind([$.cmbHelix],ds)}}else{$.lblHelix.setVisible(false);$.cmbHelix.setVisible(false);$.cmbHelix.setAllowBlank(true)}}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function clearCPInfo(){$.varCPId="";$.txtCPDocNo.setValue("");$.varStrCpCode="";$.varNumCpAmt=0;$.varSigungu="";$.varCompany=""}function productComboChange(value){var subQuery="";$.cmbMktPolicy.clear();if(!value){return}var rId=$.grdList1.getSelectedRowIdx();var dt=$.grdList1.getValue(rId);if(dt.dept_code=="F210"||dt.dept_code=="F280"||dt.dept_code=="F230"||dt.dept_code=="F310"||dt.dept_code=="F330"){subQuery=" AND extra_field1 = '"+value+"' AND extra_field2 = '"+dt.dept_code+"'"}else{subQuery=" AND extra_field1 = '"+value+"'"}var ds=bizComponentData2($,"Q4","L_CRM0294",subQuery);setComboBind([$.cmbMktPolicy],ds);if($.varReturnData){if($.varReturnData.budget_code==dt.budget_code&&$.varReturnData.product_code==value){$.cmbMktPolicy.setValue($.varReturnData.mkt_policy||"")}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1640);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panList1=new FingerPanel(host,"panList1",0,65,1200,410);$.panList1.setText("예산사용집계");$.panList1.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,1035,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,1430,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,1430,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.panList2=new FingerPanel(host,"panList2",0,695,1200,330);$.panList2.setText("영수증 내역");$.panList2.setBottomLine(true);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,1200,285);$.btnEsero=new FingerButton(host,"btnEsero",710,-37.5,130,20);$.btnEsero.setText("전자세금계산서");$.panWFMain=new FingerPanel(host,"panWFMain",0,485,1200,200);$.panWFMain.setText("내역");$.panWFMain.setBottomLine(true);$.cmbBase=new FingerComboBox(host,"cmbBase",805,-38,140,20);$.grdList1=new FingerDataGrid(host,"grdList1",0,0,1200,365);$.lblBudgetName=new FingerLabel(host,"lblBudgetName",0,15,100,20);$.lblBudgetName.setText("예산항목");$.lblPromo=new FingerLabel(host,"lblPromo",700,15,100,20);$.lblPromo.setText("판촉항목");$.lblProduct=new FingerLabel(host,"lblProduct",700,45,100,20);$.lblProduct.setText("품목");$.lblAvalAmt=new FingerLabel(host,"lblAvalAmt",0,45,100,20);$.lblAvalAmt.setText("가용금액");$.lblUseAmt=new FingerLabel(host,"lblUseAmt",220,45,100,20);$.lblUseAmt.setText("사용금액");$.lblReqAmt=new FingerLabel(host,"lblReqAmt",460,45,100,20);$.lblReqAmt.setText("사용후잔액");$.lblCompany=new FingerLabel(host,"lblCompany",700,80,100,20);$.lblCompany.setText("거래처");$.lblRemark=new FingerLabel(host,"lblRemark",0,75,100,20);$.lblRemark.setText("사용내역");$.lblSigungu=new FingerLabel(host,"lblSigungu",700,110,100,20);$.lblSigungu.setText("지역");$.txtBudget=new FingerEdit(host,"txtBudget",105,15,360,20);$.cmbPromo=new FingerComboBox(host,"cmbPromo",805,15,180,20);$.cmbProduct=new FingerComboBox(host,"cmbProduct",805,45,180,20);$.speAvalAmt=new FingerSpinEdit(host,"speAvalAmt",105,45,140,20);$.speUseAmt=new FingerSpinEdit(host,"speUseAmt",325,45,140,20);$.speReqAmt=new FingerSpinEdit(host,"speReqAmt",565,45,140,20);$.bteCompany=new FingerButtonEdit(host,"bteCompany",805,80,175,20);$.bteCompany.setText("");$.txtRemark=new FingerEdit(host,"txtRemark",105,75,360,20);$.bteSigungu=new FingerButtonEdit(host,"bteSigungu",805,110,175,20);$.bteSigungu.setText("");$.btnCard=new FingerButton(host,"btnCard",825,-37.5,130,20);$.btnCard.setText("법인카드내역");$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,230);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,230);$.lblGrapeFn=new FingerLabel(host,"lblGrapeFn",0,15,105,20);$.lblGrapeFn.setText("Grape Function");$.lblProject=new FingerLabel(host,"lblProject",5,45,100,20);$.lblProject.setText("Project");$.lblStudy=new FingerLabel(host,"lblStudy",5,75,100,20);$.lblStudy.setText("Study");$.cmbGrapeFn=new FingerComboBox(host,"cmbGrapeFn",110,15,140,20);$.cmbProject=new FingerComboBox(host,"cmbProject",110,45,140,20);$.cmbStudy=new FingerComboBox(host,"cmbStudy",110,75,140,0);$.panGrape=new FingerPanel(host,"panGrape",480,30,250,120);$.panGrape.setText("");$.panGrape.setBottomLine(true);$.panCP=new FingerPanel(host,"panCP",1020,0,180,155);$.panCP.setText("");$.panCP.setBottomLine(true);$.lblCPDocNo=new FingerLabel(host,"lblCPDocNo",30,60,100,20);$.lblCPDocNo.setText("CP 문서번호");$.txtCPDocNo=new FingerEdit(host,"txtCPDocNo",10,95,160,20);$.btnCP=new FingerButton(host,"btnCP",35,30,130,20);$.btnCP.setText("CP 등록");$.chkPresident=new FingerCheckBox(host,"chkPresident",100,107.5,20,20);$.chkPresident.setText("");$.chkDeptManager=new FingerCheckBox(host,"chkDeptManager",105,107.5,35,20);$.chkDeptManager.setText("");$.lblPresident=new FingerLabel(host,"lblPresident",0,105,100,20);$.lblPresident.setText("사장님예산");$.lblDeptManager=new FingerLabel(host,"lblDeptManager",0,105,100,20);$.lblDeptManager.setText("부사장예산");$.lblMktPolicy=new FingerLabel(host,"lblMktPolicy",470,15,100,20);$.lblMktPolicy.setText("MKT 전략");$.cmbMktPolicy=new FingerComboBox(host,"cmbMktPolicy",575,15,155,20);$.btnDefineAccount=new FingerButton(host,"btnDefineAccount",950,-40,100,30);$.btnDefineAccount.setText("예산정의");$.lblHelix=new FingerLabel(host,"lblHelix",195,75,100,20);$.lblHelix.setText("Helix");$.cmbHelix=new FingerComboBox(host,"cmbHelix",300,75,200,20);$.panTitle.setBorder(true);$.panList2.addButtons(["btnDelete","btnAdd"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.cmbBase.setAllowBlank(false,"기준년도/반기");$.cmbPromo.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbMktPolicy.setEmptyRow(true);$.cmbBase.setEnable(false);$.lblPromo.setVisible(false);$.lblProduct.setVisible(false);$.lblCompany.setVisible(false);$.lblSigungu.setVisible(false);$.lblReqAmt.setVisible(false);$.cmbPromo.setVisible(false);$.cmbProduct.setVisible(false);$.bteCompany.setVisible(false);$.bteSigungu.setVisible(false);$.speReqAmt.setVisible(false);$.panGrape.setVisible(false);$.panCP.setVisible(false);$.chkPresident.setVisible(false);$.lblPresident.setVisible(false);$.lblMktPolicy.setVisible(false);$.cmbMktPolicy.setVisible(false);$.txtCPDocNo.setReadOnly(true);$.txtBudget.setReadOnly(true);$.speAvalAmt.setEnable(false);$.speUseAmt.setEnable(false);$.speReqAmt.setEnable(false);$.txtRemark.setEnable(false);$.cmbMktPolicy.setColumnConfig([{id:"sub_code",width:100},{id:"code_name",width:130},{id:"extra_field1",width:100},{id:"extra_field2",width:100}]);$.btnDefineAccount.setClass("btn_add");$.grdList1.setColumns([new FingerDataGridColumn("wf_doc_id",99,"left","string","참조결재문서아이디",{hidden:true}),new FingerDataGridColumn("dept_code",99,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("budget_code",99,"left","string","예산항목코드",{hidden:true}),new FingerDataGridColumn("budget_name",460,"left","string","예산항목"),new FingerDataGridColumn("budget_acctype",99,"left","string","예산항목유형",{hidden:true}),new FingerDataGridColumn("budget_name_for",99,"left","string","예산항목(한자)",{hidden:true}),new FingerDataGridColumn("AcctName",99,"left","string","계쩡명",{hidden:true}),new FingerDataGridColumn("product_code",99,"left","string","품목코드",{hidden:true}),new FingerDataGridColumn("promo_budget_yn",99,"left","string","판촉예산여부",{hidden:true}),new FingerDataGridColumn("half_amt",120,"right","string","배정금액",{format:"int"}),new FingerDataGridColumn("plan_use_amt",120,"right","string","사용금액",{format:"int"}),new FingerDataGridColumn("plan_using_amt",120,"right","string","결재중금액",{format:"int"}),new FingerDataGridColumn("plan_aval_amt",120,"right","string","Hold금액",{format:"int"}),new FingerDataGridColumn("aval_amt",120,"right","string","가용잔액",{format:"int"}),new FingerDataGridColumn("use_percent",120,"right","string","사용비율",{format:"floor_2"}),new FingerDataGridColumn("assign_seq",99,"left","string","배정순번",{hidden:true}),new FingerDataGridColumn("plan_seq",99,"left","string","계획연번",{hidden:true}),new FingerDataGridColumn("for_dept_name",99,"left","string","부서명(한자)",{hidden:true}),new FingerDataGridColumn("sales_dept_yn",99,"left","string","영업무서여부",{hidden:true}),new FingerDataGridColumn("marketing_dept_yn",99,"left","string","마케팅부서여부",{hidden:true}),new FingerDataGridColumn("grape_yn",99,"left","string","Grape Function 여부",{hidden:true}),new FingerDataGridColumn("project_yn",99,"left","string","Project 여부",{hidden:true}),new FingerDataGridColumn("study_yn",99,"left","string","Study 여부",{hidden:true}),new FingerDataGridColumn("helix_yn",99,"left","string","Helix 여부",{hidden:true}),new FingerDataGridColumn("grape_function_code",0,"left","string","",{hidden:true}),new FingerDataGridColumn("marketing_dept_yn",0,"left","string","",{hidden:true})]);$.grdList1.init({panel:$.panList1,scroll:"xy"});$.grdList1.setBorder(false);$.grdList2.setColumns([new FingerDataGridColumn("seq",99,"left","string","시퀀스",{hidden:true}),new FingerDataGridColumn("ref_wf_doc_id",99,"left","string","참조결재문서아이디",{hidden:true}),new FingerDataGridColumn("modify_yn",99,"left","string","수정가능여부",{hidden:true}),new FingerDataGridColumn("receipt_type",100,"center","string","영수증종류",{footer:{text:"총계:",colspan:2}}),new FingerDataGridColumn("use_date",80,"center","date","사용일자",{format:"ymd"}),new FingerDataGridColumn("use_amt",100,"right","string","사용금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("tax_amt",86,"right","string","부가세",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("nodeduction_amt",86,"right","string","불공제액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("deposit_emp_code",99,"left","string","입금처코드",{hidden:true}),new FingerDataGridColumn("deposit_emp_name",130,"left","string","입금처",{readonly:true}),new FingerDataGridColumn("account_comp_code",99,"left","string","회계거래처코드",{hidden:true}),new FingerDataGridColumn("account_comp_name",150,"left","string","회계거래처",{readonly:true}),new FingerDataGridColumn("VatBPNM1",99,"left","string","회계거래처명",{hidden:true}),new FingerDataGridColumn("VatRegN",99,"left","string","사업자번호",{hidden:true}),new FingerDataGridColumn("SAPCODE",150,"left","string","원천대상/기타 거래처",{readonly:true}),new FingerDataGridColumn("pay_me",99,"left","string","지급처변경",{hidden:true}),new FingerDataGridColumn("bank_account",150,"left","string","입금계좌",{readonly:true}),new FingerDataGridColumn("bank",99,"left","string","은행",{hidden:true}),new FingerDataGridColumn("account",99,"left","string","계좌번호",{hidden:true}),new FingerDataGridColumn("acct_name",99,"left","string","예금주",{hidden:true}),new FingerDataGridColumn("promo_budget_yn",99,"left","string","판촉예산여부",{hidden:true}),new FingerDataGridColumn("APPDAT",99,"left","string","승인일",{hidden:true}),new FingerDataGridColumn("CARDNO",99,"left","string","카드번호",{hidden:true}),new FingerDataGridColumn("VENKNM",150,"left","string","가맹점",{readonly:false}),new FingerDataGridColumn("APPRNO",100,"left","string","승인번호",{readonly:true}),new FingerDataGridColumn("APPAMT",99,"left","string","사용내역",{hidden:true}),new FingerDataGridColumn("use_remark",99,"left","string","사용내역",{hidden:true}),new FingerDataGridColumn("grape_function",99,"left","string","Function")]);$.grdList2.init({panel:$.panList2,scroll:"xy",footer:true,eventCellReadOnly:true,isFilter:false});$.grdList2.setEditable(true);$.grdList2.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panList1);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panList2);$.panMain.add($.panWFMain);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panList1.add($.cmbBase);$.panList1.add($.grdList1);$.panList1.add($.btnDefineAccount);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panList2.add($.grdList2);$.panList2.add($.btnEsero);$.panList2.add($.btnCard);$.panWFMain.add($.lblBudgetName);$.panWFMain.add($.lblPromo);$.panWFMain.add($.lblProduct);$.panWFMain.add($.lblAvalAmt);$.panWFMain.add($.lblUseAmt);$.panWFMain.add($.lblReqAmt);$.panWFMain.add($.lblCompany);$.panWFMain.add($.lblRemark);$.panWFMain.add($.lblSigungu);$.panWFMain.add($.txtBudget);$.panWFMain.add($.cmbPromo);$.panWFMain.add($.cmbProduct);$.panWFMain.add($.speAvalAmt);$.panWFMain.add($.speUseAmt);$.panWFMain.add($.speReqAmt);$.panWFMain.add($.bteCompany);$.panWFMain.add($.txtRemark);$.panWFMain.add($.bteSigungu);$.panWFMain.add($.panGrape);$.panWFMain.add($.panCP);$.panWFMain.add($.chkPresident);$.panWFMain.add($.chkDeptManager);$.panWFMain.add($.lblPresident);$.panWFMain.add($.lblDeptManager);$.panWFMain.add($.lblMktPolicy);$.panWFMain.add($.cmbMktPolicy);$.panGrape.add($.cmbStudy);$.panGrape.add($.cmbProject);$.panGrape.add($.cmbGrapeFn);$.panGrape.add($.lblStudy);$.panGrape.add($.lblProject);$.panGrape.add($.lblGrapeFn);$.panGrape.add($.lblHelix);$.panGrape.add($.cmbHelix);$.panCP.add($.lblCPDocNo);$.panCP.add($.btnCP);$.panCP.add($.txtCPDocNo);var ds=bizComponentData2($,"Q1","L_CRM0041");$.grdList2.setColumnDropDownList("receipt_type",ds.resultList[0]);$.cmbBase.setColumn("half_code","half_name");$.cmbPromo.setColumn("promo_code","promo_name");$.cmbProduct.setColumn("product_code","product_name");$.cmbGrapeFn.setEmptyRow(true);$.cmbProject.setEmptyRow(true);$.cmbStudy.setEmptyRow(true);$.cmbHelix.setEmptyRow(true);var ds=bizComponentData2($,"Q1","L_CRM0008_3|L_CRM0072_2|L_CRM0059|L_CRM0274|L_CRM0275|L_CRM0276|L_CRM281");setComboBind([$.cmbBase,$.cmbPromo,$.cmbProduct,$.cmbGrapeFn,$.cmbProject,$.cmbStudy,$.cmbHelix],ds);if(g_main.session.obj.DeptCode=="C310"){$.cmbBase.setValue("20192")}else{if(g_main.session.obj.DeptCode=="G120"){$.cmbBase.setValue("20191")}else{$.cmbBase.setValue("")}}$.grdList1.setColumnDropDownList("grape_function_code",ds.resultList[3]);$.grdList2.setColumnDropDownList("grape_function",ds.resultList[3]);ds=bizComponentData2($,"Q4","L_CRM0059","and product_code not in ('P09', 'P18')");setComboBind([$.cmbProduct],ds);if(g_main.session.obj.UserID=="ka160376"){$.chkDeptManager.setVisible(true);$.lblDeptManager.setVisible(true)}else{$.chkDeptManager.setVisible(false);$.lblDeptManager.setVisible(false)}relocateChildIndexInPanel([$.panWFMain]);searchWFDocument()};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue("["+g_main.session.obj.DeptName+"] "+result.business_title);if($.p_argument){var p_arg=$.p_argument;if(p_arg.title!=""){$.varOpenType="POP";$.strclinical_id=p_arg.clinical_id;$.strakr_clinical_no=p_arg.akr_clinical_no;$.txtTitle.setValue($.p_argument.title);$.wbeWFDetail.setValue(convertRtfToHtml($.p_argument.content));$.varInstituteName=p_arg.institute_name;if(p_arg.files.length>0){setDataGrid([$.grdFile],p_arg.files,true)}}}searchAdvence()}else{if(type=="AFT"){setDataGrid([$.grdList1],ds);if(ds.resultList[0].length>0){if($.varWfDocId&&$.varReturnData.budget_code){for(var i=0;i<$.grdList1.getRowCount();i++){if($.grdList1.getValue(i,"budget_code")==$.varReturnData.budget_code&&$.grdList1.getValue(i,"product_code")==$.varReturnData.product_code){$.grdList1.selectRow(i);break}}}else{$.grdList1.selectRow(0)}}$.varBank=ds.resultList[1][0].bank;$.varAccount=ds.resultList[1][0].account;$.varBankAccount=ds.resultList[1][0].bank_account;$.varAcctName=ds.resultList[1][0].acct_name;if($.grdList1.getRowCount()>0){$.bteCompany.setEnable(true);$.txtRemark.setEnable(true);$.bteSigungu.setEnable(true)}else{$.cmbPromo.setEnable(true);$.bteCompany.setEnable(true);$.txtRemark.setEnable(false);$.bteSigungu.setEnable(true)}}else{if(type=="Q_CP"){var bOverlap=false;var rs=ds.resultList[0];for(var i=0;i<rs.length;i++){var dr=rs[i];bOverlap=false;for(var j=0;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(j,"APPRNO")==dr.APPRNO){bOverlap=true}}if(bOverlap==true){MessageBoxShow("해당 법인카드 건은 이미 영수증내역에 추가되어 있습니다.")}else{var rId=$.grdList2.addRow({receipt_type:"20",use_date:extFormat(getToday("").substr(0,2)+dr.APPDAT.replace(/\//g,"").substr(0,6),"yyyyMMdd","-"),use_amt:dr.APPAMT,tax_amt:dr.TAXAMT,nodeduction_amt:0,deposit_emp_code:dr.EMPNUM,deposit_emp_name:dr.CARDNO,APPDAT:dr.APPDAT,CARDNO:dr.CARDNO,APPRNO:dr.APPRNO,VENKNM:dr.VENKNM,modify_yn:"N",bank:dr.bank,account:dr.account,bank_account:dr.bank_account,acct_name:dr.acct_name});rowProperties(rId,"20");calcUseAmt("S")}}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];console.log("--------------------------------");console.log(args);if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);if(args[6][0]){$.varReturnData=args[6][0];$.varReturnBinding=true}if(args[7]){$.receiptData=args[7];$.varReceiptBinding=true}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){var rId=$.grdList1.getSelectedRowIdx();if($.grdList1.getValue(rId,"budget_code")=="B02300004"){$.cmbProduct.setAllowBlank(false,"품목")}if(!validateControls([$.txtTitle,$.cmbBase,$.cmbPromo,$.cmbProduct,$.cmbProject,$.cmbStudy,$.cmbHelix,$.cmbMktPolicy])){return}if($.grdList1.getRowCount()<=0){MessageBoxShow("선택된 예산계획내역이 없습니다.");return}else{if($.grdList2.getRowCount()<=0){MessageBoxShow("저장할 영수증내역이 없습니다.");return}}if($.speAvalAmt.getValue()!=0&&$.speAvalAmt.getValue()<$.speUseAmt.getValue()){MessageBoxShow("총 사용금액이 가용금액을 초과 할 수 없습니다.");return}if(!chkReceipt()){return}if(!chkCP()){return}if(!fnChkGrape()){return}if($.grdList1.getValue(rId,"promo_budget_yn")=="Y"&&$.grdList1.getValue(rId,"budget_code").substring(0,4)!="B003"&&$.grdList1.getValue(rId,"budget_code")!="B02300004"){if($.bteCompany.getText()==""&&$.bteSigungu.getText()==""){MessageBoxShow("판촉성 예산항목은 거래처 또는 지역을 필수로 입력하셔야 합니다.");return}}if($.grdList1.getValue(rId,"budget_code")=="B01400029"){if($.grdFile.getRowCount()<1){MessageBoxShow("무환수입 예산의 경우<br/>첨부파일에 증빙을 첨부해 주세요.");return}}if(($.grdList1.getValue(rId,"budget_code")=="B01500069"||$.grdList1.getValue(rId,"budget_code")=="B01500070")&&$.cmbPromo.getValue()=="0014"){var bDoc=false;for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"business_id")=="BP00000057"||$.grdDoc.getValue(i,"business_id")=="BP00000081"){bDoc=true}}if(bDoc==false){MessageBoxShow("정책지원예산, 판촉물의 경우<br/>구매신청서를 첨부해 주세요.");return}}if($.grdList1.getValue(rId,"budget_code")=="B00400039"){if($.grdFile.getRowCount()<1){MessageBoxShow("부서워크샵 결과물을 첨부해 주시기 바랍니다.");return}var bDoc=false;for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"business_id")=="BP00000063"){bDoc=true}}if(bDoc==false){MessageBoxShow("부서 및 소/팀 워크샵 신청서를 첨부해 주시기 바랍니다.");return}}if(!$.varWfDocId){saveWFDocument("","N")}if(saveBudgetAft("N")){if(saveReceipt("N")){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFBgtAft",new_line:true};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{removeWFDocument($.varWfDocId)}}else{removeWFDocument($.varWfDocId)}}else{if(id=="btnTmpSave"){if($.varOpenType=="POP"){MessageBoxShow("기안 업무 연동시 임시저장은 사용 불가 합니다.");return}if($.grdList1.getRowCount()<=0){MessageBoxShow("선택된 예산계획내역이 없습니다.");return}else{if($.grdList2.getRowCount()<=0){MessageBoxShow("저장할 영수증내역이 없습니다.");return}}if(saveWFDocument("","N")){if(saveBudgetAft("N")){if(saveReceipt("N")){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}else{removeWFDocument($.varWfDocId)}}else{removeWFDocument($.varWfDocId)}}else{removeWFDocument($.varWfDocId)}}else{if(id=="btnEsero"){if($.grdList1.getRowCount()<=0){return}$.popUpCallId="btnEsero";var param={};g_main.openPopup("popEseroApprovalSub.html","popEseroApprovalSub","세금계산서&계산서 수신내역",0,0,"","",param,"","")}else{if(id=="btnCard"){if($.grdList1.getRowCount()<1){return}$.popUpCallId="btnCard";var param={};g_main.openPopup("popCardApprovalSub.html","popCardApprovalSub","카드승인내역",0,0,"","",param,"","")}else{if(id=="btnCP"){if($.cmbPromo.getValue()==""){MessageBoxShow("판촉항목을 선택하여 주십시오.");return}$.varStrCpCode=fnGetCPCode($.cmbPromo.getValue());$.varStrCpCode_tmp=$.cmbPromo.getValue();var strForm="";var popText="";if($.varStrCpCode_tmp=="0004"||$.varStrCpCode_tmp=="0005"||$.varStrCpCode_tmp=="0006"||$.varStrCpCode_tmp=="0007"||$.varStrCpCode_tmp=="0009"||$.varStrCpCode_tmp=="0013"||$.varStrCpCode_tmp=="0014"||$.varStrCpCode_tmp=="0015"||$.varStrCpCode_tmp=="0016"||$.varStrCpCode_tmp=="0019"||$.varStrCpCode_tmp=="0020"||$.varStrCpCode_tmp=="0022"||$.varStrCpCode_tmp=="0024"||$.varStrCpCode_tmp=="0025"||$.varStrCpCode_tmp=="0027"||$.varStrCpCode_tmp=="0029"||$.varStrCpCode_tmp=="0030"||$.varStrCpCode_tmp=="0032"){MessageBoxShow("CP내용 등록대상이 아닙니다.");return}else{$.popUpCallId=id;var param={CP_ID:$.varCPId||"",CP_CODE:$.varStrCpCode||"",CP_DOC_NO:$.txtCPDocNo.getValue()||"",PROMO_CODE:$.cmbPromo.getValue()};g_main.openPopup("crmCPMaster.html","crmCPMaster","CP관리",1200,800,"","",param,"","")}}else{if(id=="btnDefineAccount"){var rId=$.grdList1.getSelectedRowIdx();if(!rId){MessageBoxShow("예산을 선택해 주세요.");return}var rowData=$.grdList1.getValue(rId);var param={budget_code:rowData.budget_code,list:$.grdList1.getAllRows()};g_main.openPopup("popDefileAccount.html","popDefileAccount","정의/정산",0,0,"","",param,"","")}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){if(id=="bteCompany"){$.popUpCallId="bteCompany";var param={};g_main.openPopup("popCompanyListSub.html","popCompanyListSub","",0,0,"","",param,"","")}else{if(id=="bteSigungu"){$.popUpCallId="bteSigungu";var param={};g_main.openPopup("popSidogu.html","popSidogu","",0,0,"","",param,"","")}}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbPromo"){var rId=$.grdList1.getSelectedRowIdx();if(value==""||!value){return}if($.grdList1.getValue(rId,"AcctName")!=null&&$.grdList1.getValue(rId,"for_dept_name")!=null&&$.cmbPromo.getValue("acct_name")!=null){var bdgType=$.grdList1.getValue(rId,"budget_acctype");if($.cmbPromo.getValue("acct_name")==""){$.txtRemark.setValue($.grdList1.getValue(rId,"AcctName")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}else{$.txtRemark.setValue($.cmbPromo.getValue("acct_name")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}}else{$.txtRemark.setValue(g_main.session.obj.EmpNameFOR)}$.txtRemark.setEnable(false)}else{if(id=="cmbProject"){if(!value){return}$.cmbStudy.clear();var subQuery=" AND extra_field2 = '"+$.cmbProject.getValue("code_name")+"'";var ds=bizComponentData2($,"Q4","L_CRM0276",subQuery);setComboBind([$.cmbStudy],ds)}else{if(id=="cmbStudy"){if(!value){return}$.cmbHelix.clear();var subQuery="";var ds=bizComponentData2($,"Q4","L_CRM281",subQuery);setComboBind([$.cmbHelix],ds)}else{if(id=="cmbProduct"){var subQuery="";$.cmbMktPolicy.clear();var rId=$.grdList1.getSelectedRowIdx();var dt=$.grdList1.getValue(rId);if(dt.dept_code=="F210"||dt.dept_code=="F280"||dt.dept_code=="F230"||dt.dept_code=="F310"||dt.dept_code=="F330"){subQuery=" AND extra_field1 = '"+$.cmbProduct.getValue()+"' AND extra_field2 = '"+dt.dept_code+"'"}else{subQuery=" AND extra_field1 = '"+$.cmbProduct.getValue()+"'"}var ds=bizComponentData2($,"Q4","L_CRM0294",subQuery);setComboBind([$.cmbMktPolicy],ds)}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList2"){$.varRowIdx=rId;if(cInd=="deposit_emp_name"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="30"||$.grdList2.getValue(rId,"receipt_type")=="40"||$.grdList2.getValue(rId,"receipt_type")=="50"){return}$.popUpCallId="deposit_emp_name";var param={cardCode:$.grdList2.getValue(rId,"deposit_emp_code")};g_main.openPopup("popDepositEmpSub.html","popDepositEmpSub","입금처 리스트",0,0,"","",param,"","")}else{if(cInd=="SAPCODE"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="30"||$.grdList2.getValue(rId,"receipt_type")=="40"||$.grdList2.getValue(rId,"receipt_type")=="50"){return}$.popUpCallId="SAPCODE";var param={};g_main.openPopup("popWithholdmentSub.html","popWithholdmentSub","원천대상 및 기타거래처",0,0,"","",param,"","")}else{if(cInd=="account_comp_name"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="10"||$.grdList2.getValue(rId,"receipt_type")=="20"){return}$.popUpCallId="account_comp_name";var param={};g_main.openPopup("popAccountCompany.html","popAccountCompany","회계거래처 리스트",0,0,"","",param,"","")}}}}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList1"){if($.grdList1.getRowCount<=0){return}$.varIdx=rId;$.varORemark="";$.panWFMain.clear();$.cmbPromo.clear();$.cmbGrapeFn.setValue("");$.cmbProject.setValue("");$.cmbStudy.setValue("");$.cmbHelix.setValue("");clearCPInfo();var ds=bizComponentData2($,"Q4","L_CRM0072_2"," and budget_code = '"+$.grdList1.getValue(rId,"budget_code")+"'");setComboBind([$.cmbPromo],ds);$.speAvalAmt.setValue($.grdList1.getValue(rId,"aval_amt"));$.speReqAmt.setValue(Number($.grdList1.getValue(rId,"aval_amt"))-Number($.grdList1.getValue(rId,"use_amt1")||0));$.ref_wf_doc_id=$.grdList1.getValue(rId,"wf_doc_id");$.txtRemark.setEnable(false);if($.grdList1.getValue(rId,"marketing_policy_yn")=="Y"){$.lblMktPolicy.setVisible(true);$.cmbMktPolicy.setVisible(true);$.cmbMktPolicy.setAllowBlank(false,"MKT 전략")}else{$.lblMktPolicy.setVisible(false);$.cmbMktPolicy.setVisible(false);$.cmbMktPolicy.setAllowBlank(true)}if($.varReturnData&&$.varReturnBinding){$.txtRemark.setValue($.varReturnData.use_remark);$.txtBudget.setValue($.varReturnData.budget_name);$.cmbPromo.setValue($.varReturnData.promo_code);$.cmbProduct.setValue($.varReturnData.pr_product_code);$.bteCompany.setText($.varReturnData.company_name_list||"");$.bteSigungu.setText($.varReturnData.sidogu_name_list||"");$.varCompany=$.varReturnData.company_id_list;$.varSigungu=$.varReturnData.sidogu_code_list;$.varReturnBinding=false}else{$.txtBudget.setValue($.grdList1.getValue(rId,"budget_name"));$.cmbPromo.setValue($.grdList1.getValue(rId,"promo_code"));$.cmbProduct.setValue($.grdList1.getValue(rId,"pr_product_code"));$.bteCompany.setText($.grdList1.getValue(rId,"company_name_list")||"");$.bteSigungu.setText($.grdList1.getValue(rId,"sidogu_name_list")||"");$.txtRemark.setValue("");$.speUseAmt.setValue($.grdList1.getValue(rId,"use_amt1")||0);if($.grdList1.getValue(rId,"budget_acctype")!=null&&$.grdList1.getValue(rId,"budget_acctype")!=""){var bdgType=$.grdList1.getValue(rId,"budget_acctype");if(bdgType=="10"||bdgType=="11"||bdgType=="12"||bdgType=="20"||bdgType=="30"){$.txtRemark.setValue($.grdList1.getValue(rId,"AcctName")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}}else{if($.grdList1.getValue(rId,"sales_dept_yn")=="Y"||$.grdList1.getValue(rId,"marketing_dept_yn")=="Y"){if($.grdList1.getValue(rId,"AcctName")!=null&&$.grdList1.getValue(rId,"for_dept_name")!=null){$.txtRemark.setValue($.grdList1.getValue(rId,"AcctName")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}else{$.txtRemark.setValue(g_main.session.obj.EmpNameFOR)}}else{$.txtRemark.setEnable(true)}}if($.grdList1.getValue(rId,"promo_budget_yn")=="Y"&&$.grdList1.getValue(rId,"product_code")!=null&&$.grdList1.getValue(rId,"product_code")!=""){$.cmbProduct.setValue($.grdList1.getValue(rId,"product_code"))}}if($.grdList2.getRowCount()>0){calcUseAmt("S")}setPromoBudget(rId);setGrape(rId);productComboChange($.grdList1.getValue(rId,"product_code"));if($.grdList1.getValue(rId,"budget_code")=="B01400040"){MessageBoxShow("연구비는 ISR관리 -> 연구비지급관리 를 통해 정산하시기 바랍니다.")}if($.varReceiptBinding){setDataGrid([$.grdList2],$.receiptData,true);$.grdList2.selectRow(0);calcUseAmt("S");$.varReceiptBinding=false}}else{if(id=="grdList2"){rowProperties(rId,$.grdList2.getValue(rId,"receipt_type"));var cRow=$.grdList2.getValue(rId);if(!$.grape_function_edit){cRow.grape_function_readonly=true}else{cRow.grape_function_readonly=false}}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList2"){if(cInd=="receipt_type"){if(oValue!=""){if(oValue=="20"||oValue=="50"){if(nValue=="10"||nValue=="30"||nValue=="40"){MessageBoxShow("영수증종류가 법인카드, 카드매입일경우 현금, 세금계산서, 계산서로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}if(oValue=="50"&&nValue=="20"){if(Number($.grdList2.getValue(rId,"tax_amt"))!=0||Number($.grdList2.getValue(rId,"nodeduction_amt"))!=0){MessageBoxShow("영수증종류가 법인카드일 경우 부가세가 0이어야 합니다.");$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt",0)}$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");rowProperties(rId,nValue)}if(oValue=="20"&&nValue=="50"){rowProperties(rId,nValue)}}else{if(oValue=="10"||oValue=="30"||oValue=="40"){if(nValue=="20"||nValue=="50"){MessageBoxShow("영수증종류가 현금, 세금계산서, 계산서일경우 법인카드, 카드매입로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}if(oValue!="30"&&nValue=="30"&&$.grdList2.getValue(rId,"modify_yn")=="Y"){confirmBoxShow("전자세금계산서가 아닌지 다시 한번 확인해주십시오.<br><br>종이세금계산서가 맞다면 '예'를 눌러주시고,<br><br>전자세금계산서라면 '아니오'를 눌러주세요.",function(){if(g_main.msgShare==true){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");rowProperties(rId,"30");return}else{calcUseAmt("D");$.grdList2.deleteCurrentRow();$.popUpCallId="btnEsero";var param={};g_main.openPopup("popEseroApprovalSub.html","popEseroApprovalSub","세금계산서&계산서 수신내역",0,0,"","",param,"","")}},230)}else{if(oValue=="30"&&nValue!="30"&&$.grdList2.getValue(rId,"modify_yn")=="N"){MessageBoxShow("영수증종류가 전자세금계산서일 경우 그외 항목으로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}}if(oValue=="30"&&nValue=="40"){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt",0);rowProperties(rId,nValue)}if((oValue=="30"||oValue=="40")&&nValue=="10"){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");rowProperties(rId,nValue)}if(oValue=="10"&&nValue=="40"){$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");rowProperties(rId,nValue)}}}}if(nValue=="10"){$.grdList2.setValue(rId,"deposit_emp_code",g_main.session.obj.UserID);$.grdList2.setValue(rId,"deposit_emp_name","["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName);$.grdList2.setValue(rId,"bank",$.varBank);$.grdList2.setValue(rId,"account",$.varAccount);$.grdList2.setValue(rId,"bank_account",$.varBankAccount);$.grdList2.setValue(rId,"acct_name",g_main.session.obj.UserName)}}else{if(cInd=="tax_amt"){if($.grdList2.getValue(rId,"receipt_type")=="30"){if(nValue==0){return}$.grdList2.setValue(rId,"nodeduction_amt",0);calcUseAmt("S")}else{if($.grdList2.getValue(rId,"receipt_type")=="50"){if(nValue==0){return}$.grdList2.setValue(rId,"nodeduction_amt",0);calcUseAmt("S")}}}else{if(cInd=="nodeduction_amt"){if($.grdList2.getValue(rId,"receipt_type")=="30"){if(nValue==0){return}$.grdList2.setValue(rId,"tax_amt",0);calcUseAmt("S")}else{if($.grdList2.getValue(rId,"receipt_type")=="50"){if(nValue==0){return}$.grdList2.setValue(rId,"tax_amt",0);calcUseAmt("S")}}}else{if(cInd=="use_amt"){calcUseAmt("S")}else{if(cInd=="use_date"){var now=getFormatDate(nValue,"yyyyMMdd").substr(0,8);if(Number(now)>Number(getToday(""))){$.grdList2.setValue(rId,cInd,oValue);return}var start=$.cmbBase.getValue("receipt_start_date");var end=$.cmbBase.getValue("receipt_end_date");if(unmask(now)<start||unmask(now)>end){$.grdList2.setValue(rId,"use_date",oValue);MessageBoxShow("반기에 해당하는 영수증 일자만 처리 가능합니다.");return false}}}}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txtRemark"){if(value!=""){$.varORemark=value}else{$.varORemark=""}}};$.fingeredit_keypress=function(id,value){if(id=="txtRemark"){if(value==""){return}var text="";if($.varORemark!=""){$.txtRemark.setValue($.varORemark);$.varORemark=""}else{if($.varORemark==""&&$.txtRemark.getValue()!=""){var row=$.grdList1.getValue($.grdList1.getSelectedRowIdx());if(row.for_dept_name!=""){text=$.txtRemark.getValue().split("-"+row.for_dept_name+"-"+g_main.session.obj.EmpNameFOR)[0];$.txtRemark.setValue(text)}else{text=$.txtRemark.getValue().split("-"+g_main.session.obj.EmpNameFOR)[0];$.txtRemark.setValue(text)}}}}};$.fingeredit_lostfocus=function(id,value){if(id=="txtRemark"){if($.txtRemark.getValue()==""){return}var row=$.grdList1.getValue($.grdList1.getSelectedRowIdx());var indexText="";if(row.for_dept_name!=""){indexText="-"+row.for_dept_name+"-"+g_main.session.obj.EmpNameFOR;if($.txtRemark.getValue().indexOf(indexText)==-1){$.txtRemark.setValue($.txtRemark.getValue()+"-"+row.for_dept_name+"-"+g_main.session.obj.EmpNameFOR)}}else{indexText="-"+g_main.session.obj.EmpNameFOR;if($.txtRemark.getValue().indexOf(indexText)==-1){$.txtRemark.setValue($.txtRemark.getValue()+"-"+g_main.session.obj.EmpNameFOR)}}}};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList2"){if($.grdList1.getRowCount()<=0){return}if(btnId=="btnAdd"){$.varReceiptType="";$.grdList2.addRow({modify_yn:"Y",receipt_type:"10",use_date:getToday("-"),use_date_readonly:false,use_amt:0,use_amt_readonly:false,tax_amt:0,tax_amt_readonly:true,nodeduction_amt:0,nodeduction_amt_readonly:true,deposit_emp_code:g_main.session.obj.UserID,deposit_emp_name:"["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName,bank:$.varBank,account:$.varAccount,bank_account:$.varBankAccount,acct_name:g_main.session.obj.UserName});var rId1=$.grdList1.getSelectedRowIdx();var rId2=$.grdList2.getSelectedRowIdx();if($.grdList1.getValue(rId1,"grape_function_code")!="E122"&&$.grdList1.getValue(rId1,"grape_function_code")!=""){$.grdList2.setValue(rId2,"grape_function",$.grdList1.getValue(rId1,"grape_function_code"))}rowProperties($.grdList2.getSelectedRowIdx(),"10")}else{if(btnId=="btnDelete"){var rId=$.grdList2.getSelectedRowIdx();if(!rId){return}var data=$.grdList2.getValue(rId);if(data.receipt_type=="20"||data.receipt_type=="50"){if(saveCardRe("FTRFLG10")){calcUseAmt("D");$.grdList2.deleteCurrentRow()}}else{calcUseAmt("D");$.grdList2.deleteCurrentRow()}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.varWfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)&&saveBudgetAft("N")&&saveReceipt("N")){if($.varOpenType=="POP"){var param={wf_doc_id:$.varWfDocId,doc_type:"70",doc_title:$.txtTitle.getValue()};g_popupStack.setData(param);g_popupStack.close()}else{var param={wf_doc_id:$.varWfDocId,doc_type:"70"};g_main.openModelWithBusiness("crmWFGeneralProc",param)}}else{removeWFDocument($.varWfDocId)}}}}else{if(id=="popEseroApprovalSub"){if($.popUpCallId=="btnEsero"){var overlap=false;var ioe=false;for(var i=0;i<popResult.length;i++){overlap=false;for(var j=0;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(j,"APPRNO")==popResult[i].APPRNO){overlap=true}}if(overlap){MessageBoxShow("선택한 계산서는 이미 영수증내역에 추가되어 있습니다.");return}$.grdList2.addRow({receipt_type:popResult[i].receipt_type,use_date:popResult[i].APPDAT||"",use_date_readonly:true,use_amt:popResult[i].APPAMT||"",use_amt_readonly:true,tax_amt:(popResult[i].VAT_DEDUCT_YN=="Y"?popResult[i].TAXAMT:0),tax_amt_readonly:true,nodeduction_amt:(popResult[i].VAT_DEDUCT_YN=="N"?popResult[i].TAXAMT:0),nodeduction_amt_readonly:true,APPRNO:popResult[i].APPRNO,account_comp_name:popResult[i].account_comp_name||"",VatRegN:popResult[i].BIZNUM||"",VatBPNM1:popResult[i].BIZNAME||"",deposit_emp_name:"",deposit_emp_code:"",SAPCODE:"",deposit_emp_name_readonly:true,account_comp_code:popResult[i].account_comp_code||"",SAPCODE_readonly:true,modify_yn:popResult[i].modify_yn||"N",VENKNM_readonly:false});var rId1=$.grdList1.getSelectedRowIdx();var rId2=$.grdList2.getSelectedRowIdx();if($.grdList1.getValue(rId1,"grape_function_code")!="E122"&&$.grdList1.getValue(rId1,"grape_function_code")!=""){$.grdList2.setValue(rId2,"grape_function",$.grdList1.getValue(rId1,"grape_function_code"))}if(popResult[i].receipt_type=="10"){ioe=true}calcUseAmt("S")}if(!ioe){$.popUpCallId="IOE";var param={account_comp_code:popResult[0].account_comp_code||""};g_main.openPopup("popAccountCompany.html","popAccountCompany","회계거래처 리스트",0,0,"","",param,"","")}else{for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"receipt_type")!="10"){$.grdList2.setValue(i,"bank_account","농협 111-1111-11111");$.grdList2.setValue(i,"bank","11");$.grdList2.setValue(i,"account","111-1111-11111");$.grdList2.setValue(i,"acct_name","임시은행");$.grdList2.setValue(i,"pay_me","N")}else{$.grdList2.setValue(i,"bank_account",$.varBankAccount);$.grdList2.setValue(i,"bank",$.varBank);$.grdList2.setValue(i,"account",$.varAccount);$.grdList2.setValue(i,"acct_name",$.varAcctName);$.grdList2.setValue(i,"deposit_emp_name","["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName);$.grdList2.setValue(i,"deposit_emp_code",g_main.session.obj.UserID)}}}}}else{if(id=="popAccountCompany"){if($.popUpCallId=="IOE"){var rId=$.grdList2.getSelectedRowIdx();if(popResult.pay_me=="Y"){$.grdList2.setValue(rId,"bank_account",$.varBankAccount);$.grdList2.setValue(rId,"bank",$.varBank);$.grdList2.setValue(rId,"account",$.varAccount);$.grdList2.setValue(rId,"acct_name",$.varAcctName);$.grdList2.setValue(rId,"pay_me",popResult.pay_me)}else{$.grdList2.setValue(rId,"bank_account",popResult.bank_account);$.grdList2.setValue(rId,"bank",popResult.bank);$.grdList2.setValue(rId,"account",popResult.account);$.grdList2.setValue(rId,"acct_name",popResult.acct_name);$.grdList2.setValue(rId,"pay_me",popResult.pay_me)}}else{if($.popUpCallId=="account_comp_name"){$.grdList2.setValue($.varRowIdx,"account_comp_code",popResult.card_code);$.grdList2.setValue($.varRowIdx,"VatBPNM1",popResult.card_name);$.grdList2.setValue($.varRowIdx,"VatRegN",popResult.VATRegNum);$.grdList2.setValue($.varRowIdx,"account_comp_name",popResult.account_comp_name);if($.grdList2.getValue($.varRowIdx,"receipt_type")!="50"){if(popResult.pay_me=="Y"){$.grdList2.setValue($.varRowIdx,"bank_account",$.varBankAccount);$.grdList2.setValue($.varRowIdx,"bank",$.varBank);$.grdList2.setValue($.varRowIdx,"account",$.varAccount);$.grdList2.setValue($.varRowIdx,"acct_name",$.varAcctName);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}else{$.grdList2.setValue($.varRowIdx,"bank_account",popResult.bank_account);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}}}}}else{if(id=="popCardApprovalSub"){if($.popUpCallId=="btnCard"){$.varReceiptType="";var overlapCnt=0;var overlap=false;for(var i=0;i<popResult.length;i++){overlap=false;for(var j=0;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(j,"APPRNO")==popResult[i].APPRNO){overlapCnt++;overlap=true}}if(overlap){continue}$.grdList2.addRow({receipt_type:"20",use_date:extFormat(getToday("").substr(0,2)+popResult[i].APPDAT.replace(/\//g,"").substr(0,6),"yyyyMMdd","-"),use_date_readonly:true,use_amt:popResult[i].APPAMT||"",use_amt_readonly:true,tax_amt:0,tax_amt_readonly:true,nodeduction_amt:0,nodeduction_amt_readonly:true,deposit_emp_name:popResult[i].CARDNO,deposit_emp_code:popResult[i].EMPNUM||"",CARDNO:popResult[i].CARDNO||"",APPRNO:popResult[i].APPRNO||"",modify_yn:"N",VENKNM:popResult[i].VENKNM||"",VENKNM_readonly:true,account:popResult[i].ACCOUNT||"",bank_account:popResult[i].BANK_ACCOUNT||"",APPDAT:popResult[i].APPDAT||"",VENGRP:popResult[i].VENGRP||"",bank:popResult[i].BANK||"",acct_name:popResult[i].ACCT_NAME||""});var rId1=$.grdList1.getSelectedRowIdx();var rId2=$.grdList2.getSelectedRowIdx();if($.grdList1.getValue(rId1,"grape_function_code")!="E122"&&$.grdList1.getValue(rId1,"grape_function_code")!=""){$.grdList2.setValue(rId2,"grape_function",$.grdList1.getValue(rId1,"grape_function_code"))}}if(popResult.length>0){$.varReceiptType="20"}calcUseAmt("S");if(overlapCnt>0){MessageBoxShow("선택한 법인카드 건중 이미 영수증내역에 추가되어 있는 건이 있습니다.")}}}else{if(id=="popDepositEmpSub"){if($.popUpCallId=="deposit_emp_name"){log(popResult);$.grdList2.setValue($.varRowIdx,"deposit_emp_code",popResult.code);$.grdList2.setValue($.varRowIdx,"deposit_emp_name","["+popResult.code+"]"+popResult.emp_name);$.grdList2.setValue($.varRowIdx,"bank_account",popResult.bank_account);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"SAPCODE","");if($.grdList2.getValue($.varRowIdx,"receipt_type")=="10"){if($.grdList2.getValue($.varRowIdx,"deposit_emp_code")=="ka777777"){$.grdList2.setValue($.varRowIdx,"SAPCODE_readonly",true)}else{$.grdList2.setValue($.varRowIdx,"SAPCODE_readonly",false)}}}}else{if(id=="popWithholdmentSub"){if($.popUpCallId=="SAPCODE"){$.grdList2.setValue($.varRowIdx,"SAPCODE",popResult.target_info);if(popResult.pay_me=="Y"){$.grdList2.setValue($.varRowIdx,"bank_account",$.varBankAccount);$.grdList2.setValue($.varRowIdx,"bank",$.varBank);$.grdList2.setValue($.varRowIdx,"account",$.varAccount);$.grdList2.setValue($.varRowIdx,"acct_name",$.varAcctName);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}else{$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me);$.grdList2.setValue($.varRowIdx,"bank_account",popResult.target_info2);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name)}}}else{if(id=="popCompanyListSub"){if($.popUpCallId=="bteCompany"){$.bteCompany.setText(popResult.company_name);$.varCompany=popResult.company_id;$.bteSigungu.setText("");$.varSigungu=""}}else{if(id=="popSidogu"){if($.popUpCallId=="bteSigungu"){$.bteCompany.setText("");$.varCompany="";$.bteSigungu.setText(popResult.sidogu_name);$.varSigungu=popResult.sidogu_code}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popWFGoAboardSub"){if($.popUpCallId=="bteSubject"){$.varSubWfDocId=popResult.wf_doc_id;$.bteSubject.setText(popResult.subject)}}else{if(id=="crmCPMaster"){$.varCPId=popResult.cp_id;$.txtCPDocNo.setValue(popResult.cp_doc_no);if(popResult.cp_code){$.varStrCpCode=popResult.cp_code}$.varNumCpAmt="";if(popResult.total_amt){$.varNumCpAmt=popResult.total_amt}if($.varStrCpCode=="CP03"||$.varStrCpCode=="CP02"){$.grdList2.clear();searchCardApprovalSub_Q()}}}}}}}}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>