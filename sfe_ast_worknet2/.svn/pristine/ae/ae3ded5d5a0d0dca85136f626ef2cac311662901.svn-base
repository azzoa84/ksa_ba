<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panShoukaMonth1=null;$.grdShoukaMonth1=null;$.panShoukaMonth2=null;$.grdShoukaMonth2=null;$.lbl_date=null;$.dte_QCallDate=null;$.lbl_sidogu_like=null;$.txt_sidogu_like=null;$.lbl_Txt1=null;$.txt_EditEx1=null;$.btnBefore=null;$.btnAfter=null;$.btnSearch=null;$.btnSend=null;$.htmlTxt1=null;$.htmlTxt2=null;$.txt_Start=null;$.txt_End=null;$.txtRequestWarning=null;function createJson_Q(workType){var json;if(workType=="Q"){json=createExecuteParamInfo("P_crmShoukaMonth10_Q",[workType,$.dte_QCallDate.getValue(),$.txt_sidogu_like.getValue(),"#UserID#"])}else{if(workType=="Q2"){json=createExecuteParamInfo("P_crmShoukaMonth10_Q",[workType,"","","#UserID#"])}}return json}function createJson_Q1(workType){var json=createExecuteParamInfo("P_can_you_etc_Q",[workType,$.txt_EditEx1.getValue()||""]);return json}function createJson_Q2(workType){var json=createExecuteParamInfo("P_etc_start_end_Q",[workType]);return json}function createJson_S(workType){var strnoncheck="N";var gRow=$.grdShoukaMonth1.getAllRows();var rows=[];for(var i in gRow){if(gRow[i].CheckYN=="Y"){if(gRow[i].fore_company_name==""){MessageBoxShow("예상거래처를 입력하세요");return false}else{rows.push([workType,gRow[i].sale_seq,gRow[i].wholesaler_name,gRow[i].sale_date,gRow[i].product_name,gRow[i].sale_qty,gRow[i].addr,gRow[i].sidogu_name,gRow[i].fore_company_name,"#UserID#"]);strnoncheck="Y"}}}if(strnoncheck=="N"){MessageBoxShow("기타실적을 선택하세요");return false}var json=createExecuteParamInfo("P_crmShoukaMonth10_S",rows);return json}function createJson_S2(workType){var strnoncheck="N";var gRow=$.grdShoukaMonth2.getAllRows();var rows=[];for(var i in gRow){if(gRow[i].CheckYN2=="Y"||gRow[i].sale_result==""){rows.push([workType,gRow[i].month_id]);strnoncheck="Y"}}if(strnoncheck=="N"||gRow[i].sale_result==""){MessageBoxShow("삭제할 기타실적을 선택하세요");return false}else{MessageBoxShow("처리 결과가 나온 요청은 삭제할 수 없습니다.");return false}var json=createExecuteParamInfo("P_crmShoukaMonth10_S2",rows);return json}function searchShoukaMonth10(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q(workType);callQuery(["req",json],workType=="Q"?"Month1":"Month2",$)}function searchCanYouETC(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q1(workType);var ds=callQuerySync(["req",json],workType);if(ds&&ds.errorCode=="MSG0001"){$.txt_EditEx1.setValue(ds.resultList[0][0].etc_yn)}}function searchEtcStartEnd(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q2(workType);var ds=callQuerySync(["req",json],workType);if(ds&&ds.errorCode=="MSG0001"){var rs=ds.resultList[0][0];var startDay=rs.etc_start_date;var endDay=rs.etc_end_date;$.txt_Start.setValue(startDay.substring(0,4)+"-"+startDay.substring(4,6)+"-"+startDay.substring(6,8));$.txt_End.setValue(endDay.substring(0,4)+"-"+endDay.substring(4,6)+"-"+endDay.substring(6,8))}}function saveShoukaMonth10(workType){if(!$.panQuery.validateControls()){return}var json=createJson_S(workType);if(json){callExecute(["req",json],workType,$)}}function saveShoukaMonth10_S2(workType){if(!$.panQuery.validateControls()){return}var json=createJson_S2(workType);if(json){callExecute(["req",json],workType,$)}}function gridValidator(){if(arguments.length<2){return false}var grdName=arguments[0];for(var i=0;i<grdName.getRowCount();i++){for(var j=1;j<arguments.length;j++){if(grdName.getValue(i,arguments[j])==""||grdName.getValue(i,arguments[j])==null){MessageBoxShow(grdName.getColumnText(arguments[j])+" 은(는) 필수 입력항목입니다");return false}}}return true}function getObjectDate(objDate){var year=parseInt(objDate.year)+1900;var month=parseInt(objDate.month)+1;var date=objDate.date;if(parseInt(month)<10){month="0"+month}if(parseInt(date)<10){date="0"+date}return year+""+month+""+date}function formatDateYMD(ds){var rs=ds.resultList[0];for(var i in rs){rs[i].reqdate=getObjectDate(rs[i].create_time)}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,915);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,90);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panShoukaMonth1=new FingerPanel(host,"panShoukaMonth1",0,100,1200,395);$.panShoukaMonth1.setText("기타실적");$.panShoukaMonth1.setBottomLine(true);$.grdShoukaMonth1=new FingerDataGrid(host,"grdShoukaMonth1",0,0,1200,350);$.panShoukaMonth2=new FingerPanel(host,"panShoukaMonth2",0,505,1200,400);$.panShoukaMonth2.setText("요청결과");$.panShoukaMonth2.setBottomLine(true);$.grdShoukaMonth2=new FingerDataGrid(host,"grdShoukaMonth2",0,0,1200,355);$.lbl_date=new FingerLabel(host,"lbl_date",0,30,100,20);$.lbl_date.setText("조회년월");$.dte_QCallDate=new FingerDateEdit(host,"dte_QCallDate",135,30,110,20);$.lbl_sidogu_like=new FingerLabel(host,"lbl_sidogu_like",300,30,155,20);$.lbl_sidogu_like.setText("지역정보(시,도,구,군)");$.txt_sidogu_like=new FingerEdit(host,"txt_sidogu_like",460,30,160,20);$.lbl_Txt1=new FingerLabel(host,"lbl_Txt1",1065,30,20,20);$.lbl_Txt1.setText("~");$.txt_EditEx1=new FingerEdit(host,"txt_EditEx1",5,5,85,20);$.btnBefore=new FingerButton(host,"btnBefore",105,30,50,25);$.btnBefore.setText("◀");$.btnAfter=new FingerButton(host,"btnAfter",245,30,50,25);$.btnAfter.setText("▶");$.btnSearch=new FingerButton(host,"btnSearch",630,30,80,20);$.btnSearch.setText("조회");$.btnSend=new FingerButton(host,"btnSend",925,-40,125,30);$.btnSend.setText("기타실적요청");$.htmlTxt1=new FingerHTMLView(host,"htmlTxt1",1030,10,105,20);$.htmlTxt2=new FingerHTMLView(host,"htmlTxt2",1005,65,180,20);$.txt_Start=new FingerEdit(host,"txt_Start",975,30,90,20);$.txt_End=new FingerEdit(host,"txt_End",1090,30,90,20);$.txtRequestWarning=new FingerLabel(host,"txtRequestWarning",580,515,370,20);$.txtRequestWarning.setText("여신팀에서 확인한 결과와 내용이 입력된 요청은 삭제 불가 합니다.");$.panQuery.setBorder(true);$.panShoukaMonth2.addButtons(["btnDelete"]);$.dte_QCallDate.setDateFormat("yyyymm");$.dte_QCallDate.setAllowBlank(false,"콜기준일");$.htmlTxt1.setHTML("<label style = 'color: #FF0000; font-weight: 600;'>요청 가능 기간</label>");$.htmlTxt2.setHTML("<label style = 'color: #FF0000; font-weight: 600;'>요청기간 이외 요청 불가</label>");$.txt_EditEx1.setVisible(false);$.txt_Start.setReadOnly(true);$.txt_End.setReadOnly(true);$.btnSend.setClass("btn_new");$.grdShoukaMonth1.setColumns([new FingerDataGridColumn("CheckYN",60,"center","checkbox",[{text:"선택",css:"col_edit"}]),new FingerDataGridColumn("sale_seq",60,"right","int","순번",{readonly:true}),new FingerDataGridColumn("wholesaler_name",200,"left","string","도매상명",{readonly:true}),new FingerDataGridColumn("sale_date",100,"left","string","판매일자",{format:"s_ymd",readonly:true}),new FingerDataGridColumn("product_name",180,"left","string","품목명",{readonly:true}),new FingerDataGridColumn("sidogu_name",213,"left","string","주소",{readonly:true}),new FingerDataGridColumn("addr",150,"left","string","시,도",{readonly:true}),new FingerDataGridColumn("fore_company_name",220,"left","string",[{text:"예상거래처",css:"col_edit",readonly:true}]),new FingerDataGridColumn("sale_qty",0,"left","string","",{hidden:true})]);$.grdShoukaMonth1.init({panel:$.panShoukaMonth1,eventCellReadOnly:true});$.grdShoukaMonth1.setEditable(true);$.grdShoukaMonth1.setBorder(false);$.grdShoukaMonth2.setColumns([new FingerDataGridColumn("CheckYN2",60,"center","checkbox",[{text:"선택",css:"col_edit"}]),new FingerDataGridColumn("reqdate",80,"left","string","요청일자",{format:"s_ymd"}),new FingerDataGridColumn("sale_seq",60,"right","int","순번"),new FingerDataGridColumn("wholesaler_name",150,"left","string","도매상명"),new FingerDataGridColumn("sale_date",80,"left","string","판매일자",{format:"s_ymd"}),new FingerDataGridColumn("product_name",120,"left","string","품목명"),new FingerDataGridColumn("addr",140,"left","string","주소"),new FingerDataGridColumn("sidogu_name",100,"left","string","시,도"),new FingerDataGridColumn("fore_company_name",140,"left","string","예상거래처"),new FingerDataGridColumn("sale_result",80,"left","string",[{text:"결과",css:"col_chk"}]),new FingerDataGridColumn("sale_content",173,"left","string",[{text:"내용",css:"col_chk"}]),new FingerDataGridColumn("month_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("equal",0,"left","string","",{hidden:true}),new FingerDataGridColumn("create_user",0,"left","string","",{hidden:true}),new FingerDataGridColumn("business_no",0,"left","string","",{hidden:true}),new FingerDataGridColumn("pharm_name",0,"left","string","",{hidden:true})]);$.grdShoukaMonth2.init({panel:$.panShoukaMonth2});$.grdShoukaMonth2.setEditable(false);$.grdShoukaMonth2.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panShoukaMonth1);$.panMain.add($.panShoukaMonth2);$.panMain.add($.txtRequestWarning);$.panQuery.add($.btnSearch);$.panQuery.add($.btnAfter);$.panQuery.add($.btnBefore);$.panQuery.add($.txt_EditEx1);$.panQuery.add($.lbl_Txt1);$.panQuery.add($.txt_sidogu_like);$.panQuery.add($.lbl_sidogu_like);$.panQuery.add($.dte_QCallDate);$.panQuery.add($.lbl_date);$.panQuery.add($.htmlTxt1);$.panQuery.add($.htmlTxt2);$.panQuery.add($.txt_Start);$.panQuery.add($.txt_End);$.panShoukaMonth1.add($.grdShoukaMonth1);$.panShoukaMonth1.add($.btnSend);$.panShoukaMonth2.add($.grdShoukaMonth2);relocateChildIndexInPanel([$.panQuery]);$.dte_QCallDate.setValue(getToday(""));$.btnSend.setEnable(false);searchShoukaMonth10("Q2");searchCanYouETC("Q");searchEtcStartEnd("Q")};$.callback=function(type,ds){if(type=="Month2"){if(ds&&ds.errorCode=="MSG0001"){formatDateYMD(ds)}setDataGrid([$.grdShoukaMonth2],ds);$.grdShoukaMonth2.selectRow(0)}else{if(type=="Month1"){setDataGrid([$.grdShoukaMonth1],ds);$.grdShoukaMonth1.selectRow(0);if($.grdShoukaMonth1.getRowCount()>0){if($.txt_EditEx1.getValue()=="Y"){$.btnSend.setEnable(true)}}}else{if(type=="S"||type=="D"){log(ds);if(ds){var rs=ds.resultList;var msg="정상적으로 저장되었습니다.";if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){msg=rs[i].errorCode+"</br>"+rs[i].errorMsg}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){msg=ds.errorCode+"</br>"+ds.errorMsg}}MessageBoxShow(msg);if(type=="S"){searchShoukaMonth10("Q");searchShoukaMonth10("Q2")}else{searchShoukaMonth10("Q2")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchCanYouETC("Q");searchShoukaMonth10("Q")}else{if(id=="btnBefore"){if($.dte_QCallDate.getValue()==null||$.dte_QCallDate.getValue()==""){return}var dt=$.dte_QCallDate.getValue()+"01";$.dte_QCallDate.setValue(getCalcMonth(dt,-1))}else{if(id=="btnAfter"){if($.dte_QCallDate.getValue()==null||$.dte_QCallDate.getValue()==""){return}var dt=$.dte_QCallDate.getValue()+"01";$.dte_QCallDate.setValue(getCalcMonth(dt,1))}else{if(id=="btnSend"){confirmBoxShow("기타실적요청 하시겠습니까?",function(){if(g_main.msgShare==true){saveShoukaMonth10("S")}})}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdShoukaMonth2"){if(cInd=="CheckYN2"){$.grdShoukaMonth2.setValue(rId,cInd,$.grdShoukaMonth2.getValue(rId,cInd)=="Y"?"N":"Y")}}else{if(id=="grdShoukaMonth1"){if(cInd=="CheckYN"){$.grdShoukaMonth1.setValue(rId,cInd,$.grdShoukaMonth1.getValue(rId,cInd)=="Y"?"N":"Y")}}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdShoukaMonth2"){if(cInd=="CheckYN2"){$.grdShoukaMonth2.selectRow(rId)}}else{if(id=="grdShoukaMonth1"){if(cInd=="CheckYN"){$.grdShoukaMonth1.selectRow(rId)}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if(id=="txt_sidogu_like"&&value=="13"){searchCanYouETC("Q");searchShoukaMonth10("Q")}};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panShoukaMonth2"){if(btnId=="btnDelete"){if($.grdShoukaMonth2.getRowCount()<1){return}confirmBoxShow("선택된 항목을 삭제하시겠습니까?",function(){if(g_main.msgShare==true){saveShoukaMonth10_S2("D")}})}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>