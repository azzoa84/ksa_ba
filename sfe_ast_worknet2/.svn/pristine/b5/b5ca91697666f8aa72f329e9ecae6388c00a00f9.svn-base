<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panInfo=null;$.panFile=null;$.panBottom=null;$.lblDocNo=null;$.lblEmp=null;$.lblPM=null;$.lblType=null;$.lblProduct=null;$.lblTheme=null;$.lblCPDate=null;$.lblWave=null;$.lblPlace=null;$.lblStayPlace=null;$.lblAppDate=null;$.lblContact=null;$.lblContactOrgan=null;$.lblContactCnt=null;$.lblStay=null;$.lblStayOrgan=null;$.lblStayCnt=null;$.lblTrans=null;$.lblTransAmt=null;$.lblMeal=null;$.lblMealAmt=null;$.lblMemento=null;$.lblMementoAmt=null;$.lblRoom=null;$.lblRoom1Day=null;$.lblRoomContact=null;$.lblRoomCnt=null;$.lblSupport=null;$.lblSupportAmt=null;$.lblAgency=null;$.lblMementoQty=null;$.txtDocNo=null;$.cmbEmp=null;$.cmbPM=null;$.cmbStatus=null;$.cmbType=null;$.cmbProduct=null;$.cmbTheme=null;$.dteStart=null;$.dteEnd=null;$.txtPlace=null;$.txtStayPlace=null;$.dteAppDate=null;$.speContactOrgan=null;$.speContactCnt=null;$.speStayOrgan=null;$.speStayCnt=null;$.speTransAmt=null;$.speMealAmt=null;$.speMementoAmt=null;$.speRoomAmt=null;$.speRoomContact=null;$.speRoomCnt=null;$.speSupportAmt=null;$.txtAgency=null;$.speMementoQty=null;$.grdFile=null;$.btnConfirm=null;$.btnCancel=null;$.btnMemoSave=null;$.btnReportYnSave=null;$.btnSeminarCancel=null;$.memCPDescr=null;$.chkReportYN=null;$.lblReviewNo=null;$.lblReviewDate=null;$.txtReviewNo=null;$.dteReviewDate=null;$.imgPicture1=null;$.imgPicture2=null;$.imgPicture3=null;$.imgPicture4=null;$.panContact=null;$.grdContact=null;$.btnUpload=null;$.btnView=null;$.btnUploadList=null;$.btnMAConfirm=null;$.btnMACancel=null;$.cboFromHH=null;$.cboFromMM=null;$.cboToHH=null;$.cboToMM=null;$.lblcolon1=null;$.lblcolon2=null;$.btnBatchUpload=null;$.txtCPId=null;$.lblImage=null;$.lblAgencyDocuYN=null;$.rdoAgencyDocuYN=null;$.btnViewBfCP=null;$.varCPId="";$.varPopupType="N";$.varBfCPId="";$.cp_code="";function createJSON_S(workType){var fRow=$.grdFile.getAllRows();var con_id="",com_id="",sup_amt="",cp_food="",cp_food_amt="",cp_gift="",cp_gift_amt="",cp_stay="",cp_stay_amt="",cp_trans="",cp_trans_amt="",file_path="",file_name="";for(var i=0;i<$.grdContact.getRowCount();i++){com_id+=$.grdContact.getValue(i,"company_id")+"|";con_id+=$.grdContact.getValue(i,"contact_id")+"|";sup_amt+=$.grdContact.getValue(i,"support_amt")+"|";cp_food+=$.grdContact.getValue(i,"cp_food_yn")+"|";cp_food_amt+=$.grdContact.getValue(i,"food_amt")+"|";cp_gift+=$.grdContact.getValue(i,"cp_gift_yn")+"|";cp_gift_amt+=$.grdContact.getValue(i,"gift_amt")+"|";cp_stay+=$.grdContact.getValue(i,"cp_stay_yn")+"|";cp_stay_amt+=$.grdContact.getValue(i,"stay_amt")+"|";cp_trans+=$.grdContact.getValue(i,"cp_trans_yn")+"|";cp_trans_amt+=$.grdContact.getValue(i,"trans_amt")+"|";file_path+=$.grdContact.getValue(i,"file_path")+"|";file_name+=$.grdContact.getValue(i,"file_name")+"|"}if($.grdContact.getRowCount()>0){com_id=com_id.substring(0,com_id.length-1);con_id=con_id.substring(0,con_id.length-1);sup_amt=sup_amt.substring(0,sup_amt.length-1);cp_food=cp_food.substring(0,cp_food.length-1);cp_food_amt=cp_food_amt.substring(0,cp_food_amt.length-1);cp_gift=cp_gift.substring(0,cp_gift.length-1);cp_gift_amt=cp_gift_amt.substring(0,cp_gift_amt.length-1);cp_stay=cp_stay.substring(0,cp_stay.length-1);cp_stay_amt=cp_stay_amt.substring(0,cp_stay_amt.length-1);cp_trans=cp_trans.substring(0,cp_trans.length-1);cp_trans_amt=cp_trans_amt.substring(0,cp_trans_amt.length-1);file_path=file_path.substring(0,file_path.length-1);file_name=file_name.substring(0,file_name.length-1)}var fSeq="",fFileType="",fServerPath="",fServerFname="",fLocalFname="";for(var i in fRow){if(i>0){fSeq+="|";fFileType+="|";fServerPath+="|";fServerFname+="|";fLocalFname+="|"}fSeq+=Number(i)+1;fFileType+=fRow[i].file_type;fServerPath+=fRow[i].server_path;fServerFname+=fRow[i].server_fname;fLocalFname+=fRow[i].local_fname}var json=createExecuteParamInfo("P_crmCPSeminarStayAfter_S_B64",[workType,$.varCPId,$.txtDocNo.getValue(),$.cmbEmp.getValue(),"#DeptCode#",$.cmbPM.getValue(),$.cmbProduct.getValue(),$.cmbTheme.getValue(),$.txtReviewNo.getValue(),$.dteReviewDate.getValue(),$.dteStart.getValue(),$.cboFromHH.getValue(),$.cboFromMM.getValue(),$.dteEnd.getValue(),$.cboToHH.getValue(),$.cboToMM.getValue(),$.txtPlace.getValue(),$.txtStayPlace.getValue(),"",$.speContactOrgan.getValue(),$.speContactCnt.getValue(),$.speStayOrgan.getValue(),$.speStayCnt.getValue(),$.speSupportAmt.getValue(),$.speTransAmt.getValue(),$.speMealAmt.getValue(),$.speMementoAmt.getValue(),$.speRoomAmt.getValue(),$.speRoomContact.getValue(),$.speRoomCnt.getValue(),$.cmbType.getValue(),$.txtAgency.getValue(),$.rdoAgencyDocuYN.getValue(),$.speMementoQty.getValue(),$.dteAppDate.getValue(),"",0,"",$.imgPicture1.getValue()!=""?$.imgPicture1.getUploadParam().image_base64:"",$.imgPicture2.getValue()!=""?$.imgPicture2.getUploadParam().image_base64:"",$.imgPicture3.getValue()!=""?$.imgPicture3.getUploadParam().image_base64:"",$.imgPicture4.getValue()!=""?$.imgPicture4.getUploadParam().image_base64:"",$.varBfCPId,"CP22","#UserID#","Y",con_id,com_id,sup_amt,cp_food,cp_food_amt,cp_gift,cp_gift_amt,cp_stay,cp_stay_amt,cp_trans,cp_trans_amt,file_path,file_name,"Y",fFileType,fSeq,fServerPath,fServerFname,fLocalFname]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmCPExtraFunction_S",[workType,$.varCPId,$.chkReportYN.getValue(),"#UserID#"]);return json}function saveSeminar(workType){if(workType=="N"||workType=="U"||workType=="NT"||workType=="UT"){if(!$.imgPicture1.getUploadParam()||!$.imgPicture2.getUploadParam()||!$.imgPicture3.getUploadParam()||!$.imgPicture4.getUploadParam()){MessageBoxShow("사진은 한장 이상 등록 되어야 합니다.");return}if($.grdFile.getRowCount<8){MessageBoxShow("파일유형 8가지는 필수 입니다.");return}var chk1="",chk2="",chk3="",chk4="",chk5="",chk6="",chk7="",chk8="";var fRow=$.grdFile.getAllRows();for(var i in fRow){if(fRow[i].file_type=="033"){chk1="033"}else{if(fRow[i].file_type=="021"){chk2="021"}else{if(fRow[i].file_type=="027"){chk3="027"}else{if(fRow[i].file_type=="028"){chk4="028"}else{if(fRow[i].file_type=="065"){chk5="065"}else{if(fRow[i].file_type=="042"){chk6="042"}else{if(fRow[i].file_type=="026"){chk7="026"}else{if(fRow[i].file_type=="036"){chk8="036"}}}}}}}}if(chk1=="033"&&chk2=="021"&&chk3=="027"&&chk4=="028"&&chk5=="065"&&chk6=="042"&&chk7=="026"&&chk8=="036"){break}}if(chk1!="033"){MessageBoxShow("심의결과통지서는 필수 첨부 파일 입니다.");return}else{if(chk2!="021"){MessageBoxShow("진행계획서(프로그램 및 세부계획서, 지출예산서 포함)은 필수 첨부 파일 입니다.");return}else{if(chk3!="027"){MessageBoxShow("대행사 지출예산서(최종본)는 필수 첨부 파일 입니다.");return}else{if(chk4!="028"){MessageBoxShow("참석자명단(이름, 소속, 지원항목, 비용 등)은 필수 첨부 파일 입니다.");return}else{if(chk5!="065"){MessageBoxShow("방명록은 필수 첨부 파일 입니다,");return}else{if(chk6!="042"){MessageBoxShow("결과보고서는 필수 첨부 파일 입니다.");return}else{if(chk7!="026"){MessageBoxShow("초청장 및 Agenda는 필수 첨부 파일 입니다.");return}else{if(chk8!="036"){MessageBoxShow("개인정보 활용동의서는 필수 첨부 파일 입니다.");return}}}}}}}}var dt1=getToday();var dt2=$.dteStart.getValue();var dt3=getCompareDate(dt1,dt2);if(dt3>27){MessageBoxShow("지원개시일로부터 27일 이내에만 신청가능합니다.");return}}var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$,false)}}function saveExtraFunction(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds){if(ds.errorCode=="MSG0004"){return true}}else{return true}}}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmCPInfo_Q",[workType,$.cp_code]);return json}function createJSON_Q2_1(cpFormId,cpProcName){if(cpProcName=="P_crmCPDetailAfter_Q"||cpProcName=="P_crmCPExternalAct_Q"){var json=createExecuteParamInfo(cpProcName,["Q",$.varBfCPId])}else{var json=createExecuteParamInfo(cpProcName,["Q",$.varBfCPId,"#UserID#"])}return json}function calcSupportAmt(){var transAmt=0,mealAmt=0,stayAmt=0;transAmt=$.speContactCnt.getValue()*$.speTransAmt.getValue();mealAmt=$.speContactCnt.getValue()*$.speMealAmt.getValue();mementoAmt=$.speContactCnt.getValue()*$.speMementoAmt.getValue();stayAmt=$.speStayCnt.getValue()*$.speRoomAmt.getValue();$.speSupportAmt.setValue(transAmt+mealAmt+stayAmt+mementoAmt)}function setControlEnable(bo){if(bo){$.panInfo.enableButton(["btnSave","btnTemp"]);$.panFile.enableButton(["btnAdd","btnDelete"])}else{$.panInfo.disableButton(["btnSave","btnTemp"]);$.panFile.disableButton(["btnAdd","btnDelete"])}$.dteStart.setEnable(bo);$.cboFromHH.setEnable(bo);$.cboFromMM.setEnable(bo);$.dteEnd.setEnable(bo);$.cboToHH.setEnable(bo);$.cboToMM.setEnable(bo);$.txtPlace.setReadOnly(!bo);$.speContactCnt.setReadOnly(!bo);$.cmbProduct.setEnable(bo);$.cmbTheme.setEnable(bo);$.cmbPM.setEnable(bo);$.cmbType.setEnable(bo);$.txtStayPlace.setReadOnly(!bo);$.speContactCnt.setReadOnly(!bo);$.speContactOrgan.setReadOnly(!bo);$.speStayCnt.setReadOnly(!bo);$.speStayOrgan.setReadOnly(!bo);$.speTransAmt.setReadOnly(!bo);$.speMealAmt.setReadOnly(!bo);$.speMementoAmt.setReadOnly(!bo);$.speRoomAmt.setReadOnly(!bo);$.speRoomCnt.setReadOnly(!bo);$.speRoomContact.setReadOnly(!bo);$.speSupportAmt.setReadOnly(!bo);$.txtAgency.setReadOnly(!bo);$.speMementoQty.setReadOnly(!bo);$.txtReviewNo.setReadOnly(!bo);$.dteReviewDate.setEnable(bo);$.rdoAgencyDocuYN.setEnable(bo)}function setAllowBlank(){$.cmbEmp.setAllowBlank(false,"담당자");$.cmbPM.setAllowBlank(false,"PM");$.cmbType.setAllowBlank(false,"구분");$.cmbProduct.setAllowBlank(false,"품목");$.dteStart.setAllowBlank(false,"계최시작일");$.dteEnd.setAllowBlank(false,"계최종료일");$.cboFromHH.setAllowBlank(false,"시작 시간");$.cboFromMM.setAllowBlank(false,"시작 시간");$.cboToHH.setAllowBlank(false,"종료 시간");$.cboToMM.setAllowBlank(false,"종료 시간");$.txtPlace.setAllowBlank(false,"행사장소");$.txtStayPlace.setAllowBlank(false,"숙박장소");$.dteAppDate.setAllowBlank(false,"승인요청일");$.speContactOrgan.setAllowBlank(false,"총 참가 기관수");$.speContactCnt.setAllowBlank(false,"총 참가 인원수");$.speStayOrgan.setAllowBlank(false,"숙박인원 기관수");$.speStayCnt.setAllowBlank(false,"숙박인원수");$.speTransAmt.setAllowBlank(false,"교통비(1인)");$.speMealAmt.setAllowBlank(false,"숙박비(1인)");$.speRoomAmt.setAllowBlank(false,"숙박비");$.speRoomContact.setAllowBlank(false,"숙박인원");$.speRoomCnt.setAllowBlank(false,"숙박실 수");$.speSupportAmt.setAllowBlank(false,"지원총액");$.txtReviewNo.setAllowBlank(false,"심의번호");$.dteReviewDate.setAllowBlank(false,"심의일자")}function calcCPTerm(){var start_dt=extFormat($.dteStart.getText(),"yyyyMMdd").split("-");var end_dt=extFormat($.dteEnd.getText(),"yyyyMMdd").split("-");var app_dt=extFormat($.dteAppDate.getText(),"yyyyMMdd").split("-");start_dt[1]=(Number(start_dt[1])-1)+"";end_dt[1]=(Number(end_dt[1])-1)+"";app_dt[1]=(Number(app_dt[1])-1)+"";var from_dt=new Date(start_dt[0],start_dt[1],start_dt[2]);var to_dt=new Date(end_dt[0],end_dt[1],end_dt[2]);var app_dt2=new Date(app_dt[0],app_dt[1],app_dt[2]);return{val1:(to_dt.getTime()-from_dt.getTime())/1000/60/60/24,val2:(app_dt2.getTime()-from_dt.getTime())/1000/60/60/24}}function openCPContact(id){$.popUpCallId=id;var param={contact_name:""};g_main.openPopup("popCPContact.html","popCPContact","",0,0,"","",param,"","")}function clearControl(){$.panInfo.clear();$.panInfo.enableButton(["btnSave","btnTemp","btnLoad"]);$.panInfo.disableButton(["btnDelete"]);$.txtDocNo.setReadOnly(true);$.cmbEmp.setEnable(false);$.cmbStatus.setEnable(false);$.dteAppDate.setEnable(false);$.varCPId="";$.varBfCPId="";$.grdFile.clear();setControlEnable(true);setAllowBlank();$.dteStart.setValue(getToday());$.dteEnd.setValue(getToday());$.cmbEmp.setValue(g_main.session.obj.UserID);$.cmbStatus.setValue("10");$.rdoAgencyDocuYN.setValue("N");$.panInfo.disableButton(["btnDelete"]);$.panBottom.setVisible(false);$.dteStart.setEnable(true);$.dteEnd.setEnable(true);$.memCPDescr.setReadOnly(true);$.imgPicture1.setMode("N");$.imgPicture2.setMode("N");$.imgPicture3.setMode("N");$.imgPicture4.setMode("N")}function setSupportYN(){for(var i=0;i<$.grdContact.getRowCount();i++){if(Number($.grdContact.getValue(i,"food_amt"))>0){$.grdContact.setValue(i,"cp_food_yn","Y")}else{$.grdContact.setValue(i,"cp_food_yn","N")}if(Number($.grdContact.getValue(i,"gift_amt"))>0){$.grdContact.setValue(i,"cp_gift_yn","Y")}else{$.grdContact.setValue(i,"cp_gift_yn","N")}if(Number($.grdContact.getValue(i,"stay_amt"))>0){$.grdContact.setValue(i,"cp_stay_yn","Y")}else{$.grdContact.setValue(i,"cp_stay_yn","N")}if(Number($.grdContact.getValue(i,"trans_amt"))>0){$.grdContact.setValue(i,"cp_trans_yn","Y")}else{$.grdContact.setValue(i,"cp_trans_yn","N")}$.grdContact.setValue(i,"support_amt",(Number($.grdContact.getValue(i,"food_amt"))+Number($.grdContact.getValue(i,"gift_amt"))+Number($.grdContact.getValue(i,"stay_amt"))+Number($.grdContact.getValue(i,"trans_amt"))))}}function getCompanyCode(){for(var i=0;i<$.grdContact.getRowCount();i++){var strQuery=" where x.contact_id = '"+$.grdContact.getValue(i,"contact_id")+"'";var ds=bizComponentData2($,"Q4","L_CRM0292",strQuery);if($.grdContact.getValue(i,"contact_name")!=ds.resultList[0][0].contact_name){$.grdContact.setValue(i,"contact_name","X"+$.grdContact.getValue(i,"contact_name"))}else{$.grdContact.setValue(i,"contact_name",ds.resultList[0][0].contact_name)}$.grdContact.setValue(i,"company_id",ds.resultList[0][0].company_id);$.grdContact.setValue(i,"company_name",ds.resultList[0][0].company_name)}}function gridValidator(){if(arguments.length<2){return false}var grdName=arguments[0];for(var i=0;i<grdName.getRowCount();i++){for(var j=1;j<=arguments.length;j++){if(grdName.getValue(i,arguments[j])==""||grdName.getValue(i,arguments[j])==null){MessageBoxShow(grdName.getColumnText(arguments[j])+" 은(는) 필수 입력항목입니다");return false}}}return true}function searchCPInfo(workType){var json=createJSON_Q2(workType);callQuery(["req",json],"CP_INFO",$)}function searchCPData(cpFormId,cpProcName){var json=createJSON_Q2_1(cpFormId,cpProcName);callQuery(["req",json],"CP_DATA",$)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1200);$.panMain.setText("");$.panMain.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",0,0,1200,430);$.panInfo.setText("자사제품 설명회 숙박(사후)");$.panInfo.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,855,1200,200);$.panFile.setText("첨부파일");$.panFile.setBottomLine(true);$.panBottom=new FingerPanel(host,"panBottom",0,1065,1200,110);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.lblDocNo=new FingerLabel(host,"lblDocNo",25,10,100,20);$.lblDocNo.setText("문서번호");$.lblEmp=new FingerLabel(host,"lblEmp",385,10,100,20);$.lblEmp.setText("담당자");$.lblPM=new FingerLabel(host,"lblPM",720,10,100,20);$.lblPM.setText("PM");$.lblType=new FingerLabel(host,"lblType",25,40,100,20);$.lblType.setText("구분");$.lblProduct=new FingerLabel(host,"lblProduct",385,40,100,20);$.lblProduct.setText("품목");$.lblTheme=new FingerLabel(host,"lblTheme",720,40,100,20);$.lblTheme.setText("테마");$.lblCPDate=new FingerLabel(host,"lblCPDate",25,70,100,20);$.lblCPDate.setText("개최일시");$.lblWave=new FingerLabel(host,"lblWave",340,70,20,20);$.lblWave.setText("~");$.lblPlace=new FingerLabel(host,"lblPlace",25,100,100,20);$.lblPlace.setText("행사장소");$.lblStayPlace=new FingerLabel(host,"lblStayPlace",385,100,100,20);$.lblStayPlace.setText("숙박장소");$.lblAppDate=new FingerLabel(host,"lblAppDate",845,220,100,20);$.lblAppDate.setText("승인요청일");$.lblContact=new FingerLabel(host,"lblContact",25,130,100,20);$.lblContact.setText("총 참가인원");$.lblContactOrgan=new FingerLabel(host,"lblContactOrgan",215,130,40,20);$.lblContactOrgan.setText("기관");$.lblContactCnt=new FingerLabel(host,"lblContactCnt",350,130,20,20);$.lblContactCnt.setText("명");$.lblStay=new FingerLabel(host,"lblStay",385,130,100,20);$.lblStay.setText("숙박인원수");$.lblStayOrgan=new FingerLabel(host,"lblStayOrgan",575,130,40,20);$.lblStayOrgan.setText("기관");$.lblStayCnt=new FingerLabel(host,"lblStayCnt",710,130,20,20);$.lblStayCnt.setText("명");$.lblTrans=new FingerLabel(host,"lblTrans",25,160,100,20);$.lblTrans.setText("교통비(1인)");$.lblTransAmt=new FingerLabel(host,"lblTransAmt",350,160,20,20);$.lblTransAmt.setText("원");$.lblMeal=new FingerLabel(host,"lblMeal",385,160,100,20);$.lblMeal.setText("식사비(1인)");$.lblMealAmt=new FingerLabel(host,"lblMealAmt",710,160,20,20);$.lblMealAmt.setText("원");$.lblMemento=new FingerLabel(host,"lblMemento",730,130,90,20);$.lblMemento.setText("기념품(1인)");$.lblMementoAmt=new FingerLabel(host,"lblMementoAmt",1050,130,20,20);$.lblMementoAmt.setText("원");$.lblRoom=new FingerLabel(host,"lblRoom",25,190,100,20);$.lblRoom.setText("숙박비");$.lblRoom1Day=new FingerLabel(host,"lblRoom1Day",225,190,45,20);$.lblRoom1Day.setText("원/박");$.lblRoomContact=new FingerLabel(host,"lblRoomContact",325,190,20,20);$.lblRoomContact.setText("인");$.lblRoomCnt=new FingerLabel(host,"lblRoomCnt",405,190,20,20);$.lblRoomCnt.setText("실");$.lblSupport=new FingerLabel(host,"lblSupport",730,160,90,20);$.lblSupport.setText("지원총액");$.lblSupportAmt=new FingerLabel(host,"lblSupportAmt",1050,160,20,20);$.lblSupportAmt.setText("원");$.lblAgency=new FingerLabel(host,"lblAgency",25,220,100,20);$.lblAgency.setText("대행사");$.lblMementoQty=new FingerLabel(host,"lblMementoQty",415,190,130,20);$.lblMementoQty.setText("기념답례품 수량");$.txtDocNo=new FingerEdit(host,"txtDocNo",365,10,20,20);$.cmbEmp=new FingerComboBox(host,"cmbEmp",490,10,230,20);$.cmbPM=new FingerComboBox(host,"cmbPM",825,10,230,20);$.cmbStatus=new FingerComboBox(host,"cmbStatus",1080,10,105,20);$.cmbType=new FingerComboBox(host,"cmbType",130,40,230,20);$.cmbProduct=new FingerComboBox(host,"cmbProduct",490,40,230,20);$.cmbTheme=new FingerComboBox(host,"cmbTheme",825,40,230,20);$.dteStart=new FingerDateEdit(host,"dteStart",130,70,100,20);$.dteEnd=new FingerDateEdit(host,"dteEnd",365,70,100,20);$.txtPlace=new FingerEdit(host,"txtPlace",130,100,225,20);$.txtStayPlace=new FingerEdit(host,"txtStayPlace",490,100,225,20);$.dteAppDate=new FingerDateEdit(host,"dteAppDate",950,220,100,20);$.speContactOrgan=new FingerSpinEdit(host,"speContactOrgan",130,130,90,20);$.speContactCnt=new FingerSpinEdit(host,"speContactCnt",260,130,95,20);$.speStayOrgan=new FingerSpinEdit(host,"speStayOrgan",490,130,90,20);$.speStayCnt=new FingerSpinEdit(host,"speStayCnt",620,130,95,20);$.speTransAmt=new FingerSpinEdit(host,"speTransAmt",130,160,225,20);$.speMealAmt=new FingerSpinEdit(host,"speMealAmt",490,160,225,20);$.speMementoAmt=new FingerSpinEdit(host,"speMementoAmt",825,130,225,20);$.speRoomAmt=new FingerSpinEdit(host,"speRoomAmt",130,190,100,20);$.speRoomContact=new FingerSpinEdit(host,"speRoomContact",270,190,60,20);$.speRoomCnt=new FingerSpinEdit(host,"speRoomCnt",350,190,60,20);$.speSupportAmt=new FingerSpinEdit(host,"speSupportAmt",825,160,225,20);$.txtAgency=new FingerEdit(host,"txtAgency",130,220,585,20);$.speMementoQty=new FingerSpinEdit(host,"speMementoQty",560,190,155,20);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,1200,155);$.btnConfirm=new FingerButton(host,"btnConfirm",10,5,120,45);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",10,55,120,45);$.btnCancel.setText("승인취소");$.btnMemoSave=new FingerButton(host,"btnMemoSave",905,5,90,95);$.btnMemoSave.setText("메모저장");$.btnReportYnSave=new FingerButton(host,"btnReportYnSave",985,5,120,20);$.btnReportYnSave.setText("신고상태저장");$.btnSeminarCancel=new FingerButton(host,"btnSeminarCancel",985,75,120,20);$.btnSeminarCancel.setText("개최취소");$.memCPDescr=new FingerMemoEdit(host,"memCPDescr",115,1070,780,90);$.chkReportYN=new FingerCheckBox(host,"chkReportYN",985,40,115,20);$.chkReportYN.setText("협회신고");$.lblReviewNo=new FingerLabel(host,"lblReviewNo",720,70,100,20);$.lblReviewNo.setText("심의번호");$.lblReviewDate=new FingerLabel(host,"lblReviewDate",720,100,100,20);$.lblReviewDate.setText("심의일자");$.txtReviewNo=new FingerEdit(host,"txtReviewNo",825,70,225,20);$.dteReviewDate=new FingerDateEdit(host,"dteReviewDate",825,100,225,20);$.imgPicture1=new FingerImage(host,"imgPicture1",130,255,200,110);$.imgPicture2=new FingerImage(host,"imgPicture2",340,255,200,110);$.imgPicture3=new FingerImage(host,"imgPicture3",550,255,200,110);$.imgPicture4=new FingerImage(host,"imgPicture4",760,255,200,110);$.panContact=new FingerPanel(host,"panContact",0,435,1200,410);$.panContact.setText("자사제품설명회 참석자 - 사후");$.panContact.setBottomLine(true);$.grdContact=new FingerDataGrid(host,"grdContact",0,0,1200,365);$.btnUpload=new FingerButton(host,"btnUpload",655,-40,120,30);$.btnUpload.setText("동의서 업로드");$.btnView=new FingerButton(host,"btnView",765,-40,120,30);$.btnView.setText("동의서 보기");$.btnUploadList=new FingerButton(host,"btnUploadList",365,-40,150,30);$.btnUploadList.setText("참석자 일괄 업로드");$.btnMAConfirm=new FingerButton(host,"btnMAConfirm",1095,5,120,45);$.btnMAConfirm.setText("MA승인");$.btnMACancel=new FingerButton(host,"btnMACancel",1095,55,120,45);$.btnMACancel.setText("MA승인취소");$.cboFromHH=new FingerComboBox(host,"cboFromHH",235,70,55,20);$.cboFromMM=new FingerComboBox(host,"cboFromMM",295,70,55,20);$.cboToHH=new FingerComboBox(host,"cboToHH",470,70,55,20);$.cboToMM=new FingerComboBox(host,"cboToMM",535,70,55,20);$.lblcolon1=new FingerLabel(host,"lblcolon1",275,70,20,20);$.lblcolon1.setText(":");$.lblcolon2=new FingerLabel(host,"lblcolon2",515,70,20,20);$.lblcolon2.setText(":");$.btnBatchUpload=new FingerButton(host,"btnBatchUpload",505,-40,160,30);$.btnBatchUpload.setText("동의서 일괄 업로드");$.txtCPId=new FingerEdit(host,"txtCPId",130,10,225,20);$.lblImage=new FingerLabel(host,"lblImage",20,300,100,20);$.lblImage.setText("진행사진");$.lblAgencyDocuYN=new FingerLabel(host,"lblAgencyDocuYN",725,190,200,20);$.lblAgencyDocuYN.setText("대행사 지출 관련 서류 보관 자료");$.rdoAgencyDocuYN=new FingerRadioBox(host,"rdoAgencyDocuYN",940,190,110,20);$.btnViewBfCP=new FingerButton(host,"btnViewBfCP",1080,45,120,30);$.btnViewBfCP.setText("사전CP보기");$.panInfo.addButtons(["btnLoad","btnDelete","btnTemp","btnSave","btnNew"]);$.panContact.addButtons(["btnDelete","btnAdd"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.grdFile.setColumns([new FingerDataGridColumn("file_type",300,"left","string","자료유형"),new FingerDataGridColumn("seq",99,"left","string","연번",{hidden:true}),new FingerDataGridColumn("server_path",99,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("server_fname",99,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("local_fname",880,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]})]);$.grdFile.init({panel:$.panFile,scroll:"xy",isFilter:false,nonExcel:true});$.grdFile.setEditable(true);$.grdFile.setBorder(false);$.grdContact.setColumns([new FingerDataGridColumn("contact_id",99,"left","string","참석자ID",{readonly:true}),new FingerDataGridColumn("contact_name",100,"left","string","참석자",{readonly:true}),new FingerDataGridColumn("company_id",99,"left","string","소속ID",{readonly:true}),new FingerDataGridColumn("company_name",230,"left","string","소속",{readonly:true}),new FingerDataGridColumn("support_amt",110,"right","string","총 지원금액",{readonly:true,format:"int"}),new FingerDataGridColumn("cp_food_yn",70,"center","checkbox","식음료 유무",{readonly:true}),new FingerDataGridColumn("food_amt",90,"right","string","식음료비",{format:"int"}),new FingerDataGridColumn("cp_gift_yn",70,"center","checkbox","기념품 유무",{readonly:true}),new FingerDataGridColumn("gift_amt",90,"right","string","기념품비",{format:"int"}),new FingerDataGridColumn("cp_stay_yn",70,"center","checkbox","숙박비 유무",{readonly:true}),new FingerDataGridColumn("stay_amt",90,"right","string","숙박비",{format:"int"}),new FingerDataGridColumn("cp_trans_yn",70,"center","checkbox","교통비 유무",{readonly:true}),new FingerDataGridColumn("trans_amt",90,"right","string","교통비",{format:"int"}),new FingerDataGridColumn("upload_yn",120,"center","string","동의서",{readonly:true}),new FingerDataGridColumn("file_path",120,"center","string","동의서 파일 경로",{hidden:true}),new FingerDataGridColumn("file_name",120,"center","string","동의서 파일명",{hidden:true})]);$.grdContact.init({panel:$.panContact,scroll:"xy"});$.grdContact.setEditable(true);$.grdContact.setBorder(false);$.txtDocNo.setVisible(false);$.txtCPId.setReadOnly(true);$.cmbEmp.setEnable(false);$.cmbStatus.setEnable(false);$.dteAppDate.setEnable(false);$.cmbEmp.setEmptyRow(true);$.cmbPM.setEmptyRow(true);$.cmbStatus.setEmptyRow(true);$.cmbType.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbTheme.setEmptyRow(true);$.imgGroup=new FingerImageGroup([$.imgPicture1,$.imgPicture2,$.imgPicture3,$.imgPicture4]);$.imgPicture1.setMode("N");$.imgPicture2.setMode("N");$.imgPicture3.setMode("N");$.imgPicture4.setMode("N");$.imgPicture1.setZooming(true);$.imgPicture2.setZooming(true);$.imgPicture3.setZooming(true);$.imgPicture4.setZooming(true);$.btnMAConfirm.setVisible(false);$.btnMACancel.setVisible(false);$.rdoAgencyDocuYN.addButtons([{code_name:"있음",sub_code:"Y"},{code_name:"없음",sub_code:"N"}]);setAllowBlank("left");$.dteAppDate.setValue(getToday(""));$.host=host;$.args=args};$.start=function(){$.panMain.add($.panInfo);$.panMain.add($.panFile);$.panMain.add($.panBottom);$.panMain.add($.memCPDescr);$.panMain.add($.panContact);$.panInfo.add($.lblDocNo);$.panInfo.add($.lblEmp);$.panInfo.add($.lblPM);$.panInfo.add($.lblType);$.panInfo.add($.lblProduct);$.panInfo.add($.lblTheme);$.panInfo.add($.lblCPDate);$.panInfo.add($.lblWave);$.panInfo.add($.lblPlace);$.panInfo.add($.lblStayPlace);$.panInfo.add($.lblAppDate);$.panInfo.add($.lblContact);$.panInfo.add($.lblContactOrgan);$.panInfo.add($.lblContactCnt);$.panInfo.add($.lblStay);$.panInfo.add($.lblStayCnt);$.panInfo.add($.lblTrans);$.panInfo.add($.lblTransAmt);$.panInfo.add($.lblMeal);$.panInfo.add($.lblMealAmt);$.panInfo.add($.lblMemento);$.panInfo.add($.lblMementoAmt);$.panInfo.add($.lblRoom);$.panInfo.add($.lblRoom1Day);$.panInfo.add($.lblRoomContact);$.panInfo.add($.lblRoomCnt);$.panInfo.add($.lblSupport);$.panInfo.add($.lblSupportAmt);$.panInfo.add($.lblAgency);$.panInfo.add($.lblMementoQty);$.panInfo.add($.txtDocNo);$.panInfo.add($.cmbEmp);$.panInfo.add($.cmbPM);$.panInfo.add($.cmbStatus);$.panInfo.add($.cmbType);$.panInfo.add($.cmbProduct);$.panInfo.add($.cmbTheme);$.panInfo.add($.dteStart);$.panInfo.add($.dteEnd);$.panInfo.add($.txtPlace);$.panInfo.add($.txtStayPlace);$.panInfo.add($.dteAppDate);$.panInfo.add($.speContactOrgan);$.panInfo.add($.speContactCnt);$.panInfo.add($.speStayOrgan);$.panInfo.add($.speStayCnt);$.panInfo.add($.speTransAmt);$.panInfo.add($.speMealAmt);$.panInfo.add($.speMementoAmt);$.panInfo.add($.speRoomAmt);$.panInfo.add($.speRoomContact);$.panInfo.add($.speRoomCnt);$.panInfo.add($.speSupportAmt);$.panInfo.add($.txtAgency);$.panInfo.add($.speMementoQty);$.panInfo.add($.lblStayOrgan);$.panInfo.add($.lblReviewNo);$.panInfo.add($.lblReviewDate);$.panInfo.add($.txtReviewNo);$.panInfo.add($.dteReviewDate);$.panInfo.add($.imgPicture1);$.panInfo.add($.imgPicture2);$.panInfo.add($.imgPicture3);$.panInfo.add($.imgPicture4);$.panInfo.add($.cboFromHH);$.panInfo.add($.cboFromMM);$.panInfo.add($.cboToHH);$.panInfo.add($.cboToMM);$.panInfo.add($.lblcolon1);$.panInfo.add($.lblcolon2);$.panInfo.add($.txtCPId);$.panInfo.add($.lblImage);$.panInfo.add($.lblAgencyDocuYN);$.panInfo.add($.rdoAgencyDocuYN);$.panInfo.add($.btnViewBfCP);$.panFile.add($.grdFile);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnCancel);$.panBottom.add($.btnMemoSave);$.panBottom.add($.btnReportYnSave);$.panBottom.add($.btnSeminarCancel);$.panBottom.add($.chkReportYN);$.panBottom.add($.btnMAConfirm);$.panBottom.add($.btnMACancel);$.panContact.add($.grdContact);$.panContact.add($.btnUpload);$.panContact.add($.btnView);$.panContact.add($.btnUploadList);$.panContact.add($.btnBatchUpload);$.cmbEmp.setColumn("employee_id","emp_name");$.cmbPM.setColumn("employee_id","emp_name");$.cmbProduct.setColumn("product_code","product_name");var ds=bizComponentData2($,"Q1","L_CRM0052|L_CRM192|L_CRM0111|L_CRM0161|L_CRM0131");setComboBind([$.cmbEmp,$.cmbPM,$.cmbStatus,$.cmbType,$.cmbProduct],ds);$.cmbEmp.setValue(g_main.session.obj.UserID);var ds=bizComponentData2($,"Q4","L_CRM0110"," and (extra_field1 LIKE '%CP22%' or extra_field1 = 'ALL')");$.grdFile.setColumnDropDownList("file_type",ds.resultList[0],null,true);var ds=bizComponentData2($,"Q1","L_COM017|L_COM018|L_COM017|L_COM018");setComboBind([$.cboFromHH,$.cboFromMM,$.cboToHH,$.cboToMM],ds);clearControl();if($.p_argument&&$.p_argument.length>0){setControlEnable(false);$.panInfo.enableButton(["btnNew","btnLoad"]);var rs=$.p_argument[0][0];$.varCPId=rs.cp_id;$.varPopupType="Y";$.varBfCPId=rs.before_cp_id;$.txtDocNo.setValue(rs.cp_doc_no);$.cmbEmp.setValue(rs.cp_emp_id);$.cmbPM.setValue(rs.cp_emp_pm);$.cmbStatus.setValue(rs.cp_status);$.cmbType.setValue(rs.seminar_type);$.cmbProduct.setValue(rs.product_code);if(rs.report_theme){var ds=bizComponentData2($,"Q3","L_CRM0107",rs.product_code);setComboBind([$.cmbTheme],ds);$.cmbTheme.setValue(rs.report_theme)}$.txtCPId.setValue(rs.cp_id);$.dteStart.setValue(rs.cp_start_date);$.cboFromHH.setValue(rs.cp_start_date_hh);$.cboFromMM.setValue(rs.cp_start_date_mm);$.dteEnd.setValue(rs.cp_end_date);$.cboToHH.setValue(rs.cp_end_date_hh);$.cboToMM.setValue(rs.cp_end_date_mm);$.txtPlace.setValue(rs.cp_place);$.txtStayPlace.setValue(rs.cp_stay_place);$.dteAppDate.setValue(rs.app_date);$.speContactOrgan.setValue(rs.contact_organ_cnt);$.speContactCnt.setValue(rs.contact_cnt);$.speStayOrgan.setValue(rs.stay_organ_cnt);$.speStayCnt.setValue(rs.stay_cnt);$.speTransAmt.setValue(rs.trans_cost_each_amt);$.speMealAmt.setValue(rs.meal_each_amt);$.speMementoAmt.setValue(rs.memento_each_amt);$.speRoomAmt.setValue(rs.room_1day_amt);$.speRoomContact.setValue(rs.room_contact_cnt);$.speRoomCnt.setValue(rs.room_cnt);$.speSupportAmt.setValue(rs.support_total);$.txtAgency.setValue(rs.agency);$.speMementoQty.setValue(rs.memento_qty);$.memCPDescr.setValue(rs.cp_descr);$.txtReviewNo.setValue(rs.review_no);$.dteReviewDate.setValue(rs.review_date);$.chkReportYN.setValue(rs.report_yn);$.rdoAgencyDocuYN.setValue(rs.agency_docu_yn);if(rs.cp_picture1){$.imgPicture1.setValue(rs.cp_picture1)}if(rs.cp_picture2){$.imgPicture2.setValue(rs.cp_picture2)}if(rs.cp_picture3){$.imgPicture3.setValue(rs.cp_picture3)}if(rs.cp_picture4){$.imgPicture4.setValue(rs.cp_picture4)}if(rs.Confirm){$.panBottom.setVisible(true);$.memCPDescr.setReadOnly(false)}else{$.panBottom.setVisible(false)}if(rs.save_yn=="N"){setControlEnable(false);$.panInfo.disableButton(["btnSave","btnDelete","btnTemp"]);$.panContact.disableButton(["btnDelete","btnAdd"]);$.btnUpload.setEnable(false);$.imgPicture1.setMode("R");$.imgPicture2.setMode("R");$.imgPicture3.setMode("R");$.imgPicture4.setMode("R");$.btnUploadList.setEnable(false);$.btnBatchUpload.setEnable(false)}else{if(rs.save_yn="Y"){setControlEnable(true);$.panInfo.enableButton(["btnSave","btnDelete","btnTemp"]);$.panContact.enableButton(["btnDelete","btnAdd"]);if(!$.imgPicture1.getValue()){$.imgPicture1.setMode("N")}if(!$.imgPicture2.getValue()){$.imgPicture2.setMode("N")}if(!$.imgPicture3.getValue()){$.imgPicture3.setMode("N")}if(!$.imgPicture4.getValue()){$.imgPicture4.setMode("N")}}}setDataGrid([$.grdContact],$.p_argument[1],true);setDataGrid([$.grdFile],$.p_argument[2],true);if(rs.cp_status=="10"){$.btnConfirm.setEnable(true)}else{if(rs.cp_status=="90"){$.btnConfirm.setEnable(false);$.btnCancel.setEnable(true);$.panInfo.disableButton(["btnTemp"]);$.btnUpload.setEnable(false);$.btnUploadList.setEnable(false);$.btnBatchUpload.setEnable(false);$.grdContact.setEditable(false);if(g_main.session.getValue("EmpCode")=="ka951012"){$.panBottom.setVisible(true);$.btnConfirm.setVisible(false);$.btnCancel.setVisible(false);$.btnMemoSave.setVisible(false);$.btnReportYnSave.setVisible(false);$.btnSeminarCancel.setVisible(false);$.chkReportYN.setVisible(false);$.btnMAConfirm.setVisible(true);$.btnMACancel.setVisible(true)}}else{if(rs.cp_status=="01"){setControlEnable(true);$.panInfo.enableButton(["btnSave","btnTemp","btnDelete"])}}}var value=calcCPTerm();$.speTerm.setValue(value.val1+1);$.lblLabel3.setText("현재 개최일로부터 "+value.val2+"일 전입니다.")}else{$.dteAppDate.setValue(getToday());$.memCPDescr.setVisible(false)}};$.callback=function(type,ds){if(type=="N"||type=="NT"){if(ds.errorCode.substr(0,1)!="E"&&ds.errorCode.substr(0,1)!="P"){var rStr=ds.returnStr.split("|");$.varCPId=rStr[0];$.txtCPId.setValue(rStr[0]);$.txtDocNo.setValue(rStr[1]);MessageBoxShow("정상적으로 저장되었습니다.");if($.varPopupType=="Y"){g_popupStack.close()}}else{MessageBoxShow("저장시 오류가 발생하였습니다.\n관리자에게 문의하여 주시기 바랍니다.");return}}else{if(type=="U"||type=="UT"){console.log(JSON.stringify(ds));if(ds.errorCode.substr(0,1)!="E"&&ds.errorCode.substr(0,1)!="P"){MessageBoxShow("정상적으로 저장되었습니다.");if($.varPopupType=="Y"){g_popupStack.close()}}else{MessageBoxShow("저장시 오류가 발생하였습니다.\n관리자에게 문의하여 주시기 바랍니다.");return}}else{if(type=="D"){var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}else{if(type=="CP_INFO"){$.varFormId=ds.resultList[0][0]["cp_form_id"];$.cp_name=ds.resultList[0][0]["cp_name"];$.varFormHeightSize=Number(ds.resultList[0][0]["form_height"]);$.varFormWidthSize=Number(ds.resultList[0][0]["form_width"]);var cpFormId=ds.resultList[0][0]["cp_form_id"];var cpProcName=ds.resultList[0][0]["query_name"];searchCPData(cpFormId,cpProcName)}else{if(type=="CP_DATA"){if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;param[0][0].CallType="BUCall";param[0][0].Confirm=false;param[0][0].cp_descr=param.cp_desc;param[0][0].cp_status="90";param[0][0].save_yn="N";var popName=$.varFormId;var popHtml=popName+".html";g_main.openPopup(popHtml,popName,$.cp_name,$.varFormWidthSize,$.varFormHeightSize,"","",param,"","")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnFileDown"){var rId=$.grdFile.getSelectedRowIdx();var download_url=("/ServerFiles/CPFiles/"+$.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"));g_fileBrowser.download(download_url)}else{if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMemoSave"){var share={save_mode:"MEMO",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnReportYnSave"){if(saveExtraFunction("REPORT")){MessageBoxShow("정상적으로 저장되었습니다.");return}}else{if(id=="btnSeminarCancel"){confirmBoxShow("개최취소 처리하시겠습니까?",function(){if(g_main.msgShare==true){if(saveExtraFunction("CANCEL")){MessageBoxShow("정상적으로 저장되었습니다.");return}}})}else{if(id=="btnUpload"){if($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"contact_id").substr(0,2)!="ka"){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"file_path",ds.resultList[0][0].server_path);$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"file_name",ds.resultList[0][0].server_fname);$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"upload_yn","Y")})}}else{if(id=="btnView"){if($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"upload_yn")=="Y"){g_fileBrowser.download(getServerFileUrl($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"file_path")+$.grdContact.getValue($.grdContact.getSelectedRowIdx(),"file_name")))}}else{if(id=="btnUploadList"){$.grdContact.clear();$.popUpCallId=id;var param={};param.placeHolder="내용만 복사해서 붙여넣으세요.";param.cId=["contact_id","contact_name","food_amt","stay_amt","trans_amt"];g_main.openPopup("popPaste.html","popPaste","엑셀자료삽입",600,355,"","",param,"","")}else{if(id=="btnMAConfirm"){var share={save_mode:"MACONFIRM",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMACancel"){var share={save_mode:"MACANCEL",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnBatchUpload"){if($.grdContact.getRowCount()<1){MessageBoxShow("고객이 추가 되어야 업로드가 가능합니다.");return}OpenPdfFileUploader("CPFiles",function(ds){hideToast();if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}if(ds.resultList[0]&&ds.resultList[0].length){var param="";$.popUpCallId="btnUpload";if(ds.resultList[0].length>1){var fileArray=ds.resultList[0];var imgUrlList=[],imgNameList=[];for(var i=0;i<fileArray.length;i++){imgUrlList.push(fileArray[i].file_url);imgNameList.push(fileArray[i].server_fname)}param={imgUrlList:imgUrlList,imgNameList:imgNameList,contactList:$.grdContact.getAllRows(),serverPath:fileArray[0].server_path}}else{var fileList=ds.resultList[0][0];param={imgUrlList:fileList.img_url_list,imgNameList:fileList.img_name_list,contactList:$.grdContact.getAllRows(),serverPath:fileList.server_path}}g_main.openPopup("popCPAgreementImgView.html","popCPAgreementImgView","",0,0,"","",param,"","")}})}else{if(id=="btnViewBfCP"){if($.varBfCPId!=""){var sql="SELECT cp_type FROM crmCPMaster WHERE cp_id = '"+$.varBfCPId+"'";var ds=commExecuteSQL(sql);$.popUpCallId=id;var param="";$.cp_code=ds.resultList[0][0].cp_type;searchCPInfo("FORM")}}}}}}}}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbProduct"){$.cmbTheme.clear();if(!value){return}var ds=bizComponentData2($,"Q3","L_CRM0107",value);setComboBind([$.cmbTheme],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteStart"||id=="dteEnd"){if($.dteStart.getValue()==""||$.dteEnd.getValue()==""){return}if($.dteStart.getValue()>$.dteEnd.getValue()){if(id=="dteStart"){$.dteEnd.setValue(value)}else{$.dteStart.setValue(value)}return}var value=calcCPTerm();$.speTerm.setValue(value.val1+1);$.lblLabel3.setText("현재 개최일로부터 "+value.val2+"일 전입니다.")}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdContact"){if(cInd=="gift_amt"){$.grdContact.setValue(rId,"gift_amt",0)}setSupportYN()}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="speContactCnt"||id=="speStayCnt"||id=="speTransAmt"||id=="speMealAmt"||id=="speRoomAmt"||id=="speMementoAmt"){calcSupportAmt()}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnNew"){clearControl()}else{if(btnId=="btnSave"){if(!$.varBfCPId){MessageBoxShow("사전 데이터가 없습니다.");return}if(!validateControls([$.cmbEmp,$.cmbPM,$.cmbType,$.cmbProduct,$.dteStart,$.dteEnd,$.cboFromHH,$.cboFromMM,$.cboToHH,$.cboToMM,$.txtReviewNo,$.speTerm,$.txtPlace,$.txtStayPlace,$.dteReviewDate,$.dteAppDate,$.memTarget,$.speContactOrgan,$.speContactCnt,$.speStayOrgan,$.speStayCnt,$.speTransAmt,$.speMealAmt,$.rdoAgencyDocuYN,$.speRoomAmt,$.speRoomContact,$.speRoomCnt,$.speSupportAmt,$.txtReviewNo,$.dteReviewDate,$.memCPDesc])){return}if(!gridValidator($.grdContact,"contact_id","company_id","support_amt")){return}if(!$.imgPicture1.getValue()&&!$.imgPicture2.getValue()&&!$.imgPicture3.getValue()&&!$.imgPicture4.getValue()){MessageBoxShow("최소한 하나의 영수증 사진이<br>등록되어야 합니다.");return}var userId=g_main.session.obj.UserID;if($.varBfCPId==""){MessageBoxShow("사전 데이터가 없습니다.");return}else{if($.dteAppDate.getValue()<$.dteEnd.getValue()){MessageBoxShow("승인요청일이 개최일시보다 빠를 수 없습니다.");return}}var dt=calcCPTerm();if(dt.val2<0||dt.val2>30){MessageBoxShow("승인요청일은 개최일로부터 30일 이내에만 신청 가능합니다.");return}if($.cboFromHH.getValue()=="00"||$.cboToHH.getValue()=="00"){MessageBoxShow("시각이 올바르게 설정되지 않았습니다.");return}saveSeminar($.varCPId!=""?"U":"N")}else{if(btnId=="btnDelete"){if($.varCPId==""){return}confirmBoxShow("["+$.txtDocNo.getValue()+"] 자사제품설명회 숙박(사후)을(를) 삭제하시겠습니까?",function(){if(g_main.msgShare==true){saveSeminar("D")}})}else{if(btnId=="btnTemp"){if(!$.varBfCPId){MessageBoxShow("사전 데이터가 없습니다.");return}if($.varBfCPId==""){MessageBoxShow("사전 데이터가 없습니다.");return}if(saveSeminar($.varCPId!=""?"UT":"NT")){MessageBoxShow("정상적으로 저장되었습니다.");if($.varPopupType=="Y"){g_popupStack.close()}}}else{if(btnId=="btnLoad"){$.popUpCallId="btnLoad";var param={};g_main.openPopup("popCPSeminarStAf.html","popCPSeminarStAf","",0,0,"","",param,"","")}}}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){fileList[i].file_type="";for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(fileList)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panContact"){if(btnId=="btnAdd"){$.popUpCallId="contact_btnAdd";var param={contact_name:"",check_yn:"Y"};g_main.openPopup("popCPContact.html","popCPContact","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){$.grdContact.deleteCurrentRow()}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult!=null){if(id=="popCPSeminarStAf"){if($.popUpCallId=="btnLoad"){clearControl();$.dteStart.setEnable(false);$.dteEnd.setEnable(false);var rs=popResult.rowData[0];$.varBfCPId=rs.cp_id;$.cmbEmp.setValue(rs.cp_emp_id);$.cmbPM.setValue(rs.cp_emp_pm);$.cmbStatus.setValue("10");$.cmbType.setValue(rs.seminar_type);$.cmbProduct.setValue(rs.product_code);if(rs.report_theme!=""){$.cmbTheme.clear();var ds=bizComponentData2($,"Q3","L_CRM0107",rs.product_code);setComboBind([$.cmbTheme],ds);$.cmbTheme.setValue(rs.report_theme)}$.dteStart.setValue(rs.cp_start_date);$.dteEnd.setValue(rs.cp_end_date);$.txtPlace.setValue(rs.cp_place);$.txtStayPlace.setValue(rs.cp_stay_place);$.dteAppDate.setValue(getToday(""));$.speContactOrgan.setValue(rs.contact_organ_cnt);$.speContactCnt.setValue(rs.contact_cnt);$.speStayOrgan.setValue(rs.stay_organ_cnt);$.speStayCnt.setValue(rs.stay_cnt);$.speTransAmt.setValue(rs.trans_cost_each_amt);$.speMealAmt.setValue(rs.meal_each_amt);$.speMementoAmt.setValue(rs.memento_each_amt);$.speRoomAmt.setValue(rs.room_1day_amt);$.speRoomContact.setValue(rs.room_contact_cnt);$.speRoomCnt.setValue(rs.room_cnt);$.speSupportAmt.setValue(rs.support_total);$.txtAgency.setValue(rs.agency);$.speMementoQty.setValue(rs.memento_qty);$.memCPDescr.setValue(rs.cp_descr);if(popResult.fileData){log(popResult.fileData);var fData=popResult.fileData;var fData2=[];for(var i in fData){if(fData[i].file_type=="021"){fData2.push(fData[i])}}setDataGrid([$.grdFile],fData2,true)}}}else{if(id=="popPaste"){if($.popUpCallId=="btnUploadList"){if(popResult!=null){$.grdContact.addRows(popResult.paste);var rowCount=$.grdContact.getRowCount();$.grdContact.setDisplayPanelRowCount(rowCount)}}for(var i=0;i<$.grdContact.getRowCount();i++){$.grdContact.setValue(i,"gift_amt",0);$.grdContact.setValue(i,"upload_yn","N");$.grdContact.setValue(i,"file_path"," ");$.grdContact.setValue(i,"file_name"," ")}setSupportYN();getCompanyCode()}else{if(id=="popCPAgreementImgView"){webix.alert({ok:"확인",text:'동의서에 대한 의료인 연결이 완료 되었습니다.<br>실제 동의서는 "저장"시에 최종 저장됩니다.',width:"290px"});var dt=popResult.saveContactList;if(dt.length){for(var i=0;i<dt.length;i++){for(var j=0;j<$.grdContact.getRowCount();j++){var rowData=$.grdContact.getValue(j);if(dt[i].contactId==rowData.contact_id){$.grdContact.setValue(j,"file_path",dt[i].serverPath);$.grdContact.setValue(j,"file_name",dt[i].fileName);$.grdContact.setValue(j,"upload_yn","Y")}}}}}else{if(id=="popCPContact"){if($.popUpCallId=="contact_btnAdd"){var popRows=popResult.popRows;if($.grdContact.getRowCount()>0){var aRow=$.grdContact.getAllRows();for(var i in aRow){for(var j in popRows){if(aRow[i].contact_id==popRows[j].contact_id){MessageBoxShow("이미 추가된 참석자가 있습니다.");return}}}}for(var i in popRows){$.grdContact.addRow({contact_id:popRows[i].contact_id,contact_name:popRows[i].contact_name,company_id:popRows[i].company_id,company_name:popRows[i].company_name,cp_food_yn:"N",food_amt:0,cp_gift_yn:"N",gift_amt:0,cp_stay_yn:"N",stay_amt:0,cp_trans_yn:"N",trans_amt:0,support_amt:0,upload_yn:"N",file_path:" ",file_name:" "})}}}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>