<script>function Main(){var $=this;$.host=null;$.panTop=null;$.panDelivery=null;$.panResult=null;$.grdDelivery=null;$.grdResult=null;$.tabMain=null;$.panMain=null;$.lblFy=null;$.dteFy=null;$.lblVersion=null;$.cmbVersion=null;$.lblBrand=null;$.mtBrand=null;$.btnSearch=null;$.btnExcelDownload=null;$.btnExcelUpload=null;$.searchWorkType="Q_D";$.saveWorkType="N_D";$.excelFormColumns=[];$.excelRows=[];$.isExcelUpload=false;$.popData=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_bgtMappingTable_Q",[workType,($.dteFy.getValue()||""),"","","","","","","","","","","","",0,"#UserID#"]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_bgtUnitPriceManager_Q",[workType,($.dteFy.getValue()||""),($.cmbVersion.getValue()||""),($.mtBrand.getSelectedCodeList()||""),"#UserID#"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_bgtBudgetFCSTExcelForm_Q",[workType,($.cmbVersion.getValue()||""),($.mtBrand.getSelectedCodeList()||"")]);return json}function createJSON_S(workType){var gridId=getEnabledGridId();var dt=gridId.getAllRows();var json="";var rows=[];for(var i in dt){var rowData=dt[i];rows.push([$.saveWorkType,rowData.ver_code,rowData.product_code,getSaveRowData(gridId,i),"#UserID#"])}json=createExecuteParamInfo("P_bgtUnitPriceManager_S",rows);return json}function searchBudgetVersion(workType){var json=createJSON_Q(workType);callQuery(["req",json],"UNIT_PRICE_VERSION",$)}function searchList(workType){var json=createJSON_Q1(workType);callQuery(["req",json],"UNIT_PRICE_LIST"+workType,$)}function searchBrand(workType){var json=createJSON_Q1(workType);callQuery(["req",json],"UNIT_PRICE_BRAND",$)}function searchFCST(workType){var json=createJSON_Q1(workType);var ds=callQuerySync(["req",json],"UNIT_PRICE_FCST");return ds}function downloadExcelForm(workType){var json=createJSON_Q2(workType);excelDownload(["req",json],"납품_소화단가 양식.xlsx")}function saveList(workType){var json=createJSON_S(workType);callExecute(["req",json],"UNIT_PRICE_SAVE",$)}function getFYDate(){var nowDate=getToday();var year=Number(nowDate.substr(0,4));var month=Number(nowDate.substr(4,2));if(month<4){$.dteFy.setValue(year-1)}else{$.dteFy.setValue(year)}}function renderExcelData(dt){var gridId=getEnabledGridId();var cols=resetGridColumns($.excelFormColumns);var data=[];gridId.resetColumns(cols);for(var i=0;i<$.excelRows.length;i++){var rowData=$.excelRows[i];for(var j=0;j<dt.length;j++){var excelRowData=dt[j];if(rowData.product_code==excelRowData.product_code){excelRowData.ver_code=$.cmbVersion.getValue();rowData=excelRowData}}data.push(rowData)}setDataGrid([gridId],data,true)}function renderSearchData(ds,gridId){var colList=ds.resultList[0];var cols=resetGridColumns(colList,gridId);var dt=ds.resultList[1];gridId.resetColumns(cols);if($.isExcelUpload){matchingExcelData(dt);setDataGrid([gridId],dt,true);$.isExcelUpload=false;$.popData=[]}else{setDataGrid([gridId],dt,true)}}function matchingExcelData(dt){for(var i=0;i<dt.length;i++){for(var j=0;j<$.popData.length;j++){var popData=$.popData[j];if(dt[i].product_code==popData.product_code){var obj=Object.keys(popData);for(var k=0;k<obj.length;k++){if(obj[k].indexOf("ym")>-1&&popData[obj[k]]&&popData[obj[k]]!="-"){popData[obj[k]]=Number(popData[obj[k]].replace(",",""))}}popData.ver_code=$.cmbVersion.getValue();dt[i]=jQuery.extend(false,dt[i],popData)}}}}function resetGridColumns(colList,id){var gridId=(id||getEnabledGridId());gridId.removeColumns();var cols=[];var iCount=1;cols.push(new FingerDataGridColumn("parent_product_short_name",100,"center","string","제품명",{readonly:true}));cols.push(new FingerDataGridColumn("product_name",140,"center","string","제형 및 규격",{readonly:true}));cols.push(new FingerDataGridColumn("product_code",100,"center","string","제품코드",{readonly:true}));for(var i=0;i<colList.length;i++){var rowData=colList[i];var columnId="ym"+iCount;var columnTxt=filteringData("DATE",rowData.ym);cols.push(new FingerDataGridColumn(columnId,76,"right","int",columnTxt,{format:"int"}));iCount++}return cols}function getEnabledGridId(){var gridId="";if($.tabMain.getActiveTab()==1){gridId=$.grdResult}else{gridId=$.grdDelivery}return gridId}function filteringData(type,value){var str="";if(type=="DATE"){var yyyy=value.substr(2,2);var mm=value.substr(4,2);if(mm=="YR"){mm=""}else{mm=Number(mm)+"월"}str="'"+yyyy+"년 "+mm}return str}function saveChk(gridId){if(!gridId.getRowCount()){MessageBoxShow("저장할 내역이 없습니다.");return false}return true}function getSaveRowData(gridId,rowNum){var rowData=gridId.getValue(rowNum);var obj=Object.keys(rowData);var str="";for(var j=0;j<obj.length;j++){if(obj[j].indexOf("ym")>-1){str+=(rowData[obj[j]]||"")+"|"}}return str.substr(0,str.length-1)}function brandChk(){var brandList=($.mtBrand.getSelectedCodeList()||"");if(!brandList){MessageBoxShow("브랜드를 선택해 주세요.");return false}return true}function allTabSearch(){searchList("Q_R");searchList("Q_D")}$.init=function(host,args){$.panTop=new FingerPanel(host,"panTop",0,0,1200,180);$.panTop.setText("");$.panTop.setBottomLine(true);$.panDelivery=new FingerPanel(host,"panDelivery",0,0,1198,600);$.panDelivery.setText("납품단가");$.panDelivery.setBottomLine(true);$.panResult=new FingerPanel(host,"panResult",0,0,1198,600);$.panResult.setText("소화단가");$.panResult.setBottomLine(true);$.grdDelivery=new FingerDataGrid(host,"grdDelivery",0,0,1198,555);$.grdResult=new FingerDataGrid(host,"grdResult",0,0,1198,555);$.tabMain=new FingerTab(host,"tabMain",0,190,1200,640);$.panMain=new FingerPanel(host,"panMain",0,0,1200,865);$.panMain.setText("");$.panMain.setBottomLine(true);$.lblFy=new FingerLabel(host,"lblFy",0,15,100,20);$.lblFy.setText("기준FY");$.dteFy=new FingerDateEdit(host,"dteFy",105,15,140,20);$.lblVersion=new FingerLabel(host,"lblVersion",255,15,100,20);$.lblVersion.setText("예산버전");$.cmbVersion=new FingerComboBox(host,"cmbVersion",360,15,140,20);$.lblBrand=new FingerLabel(host,"lblBrand",500,15,100,20);$.lblBrand.setText("브랜드");$.mtBrand=new FingerMultiSelect(host,"mtBrand",605,15,225,150);$.btnSearch=new FingerButton(host,"btnSearch",870,15,80,20);$.btnSearch.setText("조회");$.btnExcelDownload=new FingerButton(host,"btnExcelDownload",975,15,120,20);$.btnExcelDownload.setText("양식다운로드");$.btnExcelUpload=new FingerButton(host,"btnExcelUpload",1080,15,120,20);$.btnExcelUpload.setText("엑셀업로드");$.panTop.setBorder(true);$.panDelivery.addButtons(["btnExcelDown","btnSave"]);$.panResult.addButtons(["btnExcelDown","btnSave"]);$.dteFy.setDateFormat("yyyy");$.dteFy.setAllowBlank(false,"기준FY");$.cmbVersion.setAllowBlank(false,"예산버전");$.cmbVersion.setEmptyRow(true);$.mtBrand.setTitle("전체");$.grdDelivery.setColumns([new FingerDataGridColumn("parent_product_short_name",100,"center","string","제품명"),new FingerDataGridColumn("product_name",140,"center","string","제형 및 규격"),new FingerDataGridColumn("product_code",100,"center","string","제품코드"),new FingerDataGridColumn("ym1",100,"center","string","4월"),new FingerDataGridColumn("ym2",100,"center","string","5월"),new FingerDataGridColumn("ym3",100,"center","string","6월"),new FingerDataGridColumn("ym4",100,"center","string","7월"),new FingerDataGridColumn("ym5",100,"center","string","8월"),new FingerDataGridColumn("ym6",100,"center","string","9월"),new FingerDataGridColumn("ym7",100,"center","string","10월"),new FingerDataGridColumn("ym8",100,"center","string","11월"),new FingerDataGridColumn("ym9",100,"center","string","12월"),new FingerDataGridColumn("ym10",100,"center","string","1월"),new FingerDataGridColumn("ym11",100,"center","string","2월"),new FingerDataGridColumn("ym12",100,"center","string","3월")]);$.grdDelivery.init({scroll:"xy",leftSplit:3});$.grdDelivery.setBorder(false);$.grdDelivery.setEditable(true);$.grdResult.setColumns([new FingerDataGridColumn("parent_product_short_name",100,"center","string","제품명"),new FingerDataGridColumn("product_name",140,"center","string","제형 및 규격"),new FingerDataGridColumn("product_code",100,"center","string","제품코드"),new FingerDataGridColumn("ym1",100,"center","string","4월"),new FingerDataGridColumn("ym2",100,"center","string","5월"),new FingerDataGridColumn("ym3",100,"center","string","6월"),new FingerDataGridColumn("ym4",100,"center","string","7월"),new FingerDataGridColumn("ym5",100,"center","string","8월"),new FingerDataGridColumn("ym6",100,"center","string","9월"),new FingerDataGridColumn("ym7",100,"center","string","10월"),new FingerDataGridColumn("ym8",100,"center","string","11월"),new FingerDataGridColumn("ym9",100,"center","string","12월"),new FingerDataGridColumn("ym10",100,"center","string","1월"),new FingerDataGridColumn("ym11",100,"center","string","2월"),new FingerDataGridColumn("ym12",100,"center","string","3월")]);$.grdResult.init({scroll:"xy",leftSplit:3});$.grdResult.setBorder(false);$.grdResult.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panTop.add($.lblFy);$.panTop.add($.dteFy);$.panTop.add($.lblVersion);$.panTop.add($.cmbVersion);$.panTop.add($.lblBrand);$.panTop.add($.mtBrand);$.panTop.add($.btnSearch);$.panTop.add($.btnExcelDownload);$.panTop.add($.btnExcelUpload);$.panDelivery.add($.grdDelivery);$.panResult.add($.grdResult);$.panMain.add($.panTop);$.panMain.add($.tabMain);$.tabMain.addTab([{text:"납품단가",body:$.panDelivery,width:200},{text:"소화단가",body:$.panResult,width:200}]);getFYDate();searchBrand("Q_BRAND")};$.callback=function(type,ds){if(type=="UNIT_PRICE_VERSION"){$.cmbVersion.clear();if(ds&&ds.errorCode=="MSG0001"){setComboBind([$.cmbVersion],ds)}}else{if(type=="UNIT_PRICE_BRAND"){$.mtBrand.setData1(ds.resultList[0],"product_code","product_name")}else{if(type.indexOf("UNIT_PRICE_LIST")>-1){var gubun=type.replace("UNIT_PRICE_LIST","");var gridId="";if(gubun=="Q_R"){gridId=$.grdResult}else{gridId=$.grdDelivery}renderSearchData(ds,gridId)}else{if(type=="UNIT_PRICE_SAVE"){MessageBoxShow("정상적으로 저장되었습니다.");allTabSearch()}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnExcelDownload"){if(!$.cmbVersion.getValue()){MessageBoxShow("예산버전을 선택해 주세요.");return}if(!brandChk()){return}downloadExcelForm("Q")}else{if(id=="btnExcelUpload"){if(!$.cmbVersion.getValue()){MessageBoxShow("예산버전을 선택해 주세요.");return}if(!brandChk()){return}var ds=searchFCST("Q_FCST");if(ds.errorCode=="MSG0001"){$.excelFormColumns=[];$.excelRows=[];$.popUpCallId=id;var dt=[];var param={};param.placeHolder="내용만 복사해서 붙여넣으세요.\r\n첫 행에 첫 열은 필수로 입력하셔야 합니다.";param.cId=["parent_product_short_name","product_name","product_code"];dt=ds.resultList[0];var iCount=1;for(var i=0;i<dt.length;i++){var rowData=dt[i];$.excelFormColumns.push({ym:rowData.ym});param.cId.push("ym"+iCount);iCount++}$.excelRows=ds.resultList[1];g_main.openPopup("popPaste.html","popPaste","엑셀자료삽입",600,355,"","",param,"","")}else{MessageBoxShow("업로드 진행 중 오류가 발생했습니다.")}}else{if(id=="btnSearch"){if(!$.panTop.validateControls()){return}if(!brandChk()){return}allTabSearch()}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteFy"){if(!value){return}searchBudgetVersion("Q_VER")}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdDelivery"){if(cInd.indexOf("ym")>-1){var inputData=nValue.toString();if(isNaN(inputData)){$.grdDelivery.setValue(rId,cInd,oValue==""?"":oValue)}}}else{if(id=="grdResult"){if(cInd.indexOf("ym")>-1){var inputData=nValue.toString();if(isNaN(inputData)){$.grdResult.setValue(rId,cInd,oValue==""?"":oValue)}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDelivery"){$.grdDelivery.editStop();if(btnId=="btnSave"){if(!saveChk($.grdDelivery)){return}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("")}})}else{if(btnId=="btnExcelDown"){$.grdDelivery.excelDown("납품단가")}}}else{if(panelId=="panResult"){$.grdResult.editStop();if(btnId=="btnSave"){if(!saveChk($.grdResult)){return}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("")}})}else{if(btnId=="btnExcelDown"){$.grdResult.excelDown("소화단가")}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popPaste"){var dt=popResult.paste;if(!dt||!dt.length){MessageBoxShow("업로드 진행 중 오류가 발생했습니다.");return}$.isExcelUpload=true;$.popData=dt;searchList($.searchWorkType)}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){if(id=="tabMain"){if(tabid==1){$.searchWorkType="Q_R";$.saveWorkType="N_R"}else{$.searchWorkType="Q_D";$.saveWorkType="N_D"}}};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){if(id=="tabMain"){if(value==1){}else{}}};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>