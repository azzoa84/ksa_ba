<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.tabMain=null;$.panMonthly=null;$.panWeekly=null;$.panWorkInfo=null;$.htmlWorkTime=null;$.htmlWorkExtend=null;$.schWorkPlan=null;$.htmlWeeklyTotalStr=null;$.htmlWeeklyTotal=null;$.lblTeam=null;$.cmbTeam=null;$.lblEmployee=null;$.cmbEmployee=null;$.htmlTopInfo=null;$.panTopWeek=null;$.lblTeamR=null;$.cmbTeamR=null;$.lblEmployeeR=null;$.cmbEmployeeR=null;$.btnSearchR=null;$.htmlCalendar=null;$.htmlWeeklyTop=null;$.htmlWeeklyInfo=null;$.grdTeam=null;$.grdEmployee=null;$.lblDept=null;$.bteDept=null;$.htmlWorkApprovalTime=null;$.htmlWeeklyTotalTitle=null;$.session=g_main.session.obj;$.varIsFirst=true;$.varIsTabClick=true;$.varIsTeamClick=false;$.varMonthWorkTimeData={prescribedWorkingHour:0,realWorkingHour:0};$.varMonthWorkExtend={weekWorkTime:0,groupTotal:0,total:0,holidayTime:0,nightWorkTime:0};$.varMonthWorkApprovalTime={weekWorkTime:0,groupTotal:0,total:0,holidayTime:0,nightWorkTime:0};$.varMonthGroupWorkTotal=[0,0,0,0,0,0,0];$.varMonthWorkGroup=[];$.varMonthDt=[];$.varMonthTotalJucha=0;$.varMonthWorkDate=0;$.varMonthCalendaRowHeight="209px";$.varMonthCalendarTotalHeight=1327;$.varWeeklyWorkTimeData={title:"",prescribedWorkingHour:0,realWorkingHour:0};$.varWeeklyNowJucha=0;$.varWeeklyNowYYYYMM=getToday().substr(0,6);$.varEmployeeCnt=0;$.varFromDate="";$.varNowYyyymm=getToday().substr(0,6);$.varAddWorkTime=4;$.varDeptCode="";$.varHtmlMonthWorkTime='<table class="report-wk-tbl"> 							<colgroup> 								<col style="width:80px;"> 								<col style="width:60px;"> 								<col style="width:80px;"> 								<col style="width:60px;"> 							</colgroup> 							<tr> 								<th colspan="4" class="wk-header">실 근무일수 (#workDate#일)</th>							</tr> 							<tr> 								<th class="wk-title">총 근로시간</th>								<td class="wk-detail">#prescribedWorkingHour#</td>								<th class="wk-title">#employee#근무시간</th>								<td class="wk-detail">#realWorkingHour#</td>							<tr> 						</table>';$.varHtmlMonthWorkExtend='<table class="report-we-tbl"> 								<colgroup> 									<col style="width:30px;"> 									<col style="width:70px;"> 									<col style="width:30px;"> 									<col style="width:30px;"> 									<col style="width:40px;"> 								</colgroup> 								<tr> 									<th colspan="3" class="we-header1">연장/야간 실근무시간</th>									<th colspan="2" class="we-header1">Total</th>								</tr> 								<tr> 									<th rowspan="2" class="we-title">연장</th> 									<td class="we-detail" style="text-align: left;">　평일</td> 									<td class="we-detail">#weekWorkTime#</td> 									<td rowspan="2" class="we-detail">#groupTotal#</td> 									<td rowspan="3" class="we-focus">#total#</td> 								</tr> 								<tr> 									<td class="we-detail" style="text-align: left;">　휴일(이동시간)</td> 									<td class="we-detail">#holidayTime#</td> 								</tr> 								<tr> 									<th colspan="3" class="we-title" style="text-align: left;">　야간</th> 									<td class="we-detail">#nightWorkTime#</td> 								</tr> 							</table>';$.varHtmlMonthWorkApprovalTime='<table class="report-we-tbl"> 									<colgroup> 										<col style="width:30px;"> 										<col style="width:70px;"> 										<col style="width:30px;"> 										<col style="width:30px;"> 										<col style="width:40px;"> 									</colgroup> 									<tr> 										<th colspan="3" class="we-header2">연장/야간 계획승인시간</th>										<th colspan="2" class="we-header2">Total</th>									</tr> 									<tr> 										<th rowspan="2" class="we-title">연장</th> 										<td class="we-detail" style="text-align: left;">　평일</td> 										<td class="we-detail">#weekWorkTime#</td> 										<td rowspan="2" class="we-detail">#groupTotal#</td> 										<td rowspan="3" class="we-focus">#total#</td> 									</tr> 									<tr> 										<td class="we-detail" style="text-align: left;">　휴일(이동시간)</td> 										<td class="we-detail">#holidayTime#</td> 									</tr> 									<tr> 										<th colspan="3" class="we-title" style="text-align: left;">　야간</th> 										<td class="we-detail">#nightWorkTime#</td> 									</tr> 								</table>';$.varHtmlWeeklyTop='<div class="team-sch-list">						<p class="weeks">#title#</p>						<table>							<tr>								<th style="border-bottom: 0;">총 근로시간</th>								<td style="border-bottom: 0;">#prescribedWorkingHour#h</td>							</tr>						</table>					 </div>';function createJSON_Q(workType,type,dateInfo){var employeeId=$.cmbEmployee.getValue();var deptCode=$.cmbTeam.getValue();var yyyymmdd="";if(workType=="Q1"){var rId=$.grdTeam.getSelectedRowIdx();var chkData=$.grdEmployee.getCheckedRows("chk",true);var strEmployee="";for(var i=0;i<chkData.length;i++){strEmployee+=chkData[i].employee_id+","}employeeId=strEmployee.substr(0,strEmployee.length-1);deptCode=$.grdTeam.getValue(rId,"dept_code");$.varFromDate=$.schWeeklyPlan.getStartDate();yyyymmdd=$.varFromDate?$.varFromDate:getToday()}else{if(workType=="Q_DEPT"){deptCode=$.varDeptCode}}var json=createExecuteParamInfo("HR..P_hrtMonthlyWorkPlanView_Q",[workType,workType=="Q"?$.varNowYyyymm:$.varWeeklyNowYYYYMM,yyyymmdd,employeeId,deptCode,type,dateInfo,"#UserID#"]);return json}function searchCalendar(workType,type,dateInfo){var json=createJSON_Q(workType,type,dateInfo);callQuery(["req",json],workType,$)}function weeklySearchButtonClick(){var chkData=$.grdEmployee.getCheckedRows("chk",true);$.varEmployeeCnt=chkData.length;if(!chkData.length){MessageBoxShow("한명 이상의 담당자를 선택해 주세요.");return}searchCalendar("Q1","","");return;setWorkWeeklyPlanData(ds)}function initView(){var ds=bizComponentData2($,"Q1","L_HRT013");$.varMonthWorkGroup=ds.resultList[0];var strQuery=" and dept_code <> '0000'";var dsSub=bizComponentData2($,"Q4","P_ORG004",strQuery,"","");setComboBind([$.cmbTeam],dsSub);$.cmbTeam.setValue($.session.DeptCode);$.cmbEmployee.setValue($.session.UserID);$.bteDept.setText($.session.DeptName);$.varDeptCode=$.session.DeptCode;initPlanCalendar();setTopInfo();initMonthData();initWeeklyData();searchCalendar("Q_DEPT","","")}function initMonthData(){$.varMonthWorkGroup=[];$.varMonthDt=[];$.varMonthTotalJucha=0;$.varMonthGroupWorkTotal=[0,0,0,0,0,0,0];$.varMonthWorkTimeData={prescribedWorkingHour:0,realWorkingHour:0};$.varMonthWorkExtend={weekWorkTime:0,groupTotal:0,total:0,holidayTime:0,nightWorkTime:0};$.varMonthWorkApprovalTime={weekWorkTime:0,groupTotal:0,total:0,holidayTime:0,nightWorkTime:0};$.varMonthWorkDate=0;setMonthWorkInfo();setMonthTotal()}function initWeeklyData(){setWeeklyWorkInfo();setWeeklyTotal()}function setTopInfo(){var html="";for(var i=0;i<$.varMonthWorkGroup.length;i++){html+='<label style="margin-left: 15px;">';html+=$.varMonthWorkGroup[i].code_name;html+="</label>";var type=$.varMonthWorkGroup[i].sub_code;if($.varMonthWorkGroup[i].sub_code=="NIGHT"){type="WEEK_"+type}html+='<label style="margin-left: 5px; height: 15px; width: 15px; background: '+fingerSchedulerColors[type]+';">';html+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";html+="</label>"}$.htmlTopInfo.setHTML(html);$.htmlTopInfo.setStyle("text-align","right")}function setMonthWorkInfo(){var htmlWorkTime=$.varHtmlMonthWorkTime.replace("#prescribedWorkingHour#",$.varMonthWorkTimeData.prescribedWorkingHour).replace("#realWorkingHour#",Math.floor($.varMonthWorkTimeData.realWorkingHour)).replace("#employee#",($.cmbEmployee.getValue("emp_name")?"'"+$.cmbEmployee.getValue("emp_name")+"'<br>":"")).replace("#workDate#",$.varMonthDt.length);var htmlWorkExtend=$.varHtmlMonthWorkExtend.replace("#weekWorkTime#",$.varMonthWorkExtend.weekWorkTime).replace("#groupTotal#",$.varMonthWorkExtend.groupTotal).replace("#total#",$.varMonthWorkExtend.total).replace("#holidayTime#",$.varMonthWorkExtend.holidayTime).replace("#nightWorkTime#",$.varMonthWorkExtend.nightWorkTime);var htmlWorkApprovalTime=$.varHtmlMonthWorkApprovalTime.replace("#weekWorkTime#",$.varMonthWorkApprovalTime.weekWorkTime).replace("#groupTotal#",$.varMonthWorkApprovalTime.groupTotal).replace("#total#",$.varMonthWorkApprovalTime.total).replace("#holidayTime#",$.varMonthWorkApprovalTime.holidayTime).replace("#nightWorkTime#",$.varMonthWorkApprovalTime.nightWorkTime);$.htmlWorkTime.setHTML(htmlWorkTime);$.htmlWorkExtend.setHTML(htmlWorkExtend);$.htmlWorkApprovalTime.setHTML(htmlWorkApprovalTime)}function setWeeklyWorkInfo(){var htmlWeeklyWorkTime=$.varHtmlWeeklyTop.replace("#prescribedWorkingHour#",$.varWeeklyWorkTimeData.prescribedWorkingHour).replace("#realWorkingHour#",Math.floor($.varWeeklyWorkTimeData.realWorkingHour)).replace("#title#",$.varWeeklyWorkTimeData.title);$.htmlWeeklyTop.setHTML(htmlWeeklyWorkTime)}function setMonthTotal(){$.htmlWeeklyTotalStr.setHTML("Weekly Total");$.htmlWeeklyTotalStr.setStyle("line-height","29px");$.htmlWeeklyTotalStr.setStyle("text-align","center");$.htmlWeeklyTotalStr.setStyle("border","1px solid #d4d4d4");$.htmlWeeklyTotalStr.setStyle("border-bottom","0");$.htmlWeeklyTotalStr.setStyle("font-weight","600");$.htmlWeeklyTotalStr.setStyle("color","#1e2022");var str="";if($.varMonthTotalJucha){str+='<div class="team-sch-list" style="width: 165px;">';str+="<ul>";for(var i=1;i<=$.varMonthTotalJucha;i++){str+='<li style="height: '+$.varMonthCalendaRowHeight+'; text-align: center;">';str+='<p class="time">';str+='<span class="tag tag1" style="text-align: center; width: 103px; height: 46px; line-height: 20px; font-size: 16px; margin: 40px 0 10px 0;">실근무시간<br>합계</span>';str+="</p>";str+='<p class="time">';str+='<i class="far fa-clock" style="font-size: 20px;"></i>';str+='<span style="font-size: 20px;">'+$.varMonthGroupWorkTotal[i-1]+"h</span>";str+="</p>";str+="</li>"}str+="</div>";str+="</ul>"}$.htmlWeeklyTotal.setHTML(str)}function setWeeklyTotal(dt,dtExtend){$.htmlWeeklyTotalTitle.setHTML("Monthly Total");$.htmlWeeklyTotalTitle.setStyle("line-height","29px");$.htmlWeeklyTotalTitle.setStyle("text-align","center");$.htmlWeeklyTotalTitle.setStyle("border","1px solid #d4d4d4");$.htmlWeeklyTotalTitle.setStyle("border-bottom","0");$.htmlWeeklyTotalTitle.setStyle("font-weight","600");$.htmlWeeklyTotalTitle.setStyle("color","#1e2022");$.htmlWeeklyTotalTitle.setStyle("display","inline-block");$.htmlWeeklyTotalTitle.setStyle("box-sizing","border-box");var str="";var chkData=$.grdEmployee.getCheckedRows("chk",true);var addTxt="h";str+='<div class="team-sch-list" style="border: 0">';str+="<ul>";var ffDay=[];for(var i=0;i<$.varEmployeeCnt;i++){var groupSum=0,extendSum=0,holTimeSum=0,holMoveTimeSum=0,nightSum=0,ffDay="N",ffDayDate="";var gianWeekSum=0,gianHoliTimeSum=0,gianMoveSum=0,gianNightSum=0;var listPadding="19px 0px 30px 19px",liNameMargin="13px",liTimeMargin="10px";if(dt&&dt.length){for(var j=0;j<dt.length;j++){if(chkData[i].employee_id==dt[j].employee_id){var rowData=dt[j];var workTime=sumRestnWorkTime(rowData);if(rowData.ffday_yn=="Y"){ffDay=rowData.ffday_yn;ffDayDate=rowData.start.substr(5).replace("-",".")}if(rowData.gubun){groupSum+=getWorkTimeHH(workTime)}extendSum+=Number(rowData.extend_gian_time);holTimeSum+=Number(rowData.hol_gian_time);holMoveTimeSum+=Number(rowData.vac_move_time);nightSum+=Number(rowData.night_gian_time)}}}if(dtExtend&&dtExtend.length){for(var j=0;j<dtExtend.length;j++){if(chkData[i].employee_id==dtExtend[j].employee_id){if(dtExtend[j].work_type=="50"||dtExtend[j].work_type=="30"){gianHoliTimeSum+=dtExtend[j].extend_time}else{if(dtExtend[j].work_type=="60"){gianNightSum+=dtExtend[j].extend_time}else{if(dtExtend[j].work_type=="99"){gianMoveSum+=dtExtend[j].extend_time}else{gianWeekSum+=dtExtend[j].extend_time}}}}}}if(ffDay=="Y"){listPadding="12px 0px 30px 19px",liNameMargin="7px",liTimeMargin="6px"}if($.varEmployeeCnt==1){str+='<li class="weekly-list" style="border-top: 1px solid #d4d4d4; border-bottom: 1px solid #d4d4d4; padding: '+listPadding+';">'}else{if(i==0){str+='<li class="weekly-list" style="border-top: 1px solid #d4d4d4; padding: '+listPadding+';">'}else{if(i==$.varEmployeeCnt-1){str+='<li class="weekly-list" style="border-bottom: 1px solid #d4d4d4; padding: '+listPadding+';">'}else{str+='<li class="weekly-list" style="padding: '+listPadding+';">'}}}str+='<p class="name" style="margin-bottom: '+liNameMargin+';">';str+='<i class="fas fa-user"></i>'+chkData[i].emp_name;str+="</p>";str+='<p class="time" style="margin-bottom: '+liTimeMargin+';">';str+='<span class="tag tag1">총 근무</span><i class="far fa-clock"></i>'+groupSum+addTxt;str+="</p>";str+='<p class="time" style="margin-bottom: '+liTimeMargin+';">';var extendStr=gianWeekSum+(gianHoliTimeSum?"/"+gianHoliTimeSum:"")+(gianMoveSum?"("+gianMoveSum+")":"");str+='<span class="tag tag2">연장</span><i class="far fa-clock"></i>'+extendStr+addTxt;str+="</p>";str+='<p class="time" style="margin-bottom: '+liTimeMargin+';">';str+='<span class="tag tag3">야간</span><i class="far fa-clock"></i>'+gianNightSum+addTxt;str+="</p>";if(ffDay=="Y"){str+='<p class="time" style="margin-bottom: '+liTimeMargin+';">';str+='<span class="tag tag4" style="margin-right: 7px; ">FF.Day</span> <span style="color: #a46bd0;">'+ffDayDate+"</span>";str+="</p>"}str+="</li>"}str+="</div>";str+="</ul>";$.htmlWeeklyInfo.setHTML(str)}function initPlanCalendar(){var options={left:"prev,title,next",center:"",right:""};$.schWorkPlan.changeOptions({header:options,firstDay:1,fixedWeekCount:false});$.schWorkPlan.setDefaultView("month");$.schWorkPlan.setEventOrder("eventnumber");$.schWorkPlan.setHeight($.varMonthCalendarTotalHeight);jQuery(".fc-sat").css("color","#0054FF");jQuery(".fc-basic-view .fc-body .fc-row").css("height",$.varMonthCalendaRowHeight);jQuery(".fc-head th").css({height:"30px","vertical-align":"middle"});jQuery(".fc-toolbar .fc-left").css({"margin-left":"460px"})}function sumRestnWorkTime(dt){if(dt.work_start_time&&dt.work_end_time){var totalWorkTime=calcDiffTime(dt.work_start_time,dt.work_end_time,dt.gubun);var restHHMM=calcRestWorkTime(totalWorkTime);var strRestHHMM=changeHHMM(restHHMM,"");if(dt.work_start_time<="1200"&&dt.work_end_time>="1300"&&Number(strRestHHMM)==30){strRestHHMM="0100"}return calcDiffTime(strRestHHMM,totalWorkTime,"")}return""}function calcDiffTime(startTime,endTime,gubun,value){var str=(value?value:"");var startHH=0,startMM=0,endHH=0,endMM=0;var minus=false;if(startTime){startTime=startTime.toString();startHH=getWorkTimeHH(startTime);startMM=getWorkTimeMM(startTime)}if(endTime){endTime=endTime.toString();endHH=getWorkTimeHH(endTime);endMM=getWorkTimeMM(endTime)}var startSec=startHH*3600+startMM*60;var endSec=endHH*3600+endMM*60;var sec=0;if(startSec>endSec){sec=startSec-endSec;minus=true}else{sec=endSec-startSec}if(gubun=="WK3G"||gubun=="WK3O"||gubun=="WK3P"){if(startHH<12){sec+=$.varAddWorkTime*3600}else{sec+=($.varAddWorkTime+1)*3600}}return changeHHMM(sec,str,minus)}function calcRestWorkTime(totalWorkTime){var workHH=getWorkTimeHH(totalWorkTime);var restHHMM=Math.floor(Number(workHH)/4)*30*60;return restHHMM}function changeHHMM(sec,str,minus){var hours=Math.floor(sec/3600);var minutes=Math.floor((sec-(hours*3600))/60);if(hours<10){hours="0"+hours}if(minutes<10){minutes="0"+minutes}return(minus?"-":"")+(hours+str+minutes)}function calcRealWorkTime(startDate,endDate,val){var totalWorkTime=calcDiffTime(startDate,endDate,"","");var restHHMM=calcRestWorkTime(totalWorkTime);var realWorkTime=calcDiffTime(changeHHMM(restHHMM,""),totalWorkTime,"");if(val){return getWorkTimeHHMM(realWorkTime)}else{return getWorkTimeHH(realWorkTime)}}function changeStrHHMM(hhmm){var str="";if(hhmm){var HH=hhmm.substr(0,2);var MM=hhmm.substr(2,2);str=Number(HH)+"시간"}return str}function getWorkTimeHH(num){return Number(num.substr(0,num.length-2))||0}function getWorkTimeMM(num){return Number(num.substr(num.length-2))||0}function getWorkTimeHHMM(num){var H=Number(num.substr(0,num.length-2));var M=Number(num.substr(num.length-2))>0?".5":"";return Number(H+""+M)}function getWorkTimeHHStr(time){return time.substr(0,2)+":"+time.substr(2,2)}function setWorkMonthlyPlanData(ds){if(ds.resultList[0]&&ds.resultList[0].length){$.varMonthTotalJucha=ds.resultList[0][0].jucha}if(ds.resultList[2]&&ds.resultList[2].length){$.varMonthWorkTimeData.prescribedWorkingHour=ds.resultList[2][0].working_day*8}var dt=[];var arrTemp=[];var groupSum=0,totalSum=0,extendGianSum=0,nightGianSum=0,vacGianSum=0,vacMoveGianSum=0,vacTime=0,vacMoveTime=0,nightTime=0;var moveTime=0,holidayTime=0;var gianWeekWorkTime=0;var gianHolydayTime=0;var gianNightWorkTime=0;var gianVacTime=0;if(ds.resultList[1]&&ds.resultList[1].length){dt=deepCopyObj(ds.resultList[1]);var beforeJucha=ds.resultList[1][0].jucha;for(var i=0;i<ds.resultList[1].length;i++){var rowData=ds.resultList[1][i];var workTime=sumRestnWorkTime(rowData);extendGianSum+=Number(rowData.extend_gian_time);nightGianSum+=Number(rowData.night_gian_time);vacGianSum+=Number(rowData.vac_gian_time);vacMoveGianSum+=Number(rowData.vac_move_gian_time);vacTime+=Number(rowData.vac_time);vacMoveTime+=Number(rowData.vac_move_time);nightTime+=Number(rowData.night_time);moveTime+=Number(rowData.move_time);holidayTime+=Number(rowData.holiday_time);if(rowData.gubun){if(rowData.gubun=="WK3G"||rowData.gubun=="WK3O"||rowData.gubun=="WK3P"){dt.push({start:rowData.start,end:rowData.end,jucha:rowData.jucha,title:"근무 "+getWorkTimeHHStr(rowData.work_start_time)+"~"+getWorkTimeHHStr(rowData.work_end_time),gubun:"",type:"WORK",eventnumber:"2"})}dt.push({start:rowData.start,end:rowData.end,jucha:rowData.jucha,title:getWorkTimeHHMM(workTime),gubun:"",textColor:"#000",type:"TOTAL",eventnumber:"1"});if(beforeJucha!=rowData.jucha){$.varMonthGroupWorkTotal[beforeJucha-1]=groupSum;groupSum=0}groupSum+=getWorkTimeHHMM(workTime);totalSum+=getWorkTimeHH(workTime);if(i==ds.resultList[1].length-1){$.varMonthGroupWorkTotal[rowData.jucha-1]=groupSum;$.varMonthWorkTimeData.realWorkingHour=totalSum}beforeJucha=rowData.jucha}}$.varMonthDt=ds.resultList[1]}$.varMonthWorkExtend.total=Number($.varMonthWorkTimeData.realWorkingHour)-Number($.varMonthWorkTimeData.prescribedWorkingHour);$.varMonthWorkExtend.holidayTime=holidayTime+(holidayTime?"("+moveTime+")":"");$.varMonthWorkExtend.nightWorkTime=nightTime;$.varMonthWorkExtend.weekWorkTime=Number($.varMonthWorkExtend.total)-(holidayTime+Number($.varMonthWorkExtend.nightWorkTime));$.varMonthWorkExtend.weekWorkTime=Number($.varMonthWorkExtend.weekWorkTime)<0?0:$.varMonthWorkExtend.weekWorkTime;$.varMonthWorkExtend.groupTotal=Number($.varMonthWorkExtend.total)-Number($.varMonthWorkExtend.nightWorkTime);if(ds.resultList[3]&&ds.resultList[3].length){var extendData=ds.resultList[3];for(var i=0;i<extendData.length;i++){if(extendData[i].work_type=="50"||extendData[i].work_type=="30"){gianHolydayTime+=extendData[i].extend_time}else{if(extendData[i].work_type=="60"){gianNightWorkTime+=extendData[i].extend_time}else{if(extendData[i].work_type=="99"){gianVacTime+=extendData[i].extend_time}else{gianWeekWorkTime+=extendData[i].extend_time}}}}}$.varMonthWorkApprovalTime.total=gianWeekWorkTime+gianHolydayTime+gianNightWorkTime;$.varMonthWorkApprovalTime.weekWorkTime=gianWeekWorkTime;$.varMonthWorkApprovalTime.holidayTime=gianHolydayTime+(gianVacTime?"("+gianVacTime+")":"");$.varMonthWorkApprovalTime.groupTotal=gianWeekWorkTime+gianHolydayTime;$.varMonthWorkApprovalTime.nightWorkTime=gianNightWorkTime;$.schWorkPlan.removeEvents();$.schWorkPlan.addEventSource(dt);$.schWorkPlan.setStyle(".fc-event-container .fc-day-grid-event",{margin:"4px 0 4px 0",height:"27px","line-height":"9px"});if($.varMonthTotalJucha<6){$.schWorkPlan.setHeight(1118)}else{$.schWorkPlan.setHeight($.varMonthCalendarTotalHeight)}setMonthWorkInfo();setMonthTotal()}function setWorkWeeklyPlanData(ds){if(ds.resultList[0]&&ds.resultList[0].length){$.varWeeklyNowYYYYMM=ds.resultList[0][0].yyyymm;$.varWeeklyNowJucha=ds.resultList[0][0].jucha;$.varWeeklyWorkTimeData.title=$.varWeeklyNowYYYYMM.substr(0,4)+"년 "+Number($.varWeeklyNowYYYYMM.substr(4,2))+"월"}if(ds.resultList[3]&&ds.resultList[3].length){$.varWeeklyWorkTimeData.prescribedWorkingHour=ds.resultList[3][0].working_day*8}var arrWeeklyTemp=[];var chkData=$.grdEmployee.getCheckedRows("chk",true);if(ds.resultList[1]&&ds.resultList[1].length){var beforeEmployeeId=ds.resultList[1][0].employee_id;var arrEmployeeTemp=[];var arrTemp=[];var iRowData=[];var employeeId="";var index=1;for(var i=0;i<ds.resultList[1].length;i++){iRowData=ds.resultList[1][i];employeeId=iRowData.employee_id;for(var ii=0;ii<chkData.length;ii++){if(chkData[ii].employee_id==employeeId){iRowData.index=(ii+1);break}}if(i==ds.resultList[1].length-1){if(employeeId==beforeEmployeeId){arrEmployeeTemp.push(iRowData);beforeEmployeeId=""}else{var dt=deepCopyObj(arrEmployeeTemp);var groupSum=0,totalSum=0,extendSum=0,nightSum=0;for(var j=0;j<arrEmployeeTemp.length;j++){var jRowData=arrEmployeeTemp[j];var workTime=sumRestnWorkTime(jRowData);if(jRowData.extend_gubun){if(jRowData.extend_gubun=="60"){nightSum+=calcRealWorkTime(jRowData.work_start_time,jRowData.work_end_time,true)}else{extendSum+=calcRealWorkTime(jRowData.work_start_time,jRowData.work_end_time,true)}}if(jRowData.gubun){dt.push({start:jRowData.start,end:jRowData.end,jucha:jRowData.jucha,title:getWorkTimeHHMM(workTime),index:jRowData.index,gubun:"",textColor:"#000",type:"TOTAL",eventnumber:"1"});groupSum+=getWorkTimeHHMM(workTime);totalSum+=getWorkTimeHH(workTime)}}arrWeeklyTemp.push(dt);arrEmployeeTemp=[];arrEmployeeTemp.push(iRowData)}beforeEmployeeId=""}if(employeeId==beforeEmployeeId){arrEmployeeTemp.push(iRowData)}else{var dt=deepCopyObj(arrEmployeeTemp);var groupSum=0,totalSum=0,extendSum=0,nightSum=0;for(var j=0;j<arrEmployeeTemp.length;j++){var jRowData=arrEmployeeTemp[j];var workTime=sumRestnWorkTime(jRowData);if(jRowData.extend_gubun){if(jRowData.extend_gubun=="60"){nightSum+=calcRealWorkTime(jRowData.work_start_time,jRowData.work_end_time,true)}else{extendSum+=calcRealWorkTime(jRowData.work_start_time,jRowData.work_end_time,true)}}if(jRowData.gubun){dt.push({start:jRowData.start,end:jRowData.end,jucha:jRowData.jucha,title:getWorkTimeHHMM(workTime),index:jRowData.index,gubun:"",textColor:"#000",type:"TOTAL",eventnumber:"1"});groupSum+=getWorkTimeHHMM(workTime);totalSum+=getWorkTimeHH(workTime)}}arrEmployeeTemp=[];arrWeeklyTemp.push(dt);if(i!=ds.resultList[1].length-1){arrEmployeeTemp.push(iRowData)}}beforeEmployeeId=employeeId}}var date=ds.resultList[0][0].start_date;$.varFromDate=date;if(date){date=date.substr(0,4)+"-"+date.substr(4,2)+"-"+date.substr(6,2)}$.schWeeklyPlan.render($.varEmployeeCnt,date);$.schWeeklyPlan.addEventSource(arrWeeklyTemp);$.schWeeklyPlan.setStyle(".fc-day-grid-event",{margin:"5px 0 5px 0",height:"27px","line-height":"10px"});setPanelProperty("WEEK");setWeeklyWorkInfo();setWeeklyTotal(ds.resultList[2]||"",ds.resultList[4]||"")}function initCalendarStyle(){if(!$.varIsFirst){$.schWorkPlan.setStyle(".fc-sat",{color:"#0054FF"});$.schWorkPlan.setStyle(".fc-basic-view .fc-body .fc-row",{height:$.varMonthCalendaRowHeight});$.schWorkPlan.setStyle(".fc-head th",{height:"30px","vertical-align":"middle"});$.schWorkPlan.setStyle(".fc-month-view .fc-title",{margin:"9px 0 9px 0 !important"})}}function setPanelProperty(type){if(type=="WEEK"){var height=$.varWeekCalendaHeight*$.varEmployeeCnt;var addHeight=35;$.panMain.setSize(1200,height+295+addHeight,true);$.tabMain.setProperty(0,0,1200,height+280+addHeight);$.tabMain.setSize(height+280+addHeight);$.panWeekly.setSize(1198,height+275+addHeight);$.htmlWeeklyInfo.setProperty(0,217+addHeight,180,height+10);$.htmlCalendar.setProperty(190,145+addHeight,1006,height+80)}else{$.panMain.setSize(1200,1645,true);$.tabMain.setProperty(0,0,1200,1595);$.tabMain.setSize(1595)}}function onWeeklyButtonClickEvent(type){searchCalendar("Q1",type,$.varWeeklyNowYYYYMM+""+$.varWeeklyNowJucha)}$.FingerMultiScheduler_view_display=function(id,view){view.title=$.varWeeklyNowYYYYMM.substr(0,4)+"년 "+Number($.varWeeklyNowYYYYMM.substr(4,2))+"월 "+$.varWeeklyNowJucha+"주차";$.schWeeklyPlan.setStyle(".fc-sat",{color:"#0054FF"});$.schWeeklyPlan.setStyle(".fc-head th",{height:"30px","vertical-align":"middle"});$.schWeeklyPlan.setStyle(".fc-basic-view .fc-body .fc-row",{height:$.varWeekCalendaHeight-1+"px"});$.schWeeklyPlan.setStyle(".fc-day-grid-event",{margin:"5px 0 5px 0",height:"27px","line-height":"10px"});$.schWeeklyPlan.setStyle(".fc-basicWeek-view .fc-content-skeleton",{"padding-bottom":"0px"});var arrHeader=jQuery(".multi-calendar").find(".fc-day-header.fc-widget-header");for(var i=0;i<arrHeader.length;i++){var title=arrHeader[i].textContent.split("/")[0];if(Number($.varWeeklyNowYYYYMM.substr(4,2))!=Number(title)){jQuery(arrHeader[i]).css("opacity","0.3")}else{jQuery(arrHeader[i]).css("opacity","1")}}};$.FingerMultiScheduler_ready=function(id){};$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1600);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,5,1198,55);$.panTop.setText("");$.panTop.setBottomLine(true);$.tabMain=new FingerTab(host,"tabMain",0,0,1200,1595);$.panMonthly=new FingerPanel(host,"panMonthly",0,0,1198,1555);$.panMonthly.setText("");$.panMonthly.setBottomLine(true);$.panWeekly=new FingerPanel(host,"panWeekly",0,0,1198,1345);$.panWeekly.setText("");$.panWeekly.setBottomLine(true);$.panWorkInfo=new FingerPanel(host,"panWorkInfo",0,70,1198,130);$.panWorkInfo.setText("");$.panWorkInfo.setBottomLine(true);$.htmlWorkTime=new FingerHTMLView(host,"htmlWorkTime",0,0,280,125);$.htmlWorkExtend=new FingerHTMLView(host,"htmlWorkExtend",285,0,310,125);$.schWorkPlan=new FingerScheduler(host,"schWorkPlan","workweek",["30"],[],0,210,1025,1340);$.htmlWeeklyTotalStr=new FingerHTMLView(host,"htmlWeeklyTotalStr",1030,250,163,31);$.htmlWeeklyTotal=new FingerHTMLView(host,"htmlWeeklyTotal",1030,281,165,1270);$.lblTeam=new FingerLabel(host,"lblTeam",0,15,100,20);$.lblTeam.setText("팀");$.cmbTeam=new FingerComboBox(host,"cmbTeam",105,15,185,20);$.lblEmployee=new FingerLabel(host,"lblEmployee",275,15,100,20);$.lblEmployee.setText("담당자");$.cmbEmployee=new FingerComboBox(host,"cmbEmployee",380,15,140,20);$.htmlTopInfo=new FingerHTMLView(host,"htmlTopInfo",630,20,555,20);$.panTopWeek=new FingerPanel(host,"panTopWeek",0,5,1198,121);$.panTopWeek.setText("");$.panTopWeek.setBottomLine(true);$.lblTeamR=new FingerLabel(host,"lblTeamR",265,10,100,20);$.lblTeamR.setText("하위 조직");$.cmbTeamR=new FingerComboBox(host,"cmbTeamR",160,10,185,20);$.lblEmployeeR=new FingerLabel(host,"lblEmployeeR",540,10,100,20);$.lblEmployeeR.setText("담당자");$.cmbEmployeeR=new FingerMultiSelect(host,"cmbEmployeeR",730,10,140,5);$.btnSearchR=new FingerButton(host,"btnSearchR",890,10,80,25);$.btnSearchR.setText("조회");$.htmlCalendar=new FingerHTMLView(host,"htmlCalendar",190,180,1006,880);$.htmlWeeklyTop=new FingerHTMLView(host,"htmlWeeklyTop",0,145,180,70);$.htmlWeeklyInfo=new FingerHTMLView(host,"htmlWeeklyInfo",0,251,180,455);$.grdTeam=new FingerDataGrid(host,"grdTeam",375,10,175,95);$.grdEmployee=new FingerDataGrid(host,"grdEmployee",650,10,200,95);$.lblDept=new FingerLabel(host,"lblDept",0,10,100,20);$.lblDept.setText("부서");$.bteDept=new FingerButtonEdit(host,"bteDept",110,10,160,20);$.bteDept.setText("");$.htmlWorkApprovalTime=new FingerHTMLView(host,"htmlWorkApprovalTime",888,0,310,125);$.htmlWeeklyTotalTitle=new FingerHTMLView(host,"htmlWeeklyTotalTitle",0,221,180,30);$.panTop.setBorder(true);$.panTopWeek.setBorder(true);$.panTopWeek.setVisible(false);$.cmbTeamR.setVisible(false);$.cmbEmployeeR.setVisible(false);$.cmbTeam.setEmptyRow(true);$.cmbEmployee.setEmptyRow(true);$.cmbTeam.setColumn("dept_code","dept_name");$.cmbEmployee.setColumn("employee_id","emp_name");$.cmbTeam.setAllowBlank(false,"팀");$.cmbEmployee.setAllowBlank(false,"담당자");$.cmbEmployee.setEnable(false);$.cmbTeam.setColumnConfig("DEPT");$.varWeekCalendaHeight=160;$.schWeeklyPlan=new fingerMultiScheduler($.htmlCalendar,"schWeeklyPlan",985,$.varWeekCalendaHeight);$.schWeeklyPlan.addHandler(onWeeklyButtonClickEvent);$.grdTeam.setColumns([new FingerDataGridColumn("dept_code",0,"left","int","",{hidden:true}),new FingerDataGridColumn("dept_name",160,"left","int","")]);$.grdTeam.init({scroll:"y",header:false,isFilter:false});$.grdTeam.setBorder(true);$.grdEmployee.setColumns([new FingerDataGridColumn("employee_id",0,"left","int","",{hidden:true}),new FingerDataGridColumn("chk",50,"center","checkbox",""),new FingerDataGridColumn("emp_name",150,"left","int",""),new FingerDataGridColumn("work_time",150,"left","int","",{hidden:true}),new FingerDataGridColumn("extend_time",150,"left","int","",{hidden:true}),new FingerDataGridColumn("night_time",150,"left","int","",{hidden:true})]);$.grdEmployee.init({scroll:"y",header:false,isFilter:false});$.grdEmployee.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.tabMain);$.panTop.add($.lblTeam);$.panTop.add($.cmbTeam);$.panTop.add($.lblEmployee);$.panTop.add($.cmbEmployee);$.panTop.add($.htmlTopInfo);$.panMonthly.add($.schWorkPlan);$.panMonthly.add($.htmlWeeklyTotalStr);$.panMonthly.add($.htmlWeeklyTotal);$.panMonthly.add($.panTop);$.panMonthly.add($.panWorkInfo);$.panWeekly.add($.htmlCalendar);$.panWeekly.add($.htmlWeeklyTop);$.panWeekly.add($.htmlWeeklyInfo);$.panWeekly.add($.panTopWeek);$.panWeekly.add($.htmlWeeklyTotalTitle);$.panWorkInfo.add($.htmlWorkTime);$.panWorkInfo.add($.htmlWorkExtend);$.panWorkInfo.add($.htmlWorkApprovalTime);$.panTopWeek.add($.lblTeamR);$.panTopWeek.add($.cmbTeamR);$.panTopWeek.add($.lblEmployeeR);$.panTopWeek.add($.cmbEmployeeR);$.panTopWeek.add($.btnSearchR);$.panTopWeek.add($.grdTeam);$.panTopWeek.add($.grdEmployee);$.panTopWeek.add($.lblDept);$.panTopWeek.add($.bteDept);$.tabMain.addTab([{text:"월간",body:$.panMonthly,width:100},{text:"주간",body:$.panWeekly,width:100}]);initView();searchCalendar("Q","","")};$.callback=function(type,ds){if(type=="Q"){initMonthData();setWorkMonthlyPlanData(ds)}else{if(type=="Q1"){initWeeklyData();setWorkWeeklyPlanData(ds)}else{if(type=="Q_DEPT"){if(!$.varIsTeamClick){setDataGrid([$.grdTeam],ds.resultList[0],true)}setDataGrid([$.grdEmployee],ds.resultList[1],true);for(var i=0;i<$.grdEmployee.getRowCount();i++){$.grdEmployee.setValue(i,"chk","Y")}if(!$.varIsFirst){weeklySearchButtonClick()}$.varIsFirst=false}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearchR"){weeklySearchButtonClick()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteDept"){var param={dept_name:"",};g_main.openPopup("popDept.html","popDept","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbTeam"){if(!value){$.cmbEmployee.setEnable(false);$.cmbEmployee.setValue("");return}$.cmbEmployee.setEnable(true);var strQuery=" and dept_code ='"+value+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cmbEmployee.clear();setComboBind([$.cmbEmployee],ds)}else{if(id=="cmbEmployee"){if(!value){return}searchCalendar("Q","","")}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdTeam"){$.varIsTeamClick=false;var rowData=$.grdTeam.getValue(rId);var value=rowData.dept_code;if(value==$.varDeptCode){$.varIsTeamClick=true;searchCalendar("Q_DEPT","","")}else{var strQuery=" and dept_code ='"+value+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");setDataGrid([$.grdEmployee],ds);for(var i=0;i<$.grdEmployee.getRowCount();i++){$.grdEmployee.setValue(i,"chk","Y")}weeklySearchButtonClick()}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popDept"){if($.popUpCallId=="bteDept"){if(popResult.dept_code=="ROOT"){MessageBoxShow("잘못된 부서를 선택하셨습니다.");return}$.bteDept.setText(popResult.dept_name);$.varDeptCode=popResult.dept_code;$.varIsTeamClick=false;searchCalendar("Q_DEPT","","")}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){if(id=="tabMain"){if(tabid==1){$.panTop.setVisible(false);$.panTopWeek.setVisible(true);$.panWorkInfo.setVisible(false);if($.varIsTabClick){weeklySearchButtonClick();$.varIsTabClick=false}else{setPanelProperty("WEEK")}}else{$.panTop.setVisible(true);$.panTopWeek.setVisible(false);$.panWorkInfo.setVisible(true);setPanelProperty("MONTH")}}};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){if(id=="schWorkPlan"){initCalendarStyle()}};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){if(id=="schWorkPlan"){initCalendarStyle();if(!$.varIsFirst){var regExp=view.title.replace(/[^0-9]/g,"");$.varNowYyyymm=regExp;searchCalendar("Q","","")}}};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>