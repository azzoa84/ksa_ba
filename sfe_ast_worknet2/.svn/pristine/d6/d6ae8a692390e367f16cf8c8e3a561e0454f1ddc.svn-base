<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panMaster=null;$.panInfo=null;$.panDetail=null;$.grdMaster=null;$.grdDetail=null;$.btnSearch=null;$.lblyyyy=null;$.ymdyyyy=null;$.lblapply_start_date=null;$.ymdapply_start_date=null;$.lblWave=null;$.ymdapply_end_date=null;$.lblretire_income_ded_rate=null;$.numretire_income_ded_rate=null;$.labelEx2=null;$.lblmemo=null;$.txtmemo=null;$.btnCopy=null;$.enableYN=null;$.deleteRows=[];$.initRow=false;var stryyyy="";function QueryClick(){$.deleteRows=[];var iBeforeRow=$.grdMaster.getSelectedRowIdx();fnQRY_P_HRA5000_Q("MASTER");if($.grdMaster.getRowCount()<1){NewClick()}}function NewClick(){$.grdDetail.clear();$.panInfo.clear();$.ymdyyyy.setEnable(true);$.enableYN.setReadOnly(true)}function FocusedRowChanged(){var rId=$.grdMaster.getSelectedRowIdx();$.ymdapply_end_date.setValue("");$.deleteRows=[];$.ymdyyyy.setValue($.grdMaster.getValue(rId,"yyyy"));$.ymdapply_start_date.setValue($.grdMaster.getValue(rId,"apply_start_date"));$.ymdapply_end_date.setValue($.grdMaster.getValue(rId,"apply_end_date"));$.numretire_income_ded_rate.setValue($.grdMaster.getValue(rId,"retire_income_ded_rate"));$.txtmemo.setValue($.grdMaster.getValue(rId,"memo"));fnQRY_P_HRA5000_Q("DETAIL");$.ymdyyyy.setEnable(false);$.enableYN.setReadOnly(false)}function fnQRY_P_HRA5000_Q(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function createJSON_Q(workType){var json=createExecuteParamInfo("HR..P_HRA5000_Q",[workType,$.ymdyyyy.getValue()]);return json}function fnSET_P_HRA5000_S(workType){if((workType=="N"&&!validateControls([$.ymdyyyy,$.ymdapply_start_date,$.ymdapply_end_date,$.numretire_income_ded_rate]))||(workType=="U"&&!validateControls([$.ymdyyyy,$.ymdapply_start_date,$.ymdapply_end_date,$.numretire_income_ded_rate]))){return false}if(workType=="BEFORE"&&$.ymdyyyy.getValue()==null){MessageBoxShow("기준년도는 필수항목입니다.");return false}var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],workType,$);var bResult=false;if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{bResult=true}}return bResult}function createJSON_S(workType){var json=createExecuteParamInfo("HR..P_HRA5000_S",[workType,$.ymdyyyy.getValue(),$.ymdapply_start_date.getValue(),$.ymdapply_end_date.getValue(),$.numretire_income_ded_rate.getValue(),$.txtmemo.getValue()||"",g_main.session.obj.EmpCode,"#HostInfo#"]);return json}function fnSET_P_HRA5000_S1(workType){if(!gridValidator($.grdDetail,"work_year_fr")||!gridValidator($.grdDetail,"work_year_to")||!gridValidator($.grdDetail,"max_amt")){return false}var json=createJSON_S1(workType);if(json&&json!="NoChange"){var ds=callExecuteSync(["req",json],workType,$);if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);return false}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);return false}}}}return true}function createJSON_S1(workType){var json="";var changedRows=$.grdDetail.getChangedRows();if($.deleteRows.length>0){for(var i in $.deleteRows){changedRows.push($.deleteRows[i])}}var rows=[];if(changedRows.length<1){return"NoChange"}for(var i in changedRows){workType=changedRows[i].rowType;rows.push([workType,$.ymdyyyy.getValue(),changedRows[i].work_year_fr,changedRows[i].work_year_to,changedRows[i].cumulative_tax_ded_amt,changedRows[i].max_amt,"#UserId#","#HostInfo#"])}json=createExecuteParamInfo("HR..P_HRA5000_S1",rows);return json}function gridValidator(){if(arguments.length<2){return false}var grdName=arguments[0];for(var i=0;i<grdName.getRowCount();i++){for(var j=1;j<arguments.length;j++){if(grdName.getValue(i,arguments[j])==null){MessageBoxShow(grdName.getColumnText(arguments[j])+" 은(는) 필수 입력항목입니다");return false}}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,705);$.panMain.setText("");$.panMain.setBottomLine(true);$.panMaster=new FingerPanel(host,"panMaster",0,0,300,700);$.panMaster.setText("기준년도별 퇴직기준정보");$.panMaster.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",310,0,890,155);$.panInfo.setText("퇴직정산 기준정보");$.panInfo.setBottomLine(true);$.panDetail=new FingerPanel(host,"panDetail",310,160,890,540);$.panDetail.setText("근속연수공제");$.panDetail.setBottomLine(true);$.grdMaster=new FingerDataGrid(host,"grdMaster",0,0,300,655);$.grdDetail=new FingerDataGrid(host,"grdDetail",0,0,890,495);$.btnSearch=new FingerButton(host,"btnSearch",565,-40,95,30);$.btnSearch.setText("조회");$.lblyyyy=new FingerLabel(host,"lblyyyy",0,15,100,20);$.lblyyyy.setText("기준년도");$.ymdyyyy=new FingerDateEdit(host,"ymdyyyy",105,15,140,20);$.lblapply_start_date=new FingerLabel(host,"lblapply_start_date",0,45,100,20);$.lblapply_start_date.setText("적용기간");$.ymdapply_start_date=new FingerDateEdit(host,"ymdapply_start_date",105,45,140,20);$.lblWave=new FingerLabel(host,"lblWave",245,45,20,20);$.lblWave.setText("~");$.ymdapply_end_date=new FingerDateEdit(host,"ymdapply_end_date",270,45,140,20);$.lblretire_income_ded_rate=new FingerLabel(host,"lblretire_income_ded_rate",415,45,100,20);$.lblretire_income_ded_rate.setText("기본공제");$.numretire_income_ded_rate=new FingerSpinEdit(host,"numretire_income_ded_rate",520,45,140,20);$.labelEx2=new FingerLabel(host,"labelEx2",660,45,20,25);$.labelEx2.setText("%");$.lblmemo=new FingerLabel(host,"lblmemo",0,75,100,20);$.lblmemo.setText("메모");$.txtmemo=new FingerEdit(host,"txtmemo",105,75,580,20);$.btnCopy=new FingerButton(host,"btnCopy",750,15,140,20);$.btnCopy.setText("전년도 자료복사");$.enableYN=new FingerEdit(host,"enableYN",270,15,30,20);$.btnSearch.setVisible(false);$.enableYN.setVisible(false);$.ymdyyyy.setDateFormat("yyyy");$.panInfo.addButtons(["btnDelete","btnSave","btnNew"]);$.panDetail.addButtons(["btnDelete","btnAdd"]);$.ymdyyyy.setAllowBlank(false,"기준년도");$.ymdapply_start_date.setAllowBlank(false,"시작일");$.ymdapply_end_date.setAllowBlank(false,"종료일");$.numretire_income_ded_rate.setAllowBlank(false,"기본공제");$.grdMaster.setColumns([new FingerDataGridColumn("yyyy",80,"left","string","기준년도"),new FingerDataGridColumn("apply_start_date",100,"left","string","적용시작일",{format:"s_ymd"}),new FingerDataGridColumn("apply_end_date",100,"left","string","적용종료일",{format:"s_ymd"}),new FingerDataGridColumn("retire_income_ded_rate",100,"left","string","퇴직소득공제율",{hidden:true}),new FingerDataGridColumn("memo",100,"left","string","메모",{hidden:true})]);$.grdMaster.init({panel:$.panMaster,nonExcel:true,isFilter:false,scroll:"xy"});$.grdDetail.setColumns([new FingerDataGridColumn("work_year_fr",180,"right","string",{text:"근속년수하한(초과)",css:"col_chk"},{format:"int"}),new FingerDataGridColumn("work_year_to",180,"right","string",{text:"근속년수상한(이하)",css:"col_chk"},{format:"int"}),new FingerDataGridColumn("cumulative_tax_ded_amt",150,"right","string","근속공제액",{format:"int"}),new FingerDataGridColumn("max_amt",150,"right","string",{text:"최대치",css:"col_chk"},{format:"int"})]);$.grdDetail.init({panel:$.panDetail,nonExcel:true,isFilter:false,scroll:"xy",evenCellReadOnly:true});$.grdDetail.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panMaster);$.panMain.add($.panInfo);$.panMain.add($.panDetail);$.panMaster.add($.grdMaster);$.panInfo.add($.btnSearch);$.panInfo.add($.lblyyyy);$.panInfo.add($.ymdyyyy);$.panInfo.add($.lblapply_start_date);$.panInfo.add($.ymdapply_start_date);$.panInfo.add($.lblWave);$.panInfo.add($.ymdapply_end_date);$.panInfo.add($.lblretire_income_ded_rate);$.panInfo.add($.numretire_income_ded_rate);$.panInfo.add($.labelEx2);$.panInfo.add($.lblmemo);$.panInfo.add($.txtmemo);$.panInfo.add($.btnCopy);$.panInfo.add($.enableYN);$.panDetail.add($.grdDetail);QueryClick()};$.callback=function(type,ds){$.deleteRows=[];if(type=="MASTER"){setDataGrid([$.grdMaster],ds);$.grdMaster.selectRow(0);if($.initRow){var rIndex=0;rIndex=$.grdMaster.getGridRowIndex("yyyy",stryyyy);$.grdMaster.selectRow(rIndex)}$.initRow=false}else{if(type=="DETAIL"){setDataGrid([$.grdDetail],ds);$.grdDetail.selectRow(0);var aRow=$.grdDetail.getAllRows();for(var i in aRow){if($.grdDetail.getRowStatus(i)!="N"){aRow[i].work_year_fr_readonly=true;aRow[i].work_year_to_readonly=true}}}else{if(type=="BEFORE"){setDataGrid([$.grdDetail],ds);$.grdDetail.selectRow(0)}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){QueryClick()}else{if(id=="btnCopy"){if(fnSET_P_HRA5000_S("BEFORE")){stryyyy=$.ymdyyyy.getValue();$.initRow=true;QueryClick()}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="ymdapply_start_date"||id=="ymdapply_end_date"){if($.ymdapply_start_date.getValue()==null||$.ymdapply_end_date.getValue()==null){return}if($.ymdapply_start_date.getValue()>$.ymdapply_end_date.getValue()){MessageBoxShow("적용종료일이 적용시작일보다 빠를수 없습니다.");$.ymdapply_end_date.setValue($.ymdapply_start_date.getValue());return}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdMaster"){if($.grdMaster.getSelectedRowIdx()==0){return}FocusedRowChanged()}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){$.grdDetail.editStop();if(btnId=="btnNew"){NewClick()}else{if(btnId=="btnDelete"){confirmBoxShow($.ymdyyyy.getValue()+" 정보를 삭제하시겠습니까?",function(){if(g_main.msgShare==true){if(fnSET_P_HRA5000_S("D")){MessageBoxShow("정상적으로 삭제되었습니다.");QueryClick()}}})}else{if(btnId=="btnSave"){var strStatus="";if($.enableYN.getReadOnly()==true){strStatus="N"}else{strStatus="U"}if(fnSET_P_HRA5000_S(strStatus)){var stryyyy=$.ymdyyyy.getValue();if(fnSET_P_HRA5000_S1("")){MessageBoxShow("정상적으로 저장되었습니다.");QueryClick()}}}}}}else{if(panelId=="panDetail"){$.grdDetail.editStop();if(btnId=="btnAdd"){$.grdDetail.addRow({work_year_fr:0,work_year_to:0,cumulative_tax_ded_amt:0,max_amt:0})}else{if(btnId=="btnDelete"){var rId=$.grdDetail.getSelectedRowIdx();if(!rId){return}if($.grdDetail.getRowStatus(rId)!="N"){confirmBoxShow("삭제하시겠습니까?",function(){if(g_main.msgShare==true){$.grdDetail.getItem(rId).rowType="D";$.deleteRows.push($.grdDetail.getValue(rId));$.grdDetail.deleteCurrentRow()}})}else{$.grdDetail.deleteCurrentRow()}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>