<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTree=null;$.panTop=null;$.panBottom=null;$.panFile=null;$.panDoc=null;$.btnSearch=null;$.lbl_Title=null;$.txtpost_title=null;$.lbl_content=null;$.txt_content=null;$.lblEx1=null;$.btnViewDocu=null;$.btnWriteDocu=null;$.btnWrite=null;$.grdPost=null;$.txtpost_title1=null;$.webEdit=null;$.btnUpdate=null;$.btnDelete=null;$.btnReply=null;$.grdTree=null;$.grdFile=null;$.grdDoc=null;$.btnSave=null;$.txtboard_name=null;$.btnRefresh=null;$.txtboard_id=null;$.txtparent_post_no=null;$.txtpost_no=null;$.txtparent_board_id=null;$.txtCreateUser=null;$.txtCreateUserName=null;$.txtCreateTime=null;var strServiceURL;var rst="";function QueryClick(){if(g_main.session.obj.DeptCode==g_main.session.obj.SystemDeptCode){fnQRY_P_crmPostViewAction_Q("SYSTEM")}else{fnQRY_P_crmPostViewAction_Q("Q")}}function fnQRY_P_crmPostViewAction_Q(workType){var json=createJson_Q(workType);var ds=callExecuteSync(["req",json],workType,$);if(ds!=null){if(workType=="Q"){setDataGrid([$.grdTree],ds);$.grdTree.openNode("all");$.grdTree.selectRow(0)}else{if(workType=="SYSTEM"){setDataGrid([$.grdTree],ds);$.grdTree.openNode("all");$.grdTree.selectRow(0)}else{if(workType=="POSTLIST"){if(ds.errorCode=="MSG0006"){fninit();$.grdPost.clear()}else{convertJavaDateToJs(ds.resultList);if(ds.resultList[0][0].WType=="R"){ds.resultList[0][0].post_title="└▶ "+ds.resultList[0][0].post_title}setDataGrid([$.grdPost],ds);$.grdPost.openNode("all");$.txtpost_title1.setValue("");$.webEdit.setValue("");$.grdFile.clear();$.grdDoc.clear()}}else{if(workType=="POSTDETAIL"){$.txtpost_title1.setValue(ds.resultList[0][0].post_title);rst=convertRtfToHtml(ds.resultList[0][0].post_desc);$.webEdit.setValue(rst);setDataGrid([$.grdFile],ds.resultList[1],true);setDataGrid([$.grdDoc],ds.resultList[2],true)}else{if(workType=="COUNT"){$.txtpost_title1.setValue(ds.resultList[0][0].post_title);rst=convertRtfToHtml(ds.resultList[0][0].post_desc);$.webEdit.setValue(rst);setDataGrid([$.grdFile],ds.resultList[1],true);setDataGrid([$.grdDoc],ds.resultList[2],true)}}}}}}}function createJson_Q(workType){var json=createExecuteParamInfo("P_crmPostViewAction_Q",[workType,"#DeptCode#","#EmpCode#",$.txtboard_id.getValue(),$.txtpost_no.getValue(),$.txtpost_title.getValue(),$.txt_content.getValue()]);return json}function fnRightSet(bo){$.btnWrite.setEnable(bo);$.btnSave.setEnable(bo);$.btnUpdate.setEnable(bo);$.btnWriteDocu.setEnable(bo);$.btnReply.setEnable(bo)}function fnDefaultSet(){$.btnDelete.setVisible(false);$.btnSave.setVisible(false);$.btnUpdate.setVisible(false);$.btnReply.setVisible(false);$.txtCreateUserName.setVisible(false);$.txtCreateUser.setVisible(false);$.txtCreateTime.setVisible(false);$.txtparent_post_no.setValue("");$.txtpost_title1.setValue("");$.panFile.disableButton(["btnDelete","btnAdd"]);$.panDoc.disableButton(["btnDelete","btnAdd"])}function fninit(){fnVisibleSet(true);$.txtpost_title.setValue("");$.txt_content.setValue("");$.webEdit.setValue("");$.txtpost_title1.setValue("");$.txtpost_title1.setReadOnly(false);$.webEdit.setReadOnly(false);$.grdFile.clear();$.grdDoc.clear();$.panFile.enableButton(["btnDelete","btnAdd"]);$.panDoc.enableButton(["btnDelete","btnAdd"]);$.txtpost_title1.setFocus()}function fnVisibleSet(bo){$.btnRefresh.setVisible(bo);$.btnSave.setVisible(bo);$.btnDelete.setVisible(!bo);$.btnReply.setVisible(!bo);$.btnUpdate.setVisible(!bo);$.txtCreateUserName.setVisible(!bo);$.txtCreateTime.setVisible(!bo)}function fnSET_P_crmPostViewAction_S(workType){if($.txtpost_title1.getValue()==""){MessageBoxShow("제목은 필수 입력 항목입니다.");$.txtpost_title1.setFocus();return}var strlocal_fname="";var strserver_fname="";var strfileYn="N";var strseq="";var strserver_path="";var strwf_doc_id="";var strdocYn="N";var strdoc_seq="";var bResult=false;if($.grdFile.getSelectedRowIdx()!=-1){for(var i=0;i<$.grdFile.getRowCount();i++){if(i>0){strserver_path+="|";strserver_fname+="|";strlocal_fname+="|";strseq+="|"}strseq+=$.grdFile.getValue(i,"seq");strserver_path+=$.grdFile.getValue(i,"server_path");strserver_fname+=$.grdFile.getValue(i,"server_fname");strlocal_fname+=$.grdFile.getValue(i,"local_fname")}if(strlocal_fname!=""){strfileYn="Y"}}if($.grdDoc.getSelectedRowIdx()!=-1){for(var i=0;i<$.grdDoc.getRowCount();i++){if(i>0){strwf_doc_id+="|";strdoc_seq+="|"}strwf_doc_id+=$.grdDoc.getValue(i,"wf_doc_id");strdoc_seq+=$.grdDoc.getValue(i,"seq")}if(strwf_doc_id!=""){strdocYn="Y"}}var json=createJSON_S(workType,strlocal_fname,strserver_fname,strfileYn,strseq,strserver_path,strwf_doc_id,strdocYn,strdoc_seq);var ds=callExecuteSync(["req",json],workType,$,false);if(ds!=null){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{MessageBoxShow("정상적으로 저장 되었습니다.");bResult=true}}return bResult}function createJSON_S(workType,strlocal_fname,strserver_fname,strfileYn,strseq,strserver_path,strwf_doc_id,strdocYn,strdoc_seq){var json=createExecuteParamInfo("P_crmPostViewAction_S",[workType,$.txtboard_id.getValue(),$.txtparent_board_id.getValue(),$.txtpost_no.getValue(),$.txtpost_title1.getValue(),$.webEdit.getValue(),$.webEdit.getValue(),$.txtparent_post_no.getValue(),strfileYn,strseq,strserver_path,strserver_fname,strlocal_fname,strdocYn,strdoc_seq,strwf_doc_id,g_main.session.obj.EmpCode]);return json}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,740);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTree=new FingerPanel(host,"panTree",0,0,230,735);$.panTree.setText("게시판명");$.panTree.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",240,0,960,255);$.panTop.setText("");$.panTop.setBottomLine(true);$.panBottom=new FingerPanel(host,"panBottom",240,260,960,310);$.panBottom.setText("게시글 상세");$.panBottom.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",240,575,475,160);$.panFile.setText("첨부파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",725,575,475,160);$.panDoc.setText("기결문서");$.panDoc.setBottomLine(true);$.btnSearch=new FingerButton(host,"btnSearch",150,-40.5,80,20);$.btnSearch.setText("조회");$.lbl_Title=new FingerLabel(host,"lbl_Title",175,15.5,100,20);$.lbl_Title.setText("제목");$.txtpost_title=new FingerEdit(host,"txtpost_title",280,15.5,140,20);$.lbl_content=new FingerLabel(host,"lbl_content",425,15,100,20);$.lbl_content.setText("내용");$.txt_content=new FingerEdit(host,"txt_content",530,15,330,20);$.lblEx1=new FingerLabel(host,"lblEx1",0,15,100,20);$.lblEx1.setText("게시글리스트");$.btnViewDocu=new FingerButton(host,"btnViewDocu",615,45,140,20);$.btnViewDocu.setText("과제기술서 확인");$.btnWriteDocu=new FingerButton(host,"btnWriteDocu",740,45,140,20);$.btnWriteDocu.setText("과제기술서 작성");$.btnWrite=new FingerButton(host,"btnWrite",865,45,95,20);$.btnWrite.setText("글쓰기");$.grdPost=new FingerDataGrid(host,"grdPost",0,85,960,170);$.txtpost_title1=new FingerEdit(host,"txtpost_title1",5,5,375,20);$.webEdit=new FingerWebEditor(host,"webEdit",0,35,960,230);$.btnUpdate=new FingerButton(host,"btnUpdate",750,-39.5,80,20);$.btnUpdate.setText("수정");$.btnDelete=new FingerButton(host,"btnDelete",815,-39.5,80,20);$.btnDelete.setText("삭제");$.btnReply=new FingerButton(host,"btnReply",880,-39.5,80,20);$.btnReply.setText("답글");$.grdTree=new FingerDataGrid(host,"grdTree",0,0,230,690);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,475,115);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,475,115);$.btnSave=new FingerButton(host,"btnSave",685,-39.5,80,20);$.btnSave.setText("저장");$.txtboard_name=new FingerEdit(host,"txtboard_name",20,50,25,20);$.btnRefresh=new FingerButton(host,"btnRefresh",865,15,95,20);$.btnRefresh.setText("검색");$.txtboard_id=new FingerEdit(host,"txtboard_id",50,50,25,20);$.txtparent_post_no=new FingerEdit(host,"txtparent_post_no",80,50,25,20);$.txtpost_no=new FingerEdit(host,"txtpost_no",110,50,25,20);$.txtparent_board_id=new FingerEdit(host,"txtparent_board_id",140,50,25,20);$.txtCreateUser=new FingerEdit(host,"txtCreateUser",385,5,35,20);$.txtCreateUserName=new FingerEdit(host,"txtCreateUserName",425,5,35,20);$.txtCreateTime=new FingerEdit(host,"txtCreateTime",465,5,35,20);$.txtpost_title1.setAllowBlank(false,"게시글 제목");$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.btnSearch.setVisible(false);$.txtboard_id.setVisible(false);$.txtparent_post_no.setVisible(false);$.txtpost_no.setVisible(false);$.txtparent_board_id.setVisible(false);$.txtboard_name.setVisible(false);$.panTop.setBorder(true);$.grdTree.setColumns([new FingerDataGridColumn("KeyID",50,"left","string","keyId",{hidden:true}),new FingerDataGridColumn("board_id",70,"left","string","게시판아이디",{hidden:true}),new FingerDataGridColumn("board_name",210,"left","string","게시판명",{template:"tree"}),new FingerDataGridColumn("dept_name",70,"left","string","소유부서",{hidden:true}),new FingerDataGridColumn("order_seq",70,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("parent_board_id",70,"left","string","상위게시판 아이디",{hidden:true}),new FingerDataGridColumn("group_yn",70,"left","string","그룹여부",{hidden:true}),new FingerDataGridColumn("rw_type",70,"left","string","R/W",{hidden:true})]);$.grdTree.init({view:"treetable",scroll:"xy",treeKey:{id:"KeyID",parent:"ParentKeyID"}});$.grdTree.setBorder(false);$.grdPost.setColumns([new FingerDataGridColumn("post_no",150,"left","string","No",{hidden:true}),new FingerDataGridColumn("post_title",640,"left","string","제목"),new FingerDataGridColumn("create_time",100,"left","string","작성일",{format:"s_ymd"}),new FingerDataGridColumn("create_user",100,"left","string","작성자"),new FingerDataGridColumn("read_cnt",100,"left","string","조회"),new FingerDataGridColumn("parent_post_no",150,"left","string","상위글번호",{hidden:true}),new FingerDataGridColumn("WType",150,"left","string","글인지 답변인지 구분자",{hidden:true}),new FingerDataGridColumn("user_id",150,"left","string","만든사람아이디",{hidden:true})]);$.grdPost.init({view:"treetable",scroll:"xy",treeKey:{id:"post_no",parent:"parent_post_no"}});$.grdPost.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("seq",0,"left","string","일련번호",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("local_fname",455,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]})]);$.grdFile.init({isFilter:false,scroll:"xy"});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("seq",0,"left","string","순번",{hidden:true}),new FingerDataGridColumn("wf_doc_id",125,"left","string","기결문서아이디",{hidden:true}),new FingerDataGridColumn("wf_doc_name",455,"left","string","기결문서명")]);$.grdDoc.init({isFilter:false,scroll:"xy"});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTree);$.panMain.add($.panTop);$.panMain.add($.panBottom);$.panMain.add($.panDoc);$.panMain.add($.panFile);$.panTree.add($.btnSearch);$.panTree.add($.grdTree);$.panTop.add($.lbl_Title);$.panTop.add($.txtpost_title);$.panTop.add($.lbl_content);$.panTop.add($.txt_content);$.panTop.add($.lblEx1);$.panTop.add($.btnViewDocu);$.panTop.add($.btnWriteDocu);$.panTop.add($.btnWrite);$.panTop.add($.grdPost);$.panTop.add($.txtboard_id);$.panTop.add($.btnRefresh);$.panTop.add($.txtboard_name);$.panTop.add($.txtparent_post_no);$.panTop.add($.txtpost_no);$.panTop.add($.txtparent_board_id);$.panBottom.add($.webEdit);$.panBottom.add($.btnUpdate);$.panBottom.add($.btnDelete);$.panBottom.add($.btnReply);$.panBottom.add($.txtpost_title1);$.panBottom.add($.btnSave);$.panBottom.add($.txtCreateUser);$.panBottom.add($.txtCreateUserName);$.panBottom.add($.txtCreateTime);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);QueryClick()};$.callback=function(type,ds){};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){QueryClick()}else{if(id=="btnWrite"){$.txtparent_post_no.setValue("");fninit()}else{if(id=="btnReply"){$.txtparent_post_no.setValue($.txtpost_no.getValue());fninit()}else{if(id=="btnSave"){if(!fnSET_P_crmPostViewAction_S("N")){return}fnQRY_P_crmPostViewAction_Q("POSTLIST")}else{if(id=="btnUpdate"){var post_no=$.txtpost_no.getValue();if(!fnSET_P_crmPostViewAction_S("U")){return}}else{if(id=="btnDelete"){confirmBoxShow("선택한 글을 삭제하시겠습니까?",function(){if(g_main.msgShare==true){if(!fnSET_P_crmPostViewAction_S("D")){return}fnQRY_P_crmPostViewAction_Q("POSTLIST");fninit()}})}else{if(id=="btnRefresh"){fnDefaultSet();fnQRY_P_crmPostViewAction_Q("POSTLIST")}else{if(id=="btnViewDocu"){var param={Mode:"Write",dept_name:$.txtboard_name.getValue(),board_id:$.txtboard_id.getValue()};g_main.openPopup("popActionLearningDocu.html","popActionLearningDocu","과제기술서",905,640,"","",param,"","")}else{if(id=="btnWriteDocu"){var param={Mode:"View",dept_name:$.txtboard_name.getValue(),board_id:$.txtboard_id.getValue()};g_main.openPopup("popActionLearningDocu.html","popActionLearningDocu","과제기술서",900,700,"","",param,"","")}}}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdTree"){$.txtpost_title.setValue("");$.txt_content.setValue("");var rId=$.grdTree.getSelectedRowIdx();$.txtboard_id.setValue($.grdTree.getValue(rId,"board_id"));$.txtboard_name.setValue($.grdTree.getValue(rId,"board_name"));$.txtparent_board_id.setValue($.grdTree.getValue(rId,"parent_board_id"));var strgroup_yn=$.grdTree.getValue(rId,"group_yn");if(g_main.session.obj.DeptCode==g_main.session.obj.SystemDeptCode){fnRightSet(true)}else{if($.grdTree.getValue(rId,"rw_type")=="R"||strgroup_yn=="Y"){fnRightSet(false)}else{fnRightSet(true)}}if(strgroup_yn=="Y"){$.btnWrite.setEnable(false)}else{$.btnWrite.setEnable(true)}fnQRY_P_crmPostViewAction_Q("POSTLIST");fnDefaultSet()}else{if(id=="grdPost"){if($.grdPost.getSelectedRowIdx()<0){return}$.grdDoc.clear();$.grdFile.clear();var rId=$.grdTree.getSelectedRowIdx();var rId2=$.grdPost.getSelectedRowIdx();$.txtpost_no.setValue($.grdPost.getValue(rId2,"post_no"));if(g_main.session.obj.EmpCode!=$.grdTree.getValue(rId,"user_id")){fnQRY_P_crmPostViewAction_Q("COUNT")}else{fnQRY_P_crmPostViewAction_Q("POSTDETAIL")}$.txtCreateUser.setValue($.grdPost.getValue(rId2,"user_id"));$.txtCreateUserName.setValue($.grdPost.getValue(rId2,"create_user"));$.btnSave.setVisible(false);$.btnReply.setVisible(true);$.btnDelete.setVisible(true);$.btnUpdate.setVisible(true);if($.txtCreateUser.getValue()==g_main.session.obj.EmpCode||g_main.session.obj.DeptCode==g_main.session.obj.SystemDeptCode||g_main.session.obj.DeptCode=="C230"){$.btnUpdate.setVisible(true);$.btnDelete.setVisible(true);$.txtpost_title1.setReadOnly(false);$.webEdit.setReadOnly(false);$.panFile.enableButton(["btnDelete","btnAdd"]);$.panDoc.enableButton(["btnDelete","btnAdd"])}else{$.btnUpdate.setVisible(false);$.btnDelete.setVisible(false);$.txtpost_title1.setReadOnly(true);$.webEdit.setReadOnly(true)}}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0]);for(var i=0;i<$.grdFile.getRowCount();i++){$.grdFile.setValue(i,"seq",i+1)}})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",1100,735,"","",param,"","")}else{if(id=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}for(var i=0;i<$.grdDoc.getRowCount();i++){$.grdDoc.setValue(i,"seq",i+1)}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>