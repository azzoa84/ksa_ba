<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.grdList=null;$.panSelectList=null;$.grdChoice=null;$.panDisplay=null;$.txt_contact_name=null;$.lbl_company_name=null;$.txt_company_name=null;$.chk_MyContact=null;$.lbl_employee_name=null;$.txt_employee_name=null;$.btnSearch=null;$.btnConfirm=null;$.lbl_contact_name=null;$.btnCancel=null;$.btnAddRow=null;$.btnDelRow=null;$.base_year=0;$.listRId="";$.ChoidRId="";function createJson_Q(workType){var json=createExecuteParamInfo("P_crmCPContactList_Q",[workType,"",workType=="Q3"?$.txt_employee_name.getValue():$.txt_contact_name.getValue(),$.txt_company_name.getValue(),"","#DeptCode#","#UserID#",$.base_year]);return json}function searchCheck(){if($.txt_employee_name.getValue()!=""){searchCPContact("Q3")}else{if($.txt_contact_name.getValue()==""&&$.txt_company_name.getValue()==""){MessageBoxShow("적어도 하나의 검색어가 입력되어야 합니다.");return}else{if($.p_argument.inquiry_type=="update"){searchCPContact("Q5")}else{if($.chk_MyContact.getValue()=="Y"){searchCPContact("Q2")}else{searchCPContact("Q1")}}}}}function searchCPContact(workType){var json=createJson_Q(workType);callQuery(["req",json],"LIST",$)}function addSelectRow(){var contact_id="";var row_num=0;var rId=$.grdList.getSelectedRowIdx();if($.p_argument.inquiry_type=="advice"&&Number($.grdList.getValue(rId,"advice_amt_sum"))>=3000000){MessageBoxShow("선택 된 고객의 자문 금액이 초과되었습니다.");return}if($.p_argument.inquiry_type=="lecture"&&Number($.grdList.getValue(rId,"lect_amt_sum"))>=3000000){MessageBoxShow("선택 된 고객의 강연 금액이 초과되었습니다.");return}if($.p_argument.check_yn=="N"){if($.grdChoice.getRowCount()>0){MessageBoxShow("한 번에 한명의 고객만 등록 가능합니다.");return}else{var selected_count=0;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"checkYN")=="Y"){selected_count++}}if(selected_count>1){MessageBoxShow("한 번에 한명의 고객만 등록 가능합니다.");return}}}for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"checkYN")=="Y"){if($.p_argument.inquiry_type=="detail"&&Number($.grdList.getValue(i,"detail_cnt"))>=4){MessageBoxShow("선택 된 고객의 월 디테일링 횟수가 초과되었습니다.");return}contact_id=$.grdList.getValue(i,"contact_id");row_num=i;add_contact(contact_id,row_num)}}searchCheck()}function deleteSelectRow(){for(var i=0;i<$.grdChoice.getRowCount();i++){if($.grdChoice.getValue(i,"checkYN")=="Y"){$.grdChoice.deleteRow($.grdChoice.getRowId(i))}}}function add_contact(contact_id,row_num){var no_duplicate=true;for(var i=0;i<$.grdChoice.getRowCount();i++){if(contact_id==$.grdChoice.getValue(i,"contact_id")){no_duplicate=false}}if(no_duplicate){$.grdChoice.addRow({checkYN:"N",contact_id:$.grdList.getValue(row_num,"contact_id"),contact_name:$.grdList.getValue(row_num,"contact_name"),company_id:$.grdList.getValue(row_num,"company_id"),company_name:$.grdList.getValue(row_num,"company_name"),speciality:$.grdList.getValue(row_num,"speciality"),job_position:$.grdList.getValue(row_num,"job_position"),detail_cnt:$.grdList.getValue(row_num,"detail_cnt"),detail_cnt2:$.grdList.getValue(row_num,"detail_cnt2"),detail_before_cnt:$.grdList.getValue(row_num,"detail_before_cnt"),lect_cnt:$.grdList.getValue(row_num,"lect_cnt"),lect_amt_sum:$.grdList.getValue(row_num,"lect_amt_sum"),advice_cnt:$.grdList.getValue(row_num,"advice_cnt"),advice_amt_sum:$.grdList.getValue(row_num,"advice_amt_sum"),address1:$.grdList.getValue(row_num,"address1"),address2:$.grdList.getValue(row_num,"address2"),zip_code:$.grdList.getValue(row_num,"zip_code")})}else{MessageBoxShow("이미 선택 된 고객이 존재합니다.");return}}function popConfirm(){if(!$.grdChoice.getSelectedRowIdx()){return}var rows=[];var share={};if($.p_argument.check_yn=="Y"){if($.grdChoice.getRowCount()>0){rows=copyArray($.grdChoice.getAllRows())}share={popRows:rows}}else{share={popRows:$.grdChoice.getValue($.grdChoice.getSelectedRowIdx())}}g_popupStack.setData(share);g_popupStack.close()}function chk_AmtSum(value){if(value>=2500000){return{color:"violet"}}return value}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,825,705);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,825,85);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,95,825,285);$.panList.setText("고객 목록");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,825,240);$.panSelectList=new FingerPanel(host,"panSelectList",0,415,825,285);$.panSelectList.setText("선택 고객 목록");$.panSelectList.setBottomLine(true);$.grdChoice=new FingerDataGrid(host,"grdChoice",0,0,825,240);$.panDisplay=new FingerPanel(host,"panDisplay",725,0,100,85);$.panDisplay.setText("");$.panDisplay.setBottomLine(true);$.txt_contact_name=new FingerEdit(host,"txt_contact_name",105,15,140,20);$.lbl_company_name=new FingerLabel(host,"lbl_company_name",0,45,100,20);$.lbl_company_name.setText("소속병원");$.txt_company_name=new FingerEdit(host,"txt_company_name",105,45,140,20);$.chk_MyContact=new FingerCheckBox(host,"chk_MyContact",290,15,135,20);$.chk_MyContact.setText("내 거래처 조회");$.lbl_employee_name=new FingerLabel(host,"lbl_employee_name",435,15,100,20);$.lbl_employee_name.setText("자사 직원명");$.txt_employee_name=new FingerEdit(host,"txt_employee_name",540,15,140,20);$.btnSearch=new FingerButton(host,"btnSearch",20,15,80,55);$.btnSearch.setText("조회");$.btnConfirm=new FingerButton(host,"btnConfirm",455,407,80,30);$.btnConfirm.setText("확인");$.lbl_contact_name=new FingerLabel(host,"lbl_contact_name",0,15,100,20);$.lbl_contact_name.setText("고객명");$.btnCancel=new FingerButton(host,"btnCancel",520,407,80,30);$.btnCancel.setText("취소");$.btnAddRow=new FingerButton(host,"btnAddRow",325,407,80,30);$.btnAddRow.setText("▼ 추가");$.btnDelRow=new FingerButton(host,"btnDelRow",390,407,80,30);$.btnDelRow.setText("▲ 삭제");$.panQuery.setBorder(true);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("checkYN",60,"center","checkbox","선택"),new FingerDataGridColumn("contact_name",80,"center","string","고객명"),new FingerDataGridColumn("company_name",180,"left","string","소속"),new FingerDataGridColumn("speciality",100,"left","string","진료과목/부서"),new FingerDataGridColumn("job_position",100,"left","string","직위"),new FingerDataGridColumn("lect_cnt",120,"right","int","강연 누적횟수",{format:"int"}),new FingerDataGridColumn("lect_amt_sum",140,"right","int","강연 누적금액",{format:"int",cssFormat:chk_AmtSum}),new FingerDataGridColumn("advice_cnt",120,"right","int","자문 누적횟수",{format:"int"}),new FingerDataGridColumn("advice_amt_sum",140,"right","int","자문 누적금액",{format:"int",cssFormat:chk_AmtSum}),new FingerDataGridColumn("detail_before_cnt",90,"right","int","당월 계획",{format:"int"}),new FingerDataGridColumn("detail_cnt",90,"right","int","당월 실행",{format:"int"}),new FingerDataGridColumn("detail_cnt2",90,"right","int","전월 실행",{format:"int"}),new FingerDataGridColumn("contact_id",220,"left","string","고객아이디",{hidden:true}),new FingerDataGridColumn("zip_code",220,"left","string","우편번호",{hidden:true}),new FingerDataGridColumn("address1",220,"left","string","주소",{hidden:true}),new FingerDataGridColumn("address2",220,"left","string","세부주소",{hidden:true}),new FingerDataGridColumn("company_id",220,"left","string","거래처코드",{hidden:true}),new FingerDataGridColumn("channel",220,"left","string","채널",{hidden:true}),new FingerDataGridColumn("business_no",220,"left","string","사업자번호",{hidden:true}),new FingerDataGridColumn("yoyang_no",220,"left","string","요양기관기호",{hidden:true})]);$.grdList.init({panel:$.panList,scroll:"xy",nonExcel:true});$.grdList.setBorder(true);$.grdChoice.colIdx=$.grdChoice.setColumns([new FingerDataGridColumn("checkYN",60,"center","checkbox","선택"),new FingerDataGridColumn("contact_name",80,"center","string","고객명"),new FingerDataGridColumn("company_name",180,"left","string","소속"),new FingerDataGridColumn("speciality",100,"left","string","진료과목/부서"),new FingerDataGridColumn("job_position",100,"left","string","직위"),new FingerDataGridColumn("lect_cnt",120,"right","int","강연 누적횟수",{format:"int"}),new FingerDataGridColumn("lect_amt_sum",140,"right","int","강연 누적금액",{format:"int",cssFormat:chk_AmtSum}),new FingerDataGridColumn("advice_cnt",120,"right","int","자문 누적횟수",{format:"int"}),new FingerDataGridColumn("advice_amt_sum",140,"right","int","자문 누적금액",{format:"int",cssFormat:chk_AmtSum}),new FingerDataGridColumn("detail_before_cnt",90,"right","int","당월 계획",{format:"int"}),new FingerDataGridColumn("detail_cnt",90,"right","int","당월 실행",{format:"int"}),new FingerDataGridColumn("detail_cnt2",90,"right","int","전월 실행",{format:"int"}),new FingerDataGridColumn("contact_id",220,"left","string","고객아이디",{hidden:true}),new FingerDataGridColumn("zip_code",220,"left","string","우편번호",{hidden:true}),new FingerDataGridColumn("address1",220,"left","string","주소",{hidden:true}),new FingerDataGridColumn("address2",220,"left","string","세부주소",{hidden:true}),new FingerDataGridColumn("company_id",220,"left","string","거래처코드",{hidden:true}),new FingerDataGridColumn("channel",220,"left","string","채널",{hidden:true}),new FingerDataGridColumn("business_no",220,"left","string","사업자번호",{hidden:true}),new FingerDataGridColumn("yoyang_no",220,"left","string","요양기관기호",{hidden:true})]);$.grdChoice.init({panel:$.panSelectList,scroll:"xy",nonExcel:true});$.grdChoice.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panMain.add($.panSelectList);$.panMain.add($.btnConfirm);$.panMain.add($.btnCancel);$.panMain.add($.btnAddRow);$.panMain.add($.btnDelRow);$.panQuery.add($.txt_contact_name);$.panQuery.add($.lbl_company_name);$.panQuery.add($.txt_company_name);$.panQuery.add($.chk_MyContact);$.panQuery.add($.lbl_employee_name);$.panQuery.add($.txt_employee_name);$.panQuery.add($.lbl_contact_name);$.panQuery.add($.panDisplay);$.panList.add($.grdList);$.panSelectList.add($.grdChoice);$.panDisplay.add($.btnSearch);relocateChildIndexInPanel([$.panQuery]);if($.p_argument){if($.p_argument.check_yn=="N"){$.grdList.setColumnHidden("detail_cnt",true);$.grdList.setColumnHidden("detail_cnt2",true);$.grdList.setColumnHidden("detail_before_cnt",true);$.grdChoice.setColumnHidden("detail_cnt",true);$.grdChoice.setColumnHidden("detail_cnt2",true);$.grdChoice.setColumnHidden("detail_before_cnt",true)}else{$.grdList.setColumnHidden("lect_cnt",true);$.grdList.setColumnHidden("lect_amt_sum",true);$.grdList.setColumnHidden("advice_cnt",true);$.grdList.setColumnHidden("advice_amt_sum",true);$.grdChoice.setColumnHidden("lect_cnt",true);$.grdChoice.setColumnHidden("lect_amt_sum",true);$.grdChoice.setColumnHidden("advice_cnt",true);$.grdChoice.setColumnHidden("advice_amt_sum",true)}$.base_year=getToday("").substring(0,4);if($.p_argument.contact_name&&$.p_argument.contact_name!=""){$.txt_contact_name.setValue($.p_argument.contact_name)}if($.p_argument.company_name&&$.p_argument.company_name!=""){$.txt_company_name.setValue($.p_argument.company_name)}if($.txt_contact_name.getValue()==""&&$.txt_company_name.getValue()==""){return}}};$.callback=function(type,ds){if(type=="LIST"){setDataGrid([$.grdList],ds);$.grdList.selectRow(0)}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchCheck()}else{if(id=="btnConfirm"){popConfirm()}else{if(id=="btnCancel"){g_popupStack.close()}else{if(id=="btnAddRow"){addSelectRow()}else{if(id=="btnDelRow"){deleteSelectRow()}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){if(cInd=="checkYN"){if($.grdList.getValue(rId,"checkYN")=="N"){$.grdList.setValue(rId,"checkYN","Y")}else{if($.grdList.getValue(rId,"checkYN")=="Y"){$.grdList.setValue(rId,"checkYN","N")}}}}else{if(id=="grdChoice"){if(cInd=="checkYN"){if($.grdChoice.getValue(rId,"checkYN")=="N"){$.grdChoice.setValue(rId,"checkYN","Y")}else{if($.grdChoice.getValue(rId,"checkYN")=="Y"){$.grdChoice.setValue(rId,"checkYN","N")}}}}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList"){if(cInd=="checkYN"){$.grdList.selectRow(rId)}}else{if(id=="grdChoice"){if(cInd=="checkYN"){$.grdChoice.selectRow(rId)}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){if(id=="grdList"){popConfirm()}};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txt_company_name")&&value=="13"){searchCheck()}else{if((id=="txt_contact_name")&&value=="13"){searchCheck()}else{if((id=="txt_employee_name")&&value=="13"){searchCheck()}}}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>