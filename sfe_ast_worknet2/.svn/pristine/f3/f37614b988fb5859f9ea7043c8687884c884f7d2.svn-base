<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panTab1=null;$.panALDef=null;$.panContDef=null;$.panResult=null;$.panTab2=null;$.panALMsgList=null;$.panALMsg=null;$.panALMsgDef=null;$.tabAL=null;$.lblQYear=null;$.lblQHalf=null;$.lblQProduct=null;$.lblQType=null;$.dteQYear=null;$.cmbQHalf=null;$.cmbQProduct=null;$.cmbQType=null;$.btnQSearch=null;$.panBox1=null;$.lbl1=null;$.lbl2=null;$.lblALL1=null;$.lblALU1=null;$.lblALT1=null;$.lblALA1=null;$.lblALL2=null;$.lblALU2=null;$.lblALT2=null;$.lblALA2=null;$.chkALEntry=null;$.speALLFrom=null;$.speALLTo=null;$.speALUFrom=null;$.speALUTo=null;$.speALTFrom=null;$.speALTTo=null;$.speALAFrom=null;$.speALATo=null;$.txtALL=null;$.txtALU=null;$.txtALT=null;$.txtALA=null;$.lbl3=null;$.lbl4=null;$.lbl5=null;$.lbl6=null;$.lbl7=null;$.lbl8=null;$.lbl9=null;$.lbl10=null;$.lbl11=null;$.lbl12=null;$.lbl13=null;$.lbl14=null;$.speALEdit1=null;$.lblCont1=null;$.lineCont1=null;$.lineCont2=null;$.lineCont3=null;$.lineCont4=null;$.lineCont5=null;$.lineCont6=null;$.lblCont2=null;$.speContPatient=null;$.speContTarget=null;$.lblCont3=null;$.lblCont4=null;$.cmbContS=null;$.cmbContK=null;$.cmbContA=null;$.cmbContG=null;$.lblContK1=null;$.lblContA1=null;$.lblContG1=null;$.lblContS2=null;$.lblContK2=null;$.lblContA2=null;$.lblContG2=null;$.lblContSResult=null;$.lblContKResult=null;$.lblContAResult=null;$.lblContGResult=null;$.grdContList=null;$.grdResultList=null;$.speContS=null;$.speContK=null;$.speContA=null;$.speContG=null;$.btnClose=null;$.grdMsgList=null;$.lblMsgType=null;$.lblMsgParent=null;$.lblMsgSeq=null;$.lblMsgTitle=null;$.lblMsgDesc=null;$.cmbMsgType=null;$.txtMsgTitle=null;$.memMsgDesc=null;$.btnMsgAdd=null;$.btnMsgDelete=null;$.grdTreeMsg=null;$.speMsgSeq=null;$.bteMsgParent=null;$.grdTreeMsgDef=null;$.lineCont7=null;$.lineCont8=null;$.lblContS1=null;$.lblLUTAN=null;$.lblcondef1=null;$.lblcondef2=null;$.lblContN1=null;$.varALContList=[];$.varMsgGrade="";$.varMsgAL="";$.varALMsgId="";$.varALMsgParentId="";$.varUpdateList=[];$.varPath=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmContact_AL_Q",[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue()]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmContact_AL_Policy_Q",[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.varMsgGrade,$.varMsgAL,""]);return json}function createJSON_S0(workType){var json=createExecuteParamInfo("P_crmContact_Level_Maker_Close",[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),"#UserID#"]);return json}function createJSON_S(workType){var params=[];if(workType=="M_N"){params=[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.speALEdit1.getValue(),$.chkALEntry.getValue(),"","","","","#UserID#"]}else{if(workType=="N"){var alList=[];alList.push({al:"10",al_min:$.speALLFrom.getValue(),al_max:$.speALLTo.getValue(),al_guide:$.txtALL.getValue()});alList.push({al:"20",al_min:$.speALUFrom.getValue(),al_max:$.speALUTo.getValue(),al_guide:$.txtALU.getValue()});alList.push({al:"30",al_min:$.speALTFrom.getValue(),al_max:$.speALTTo.getValue(),al_guide:$.txtALT.getValue()});alList.push({al:"40",al_min:$.speALAFrom.getValue(),al_max:$.speALATo.getValue(),al_guide:$.txtALA.getValue()});for(var i in alList){params.push([workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.speALEdit1.getValue(),$.chkALEntry.getValue(),alList[i].al,alList[i].al_min,alList[i].al_max,alList[i].al_guide,"#UserID#"])}}}var json=createExecuteParamInfo("P_crmContact_AL_Def_S",params);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmContact_AL_Cont_S",[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.cmbContS.getValue()+"|"+$.cmbContK.getValue()+"|"+$.cmbContA.getValue()+"|"+$.cmbContG.getValue(),$.speContPatient.getValue(),$.speContTarget.getValue(),$.speContS.getValue(),$.speContK.getValue(),$.speContA.getValue(),$.speContG.getValue()]);return json}function createJSON_S3(workType){var json=createExecuteParamInfo("P_crmContact_AL_Policy_S",[workType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.varALMsgId||"",$.varALMsgParentId||"",$.cmbMsgType.getValue(),$.txtMsgTitle.getValue(),$.memMsgDesc.getValue(),$.speMsgSeq.getValue()||0,"#UserID#"]);return json}function createJSON_S4(){var json="";if($.varUpdateList.length<1){return}var rows=[];for(var i in $.varUpdateList){rows.push([$.varUpdateList[i].rowType,$.dteQYear.getValue(),$.cmbQHalf.getValue(),$.cmbQProduct.getValue(),$.cmbQType.getValue(),$.varUpdateList[i].policy_id,$.varMsgGrade,$.varMsgAL])}json=createExecuteParamInfo("P_crmContact_AL_Policy_S2",rows);return json}function searchData(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveContactClose(){var json=createJSON_S0("CLOSE");if(json){var ds=callExecuteSync(["req",json],"CLOSE",$);if(ds){MessageBoxShow("고객분류작성이 마감되었습니다.");searchData("AL_CONT");searchData("AL_RESULT")}}}function saveALDef(workType){var json=createJSON_S(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);return true}}function saveALContDef(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);return true}}function saveALMsg(workType){var json=createJSON_S3(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);if(ds){if(workType=="N"){$.varALMsgId=ds.returnStr}}return true}}function searchALMsgDef(workType){if($.varMsgGrade==""||$.varMsgAL==""){$.grdTreeMsgDef.setData("");return}var json=createJSON_Q2(workType);callQuery(["req",json],workType,$)}function saveALMsgDef(){var json=createJSON_S4();if(json){var ds=callExecuteSync(["req",json],"N",$);return true}}function searchAll(){initControls();searchData("AL_DEF");searchData("AL_CONT");searchData("AL_RESULT");searchData("AL_P_LIST");searchData("AL_P_TREE")}function initControls(){$.varALMsgId="";$.panBox1.clear();$.panALDef.clear();$.panContDef.clear();$.panALMsg.clear();$.grdContList.setData("");$.cmbContS.setValue("L");$.cmbContK.setValue("U");$.cmbContA.setValue("T");$.cmbContG.setValue("A")}function calcContDef(){if($.varALContList.length<=0){return}var rs=$.varALContList;var tCnt=rs.length,pCnt=Number($.speContPatient.getValue()),target=Number($.speContTarget.getValue()),sCnt=0,kCnt=0,aCnt=0,gCnt=0,nCnt=0,sTarget=0,kTarget=0,aTarget=0,gTarget=0,sL=0,sU=0,sT=0,sA=0,kL=0,kU=0,kT=0,kA=0,aL=0,aU=0,aT=0,aA=0,gL=0,gU=0,gT=0,gA=0,nL=0,nU=0,nT=0,nA=0,ALLfrom=$.speALLFrom.getValue(),ALLto=$.speALLTo.getValue(),ALUfrom=$.speALUFrom.getValue(),ALUto=$.speALUTo.getValue(),ALTfrom=$.speALTFrom.getValue(),ALTto=$.speALTTo.getValue(),ALAfrom=$.speALAFrom.getValue(),ALAto=$.speALATo.getValue();var cnt1=0,cnt2=0,cnt3=0,cnt4=0,cnt5=0,tar1=0,tar2=0,tar3=0,tar4=0,tar5=0,l1=0,u1=0,t1=0,a1=0,n1=0,l2=0,u2=0,t2=0,a2=0,n2=0,l3=0,u3=0,t3=0,a3=0,n3=0,l4=0,u4=0,t4=0,a4=0,n4=0,l5=0,u5=0,t5=0,a5=0,n5=0;for(var i in rs){if(rs[i].contact_p_count>=pCnt&&(rs[i].contact_company_point_sum>=ALAfrom&&rs[i].contact_company_point_sum<=ALAto)){cnt1++;tar1+=Number(rs[i].contact_company_point);switch(rs[i].al){case"10":l1++;break;case"20":u1++;break;case"30":t1++;break;case"40":a1++;break;default:n1++}}else{if(rs[i].contact_p_count>=pCnt&&(rs[i].contact_company_point_sum>=ALTfrom&&rs[i].contact_company_point_sum<=ALTto)){cnt2++;tar2+=Number(rs[i].contact_company_point);switch(rs[i].al){case"10":l2++;break;case"20":u2++;break;case"30":t2++;break;case"40":a2++;break;default:n2++}}else{if(rs[i].contact_p_count>=pCnt&&(rs[i].contact_company_point_sum>=ALUfrom&&rs[i].contact_company_point_sum<=ALUto)){cnt3++;tar3+=Number(rs[i].contact_company_point);switch(rs[i].al){case"10":l3++;break;case"20":u3++;break;case"30":t3++;break;case"40":a3++;break;default:n3++}}else{if(rs[i].contact_p_count>=pCnt&&(rs[i].contact_company_point_sum>=ALLfrom&&rs[i].contact_company_point_sum<=ALLto)){cnt4++;tar4+=Number(rs[i].contact_company_point);switch(rs[i].al){case"10":l4++;break;case"20":u4++;break;case"30":t4++;break;case"40":a4++;break;default:n4++}}else{if(rs[i].contact_p_count<pCnt&&(rs[i].contact_company_point_sum>=0&&rs[i].contact_company_point_sum<=100)){cnt5++;tar5+=Number(rs[i].contact_company_point);switch(rs[i].al){case"10":l5++;break;case"20":u5++;break;case"30":t5++;break;case"40":a5++;break;default:n5++}}}}}}}tCnt=cnt1+cnt2+cnt3+cnt4+cnt5;$.lblContS1.setText(cnt4+"명<br>"+((cnt4/tCnt)*100).toFixed(1)+"%");$.lblContK1.setText(cnt3+"명<br> "+((cnt3/tCnt)*100).toFixed(1)+"%");$.lblContA1.setText(cnt2+"명<br> "+((cnt2/tCnt)*100).toFixed(1)+"%");$.lblContG1.setText(cnt1+"명<br> "+((cnt1/tCnt)*100).toFixed(1)+"%");$.lblContN1.setText(cnt5+"명<br> "+((cnt5/tCnt)*100).toFixed(1)+"%");switch($.cmbContS.getValue()){case"A":sCnt+=cnt1;sL+=l1;sU+=u1;sT+=t1;sA+=a1;break;case"T":kCnt+=cnt1;kL+=l1;kU+=u1;kT+=t1;kA+=a1;break;case"U":aCnt+=cnt1;aL+=l1;aU+=u1;aT+=t1;aA+=a1;break;case"L":gCnt+=cnt1;gL+=l1;gU+=u1;gT+=t1;gA+=a1;break;default:nCnt+=cnt1;nL+=l1;nU+=u1;nT+=t1;nA+=a1;break}switch($.cmbContK.getValue()){case"A":sCnt+=cnt2;sL+=l2;sU+=u2;sT+=t2;sA+=a2;break;case"T":kCnt+=cnt2;kL+=l2;kU+=u2;kT+=t2;kA+=a2;break;case"U":aCnt+=cnt2;aL+=l2;aU+=u2;aT+=t2;aA+=a2;break;case"L":gCnt+=cnt2;gL+=l2;gU+=u2;gT+=t2;gA+=a2;break;default:nCnt+=cnt2;nL+=l2;nU+=u2;nT+=t2;nA+=a2;break}switch($.cmbContA.getValue()){case"A":sCnt+=cnt3;sL+=l3;sU+=u3;sT+=t3;sA+=a3;break;case"T":kCnt+=cnt3;kL+=l3;kU+=u3;kT+=t3;kA+=a3;break;case"U":aCnt+=cnt3;aL+=l3;aU+=u3;aT+=t3;aA+=a3;break;case"L":gCnt+=cnt3;gL+=l3;gU+=u3;gT+=t3;gA+=a3;break;default:nCnt+=cnt3;nL+=l3;nU+=u3;nT+=t3;nA+=a3;break}switch($.cmbContG.getValue()){case"A":sCnt+=cnt4;sL+=l4;sU+=u4;sT+=t4;sA+=a4;break;case"T":kCnt+=cnt4;kL+=l4;kU+=u4;kT+=t4;kA+=a4;break;case"U":aCnt+=cnt4;aL+=l4;aU+=u4;aT+=t4;aA+=a4;break;case"L":gCnt+=cnt4;gL+=l4;gU+=u4;gT+=t4;gA+=a4;break;default:nCnt+=cnt4;nL+=l4;nU+=u4;nT+=t4;nA+=a4;break}var sCall=$.speContS.getValue()*sCnt;var kCall=$.speContK.getValue()*kCnt;var aCall=$.speContA.getValue()*aCnt;var gCall=$.speContG.getValue()*gCnt;var tCall=sCall+kCall+aCall+gCall;$.lblContSResult.setText(sCall+"call ("+((sCall/tCall)*100).toFixed(1)+"%)");$.lblContKResult.setText(kCall+"call ("+((kCall/tCall)*100).toFixed(1)+"%)");$.lblContAResult.setText(aCall+"call ("+((aCall/tCall)*100).toFixed(1)+"%)");$.lblContGResult.setText(gCall+"call ("+((gCall/tCall)*100).toFixed(1)+"%)");$.grdContList.setData("");var toCnt=(sCnt+kCnt+aCnt+gCnt+nCnt);$.grdContList.addRow({al:"고객수",A:gCnt,T:aCnt,U:kCnt,L:sCnt,To:toCnt,N:cnt5});$.grdContList.addRow({al:"등급 비율",A:"("+((gCnt/toCnt)*100).toFixed(1)+"%)",T:"("+((aCnt/toCnt)*100).toFixed(1)+"%)",U:"("+((kCnt/toCnt)*100).toFixed(1)+"%)",L:"("+((sCnt/toCnt)*100).toFixed(1)+"%)",To:"(100%)",N:"(-)"});$.grdContList.selectRow(0)}function convertTreeToArray(rs){for(var i in rs){$.varPath=[];if(rs[i].parent_id!=0){getPath(rs,rs[i].parent_id);rs[i].path="|";for(var j in $.varPath){rs[i].path+=$.varPath[j]+"|"}}else{rs[i].path="|"+rs[i].policy_id+"|"}}return rs}function getPath(rs,pId){for(var i in rs){if(pId==rs[i].policy_id){$.varPath.push(rs[i].policy_id);if(rs[i].parent_id!=0){getPath(rs,rs[i].parent_id)}else{return}}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1000);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panTab1=new FingerPanel(host,"panTab1",0,0,300,300);$.panTab1.setText("");$.panTab1.setBottomLine(true);$.panALDef=new FingerPanel(host,"panALDef",0,0,600,430);$.panALDef.setText("Adoption Ladder 정의");$.panALDef.setBottomLine(true);$.panContDef=new FingerPanel(host,"panContDef",610,0,585,430);$.panContDef.setText("고객등급 정의");$.panContDef.setBottomLine(true);$.panResult=new FingerPanel(host,"panResult",0,445,1195,445);$.panResult.setText("최종결과");$.panResult.setBottomLine(true);$.panTab2=new FingerPanel(host,"panTab2",0,0,1195,865);$.panTab2.setText("");$.panTab2.setBottomLine(true);$.panALMsgList=new FingerPanel(host,"panALMsgList",0,0,1195,345);$.panALMsgList.setText("Adoption Ladder 전략/정책 정의 리스트");$.panALMsgList.setBottomLine(true);$.panALMsg=new FingerPanel(host,"panALMsg",0,355,620,540);$.panALMsg.setText("전략/정책 관리");$.panALMsg.setBottomLine(true);$.panALMsgDef=new FingerPanel(host,"panALMsgDef",710,355,485,540);$.panALMsgDef.setText("전략/정책 할당");$.panALMsgDef.setBottomLine(false);$.tabAL=new FingerTab(host,"tabAL",0,65,1200,930);$.lblQYear=new FingerLabel(host,"lblQYear",0,15,100,20);$.lblQYear.setText("년도");$.lblQHalf=new FingerLabel(host,"lblQHalf",205,15,100,20);$.lblQHalf.setText("반기");$.lblQProduct=new FingerLabel(host,"lblQProduct",410,15,100,20);$.lblQProduct.setText("품목");$.lblQType=new FingerLabel(host,"lblQType",615,15,100,20);$.lblQType.setText("구분");$.dteQYear=new FingerDateEdit(host,"dteQYear",105,15,100,20);$.cmbQHalf=new FingerComboBox(host,"cmbQHalf",310,15,100,20);$.cmbQProduct=new FingerComboBox(host,"cmbQProduct",515,15,100,20);$.cmbQType=new FingerComboBox(host,"cmbQType",720,15,100,20);$.btnQSearch=new FingerButton(host,"btnQSearch",1120,15,80,20);$.btnQSearch.setText("조회");$.panBox1=new FingerPanel(host,"panBox1",130,25,340,45);$.panBox1.setText("");$.panBox1.setBottomLine(true);$.lbl1=new FingerLabel(host,"lbl1",20,10,220,20);$.lbl1.setText("목표금액 / (질환환자 X 소화단가 X ");$.lbl2=new FingerLabel(host,"lbl2",290,10,20,20);$.lbl2.setText(")");$.lblALL1=new FingerLabel(host,"lblALL1",290,145,80,20);$.lblALL1.setText("Loyalty");$.lblALU1=new FingerLabel(host,"lblALU1",5,145,80,20);$.lblALU1.setText("User");$.lblALT1=new FingerLabel(host,"lblALT1",290,110,80,20);$.lblALT1.setText("Try");$.lblALA1=new FingerLabel(host,"lblALA1",5,110,80,20);$.lblALA1.setText("Awareness");$.lblALL2=new FingerLabel(host,"lblALL2",290,295,80,20);$.lblALL2.setText("Loyalty");$.lblALU2=new FingerLabel(host,"lblALU2",5,295,80,20);$.lblALU2.setText("User");$.lblALT2=new FingerLabel(host,"lblALT2",290,260,80,20);$.lblALT2.setText("Try");$.lblALA2=new FingerLabel(host,"lblALA2",5,260,80,20);$.lblALA2.setText("Awareness");$.chkALEntry=new FingerCheckBox(host,"chkALEntry",20,225,80,20);$.chkALEntry.setText("직접입력");$.speALLFrom=new FingerSpinEdit(host,"speALLFrom",375,145,40,20);$.speALLTo=new FingerSpinEdit(host,"speALLTo",470,145,40,20);$.speALUFrom=new FingerSpinEdit(host,"speALUFrom",90,145,40,20);$.speALUTo=new FingerSpinEdit(host,"speALUTo",185,145,40,20);$.speALTFrom=new FingerSpinEdit(host,"speALTFrom",375,110,40,20);$.speALTTo=new FingerSpinEdit(host,"speALTTo",470,110,40,20);$.speALAFrom=new FingerSpinEdit(host,"speALAFrom",90,110,40,20);$.speALATo=new FingerSpinEdit(host,"speALATo",185,110,40,20);$.txtALL=new FingerEdit(host,"txtALL",375,295,190,20);$.txtALU=new FingerEdit(host,"txtALU",90,295,190,20);$.txtALT=new FingerEdit(host,"txtALT",375,260,190,20);$.txtALA=new FingerEdit(host,"txtALA",90,260,190,20);$.lbl3=new FingerLabel(host,"lbl3",125,110,25,20);$.lbl3.setText("%");$.lbl4=new FingerLabel(host,"lbl4",150,110,25,20);$.lbl4.setText("~");$.lbl5=new FingerLabel(host,"lbl5",220,110,25,20);$.lbl5.setText("%");$.lbl6=new FingerLabel(host,"lbl6",410,110,25,20);$.lbl6.setText("%");$.lbl7=new FingerLabel(host,"lbl7",435,110,25,20);$.lbl7.setText("~");$.lbl8=new FingerLabel(host,"lbl8",505,110,25,20);$.lbl8.setText("%");$.lbl9=new FingerLabel(host,"lbl9",125,145,25,20);$.lbl9.setText("%");$.lbl10=new FingerLabel(host,"lbl10",150,145,25,20);$.lbl10.setText("~");$.lbl11=new FingerLabel(host,"lbl11",220,145,25,20);$.lbl11.setText("%");$.lbl12=new FingerLabel(host,"lbl12",410,145,25,20);$.lbl12.setText("%");$.lbl13=new FingerLabel(host,"lbl13",435,145,25,20);$.lbl13.setText("~");$.lbl14=new FingerLabel(host,"lbl14",505,145,25,20);$.lbl14.setText("%");$.speALEdit1=new FingerSpinEdit(host,"speALEdit1",240,11,55,20);$.lblCont1=new FingerLabel(host,"lblCont1",15,10,80,20);$.lblCont1.setText("질환환자");$.lineCont1=new FingerLine(host,"lineCont1",100,15,230,1);$.lineCont2=new FingerLine(host,"lineCont2",100,15,1,161);$.lineCont3=new FingerLine(host,"lineCont3",100,175,230,1);$.lineCont4=new FingerLine(host,"lineCont4",330,15,1,160);$.lineCont5=new FingerLine(host,"lineCont5",100,135,230,1);$.lineCont6=new FingerLine(host,"lineCont6",155,15,1,120);$.lblCont2=new FingerLabel(host,"lblCont2",160,180,100,20);$.lblCont2.setText("고객별 Share");$.speContPatient=new FingerSpinEdit(host,"speContPatient",35,125,40,20);$.speContTarget=new FingerSpinEdit(host,"speContTarget",195,185,40,20);$.lblCont3=new FingerLabel(host,"lblCont3",75,125,20,20);$.lblCont3.setText("명");$.lblCont4=new FingerLabel(host,"lblCont4",230,185,20,20);$.lblCont4.setText("%");$.cmbContS=new FingerComboBox(host,"cmbContS",273,60,60,20);$.cmbContK=new FingerComboBox(host,"cmbContK",215,60,60,20);$.cmbContA=new FingerComboBox(host,"cmbContA",157,60,60,20);$.cmbContG=new FingerComboBox(host,"cmbContG",100,60,60,20);$.lblContK1=new FingerLabel(host,"lblContK1",185,90,115,15);$.lblContK1.setText("");$.lblContA1=new FingerLabel(host,"lblContA1",125,90,115,15);$.lblContA1.setText("");$.lblContG1=new FingerLabel(host,"lblContG1",70,90,115,15);$.lblContG1.setText("");$.lblContS2=new FingerLabel(host,"lblContS2",360,20,20,20);$.lblContS2.setText("L");$.lblContK2=new FingerLabel(host,"lblContK2",360,60,20,20);$.lblContK2.setText("U");$.lblContA2=new FingerLabel(host,"lblContA2",360,100,20,20);$.lblContA2.setText("T");$.lblContG2=new FingerLabel(host,"lblContG2",360,140,20,20);$.lblContG2.setText("A");$.lblContSResult=new FingerLabel(host,"lblContSResult",450,20,140,20);$.lblContSResult.setText("0call (0%)");$.lblContKResult=new FingerLabel(host,"lblContKResult",450,60,140,20);$.lblContKResult.setText("0call (0%)");$.lblContAResult=new FingerLabel(host,"lblContAResult",450,100,140,20);$.lblContAResult.setText("0call (0%)");$.lblContGResult=new FingerLabel(host,"lblContGResult",450,140,140,20);$.lblContGResult.setText("0call (0%)");$.grdContList=new FingerDataGrid(host,"grdContList",0,225,585,160);$.grdResultList=new FingerDataGrid(host,"grdResultList",0,0,1195,400);$.speContS=new FingerSpinEdit(host,"speContS",385,20,60,20);$.speContK=new FingerSpinEdit(host,"speContK",385,60,60,20);$.speContA=new FingerSpinEdit(host,"speContA",385,100,60,20);$.speContG=new FingerSpinEdit(host,"speContG",385,140,60,20);$.btnClose=new FingerButton(host,"btnClose",975,15,160,20);$.btnClose.setText("고객분류작성 마감");$.grdMsgList=new FingerDataGrid(host,"grdMsgList",0,0,1195,300);$.lblMsgType=new FingerLabel(host,"lblMsgType",10,10,100,20);$.lblMsgType.setText("전략/정책 구분");$.lblMsgParent=new FingerLabel(host,"lblMsgParent",10,40,100,20);$.lblMsgParent.setText("상위 전략/정책");$.lblMsgSeq=new FingerLabel(host,"lblMsgSeq",10,100,100,20);$.lblMsgSeq.setText("정렬순서");$.lblMsgTitle=new FingerLabel(host,"lblMsgTitle",10,70,100,20);$.lblMsgTitle.setText("전략/정책 제목");$.lblMsgDesc=new FingerLabel(host,"lblMsgDesc",355,10,100,20);$.lblMsgDesc.setText("전략/정책 내용");$.cmbMsgType=new FingerComboBox(host,"cmbMsgType",115,10,100,20);$.txtMsgTitle=new FingerEdit(host,"txtMsgTitle",115,70,210,20);$.memMsgDesc=new FingerMemoEdit(host,"memMsgDesc",360,35,230,85);$.btnMsgAdd=new FingerButton(host,"btnMsgAdd",645,575,65,40);$.btnMsgAdd.setText("▶");$.btnMsgDelete=new FingerButton(host,"btnMsgDelete",645,625,65,40);$.btnMsgDelete.setText("◀");$.grdTreeMsg=new FingerDataGrid(host,"grdTreeMsg",0,140,620,355);$.speMsgSeq=new FingerSpinEdit(host,"speMsgSeq",115,100,100,20);$.bteMsgParent=new FingerButtonEdit(host,"bteMsgParent",115,40,210,20);$.bteMsgParent.setText("");$.grdTreeMsgDef=new FingerDataGrid(host,"grdTreeMsgDef",0,0,485,495);$.lineCont7=new FingerLine(host,"lineCont7",213,15,1,120);$.lineCont8=new FingerLine(host,"lineCont8",272,15,1,120);$.lblContS1=new FingerLabel(host,"lblContS1",255,85,100,20);$.lblContS1.setText("");$.lblLUTAN=new FingerLabel(host,"lblLUTAN",185,145,50,20);$.lblLUTAN.setText("N등급");$.lblcondef1=new FingerLabel(host,"lblcondef1",75,175,50,20);$.lblcondef1.setText("0%");$.lblcondef2=new FingerLabel(host,"lblcondef2",285,175,50,20);$.lblcondef2.setText("100%");$.lblContN1=new FingerLabel(host,"lblContN1",195,130,90,20);$.lblContN1.setText("");$.txtALL.setReadOnly(true);$.txtALU.setReadOnly(true);$.txtALT.setReadOnly(true);$.txtALA.setReadOnly(true);$.chkALEntry.setReadOnly(true);$.speALEdit1.setReadOnly(true);$.panTab2.setVisible(false);$.speContTarget.setVisible(false);$.panBox1.setVisible(false);$.lblCont4.setVisible(false);$.panQuery.setBorder(true);$.panBox1.setBorder(true);$.panALDef.addButtons(["btnSave"]);$.panContDef.addButtons(["btnSave"]);$.panALMsg.addButtons(["btnDelete","btnSave","btnNew"]);$.panALMsgDef.addButtons(["btnSave"]);$.tabAL.addTab([{text:"고객분류기준 정의",body:$.panTab1,width:150}]);$.dteQYear.setDateFormat("yyyy");$.cmbQHalf.addItem("1","상반기");$.cmbQHalf.addItem("2","하반기");var today=getToday("");var month=Number(today.substr(4,2));$.dteQYear.setValue(today.substr(0,4));$.cmbQHalf.setValue("1");$.dteQYear.setAllowBlank(false,"년도");$.cmbQHalf.setAllowBlank(false,"반기");$.cmbQProduct.setAllowBlank(false,"품목");$.cmbQType.setAllowBlank(false,"구분");$.panALDef.disableButton(["btnSave"]);$.speALEdit1.setAllowBlank(true,"처방일수");$.speALEdit1.setValue("30");$.speALLTo.setValue("100");$.speALLFrom.setAllowBlank(false,"Loyalty From");$.speALLTo.setAllowBlank(false,"Loyalty To");$.speALUFrom.setAllowBlank(false,"User From");$.speALUTo.setAllowBlank(false,"User To");$.speALTFrom.setAllowBlank(false,"Try From");$.speALTTo.setAllowBlank(false,"Try To");$.speALAFrom.setAllowBlank(false,"Awareness From");$.speALATo.setAllowBlank(false,"Awareness To");$.txtALL.setEnable(false);$.txtALU.setEnable(false);$.txtALT.setEnable(false);$.txtALA.setEnable(false);$.speALEdit1.setPlaceholder("처방일수");$.txtALL.setPlaceholder("입력하세요");$.txtALU.setPlaceholder("입력하세요");$.txtALT.setPlaceholder("입력하세요");$.txtALA.setPlaceholder("입력하세요");$.panContDef.disableButton(["btnSave"]);$.lblContS1.setAlign("center");$.lblContK1.setAlign("center");$.lblContA1.setAlign("center");$.lblContG1.setAlign("center");$.lblContSResult.setAlign("left");$.lblContKResult.setAlign("left");$.lblContAResult.setAlign("left");$.lblContGResult.setAlign("left");$.speContPatient.setAllowBlank(false,"질환환자수");$.speContTarget.setAllowBlank(true,"목표누적비중");$.speContTarget.setValue("0");$.cmbContS.setAllowBlank(false,"고객등급");$.cmbContK.setAllowBlank(false,"고객등급");$.cmbContA.setAllowBlank(false,"고객등급");$.cmbContG.setAllowBlank(false,"고객등급");$.speContS.setAllowBlank(false,"L Call 수");$.speContK.setAllowBlank(false,"U Call 수");$.speContA.setAllowBlank(false,"T Call 수");$.speContG.setAllowBlank(false,"A Call 수");$.panALMsg.disableButton(["btnDelete","btnSave","btnNew"]);$.cmbMsgType.setAllowBlank(false,"전략/정책 구분");$.txtMsgTitle.setAllowBlank(false,"전략/정책 제목");$.speMsgSeq.setAllowBlank(false,"정렬순서");$.memMsgDesc.setAllowBlank(false,"전략/정책 내용");$.panALMsgDef.disableButton(["btnSave"]);$.grdContList.setColumns([new FingerDataGridColumn("al",70,"left","string","구분"),new FingerDataGridColumn("A",80,"left","string","A"),new FingerDataGridColumn("T",80,"left","string","T"),new FingerDataGridColumn("U",80,"left","string","U"),new FingerDataGridColumn("L",80,"left","string","L"),new FingerDataGridColumn("To",98,"left","string","Total"),new FingerDataGridColumn("N",80,"left","string","N")]);$.grdContList.init();$.grdResultList.setColumns([new FingerDataGridColumn("dept_name",120,"left","string","영업소"),new FingerDataGridColumn("emp_name",70,"left","string","담당자"),new FingerDataGridColumn("company_id",60,"left","string","병원코드"),new FingerDataGridColumn("company_name",249,"left","string","병원"),new FingerDataGridColumn("ind_sp",90,"left","string","진료과"),new FingerDataGridColumn("contact_id",60,"left","string","고객코드"),new FingerDataGridColumn("contact_name",90,"left","string","고객(%)"),new FingerDataGridColumn("grade",60,"center","string","등급",{hidden:true}),new FingerDataGridColumn("contact_p_count",90,"right","int","질환환자수",{format:"int"}),new FingerDataGridColumn("contact_company_point_sum",100,"right","int","목표누적비중",{hidden:true}),new FingerDataGridColumn("contact_company_rate",80,"left","int","고객<br>Share"),new FingerDataGridColumn("al_ex_name",100,"left","string","예상A/L"),new FingerDataGridColumn("al_name",100,"left","string","최종A/L"),new FingerDataGridColumn("al_match",70,"left","string","일치여부"),new FingerDataGridColumn("target_call",100,"right","int","목표Call",{hidden:true,format:"int"}),new FingerDataGridColumn("contact_company_point",100,"right","int","목표",{hidden:true}),new FingerDataGridColumn("ap_data_name",150,"left","string","세부전공/고객성향",{hidden:true}),new FingerDataGridColumn("al_calc",80,"left","int","A/L 구분",{hidden:true})]);$.grdResultList.init({panel:$.panResult,scroll:"xy"});$.grdResultList.setBorder(false);$.grdMsgList.setColumns([new FingerDataGridColumn("parent_id",99,"center","string","",{hidden:true}),new FingerDataGridColumn("key_id",99,"center","string","등급ID",{hidden:true}),new FingerDataGridColumn("grade",55,"center","string","등급",{template:"tree"}),new FingerDataGridColumn("al",99,"left","string","A/L Code",{hidden:true}),new FingerDataGridColumn("al_name",200,"left","string","A/L"),new FingerDataGridColumn("save_yn",180,"center","string","전략/정책 등록 여부"),new FingerDataGridColumn("type1_cnt",150,"right","string","전략 등록 수"),new FingerDataGridColumn("type2_cnt",150,"right","string","정책 등록 수"),new FingerDataGridColumn("type3_cnt",150,"right","string","A/P 등록 수")]);$.grdMsgList.init({panel:$.panALMsgList,view:"treetable",treeKey:{id:"key_id",parent:"parent_id"},nonExcel:true});$.grdMsgList.setBorder(false);$.grdTreeMsg.setColumns([new FingerDataGridColumn("parent_id",99,"center","string","상위메시지ID",{hidden:true}),new FingerDataGridColumn("parent_name",99,"center","string","상위메시지명",{hidden:true}),new FingerDataGridColumn("policy_id",99,"left","string","메시지ID",{hidden:true}),new FingerDataGridColumn("policy_type",80,"center","string","구분"),new FingerDataGridColumn("policy_title",180,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("policy_desc",420,"left","string","내용"),new FingerDataGridColumn("order_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","path",{hidden:true})]);$.grdTreeMsg.init({view:"treetable",treeKey:{id:"policy_id",parent:"parent_id"},scroll:"xy"});$.grdTreeMsg.setBorder(false);$.grdTreeMsgDef.setColumns([new FingerDataGridColumn("parent_id",99,"center","string","상위메시지ID",{hidden:true}),new FingerDataGridColumn("parent_name",99,"center","string","상위메시지명",{hidden:true}),new FingerDataGridColumn("policy_id",99,"left","string","메시지ID",{hidden:true}),new FingerDataGridColumn("policy_type",80,"center","string","구분"),new FingerDataGridColumn("policy_title",200,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("policy_desc",265,"left","string","내용"),new FingerDataGridColumn("order_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","path",{hidden:true})]);$.grdTreeMsgDef.init({view:"treetable",treeKey:{id:"policy_id",parent:"parent_id"},scroll:"xy"});$.grdTreeMsgDef.setBorder(false);if(g_main.session.obj.SystemDeveloper=="Y"){$.btnClose.setVisible(true)}else{$.btnClose.setVisible(false)}$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.tabAL);$.panQuery.add($.lblQYear);$.panQuery.add($.lblQHalf);$.panQuery.add($.lblQProduct);$.panQuery.add($.lblQType);$.panQuery.add($.dteQYear);$.panQuery.add($.cmbQHalf);$.panQuery.add($.cmbQProduct);$.panQuery.add($.cmbQType);$.panQuery.add($.btnQSearch);$.panQuery.add($.btnClose);$.panTab1.add($.panALDef);$.panTab1.add($.panContDef);$.panTab1.add($.panResult);$.panALDef.add($.panBox1);$.panALDef.add($.lblALL1);$.panALDef.add($.lblALU1);$.panALDef.add($.lblALT1);$.panALDef.add($.lblALA1);$.panALDef.add($.lblALL2);$.panALDef.add($.lblALU2);$.panALDef.add($.lblALT2);$.panALDef.add($.lblALA2);$.panALDef.add($.chkALEntry);$.panALDef.add($.speALLFrom);$.panALDef.add($.speALLTo);$.panALDef.add($.speALUFrom);$.panALDef.add($.speALUTo);$.panALDef.add($.speALTFrom);$.panALDef.add($.speALTTo);$.panALDef.add($.speALAFrom);$.panALDef.add($.speALATo);$.panALDef.add($.txtALL);$.panALDef.add($.txtALU);$.panALDef.add($.txtALT);$.panALDef.add($.txtALA);$.panALDef.add($.lbl3);$.panALDef.add($.lbl4);$.panALDef.add($.lbl5);$.panALDef.add($.lbl6);$.panALDef.add($.lbl7);$.panALDef.add($.lbl8);$.panALDef.add($.lbl9);$.panALDef.add($.lbl10);$.panALDef.add($.lbl11);$.panALDef.add($.lbl12);$.panALDef.add($.lbl13);$.panALDef.add($.lbl14);$.panContDef.add($.lblCont1);$.panContDef.add($.lineCont1);$.panContDef.add($.lineCont2);$.panContDef.add($.lineCont3);$.panContDef.add($.lineCont4);$.panContDef.add($.lineCont5);$.panContDef.add($.lineCont6);$.panContDef.add($.lblCont2);$.panContDef.add($.speContPatient);$.panContDef.add($.speContTarget);$.panContDef.add($.lblCont3);$.panContDef.add($.lblCont4);$.panContDef.add($.cmbContG);$.panContDef.add($.cmbContA);$.panContDef.add($.cmbContK);$.panContDef.add($.cmbContS);$.panContDef.add($.lblContG1);$.panContDef.add($.lblContA1);$.panContDef.add($.lblContK1);$.panContDef.add($.lblContS2);$.panContDef.add($.lblContK2);$.panContDef.add($.lblContA2);$.panContDef.add($.lblContG2);$.panContDef.add($.lblContAResult);$.panContDef.add($.lblContGResult);$.panContDef.add($.lblContKResult);$.panContDef.add($.lblContSResult);$.panContDef.add($.grdContList);$.panContDef.add($.speContS);$.panContDef.add($.speContK);$.panContDef.add($.speContA);$.panContDef.add($.speContG);$.panContDef.add($.lineCont7);$.panContDef.add($.lineCont8);$.panContDef.add($.lblContS1);$.panContDef.add($.lblLUTAN);$.panContDef.add($.lblcondef1);$.panContDef.add($.lblcondef2);$.panContDef.add($.lblContN1);$.panResult.add($.grdResultList);$.panTab2.add($.panALMsgList);$.panTab2.add($.panALMsgDef);$.panTab2.add($.panALMsg);$.panTab2.add($.btnMsgAdd);$.panTab2.add($.btnMsgDelete);$.panALMsgList.add($.grdMsgList);$.panALMsg.add($.lblMsgType);$.panALMsg.add($.lblMsgParent);$.panALMsg.add($.lblMsgSeq);$.panALMsg.add($.lblMsgTitle);$.panALMsg.add($.lblMsgDesc);$.panALMsg.add($.cmbMsgType);$.panALMsg.add($.txtMsgTitle);$.panALMsg.add($.memMsgDesc);$.panALMsg.add($.grdTreeMsg);$.panALMsg.add($.speMsgSeq);$.panALMsg.add($.bteMsgParent);$.panALMsgDef.add($.grdTreeMsgDef);$.panBox1.add($.lbl1);$.panBox1.add($.lbl2);$.panBox1.add($.speALEdit1);$.cmbQProduct.setEmptyRow(true);$.cmbQType.setEmptyRow(true);$.cmbMsgType.setEmptyRow(true);var ds=bizComponentData2($,"Q1","L_CRM0271");setComboBind([$.cmbQProduct],ds);var ds=bizComponentData2($,"Q2","L_CRM233");setComboBind([$.cmbQType],ds);var ds=bizComponentData2($,"Q1","L_CRM0273");setComboBind([$.cmbMsgType],ds);$.grdTreeMsg.setColumnDropDownList("policy_type",ds.resultList[0]);$.grdTreeMsgDef.setColumnDropDownList("policy_type",ds.resultList[0]);$.cmbContS.addItem("L","L");$.cmbContK.addItem("U","U");$.cmbContA.addItem("T","T");$.cmbContG.addItem("A","A");$.cmbContS.setValue("L");$.cmbContK.setValue("U");$.cmbContA.setValue("T");$.cmbContG.setValue("A");relocateChildIndexInPanel([$.panQuery,$.panALDef,$.panContDef,$.panALMsg])};$.callback=function(type,ds){if(type=="AL_DEF"){$.panBox1.clear();$.panALDef.clear();$.panALDef.enableButton(["btnSave"]);if(ds.resultList[0].length>0){var rs1=ds.resultList[0][0];var rs2=ds.resultList[1];$.speALEdit1.setValue(rs1.ext_factor1);$.chkALEntry.setValue(rs1.manual_yn);if(rs1.manual_yn=="N"){$.speALEdit1.setEnable(true);$.txtALL.setEnable(false);$.txtALU.setEnable(false);$.txtALT.setEnable(false);$.txtALA.setEnable(false);$.speALLFrom.setEnable(true);$.speALLTo.setEnable(true);$.speALUFrom.setEnable(true);$.speALUTo.setEnable(true);$.speALTFrom.setEnable(true);$.speALTTo.setEnable(true);$.speALAFrom.setEnable(true);$.speALATo.setEnable(true);$.speALLFrom.setAllowBlank(false,"Loyalty Max");$.speALLTo.setAllowBlank(false,"Loyalty Min");$.speALUFrom.setAllowBlank(false,"User Max");$.speALUTo.setAllowBlank(false,"User Min");$.speALTFrom.setAllowBlank(false,"Try Max");$.speALTTo.setAllowBlank(false,"Try Min");$.speALAFrom.setAllowBlank(false,"Awareness Max");$.speALATo.setAllowBlank(false,"Awareness Min");for(var i in rs2){switch(rs2[i].al){case"10":$.speALLFrom.setValue(rs2[i].al_min);$.speALLTo.setValue(rs2[i].al_max);break;case"20":$.speALUFrom.setValue(rs2[i].al_min);$.speALUTo.setValue(rs2[i].al_max);break;case"30":$.speALTFrom.setValue(rs2[i].al_min);$.speALTTo.setValue(rs2[i].al_max);break;case"40":$.speALAFrom.setValue(rs2[i].al_min);$.speALATo.setValue(rs2[i].al_max);break;default:break}}}else{if(rs1.manual_yn=="Y"){$.speALEdit1.setEnable(false);$.speALLFrom.setEnable(false);$.speALLTo.setEnable(false);$.speALUFrom.setEnable(false);$.speALUTo.setEnable(false);$.speALTFrom.setEnable(false);$.speALTTo.setEnable(false);$.speALAFrom.setEnable(false);$.speALATo.setEnable(false);$.txtALL.setEnable(true);$.txtALU.setEnable(true);$.txtALT.setEnable(true);$.txtALA.setEnable(true);$.txtALL.setAllowBlank(false,"Loyalty");$.txtALU.setAllowBlank(false,"User");$.txtALT.setAllowBlank(false,"Try");$.txtALA.setAllowBlank(false,"Awareness");for(var i in rs2){switch(rs2[i].al){case"10":$.txtALL.setValue(rs2[i].al_guide);break;case"20":$.txtALU.setValue(rs2[i].al_guide);break;case"30":$.txtALT.setValue(rs2[i].al_guide);break;case"40":$.txtALA.setValue(rs2[i].al_guide);break;default:break}}}}}else{$.speALLTo.setValue(100)}}else{if(type=="AL_CONT"){$.panContDef.enableButton(["btnSave"]);if(ds.resultList[0].length>0){var rs=ds.resultList[0][0];$.speContPatient.setValue(rs.cont_p_count);$.speContTarget.setValue(rs.target_rate);if(rs.cont_level){var contLevel=rs.cont_level.split("|");$.cmbContS.setValue(contLevel[0]);$.cmbContK.setValue(contLevel[1]);$.cmbContA.setValue(contLevel[2]);$.cmbContG.setValue(contLevel[3])}$.speContS.setValue(rs.scall);$.speContK.setValue(rs.kcall);$.speContA.setValue(rs.acall);$.speContG.setValue(rs.gcall);$.varALContList=ds.resultList[1];calcContDef()}}else{if(type=="AL_RESULT"){if(ds.resultList[0].length>0){setDataGrid([$.grdResultList],ds);$.grdResultList.selectRow(0)}else{$.grdResultList.setData("")}}else{if(type=="AL_P_LIST"){if(ds.resultList[0].length>0){setDataGrid([$.grdMsgList],ds);$.grdMsgList.openNode("all");$.grdMsgList.selectRow(0)}else{$.grdMsgList.setData("")}}else{if(type=="AL_P_TREE"){$.panALMsg.enableButton(["btnDelete","btnSave","btnNew"]);if(ds.resultList[0].length>0){ds.resultList[0]=convertTreeToArray(ds.resultList[0]);setDataGrid([$.grdTreeMsg],ds);$.grdTreeMsg.openNode("all");if($.varALMsgId==""){$.grdTreeMsg.selectRow(0)}else{$.grdTreeMsg.selectRow($.grdTreeMsg.getGridRowIndex("policy_id",$.varALMsgId,0))}}else{$.grdTreeMsg.setData("")}}else{if(type=="AL_MSG_DEF"){if(ds.resultList[0].length>0){ds.resultList[0]=convertTreeToArray(ds.resultList[0]);setDataGrid([$.grdTreeMsgDef],ds);$.grdTreeMsgDef.openNode("all")}else{$.grdTreeMsgDef.setData("")}}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnQSearch"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}searchAll()}else{if(id=="btnClose"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}confirmBoxShow("고객분류작성 마감을 하시겠습니까?",function(){if(g_main.msgShare){saveContactClose()}})}else{if(id=="btnMsgAdd"){if($.varMsgGrade==""||$.varMsgAL==""){MessageBoxShow("상단 그리드에서 할당할 A/L 을 선택해 주시기 바랍니다.");return}var aRow1=$.grdTreeMsg.getAllRows(),aRow2=$.grdTreeMsgDef.getAllRows();var rId=$.grdTreeMsg.getSelectedRowIdx();if(!rId){return}var keyId=$.grdTreeMsg.getValue(rId,"policy_id");var path=$.grdTreeMsg.getValue(rId,"path");for(var i in aRow1){if(aRow1[i].policy_id==keyId||path.indexOf("|"+aRow1[i].policy_id+"|")!=-1||aRow1[i].path.indexOf("|"+keyId+"|")!=-1){var overlap=0;if(aRow2.length>0){for(var j in aRow2){if(aRow1[i].policy_id==aRow2[j].policy_id){overlap++}}}if(overlap>0){continue}aRow2.push({rowType:"N",parent_id:aRow1[i].parent_id,policy_id:aRow1[i].policy_id,policy_title:aRow1[i].policy_title,policy_desc:aRow1[i].policy_desc,policy_type:aRow1[i].policy_type,order_seq:aRow1[i].order_seq,path:aRow1[i].path});$.varUpdateList.push({rowType:"N",policy_id:aRow1[i].policy_id,})}}$.grdTreeMsgDef.setData(aRow2);$.grdTreeMsgDef.openNode("all")}else{if(id=="btnMsgDelete"){if($.varMsgGrade==""||$.varMsgAL==""){MessageBoxShow("상단 그리드에서 할당할 A/L 을 선택해 주시기 바랍니다.");return}var rId=$.grdTreeMsgDef.getSelectedRowIdx();if(!rId){return}var keyId=$.grdTreeMsgDef.getValue(rId,"policy_id");var aRow=$.grdTreeMsgDef.getAllRows();for(var i in aRow){if(aRow[i].policy_id==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].policy_id==aRow[i].policy_id){overlap++}}if(overlap>0){$.grdTreeMsgDef.deleteCurrentRow();continue}else{$.varUpdateList.push({rowType:"D",policy_id:aRow[i].policy_id});$.grdTreeMsgDef.deleteCurrentRow()}}else{$.grdTreeMsgDef.deleteCurrentRow()}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteMsgParent"){if(!validateControls([$.cmbQProduct,$.cmbQType])){return}var param={product_code:$.cmbQProduct.getValue(),channel:$.cmbQType.getValue()};g_main.openPopup("popALMsgParentList.html","popALMsgParentList","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){if(id=="bteMsgParent"){if(value==""){$.varALMsgParentId="";$.cmbMsgType.setValue("10")}}};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chkALEntry"){if(value=="Y"){$.speALEdit1.setEnable(false);$.speALLFrom.setEnable(false);$.speALLTo.setEnable(false);$.speALUFrom.setEnable(false);$.speALUTo.setEnable(false);$.speALTFrom.setEnable(false);$.speALTTo.setEnable(false);$.speALAFrom.setEnable(false);$.speALATo.setEnable(false);$.txtALL.setEnable(true);$.txtALU.setEnable(true);$.txtALT.setEnable(true);$.txtALA.setEnable(true);$.txtALL.setAllowBlank(false,"Loyalty");$.txtALU.setAllowBlank(false,"User");$.txtALT.setAllowBlank(false,"Try");$.txtALA.setAllowBlank(false,"Awareness")}else{if(value=="N"){$.speALEdit1.setEnable(true);$.txtALL.setEnable(false);$.txtALU.setEnable(false);$.txtALT.setEnable(false);$.txtALA.setEnable(false);$.speALLFrom.setEnable(true);$.speALLTo.setEnable(true);$.speALUFrom.setEnable(true);$.speALUTo.setEnable(true);$.speALTFrom.setEnable(true);$.speALTTo.setEnable(true);$.speALAFrom.setEnable(true);$.speALATo.setEnable(true);$.speALLFrom.setAllowBlank(false,"Loyalty Min");$.speALLTo.setAllowBlank(false,"Loyalty Max");$.speALUFrom.setAllowBlank(false,"User Min");$.speALUTo.setAllowBlank(false,"User Max");$.speALTFrom.setAllowBlank(false,"Try Min");$.speALTTo.setAllowBlank(false,"Try Max");$.speALAFrom.setAllowBlank(false,"Awareness Min");$.speALATo.setAllowBlank(false,"Awareness Max")}}}};$.fingercombobox_change=function(id,value){if(id=="cmbQHalf"||id=="cmbQProduct"||id=="cmbQType"){if($.dteQYear.getValue()==""||$.cmbQHalf.getValue()==""||$.cmbQProduct.getValue()==""||$.cmbQType.getValue()==""){return}searchAll()}else{if(id=="cmbContS"){calcContDef()}else{if(id=="cmbContK"){calcContDef()}else{if(id=="cmbContA"){calcContDef()}else{if(id=="cmbContG"){calcContDef()}else{if(id=="cmbMsgType"){if($.cmbMsgType.getValue()=="10"){$.bteMsgParent.setEnable(false);$.bteMsgParent.setValue("");$.varALMsgParentId=""}else{$.bteMsgParent.setEnable(true)}}}}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdTreeMsg"){$.varALMsgParentId=$.grdTreeMsg.getValue(rId,"parent_id");$.varALMsgId=$.grdTreeMsg.getValue(rId,"policy_id");$.cmbMsgType.setValue($.grdTreeMsg.getValue(rId,"policy_type"));$.bteMsgParent.setValue($.grdTreeMsg.getValue(rId,"parent_name"));$.speMsgSeq.setValue($.grdTreeMsg.getValue(rId,"order_seq"));$.txtMsgTitle.setValue($.grdTreeMsg.getValue(rId,"policy_title"));$.memMsgDesc.setValue($.grdTreeMsg.getValue(rId,"policy_desc"))}else{if(id=="grdMsgList"){$.varMsgAL=$.grdMsgList.getValue(rId,"al");$.varMsgGrade=$.grdMsgList.getValue(rId,"key_id");$.varUpdateList=[];$.panALMsgDef.enableButton(["btnSave"]);searchALMsgDef("AL_MSG_DEF");if($.grdMsgList.getValue(rId,"al_name")!=""){$.panALMsgDef.setText("전략/정책 할당 ("+$.grdMsgList.getValue(rId,"key_id")+", "+$.grdMsgList.getValue(rId,"al_name")+")")}else{$.panALMsgDef.setText("전략/정책 할당")}}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="speContPatient"||id=="speContTarget"||id=="speContS"||id=="speContK"||id=="speContA"||id=="speContG"){calcContDef()}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panALDef"){if(btnId=="btnSave"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}if($.chkALEntry.getValue()=="Y"){if(!validateControls([$.txtALL,$.txtALU,$.txtALT,$.txtALA])){return}}else{if(!validateControls([$.speALEdit1])){return}var lf=$.speALLFrom.getValue(),lt=$.speALLTo.getValue(),uf=$.speALUFrom.getValue(),ut=$.speALUTo.getValue(),tf=$.speALTFrom.getValue(),tt=$.speALTTo.getValue(),af=$.speALAFrom.getValue(),at=$.speALATo.getValue();if(lf!=0&&lt!=0&&(lf==""||lt=="")){MessageBoxShow("Loyalty 값은 필수입력 항목 입니다.");return}else{if(uf!=0&&ut!=0&&(uf==""||ut=="")){MessageBoxShow("User 값은 필수입력 항목 입니다.");return}else{if(tf!=0&&tt!=0&&(tf==""||tt=="")){MessageBoxShow("Try 값은 필수입력 항목 입니다.");return}else{if(af!=0&&at!=0&&(af==""||at=="")){MessageBoxShow("Awareness 값은 필수입력 항목 입니다.");return}}}}if(lf>lt){MessageBoxShow("Loyalty Min 값이 Loyalty Max 값보다 클 수 없습니다.");return}else{if(uf>ut){MessageBoxShow("User Min 값이 User Max 값보다 클 수 없습니다.");return}else{if(tf>tt){MessageBoxShow("Try Min 값이 Try Max 값보다 클 수 없습니다.");return}else{if(af>at){MessageBoxShow("Awareness Min 값이 Awareness Max 값보다 클 수 없습니다.");return}}}}if(ut>=lf){MessageBoxShow("User Max 값이 Loyalty Min 값보다 크거나 같을 수 없습니다.");return}else{if(tt>=uf){MessageBoxShow("Try Max 값이 User Min 값보다 크거나 같을 수 없습니다.");return}else{if(at>=tf){MessageBoxShow("Awareness Max 값이 Try Min 값보다 크거나 같을 수 없습니다.");return}}}if($.speALUTo.getValue()>=$.speALLFrom.getValue()&&$.speALUTo.getValue()<=$.speALLTo.getValue()){MessageBoxShow("User Max 값이 Loyalty 값에 포함될 수 없습니다.");return}else{if($.speALTTo.getValue()>=$.speALUFrom.getValue()&&$.speALTTo.getValue()<=$.speALUTo.getValue()){MessageBoxShow("Try Max 값이 User 값에 포함될 수 없습니다.");return}else{if($.speALATo.getValue()>=$.speALTFrom.getValue()&&$.speALATo.getValue()<=$.speALTTo.getValue()){MessageBoxShow("Awareness Max 값이 Try 값에 포함될 수 없습니다.");return}}}if(($.speALLTo.getValue()-$.speALLFrom.getValue())+($.speALUTo.getValue()-$.speALUFrom.getValue())+($.speALTTo.getValue()-$.speALTFrom.getValue())+($.speALATo.getValue()-$.speALAFrom.getValue())+3!=100){MessageBoxShow("0부터 100까지 모든 숫자가 포함되어야 합니다.");return}}if(saveALDef("N")){saveALDef("M_N");MessageBoxShow("정상적으로 저장되었습니다.");searchData("AL_DEF");searchData("AL_CONT");searchData("AL_RESULT")}}}else{if(panelId=="panContDef"){if(btnId=="btnSave"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}if(!validateControls([$.speContPatient,$.speContTarget,$.cmbContS,$.cmbContK,$.cmbContA,$.cmbContG,$.speContS,$.speContK,$.speContA,$.speContG])){return}if(saveALContDef("N")){searchData("AL_CONT");searchData("AL_RESULT");MessageBoxShow("정상적으로 저장되었습니다.")}}}else{if(panelId=="panALMsg"){if(btnId=="btnNew"){$.varALMsgId="";$.panALMsg.clear();var rId=$.grdTreeMsg.getSelectedRowIdx();if(rId&&rId>0){switch($.grdTreeMsg.getValue(rId,"policy_type")){case"10":$.cmbMsgType.setValue("20");$.bteMsgParent.setValue($.grdTreeMsg.getValue(rId,"policy_title"));$.varALMsgParentId=$.grdTreeMsg.getValue(rId,"policy_id");break;case"20":$.cmbMsgType.setValue("30");$.bteMsgParent.setValue($.grdTreeMsg.getValue(rId,"policy_title"));$.varALMsgParentId=$.grdTreeMsg.getValue(rId,"policy_id");break;case"30":$.cmbMsgType.setValue("30");$.bteMsgParent.setValue($.grdTreeMsg.getValue(rId,"parent_name"));$.varALMsgParentId=$.grdTreeMsg.getValue(rId,"parent_id");break;default:break}}else{$.cmbMsgType.setValue("10")}}else{if(btnId=="btnSave"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}if(!validateControls([$.cmbMsgType,$.txtMsgTitle,$.memMsgDesc])){return}if($.speMsgSeq.getValue()!=0&&$.speMsgSeq.getValue()==""){MessageBoxShow("정렬순서 은(는) 필수입력 항목입니다.")}var workType=$.varALMsgId==""?"N":"U";if(saveALMsg(workType)){searchData("AL_P_TREE");searchALMsgDef("AL_MSG_DEF");MessageBoxShow("정상적으로 저장되었습니다.")}}else{if(btnId=="btnDelete"){if($.varALMsgId==""){MessageBoxShow("삭제할 메시지를 선택하여 주시기 바랍니다.");return}confirmBoxShow("정말 삭제하시겠습니까?",function(){if(g_main.msgShare){if(saveALMsg("D")){$.varALMsgId="";$.varALMsgParentId="";searchData("AL_P_TREE");searchALMsgDef("AL_MSG_DEF");MessageBoxShow("정상적으로 삭제되었습니다.")}}})}}}}else{if(panelId=="panALMsgDef"){if(btnId=="btnSave"){if(!validateControls([$.dteQYear,$.cmbQHalf,$.cmbQProduct,$.cmbQType])){return}if($.varMsgGrade==""||$.varMsgAL==""){MessageBoxShow("저장할 등급 또는 AL을 선택하여 주시기 바랍니다.");return}if(saveALMsgDef()){searchData("AL_P_LIST");searchALMsgDef("AL_MSG_DEF");MessageBoxShow("정상적으로 저장되었습니다.");$.varUpdateList=[]}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popALMsgParentList"){if($.popUpCallId=="bteMsgParent"){if($.varALMsgId!=""){if($.varALMsgId==popResult.policy_id||(popResult.path).indexOf("|"+$.varALMsgId+"|")!=-1){MessageBoxShow("상위 메시지로 자신 또는 하위 메시지를 선택하실 수 없습니다.");return}}switch(popResult.policy_type){case"10":$.cmbMsgType.setValue("20");break;case"20":$.cmbMsgType.setValue("30");break;default:break}$.varALMsgParentId=popResult.policy_id;$.bteMsgParent.setValue(popResult.policy_title)}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){if(id=="tabAL"){if(tabid=="0"){if($.varUpdateList.length>0){$.tabAL.showTabPage(1);confirmBoxShow("저장할 AL 메시지 정의 데이터가 있습니다.<br>저장 하시겠습니까?",function(){if(g_main.msgShare){if(saveALMsgDef()){searchData("AL_P_LIST");searchALMsgDef("AL_MSG_DEF");MessageBoxShow("정상적으로 저장되었습니다.");$.varUpdateList=[]}}else{$.varUpdateList=[];$.tabAL.showTabPage(0)}})}}}};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>