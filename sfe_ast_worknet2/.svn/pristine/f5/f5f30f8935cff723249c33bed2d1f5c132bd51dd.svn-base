<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.lblHalf=null;$.cmbHalf=null;$.lblDept=null;$.cmbDept=null;$.lblProduct=null;$.cmbProduct=null;$.btnSearch=null;$.panList=null;$.grdList=null;$.btnWriteRead=null;$.btnCopy=null;$.panDetail=null;$.grdDetail=null;$.grdExcel=null;$.session=g_main.session.obj;$.isWrite=false;$.varDs=[];$.varMonthList=[];$.deleteRows=[];$.disabledSelect=true;$.varSelectId="";$.fixedSelectId="";$.varDt=[];function createJSON_Q(workType){var seq=0;var yh=$.cmbHalf.getValue();var half=$.cmbHalf.getValue().substr(5,1);var deptCode=$.cmbDept.getValue();var productCode=$.cmbProduct.getValue("product_code")||"";if(workType=="Q_RESULT"){var rowData=$.grdList.getValue($.varSelectId);yh=rowData.yyyy+"0"+rowData.half;half=rowData.half;deptCode=rowData.dept_code;productCode="";seq=rowData.seq}var json=createExecuteParamInfo("P_crmMKTKPI_Q",[workType,yh,half,"","",deptCode,seq,productCode,"","","","#UserID#"]);return json}function createJSON_S(workType){var rows=[];var dt=[];if(workType!="U_DETAIL"){dt=$.grdList.getChangedRows();var iCount=1;if($.deleteRows.length>0){for(var i in $.deleteRows){dt.push($.deleteRows[i])}}if(!dt.length){MessageBoxShow("저장할 내역이 없습니다.");return false}for(var i in dt){workType=(workType=="U_DETAIL"?workType:dt[i].rowType);rows.push([workType,$.cmbHalf.getValue(),$.cmbDept.getValue(),workType!="N"?dt[i].seq:1,dt[i].team_name||"",dt[i].product_code||"",dt[i].strategy||"",dt[i].kpi_description||"",dt[i].data_source||"",dt[i].data_source_standard||"",dt[i].channel,dt[i].value_type,dt[i].now_fy||0,dt[i].now_fy_text||"",dt[i].target_fy||0,dt[i].target_fy_text||"",dt[i].result_type||"",0,"",0,"",0,"",0,"",0,"",0,"",$.grdList.getGridIndexById(dt[i].id),"#UserID#"]);iCount++}}else{dt=$.grdDetail.getChangedRows();if(!dt.length){MessageBoxShow("변경된 내역이 없습니다.");return false}for(var i in dt){rows.push([workType,dt[i].yyyy+"0"+dt[i].half,dt[i].dept_code,dt[i].seq,"","","","","","","","",0,"",0,"",dt[i].result_type,dt[i].month1||0,dt[i].month_disp_text1||"",dt[i].month2||0,dt[i].month_disp_text2||"",dt[i].month3||0,dt[i].month_disp_text3||"",dt[i].month4||0,dt[i].month_disp_text4||"",dt[i].month5||0,dt[i].month_disp_text5||"",dt[i].month6||0,dt[i].month_disp_text6||"",0,"#UserID#"]);iCount++}}var json=createExecuteParamInfo("P_crmMKTKPI_S",rows);return json}function createJSON_S1(workType){$.grdList.editStop();var dt=$.grdList.getAllRows();var teamName="";var productCode="";var strategy="";var kpi="";var dataSource="";var dataSourceStandard="";var channel="";var valueType="";var beforFy="";var beforFyStr="";var afterFy="";var afterFyStr="";var sortSeq="";var addStr="|";for(var i=0;i<dt.length;i++){teamName+=(dt[i].team_name||"")+"|";productCode+=(dt[i].product_code||"")+"|";strategy+=(dt[i].strategy||"")+"|";kpi+=(dt[i].kpi_description||"")+"|";dataSource+=(dt[i].data_source||"")+"|";dataSourceStandard+=(dt[i].data_source_standard||"")+"|";channel+=(dt[i].channel||"")+"|";valueType+=(dt[i].value_type||"")+"|";beforFy+=(dt[i].now_fy||"")+"|";beforFyStr+=(dt[i].now_fy_text||"")+"|";afterFy+=(dt[i].target_fy.toString()||"")+"|";afterFyStr+=(dt[i].target_fy_text||"")+"|";sortSeq+=i.toString()+"|"}var json=createExecuteParamInfo("P_crmMKTKPI_S",[workType,"","",0,"","","","","","","","",0,"",0,"","",0,"",0,"",0,"",0,"",0,"",0,"",0,"",teamName.substr(0,teamName.length-1),productCode.substr(0,productCode.length-1),strategy.substr(0,strategy.length-1),kpi.substr(0,kpi.length-1),dataSource.substr(0,dataSource.length-1),dataSourceStandard.substr(0,dataSourceStandard.length-1),channel.substr(0,channel.length-1),valueType.substr(0,valueType.length-1),beforFy.substr(0,beforFy.length-1),beforFyStr.substr(0,beforFyStr.length-1),afterFy.substr(0,afterFy.length-1),afterFyStr.substr(0,afterFyStr.length-1),sortSeq.substr(0,sortSeq.length-1)]);return json}function searchList(workType){if(workType=="Q_HALF"){if(!$.panTop.validateControls()){return}}var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function seachProductList(workType){var json=createJSON_Q(workType);var ds=callQuerySync(["req",json],$);$.cmbProduct.clear();setComboBind([$.cmbProduct],ds);if($.varProductCode){$.cmbProduct.setValue($.varProductCode)}}function searchGridRowNum(workType){var json=createJSON_S1(workType);var ds=callQuerySync(["req",json],$);if(ds){$.varDt=ds.resultList[0]}}function saveList(workType){var type=workType;if(!workType){if(!$.panTop.validateControls()){return}type="SAVE"}var json=createJSON_S(workType);if(json){callExecute(["req",json],type,$)}}function initView(){$.varCodeArr=[{sub_code:"10",code_name:"당월"},{sub_code:"20",code_name:"누적"},];$.varDs=bizComponentData2($,"Q1","L_CRM250|L_CRM280|L_MKT001");setComboBind([$.cmbHalf,$.cmbDept],$.varDs);$.grdList.setColumnDropDownList("value_type",$.varDs.resultList[2]);if($.varDs.resultList[0]&&$.varDs.resultList[0].length){var yyyy=getToday().substr(0,4);var mm=Number(getToday().substr(4,2));var half="";if(mm>3&&mm<10){half="01"}else{half="02"}$.cmbHalf.setValue(yyyy+half);var json=createJSON_Q("Q_MONTH");var ds=callQuerySync(["req",json],$);$.varMonthList=ds.resultList[0];changeColumnList($.varMonthList)}$.grdDetail.setColumnDropDownList("result_type",$.varCodeArr);var compDeptCode=$.session.DeptCode.substr(0,2);log(compDeptCode);if(compDeptCode=="F2"||compDeptCode=="F3"){$.cmbDept.setValue(compDeptCode+"00")}changeButtonEvent()}function initData(){$.isWrite=false;$.disabledSelect=true;$.varSelectId="";$.fixedSelectId="";$.varDt=[];$.deleteRows=[];$.grdDetail.clear()}function changeButtonEvent(){if(!$.isWrite){$.btnWriteRead.setText("데이터 편집")}else{$.btnWriteRead.setText("읽기")}mergeDataGridCell();$.isWrite=!$.isWrite}function mergeDataGridCell(){$.grdList.editStop();$.grdList.clearSelect();if($.isWrite){$.grdList.removeColumns();$.grdList.resetColumns(initGridColumn());$.grdList.setEditable(true);changeColumnList($.varMonthList);$.grdList.setColumnDropDownList("value_type",$.varDs.resultList[2]);var data=deepCopyObj($.grdList.getAllRows());if(data&&data.length){setDataGrid([$.grdList],data,true)}$.disabledSelect=true;$.grdList.selectRow(0);$.grdList.clearSelect();$.disabledSelect=false;if($.fixedSelectId){$.grdList.selectRow($.fixedSelectId)}}else{$.grdList.setEditable(false);setTimeout(function(){$.disabledSelect=true;var colArr=["team_name","product_code","strategy","kpi_description","data_source","data_source_standard","channel","value_type","now_fy","now_fy_text","target_fy","target_fy_text"];if(!$.varDt.length){$.grdList.setRowSpanCustom(colArr,"grid-text-center")}else{$.grdList.setRowSpanCustomModify(colArr,"grid-text-center",$.varDt)}$.grdList.selectRow(0);$.grdList.clearSelect();$.disabledSelect=false;if($.fixedSelectId){$.grdList.selectRow($.fixedSelectId)}},10)}}function initGridColumn(){return[new FingerDataGridColumn("team_name",73,"center","string",[{text:"Team",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("product_code",70,"center","multi_line_edit",[{text:"Product",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("strategy",180,"center","multi_line_edit",[{text:"Strategy",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("kpi_description",180,"center","multi_line_edit",[{text:"KPI description",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("data_source",120,"center","multi_line_edit",[{text:"Data Source",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("data_source_standard",150,"center","multi_line_edit",[{text:"Data Source/기준",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("channel",90,"center","multi_line_edit",[{text:"Channel",rowspan:2},""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null,cssFormat:setCustomCellStyle}),new FingerDataGridColumn("value_type",95,"center","string",[{text:"수치단위",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("now_fy",60,"center","int",[{text:"FY17",colspan:2},{text:"수치"}],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("now_fy_text",65,"center","multi_line_edit",["",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("target_fy",60,"center","int",[{text:"FY17",colspan:2},{text:"수치"}],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("target_fy_text",65,"center","multi_line_edit",["",{text:"기타<br>(표시)",css:"multi_h_line"}],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("team_name_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("product_codee_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("strategy_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("kpi_description_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("data_source_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("data_source_standard_num",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("team_name_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("product_codee_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("strategy_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("kpi_description_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("data_source_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("data_source_standard_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("channel_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("now_fy_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("now_fy_text_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("target_fy_standard_rowspan",70,"center","multi_line_edit","",{hidden:true}),new FingerDataGridColumn("target_fy_text_rowspan",70,"center","multi_line_edit","",{hidden:true})]}function changeColumnList(dt,headerLine){if(dt.length){var monthList=dt;for(var i=0;i<monthList.length;i++){$.grdDetail.setColumnText("month"+(i+1),monthList[i].month_name,2);$.grdExcel.setColumnText("month"+(i+1),monthList[i].month_name,2)}var year=Number($.cmbHalf.getValue().substr(2,2));var str="FY"+(monthList[0].half=="1"?year+"(상)":year+"(하)");$.grdDetail.setColumnText("result_type",str,1);$.grdExcel.setColumnText("result_type",str,1);$.grdList.setColumnText("now_fy","FY"+(year-1),1);$.grdList.setColumnText("target_fy","FY"+year+" Target",1);$.grdExcel.setColumnText("now_fy","FY"+(year-1),1);$.grdExcel.setColumnText("target_fy","FY"+year+" Target",1)}}function gridValidator(gridId,columnArr){if(!gridId){return}for(var i=0;i<gridId.getRowCount();i++){for(var j=0;j<columnArr.length;j++){if(gridId.getValue(i,columnArr[j])==""||gridId.getValue(i,columnArr[j])==null){if(columnArr[j]=="result_type"){MessageBoxShow("당월/누적 선택은(는) 필수 입력항목입니다")}else{MessageBoxShow(gridId.getColumnText(columnArr[j])+" 은(는) 필수 입력항목입니다")}gridId.selectRow(i);return false}}}return true}webix.extend(webix.ui.datatable,{autoAdjustRowHeight:function(id,silent,rId){function processRow(that,obj){var h=[that.config.rowHeight],config;for(var i=0;i<id.length;i++){config=that.getColumnConfig(id[i]);d.style.width=config.width+"px";d.innerHTML=obj[id[i]];h.push(d.scrollHeight)}obj.$height=Math.max.apply(null,h)}if(typeof id=="string"){id=[id]}var d=webix.html.create("DIV",{"class":"webix_table_cell webix_measure_size webix_cell"},"");d.style.cssText="height:1px; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;";this.$view.appendChild(d);if(rId){var obj=this.getItem(rId);processRow(this,obj)}else{this.data.each(function(obj){processRow(this,obj)},this)}d=webix.html.remove(d);if(!silent){this.refresh()}}});function setCustomCellStyle(a,b,c,d){return{"word-break":"break-all"}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,985);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,55);$.panTop.setText("");$.panTop.setBottomLine(true);$.lblHalf=new FingerLabel(host,"lblHalf",0,15,100,20);$.lblHalf.setText("년도/반기");$.cmbHalf=new FingerComboBox(host,"cmbHalf",105,15,140,20);$.lblDept=new FingerLabel(host,"lblDept",215,15,100,20);$.lblDept.setText("부서");$.cmbDept=new FingerComboBox(host,"cmbDept",320,15,140,20);$.lblProduct=new FingerLabel(host,"lblProduct",430,15,100,20);$.lblProduct.setText("품목");$.cmbProduct=new FingerComboBox(host,"cmbProduct",535,15,140,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.panList=new FingerPanel(host,"panList",0,65,1200,600);$.panList.setText("MKT KPI");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,555);$.btnWriteRead=new FingerButton(host,"btnWriteRead",673,-40,110,30);$.btnWriteRead.setText("");$.btnCopy=new FingerButton(host,"btnCopy",769,-40,120,30);$.btnCopy.setText("선택된 행 복사");$.panDetail=new FingerPanel(host,"panDetail",0,675,1200,283);$.panDetail.setText("MKT KPI 월별");$.panDetail.setBottomLine(true);$.grdDetail=new FingerDataGrid(host,"grdDetail",0,0,1200,238);$.grdExcel=new FingerDataGrid(host,"grdExcel",0,0,10,10);$.panTop.setBorder(true);$.panList.addButton("btnExcelDown","엑셀다운로드");$.panList.setButtonAction("btnExcelDown","excel_down");$.panList.addButtons(["btnDelete","btnSave","btnAdd"]);$.panDetail.addButtons(["btnSave"]);$.cmbDept.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbHalf.setColumn("code","name");$.cmbProduct.setColumn("seq","product_code");$.cmbDept.setColumn("dept_code","dept_name");$.cmbProduct.setColumnConfig([{id:"seq",width:70},{id:"product_code",width:190}]);$.cmbHalf.setAllowBlank(false,"년도/반기");$.cmbDept.setAllowBlank(false,"부서");$.btnCopy.setClass("btn_add");$.grdList.colIdx=$.grdList.setColumns(initGridColumn());$.grdList.init({scroll:"xy",headerRowHeight:40,rowHeight:70});$.grdList.setEditable(false);$.grdList.setBorder(false);$.grdList.setGridMultiLineAutoHeight();$.grdDetail.colIdx=$.grdDetail.setColumns([new FingerDataGridColumn("result_type",96,"center","string",[{text:"FY18(상)",colspan:13},{text:"",rowspan:2},""],{readonly:true,verticalMiddle:true,sort:null}),new FingerDataGridColumn("month1",92,"center","int",["",{text:"",colspan:2},{text:"수치",colspan:1}],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text1",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month2",92,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text2",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month3",92,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text3",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month4",92,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text4",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month5",92,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text5",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month6",92,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text6",92,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("yyyy",0,"center","string","",{hidden:true}),new FingerDataGridColumn("dept_code",0,"center","string","",{hidden:true}),new FingerDataGridColumn("half",0,"center","string","",{hidden:true}),new FingerDataGridColumn("seq",0,"center","string","",{hidden:true})]);$.grdDetail.init({scroll:"none",rowHeight:70});$.grdDetail.setEditable(true);$.grdDetail.setBorder(false);$.grdExcel.setVisible(false);$.grdExcel.colIdx=$.grdExcel.setColumns([new FingerDataGridColumn("team_name",80,"center","string",[{text:"Team",rowspan:3},"",""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("product_code",80,"center","multi_line_edit",[{text:"Product",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("strategy",200,"center","multi_line_edit",[{text:"Strategy",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("kpi_description",200,"center","multi_line_edit",[{text:"KPI description",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("data_source",150,"center","multi_line_edit",[{text:"Data Source",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("data_source_standard",200,"center","multi_line_edit",[{text:"Data Source/기준",rowspan:3},"",""],{adjustRowHeight:true,verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("channel",150,"center","string",[{text:"Channel",rowspan:3},"",""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("now_fy",70,"center","int",[{text:"FY17",colspan:2},{text:"수치",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("now_fy_text",70,"center","multi_line_edit",["",{text:"기타",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("target_fy",70,"center","int",[{text:"FY17",colspan:2},{text:"수치",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("target_fy_text",70,"center","multi_line_edit",["",{text:"기타",rowspan:2},""],{verticalMiddle:true,hiddenRowSpan:true,multiSpan:true,sort:null}),new FingerDataGridColumn("result_type",70,"center","string",[{text:"FY18(상)",colspan:13},{text:"",rowspan:2},""],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month1",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text1",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null,alignCenter:true}),new FingerDataGridColumn("month2",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text2",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month3",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text3",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month4",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text4",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month5",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text5",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null}),new FingerDataGridColumn("month6",70,"center","int",["",{text:"",colspan:2},"수치"],{verticalMiddle:true,format:"int_d_zero",sort:null}),new FingerDataGridColumn("month_disp_text6",70,"center","multi_line_edit",["","","기타(표시)"],{verticalMiddle:true,sort:null})]);$.grdExcel.init({rowHeight:70});$.grdExcel.setGridMultiLineAutoHeight();$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panList);$.panMain.add($.panDetail);$.panMain.add($.grdExcel);$.panTop.add($.cmbProduct);$.panTop.add($.lblProduct);$.panTop.add($.cmbDept);$.panTop.add($.lblDept);$.panTop.add($.cmbHalf);$.panTop.add($.lblHalf);$.panTop.add($.btnSearch);$.panList.add($.grdList);$.panList.add($.btnWriteRead);$.panList.add($.btnCopy);$.panDetail.add($.grdDetail);initView()};$.callback=function(type,ds){if(type=="Q_HALF"){initData();setDataGrid([$.grdList],ds.resultList[0],true);setDataGrid([$.grdExcel],ds.resultList[2],true);$.varMonthList=ds.resultList[1];changeButtonEvent();changeColumnList($.varMonthList);seachProductList("Q_PRODUCT");$.disabledSelect=false}else{if(type=="Q_RESULT"){setDataGrid([$.grdDetail],ds)}else{if(type=="SAVE"){if(ds){MessageBoxShow("정상적으로 저장 되었습니다.");searchList("Q_HALF")}}else{if(type=="U_DETAIL"){if(ds){MessageBoxShow("정상적으로 저장 되었습니다.");searchList("Q_RESULT")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList("Q_HALF")}else{if(id=="btnWriteRead"){if(!$.isWrite&&$.grdList.getRowCount()){searchGridRowNum("S")}changeButtonEvent()}else{if(id=="btnCopy"){if($.isWrite){MessageBoxShow("편집상태일때만 복사가 가능합니다.");return}var rId=$.grdList.getSelectedRowIdx();if(!rId){MessageBoxShow("복사할 내역을 선택하세요.");return}$.grdDetail.clear();$.disabledSelect=true;var rowData=deepCopyObj($.grdList.getValue(rId));rowData.rowType="N";rowData.$height=100;delete rowData.id;$.grdList.addRow(rowData);$.varSelectId="";$.disabledSelect=false}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbHalf"||id=="cmbDept"){if(!value){return}$.varProductCode="";seachProductList("Q_PRODUCT")}else{if(id=="cmbProdcut"){$.varProductCode=value}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){var rowData=$.grdList.getValue(rId);if(rowData.rowType&&rowData.rowType=="N"){$.varSelectId=rId;$.fixedSelectId=rId;$.grdDetail.clear();return}if($.disabledSelect){return}if($.varSelectId==rId){return}$.varSelectId=rId;$.fixedSelectId=rId;searchList("Q_RESULT")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList"){if(cInd=="now_fy"||cInd=="target_fy"){var inputData=nValue.toString();if(inputData.trim()==""||isNaN(inputData)){$.grdList.setValue(rId,cInd,oValue==""?"":oValue)}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){$.grdList.editStop();$.grdDetail.editStop();if(panelId=="panList"){if(btnId=="btnAdd"){if($.isWrite){MessageBoxShow("편집상태일때만 추가가 가능합니다.");return}$.grdDetail.clear();$.disabledSelect=true;$.grdList.addRow({team_name:"",product_code:"",strategy:"",kpi_description:"",data_source:"",data_source_standard:"",channel:"",now_fy:0,now_fy_text:"",target_fy:0,target_fy_text:""});$.varSelectId="";$.disabledSelect=false}else{if(btnId=="btnSave"){if($.isWrite){MessageBoxShow("편집상태일때만 저장이 가능합니다.");return}if(!gridValidator($.grdList,["team_name","product_code","strategy","kpi_description","channel"])){return}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("")}})}else{if(btnId=="btnDelete"){if($.isWrite){MessageBoxShow("편집상태일떄만 삭제가 가능합니다.");return}var rId=$.grdList.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 내역을 선택하세요.");return}if($.grdList.getRowStatus(rId)!="N"){confirmBoxShow("삭제하시겠습니까?",function(){if(g_main.msgShare==true){$.grdList.getItem(rId).rowType="D";$.deleteRows.push($.grdList.getValue(rId));$.grdList.deleteCurrentRow()}})}else{$.grdList.deleteCurrentRow()}}else{if(btnId=="btnExcelDown"){if(!$.grdList.getRowCount()){MessageBoxShow("엑셀로 출력할 데이터가 없습니다.");return}var grdListChangedRows=$.grdList.getChangedRows();var grdDetailChangedRows=$.grdDetail.getChangedRows();if(!$.isWrite){MessageBoxShow("읽기상태일때만 엑셀다운이 가능합니다.");return}var xlsCols=[];var cols=$.grdExcel.columns;var type="";for(var i in cols){type=(cols[i].type=="multi_line_edit"?"string":cols[i].type);xlsCols.push({header:cols[i].header,datatype:type,datafield:cols[i].id,width:(cols[i].width+"px"),ishidden:(cols[i].excelHidden===true?true:(cols[i].hidden?true:false)),docNum:(cols[i].docNum?true:false),instId:(cols[i].instId?true:false),tableBorder:(cols[i].borderCss?true:false),rowSpan:(cols[i].rowSpan||cols[i].hiddenRowSpan?true:false),multiSpan:(cols[i].multiSpan?true:false)})}for(var i=0;i<xlsCols.length;i++){var headerList=xlsCols[i].header;for(var j=0;j<headerList.length;j++){if(headerList[j]){var count=(headerList[j].text.match(/<br>/g)||[]).length;if(count>1){headerList[j].text=headerList[j].text.replace("<br>","")}headerList[j].text=headerList[j].text.replace("<br>","<br style='mso-data-placement: same-cell'>")}}}var xlsDataSet=$.grdExcel.getExcelRows();for(var i=0;i<xlsDataSet.length;i++){var rowData=xlsDataSet[i];for(var j=0;j<$.varCodeArr.length;j++){if(rowData.result_type==$.varCodeArr[j].sub_code){rowData.result_type=$.varCodeArr[j].code_name}}}var fileName="[MKT KPI]"+($.cmbHalf.getValue("name")||"")+" "+($.cmbDept.getValue("dept_name")||"");excelexportjs({containerid:"dvjson",datatype:"jsoncss",dataset:xlsDataSet,columns:xlsCols,tableBorder:true,worksheetName:"Sheet1",xlsFileName:fileName})}}}}}else{if(panelId=="panDetail"){if(btnId=="btnSave"){confirmBoxShow("저장하시겠습니까?",function(){if(g_main.msgShare==true){saveList("U_DETAIL")}})}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>