<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.grdList=null;$.lbl_base_date=null;$.dte_base_date=null;$.lbl_site_code=null;$.cmb_site_code=null;$.lbl_pay_yyyymm=null;$.dte_pay_yyyymm_fr=null;$.lbl_Ex1=null;$.dte_pay_yyyymm_to=null;$.lbl_bonus_yyyymm=null;$.dte_bonus_yyyymm_fr=null;$.lbl_Ex2=null;$.dte_bonus_yyyymm_to=null;$.lbl_bal_pay_days=null;$.spe_bal_pay_days=null;$.btnSearch=null;$.btnSum=null;function createJson_Q(workType){var json=createExecuteParamInfo("HR..P_HRA5500_Q",[workType,$.dte_base_date.getValue(),$.cmb_site_code.getValue(),$.dte_pay_yyyymm_fr.getValue(),$.dte_pay_yyyymm_to.getValue(),$.dte_bonus_yyyymm_fr.getValue(),$.dte_bonus_yyyymm_to.getValue()]);return json}function createJson_S(workType){var json;var rows=[];if(workType=="U"){var gRow=$.grdList.getChangedRows();if(gRow.length<1){return false}for(var i in gRow){workType=gRow[i].rowType;rows.push([workType,$.dte_base_date.getValue(),$.cmb_site_code.getValue(),$.dte_pay_yyyymm_fr.getValue(),$.dte_pay_yyyymm_to.getValue(),$.dte_bonus_yyyymm_fr.getValue(),$.dte_bonus_yyyymm_to.getValue(),Number($.spe_bal_pay_days.getValue()),gRow[i].emp_code,Number(gRow[i].working_day_cnt),Number(gRow[i].avg_pay_sum),Number(gRow[i].retire_estimate_amt),Number(gRow[i].retire_amt),"#UserID#","#HostInfo#"])}}else{rows.push([workType,$.dte_base_date.getValue(),$.cmb_site_code.getValue(),$.dte_pay_yyyymm_fr.getValue(),$.dte_pay_yyyymm_to.getValue(),$.dte_bonus_yyyymm_fr.getValue(),$.dte_bonus_yyyymm_to.getValue(),Number($.spe_bal_pay_days.getValue()),"",0,0,0,0,"#UserID#","#HostInfo#"])}json=createExecuteParamInfo("HR..P_HRA5500_S",rows);return json}function searchHRA5500(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function saveHRA5500(workType){if(!$.panQuery.validateControls()){return}var json=createJson_S(workType);if(json){callExecute(["req",json],workType,$)}}function initControlProp(){$.dte_pay_yyyymm_fr.setDateFormat("yyyymm");$.dte_pay_yyyymm_to.setDateFormat("yyyymm");$.dte_bonus_yyyymm_fr.setDateFormat("yyyymm");$.dte_bonus_yyyymm_to.setDateFormat("yyyymm");$.dte_base_date.setAllowBlank(false,"기준일자");$.cmb_site_code.setAllowBlank(false,"사업장");$.dte_pay_yyyymm_fr.setAllowBlank(false,"급여기간 시작일");$.dte_pay_yyyymm_to.setAllowBlank(false,"급여기간 종료일");$.dte_bonus_yyyymm_fr.setAllowBlank(false,"상여기간 시작일");$.dte_bonus_yyyymm_to.setAllowBlank(false,"상여기간 종료일");$.cmb_site_code.setEmptyRow(true);$.spe_bal_pay_days.setValue(0);saveButton(false)}function bizComponentBinding(){var ds=bizComponentData2($,"Q1","L_ORG001|L_HRI002");$.cmb_site_code.setColumn("site_code","site_name");setComboBind([$.cmb_site_code],ds);$.grdList.setColumnDropDownList("site_code",ds.resultList[0],{key:"site_code",name:"site_name"});$.grdList.setColumnDropDownList("position_code",ds.resultList[1])}function queryClick(){searchHRA5500("Q")}function newClick(){calcDate();$.grdList.clear()}function calcDate(){var base_date=$.dte_base_date.getValue();$.dte_pay_yyyymm_to.setValue(base_date);$.dte_pay_yyyymm_fr.setValue(calcMonth(base_date,-2));$.dte_bonus_yyyymm_to.setValue(base_date);$.dte_bonus_yyyymm_fr.setValue(calcMonth(base_date,-11))}function deleteClick(){if($.grdList.getRowCount()<1){return}confirmBoxShow($.dte_base_date.getValue()+"에 해당하는 정보를 정말 삭제하시겠습니까?",function(){if(g_main.msgShare==true){saveHRA5500("D")}})}function saveClick(){confirmBoxShow($.dte_base_date.getValue()+"에 해당하는 정보를 저장하시겠습니까?",function(){if(g_main.msgShare==true){saveHRA5500("U")}})}function saveButton(bo){if(bo){$.panList.enableButton(["btnSave"])}else{$.panList.disableButton(["btnSave"])}}function column_cell_valueChange(data){for(var i in data){var dretire_amt=Number(data[i].retire_estimate_amt)-Number(data[i].last_retire_estimate_amt);data[i].retire_amt=dretire_amt}}function calcMonth(yyyymmdd,calcMon){if(!yyyymmdd||yyyymmdd.length!=8){return}var dt=new Date(yyyymmdd.substr(0,4),Number(yyyymmdd.substr(4,2))-1,yyyymmdd.substr(6,2));var year=dt.getFullYear();var month=dt.getMonth()+calcMon;if(month<=0){year=year-1;month=month+12}dt.setDate(1);dt.setYear(year);dt.setMonth(month);return dt.getFullYear()+addZero(eval(dt.getMonth()+1))+addZero(dt.getDate())}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,750);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,85);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,95,1200,635);$.panList.setText("퇴직금 추계액 조회");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,590);$.lbl_base_date=new FingerLabel(host,"lbl_base_date",0,15,100,20);$.lbl_base_date.setText("기준일자");$.dte_base_date=new FingerDateEdit(host,"dte_base_date",105,15,110,20);$.lbl_site_code=new FingerLabel(host,"lbl_site_code",365,15,90,20);$.lbl_site_code.setText("사업장");$.cmb_site_code=new FingerComboBox(host,"cmb_site_code",460,15,249,20);$.lbl_pay_yyyymm=new FingerLabel(host,"lbl_pay_yyyymm",0,45,100,20);$.lbl_pay_yyyymm.setText("급여기간");$.dte_pay_yyyymm_fr=new FingerDateEdit(host,"dte_pay_yyyymm_fr",105,45,110,20);$.lbl_Ex1=new FingerLabel(host,"lbl_Ex1",215,45,20,20);$.lbl_Ex1.setText("~");$.dte_pay_yyyymm_to=new FingerDateEdit(host,"dte_pay_yyyymm_to",240,45,110,20);$.lbl_bonus_yyyymm=new FingerLabel(host,"lbl_bonus_yyyymm",355,45,100,20);$.lbl_bonus_yyyymm.setText("상여기간");$.dte_bonus_yyyymm_fr=new FingerDateEdit(host,"dte_bonus_yyyymm_fr",460,45,110,20);$.lbl_Ex2=new FingerLabel(host,"lbl_Ex2",570,45,20,20);$.lbl_Ex2.setText("~");$.dte_bonus_yyyymm_to=new FingerDateEdit(host,"dte_bonus_yyyymm_to",595,45,110,20);$.lbl_bal_pay_days=new FingerLabel(host,"lbl_bal_pay_days",730,45,130,20);$.lbl_bal_pay_days.setText("근무일수차감일수");$.spe_bal_pay_days=new FingerSpinEdit(host,"spe_bal_pay_days",865,45,70,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,45,80,20);$.btnSearch.setText("조회");$.btnSum=new FingerButton(host,"btnSum",820,-40,150,30);$.btnSum.setText("추계액 계산");$.panQuery.setBorder(true);$.panList.addButtons(["btnDelete","btnSave","btnNew"]);initControlProp();$.grdList.setColumns([new FingerDataGridColumn("site_code",110,"left","string","사업장",{readonly:true}),new FingerDataGridColumn("emp_code",90,"left","string","사번",{readonly:true}),new FingerDataGridColumn("emp_name",70,"left","string","성명",{readonly:true}),new FingerDataGridColumn("dept_name",110,"left","string","부서",{readonly:true}),new FingerDataGridColumn("position_code",70,"left","string","직위",{readonly:true}),new FingerDataGridColumn("enter_date",90,"left","string","입사일",{readonly:true,format:"s_ymd"}),new FingerDataGridColumn("last_calc_date",90,"left","string","중도정산일",{readonly:true,format:"s_ymd",footer:{text:"",colspan:6}}),new FingerDataGridColumn("work_year_cnt",80,"right","int","근속년수",{readonly:true,format:"int"}),new FingerDataGridColumn("work_month_cnt",80,"right","int","개월",{readonly:true,format:"int"}),new FingerDataGridColumn("work_day_cnt",80,"right","int","일",{readonly:true,format:"int"}),new FingerDataGridColumn("working_day_cnt",90,"right","int","근무일수",{format:"int"}),new FingerDataGridColumn("pay_day_cnt",90,"right","int","급여일수",{readonly:true,format:"int"}),new FingerDataGridColumn("target_pay_amt",105,"right","int","대상급여",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("target_bonus_amt",105,"right","int","대상상여",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("annual_benefit_amt",105,"right","int","연차수당",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("avg_pay_amt",105,"right","int","평균급여",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("avg_bonus_amt",105,"right","int","평균상여",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("avg_pay_sum",105,"right","int","평균임금",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("retire_estimate_amt",125,"right","int","퇴직금추계액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("last_retire_estimate_amt",125,"right","int","전월퇴직금추계액",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("retire_amt",125,"right","int","퇴직충당금",{readonly:true,format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("modify_yn",80,"center","checkbox","수정여부",{readonly:true})]);$.grdList.init({panel:$.panList,scroll:"xy",footer:true,leftSplit:6,isFilter:false,nonExcel:true,eventCellReadOnly:true});$.grdList.setBorder(false);$.grdList.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panQuery.add($.spe_bal_pay_days);$.panQuery.add($.lbl_bal_pay_days);$.panQuery.add($.dte_bonus_yyyymm_to);$.panQuery.add($.lbl_Ex2);$.panQuery.add($.dte_bonus_yyyymm_fr);$.panQuery.add($.lbl_bonus_yyyymm);$.panQuery.add($.dte_pay_yyyymm_to);$.panQuery.add($.lbl_Ex1);$.panQuery.add($.dte_pay_yyyymm_fr);$.panQuery.add($.lbl_pay_yyyymm);$.panQuery.add($.cmb_site_code);$.panQuery.add($.lbl_site_code);$.panQuery.add($.dte_base_date);$.panQuery.add($.lbl_base_date);$.panQuery.add($.btnSearch);$.panList.add($.grdList);$.panList.add($.btnSum);bizComponentBinding();var strDate=getToday("");var session=g_main.session.obj;$.cmb_site_code.setValue(session.SiteCode);$.dte_base_date.setValue(strDate);$.dte_pay_yyyymm_to.setValue(strDate);$.dte_pay_yyyymm_fr.setValue(getCalcMonth(strDate,-2));$.dte_bonus_yyyymm_to.setValue(strDate);$.dte_bonus_yyyymm_fr.setValue(getCalcMonth(strDate,-11));queryClick()};$.callback=function(type,ds){if(type=="Q"){if(ds){var rs=ds.resultList[0][0];var rs1=ds.resultList[1];log(rs);if(rs){$.dte_base_date.setValue(rs.base_date);$.cmb_site_code.setValue(rs.site_code);$.dte_pay_yyyymm_fr.setValue(rs.pay_yyyymm_fr);$.dte_pay_yyyymm_to.setValue(rs.pay_yyyymm_to);$.dte_bonus_yyyymm_fr.setValue(rs.bonus_yyyymm_fr);$.dte_bonus_yyyymm_to.setValue(rs.bonus_yyyymm_to)}if(rs1&&rs1.length>0){column_cell_valueChange(rs1)}setDataGrid([$.grdList],rs1,true);$.grdList.selectRow(0);saveButton(false);if($.grdList.getRowCount()<1){newClick()}}}else{if(type=="U"||type=="D"){if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);return}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);return}}MessageBoxShow("정상적으로 "+(type=="U"?"저장":"삭제")+"되었습니다.");queryClick()}}else{if(type=="CALC"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){if(ds.errorCode=="P_HRA5500_S_001"){confirmBoxShow("동일한 기준일자에 중복된 데이터가 있습니다. 다시 추계액을 계산 하시겠습니까?",function(){if(g_main.msgShare==true){saveHRA5500("CALC_CONF")}})}else{MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}}else{queryClick()}}}else{if(type=="CALC_CONF"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg)}else{queryClick()}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){queryClick()}else{if(id=="btnSum"){saveHRA5500("CALC")}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dte_base_date"){calcDate()}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){var data=$.grdList.getValue(rId);data.site_code_readonly=true;data.position_code_readonly=true}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){saveButton(true);if(id=="grdList"){if(cInd=="retire_estimate_amt"){var data=$.grdList.getValue(rId);var dretire_amt=Number(data.retire_estimate_amt)-Number(data.last_retire_estimate_amt);data.retire_amt=dretire_amt}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnSave"){saveClick()}else{if(btnId=="btnDelete"){deleteClick()}else{if(btnId=="btnNew"){newClick()}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>