<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panMaster=null;$.panList1=null;$.panList2=null;$.grdMaster=null;$.grdList2=null;$.btnSearch=null;$.lbljob_yyyy=null;$.ymdjob_yyyy=null;$.lblsite_code=null;$.cmbsite_code=null;$.lblearner_code=null;$.txtearner_code=null;$.txtearner_name=null;$.lblsocial_no=null;$.txtsocial_no=null;$.lbljob_yyyy1=null;$.ymdjob_yyyy1=null;$.lblsite_code1=null;$.cmbsite_code1=null;$.lblearner_code1=null;$.txtearner_code1=null;$.txtearner_name1=null;$.lblstatus=null;$.cmbstatus=null;$.lblsocial_no1=null;$.txtsocial_no1=null;$.lblbusiness_type=null;$.cmbbusiness_type=null;$.lblcomp_name=null;$.txtcomp_name=null;$.lblbiz_regno1=null;$.txtbiz_regno1=null;$.lblreside_type=null;$.cmbreside_type=null;$.lblnation_code=null;$.cmbnation_code=null;$.lblincome_sec=null;$.cmbincome_sec=null;$.lblincome_type=null;$.cmbincome_type=null;$.lblremark=null;$.txtremark=null;$.lbladd_tax_yn=null;$.chkadd_tax_yn=null;var strTaxRate;var dIndexTaxRateH;var dIndexTaxRateL;var dTaxRateH;var dTaxRateL;var dAmtRate;var strStatus="";function NewClick(){$.panList1.clear();$.grdList2.clear();fnControlSetting(true);var dt=String($.ymdjob_yyyy.getValue());$.ymdjob_yyyy1.setValue(dt);$.cmbsite_code1.setValue(g_main.session.obj.SiteCode);$.cmbnation_code.setValue("KR");$.cmbincome_sec.setReadOnly(true);strStatus=false}function fnControlSetting(bNew){$.ymdjob_yyyy1.setEnable(bNew);$.txtearner_code1.setEnable(bNew);$.txtearner_name1.setEnable(bNew);$.cmbsite_code1.setReadOnly(!bNew);$.cmbstatus.setReadOnly(!bNew)}function QueryClick(){var iBeforeRow=$.grdMaster.getSelectedRowIdx();fnQRY_P_HRA3200_Q("MASTER");if($.grdMaster.getRowCount()<1){NewClick()}}function fnQRY_P_HRA3200_Q(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function createJSON_Q(workType){var rId1=$.grdMaster.getSelectedRowIdx();var rId2=$.grdList2.getSelectedRowIdx();var json=createExecuteParamInfo("HR..P_HRA3200_Q",[workType,workType=="MASTER"||workType=="income_sec"?$.ymdjob_yyyy.getValue():$.grdMaster.getValue(rId1,"job_yyyy"),workType=="MASTER"||workType=="income_sec"?$.txtearner_code.getValue():$.grdMaster.getValue(rId1,"earner_code"),$.cmbsite_code.getValue(),$.txtsocial_no.getValue(),workType=="income_sec"?$.grdList2.getValue(rId2,"income_sec"):"",workType=="income_sec"?$.cmbreside_type.getValue():""]);return json}function fnSET_P_HRA3200_S1(workType){if(!validateControls([$.ymdjob_yyyy1,$.cmbsite_code1,$.txtearner_code1,$.cmbreside_type,$.cmbnation_code])){return false}var json=createJSON_S1(workType);callExecute(["req",json],workType,$)}function createJSON_S1(workType){var json=createExecuteParamInfo("HR..P_HRA3200_S1",[workType,$.ymdjob_yyyy1.getValue(),$.txtearner_code1.getValue(),$.cmbstatus.getValue(),$.cmbsite_code1.getValue(),$.cmbbusiness_type.getValue(),$.cmbreside_type.getValue(),$.cmbnation_code.getValue(),$.txtcomp_name.getValue(),$.txtbiz_regno1.getValue(),$.cmbincome_type.getValue(),$.cmbincome_sec.getValue(),$.txtremark.getValue(),$.chkadd_tax_yn.getValue(),g_main.session.obj.EmpCode,"#HostInfo#"]);return json}function fnSET_P_HRA3200_S2(workType){var json=createJSON_S2(workType);callExecute(["req",json],workType,$)}function createJSON_S2(workType){var json="";var rows=[];var changedRows=$.grdList2.getChangedRows();if(changedRows.length==0){return false}for(var i in changedRows){workType=changedRows[i].rowType;rows.push([workType,$.ymdjob_yyyy1.getValue(),$.txtearner_code1.getValue(),changedRows[i].seq,getFormatDate(changedRows[i].pay_date,"yyyyMMdd"),changedRows[i].job_mm,changedRows[i].income_sec,changedRows[i].tax_rate,changedRows[i].total_pay_amt,changedRows[i].expense_rate,changedRows[i].need_expense_amt,changedRows[i].income_amt,changedRows[i].income_tax_amt,changedRows[i].corporate_tax_amt,changedRows[i].local_tax_amt,changedRows[i].special_tax_amt,changedRows[i].total_tax_Amt,changedRows[i].memo,changedRows[i].product_code,changedRows[i].remark,changedRows[i].declaration_yyyymm.replace("-",""),g_main.session.obj.EmpCode,"#HostInfo#"]);log(rows)}json=createExecuteParamInfo("HR..P_HRA3200_S2",rows);return json}function fnSET_P_HRA3200_S3(workType){var json=createJSON_S3("D");callQuery(["req",json],workType,$)}function createJSON_S3(workType){var rId=$.grdList2.getSelectedRowIdx();var json=createExecuteParamInfo("HR..P_HRA3200_S2",[workType,$.ymdjob_yyyy1.getValue(),$.txtearner_code1.getValue(),$.grdList2.getValue(rId,"seq"),getFormatDate($.grdList2.getValue(rId,"pay_date"),"yyyyMMdd"),$.grdList2.getValue(rId,"job_mm"),$.grdList2.getValue(rId,"income_sec"),$.grdList2.getValue(rId,"tax_rate"),$.grdList2.getValue(rId,"total_pay_amt"),$.grdList2.getValue(rId,"expense_rate"),$.grdList2.getValue(rId,"need_expense_amt"),$.grdList2.getValue(rId,"income_amt"),$.grdList2.getValue(rId,"income_tax_amt"),$.grdList2.getValue(rId,"corporate_tax_amt"),$.grdList2.getValue(rId,"local_tax_amt"),$.grdList2.getValue(rId,"special_tax_amt"),$.grdList2.getValue(rId,"total_tax_Amt"),$.grdList2.getValue(rId,"memo"),$.grdList2.getValue(rId,"product_code"),$.grdList2.getValue(rId,"remark"),$.grdList2.getValue(rId,"declaration_yyyymm").replace("-",""),g_main.session.obj.EmpCode,"#HostInfo#"]);return json}function incomeAmt(){var rId=$.grdList2.getSelectedRowIdx();var dNeedAmt=$.grdList2.getValue(rId,"need_expense_amt");var dTotalAmt=$.grdList2.getValue(rId,"total_pay_amt");$.grdList2.setValue(rId,"income_amt",(dTotalAmt-dNeedAmt))}function incomeTax(){var rId=$.grdList2.getSelectedRowIdx();if($.grdList2.getValue(rId,"income_sec")=="69"){if(dTaxRateH==0&&dTaxRateL==0){fnQRY_P_HRA3200_Q("income_sec");$.panList2.enableButton(["btnSave"])}}else{var dTaxRate=$.grdList2.getValue(rId,"tax_rate");var dIncomeAmt=$.grdList2.getValue(rId,"income_amt");if(dIncomeAmt>50000){var dIncomeTaxAmt=Math.floor(dIncomeAmt*(dTaxRate/100));var dIncomeTaxAmt_won=String(dIncomeTaxAmt);dIncomeTaxAmt_won=dIncomeTaxAmt_won.substring((dIncomeTaxAmt_won.length-1),dIncomeTaxAmt_won.length);dIncomeTaxAmt=dIncomeTaxAmt-dIncomeTaxAmt_won;$.grdList2.setValue(rId,"income_tax_amt",dIncomeTaxAmt)}else{$.grdList2.setValue(rId,"income_tax_amt",0)}}}function localTax(){var rId=$.grdList2.getSelectedRowIdx();var dIncomeTaxAmt=$.grdList2.getValue(rId,"income_tax_amt");var dlocal_tax_amt=Math.floor(dIncomeTaxAmt*0.1);var dlocal_tax_amt_won=String(dlocal_tax_amt);dlocal_tax_amt_won=dlocal_tax_amt_won.substring((dlocal_tax_amt_won.length-1),dlocal_tax_amt_won.length);dlocal_tax_amt=dlocal_tax_amt-dlocal_tax_amt_won;$.grdList2.setValue(rId,"local_tax_amt",dlocal_tax_amt)}function icls(){var rId=$.grdList2.getSelectedRowIdx();var dincome_tax_amt=Number($.grdList2.getValue(rId,"income_tax_amt"));var dcorporate_tax_amt=Number($.grdList2.getValue(rId,"corporate_tax_amt"));var dlocal_tax_amt=Number($.grdList2.getValue(rId,"local_tax_amt"));var dspecial_tax_amt=Number($.grdList2.getValue(rId,"special_tax_amt"));$.grdList2.setValue(rId,"total_tax_Amt",(dincome_tax_amt+dcorporate_tax_amt+dlocal_tax_amt+dspecial_tax_amt))}function taxRate(){var rId=$.grdList2.getSelectedRowIdx();var dIncomeAmt=$.grdList2.getValue(rId,"income_amt");var dTaxRate=$.grdList2.getValue(rId,"tax_rate");var dIncomeTaxAmt=Math.floor(dIncomeAmt*(dTaxRate/100));var dIncomeTaxAmt_won=String(dIncomeTaxAmt);dIncomeTaxAmt_won=dIncomeTaxAmt_won.substring((dIncomeTaxAmt_won.length-1),dIncomeTaxAmt_won.length);dIncomeTaxAmt=dIncomeTaxAmt-dIncomeTaxAmt_won;$.grdList2.setValue(rId,"income_tax_amt",dIncomeTaxAmt)}function expense_rate(){var rId=$.grdList2.getSelectedRowIdx();var dTotalAmt=$.grdList2.getValue(rId,"total_pay_amt");var dExpenseRate=$.grdList2.getValue(rId,"expense_rate");$.grdList2.setValue(rId,"need_expense_amt",Math.floor(dTotalAmt*(dExpenseRate/100)))}function calcMaster(){var rId=$.grdList2.getSelectedRowIdx();var dTotalAmt=$.grdList2.getValue(rId,"total_pay_amt");var dExpenseRate=$.grdList2.getValue(rId,"expense_rate");$.grdList2.setValue(rId,"need_expense_amt",Math.floor(dTotalAmt*(dExpenseRate/100)));incomeAmt();var dTaxRate=$.grdList2.getValue(rId,"tax_rate");var dIncomeAmt=$.grdList2.getValue(rId,"income_amt");if(dIncomeAmt>50000){var dIncomeTaxAmt=Math.floor(dIncomeAmt*(dTaxRate/100));var dIncomeTaxAmt_won=String(dIncomeTaxAmt);dIncomeTaxAmt_won=dIncomeTaxAmt_won.substring((dIncomeTaxAmt_won.length-1),dIncomeTaxAmt_won.length);dIncomeTaxAmt=dIncomeTaxAmt-dIncomeTaxAmt_won;$.grdList2.setValue(rId,"income_tax_amt",dIncomeTaxAmt)}else{$.grdList2.setValue(rId,"income_tax_amt",0)}localTax();icls()}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,715);$.panMain.setText("");$.panMain.setBottomLine(true);$.panMaster=new FingerPanel(host,"panMaster",0,0,400,700);$.panMaster.setText("리스트정보");$.panMaster.setBottomLine(true);$.panList1=new FingerPanel(host,"panList1",410,0,790,305);$.panList1.setText("기본정보");$.panList1.setBottomLine(true);$.panList2=new FingerPanel(host,"panList2",410,310,790,390);$.panList2.setText("세부정보");$.panList2.setBottomLine(true);$.grdMaster=new FingerDataGrid(host,"grdMaster",0,140,400,515);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,790,345);$.btnSearch=new FingerButton(host,"btnSearch",320,-39.5,80,20);$.btnSearch.setText("조회");$.lbljob_yyyy=new FingerLabel(host,"lbljob_yyyy",35,15,100,20);$.lbljob_yyyy.setText("귀속연도");$.ymdjob_yyyy=new FingerDateEdit(host,"ymdjob_yyyy",140,15,210,20);$.lblsite_code=new FingerLabel(host,"lblsite_code",35,45,100,20);$.lblsite_code.setText("사업장");$.cmbsite_code=new FingerComboBox(host,"cmbsite_code",140,45,210,20);$.lblearner_code=new FingerLabel(host,"lblearner_code",35,75,100,20);$.lblearner_code.setText("소득자");$.txtearner_code=new FingerEdit(host,"txtearner_code",140,75,100,20);$.txtearner_name=new FingerButtonEdit(host,"txtearner_name",245,75,100,20);$.txtearner_name.setText("");$.lblsocial_no=new FingerLabel(host,"lblsocial_no",0,105,135,20);$.lblsocial_no.setText("주민/사업자등록번호");$.txtsocial_no=new FingerEdit(host,"txtsocial_no",140,105,210,20);$.lbljob_yyyy1=new FingerLabel(host,"lbljob_yyyy1",0,15,100,20);$.lbljob_yyyy1.setText("귀속연도");$.ymdjob_yyyy1=new FingerDateEdit(host,"ymdjob_yyyy1",105,15,210,20);$.lblsite_code1=new FingerLabel(host,"lblsite_code1",320,15,100,20);$.lblsite_code1.setText("사업장");$.cmbsite_code1=new FingerComboBox(host,"cmbsite_code1",425,15,140,20);$.lblearner_code1=new FingerLabel(host,"lblearner_code1",0,45,100,20);$.lblearner_code1.setText("소득자");$.txtearner_code1=new FingerEdit(host,"txtearner_code1",105,45,100,20);$.txtearner_name1=new FingerButtonEdit(host,"txtearner_name1",210,45,100,20);$.txtearner_name1.setText("");$.lblstatus=new FingerLabel(host,"lblstatus",320,45,100,20);$.lblstatus.setText("상태");$.cmbstatus=new FingerComboBox(host,"cmbstatus",425,45,140,20);$.lblsocial_no1=new FingerLabel(host,"lblsocial_no1",0,75,100,20);$.lblsocial_no1.setText("주민등록번호");$.txtsocial_no1=new FingerEdit(host,"txtsocial_no1",105,75,210,20);$.lblbusiness_type=new FingerLabel(host,"lblbusiness_type",320,75,100,20);$.lblbusiness_type.setText("개인/법인 구분");$.cmbbusiness_type=new FingerComboBox(host,"cmbbusiness_type",425,75,140,20);$.lblcomp_name=new FingerLabel(host,"lblcomp_name",0,105,100,20);$.lblcomp_name.setText("상호");$.txtcomp_name=new FingerEdit(host,"txtcomp_name",105,105,210,20);$.lblbiz_regno1=new FingerLabel(host,"lblbiz_regno1",315,105,105,20);$.lblbiz_regno1.setText("사업자등록번호");$.txtbiz_regno1=new FingerEdit(host,"txtbiz_regno1",425,105,140,20);$.lblreside_type=new FingerLabel(host,"lblreside_type",0,135,100,20);$.lblreside_type.setText("거주구분");$.cmbreside_type=new FingerComboBox(host,"cmbreside_type",105,135,210,20);$.lblnation_code=new FingerLabel(host,"lblnation_code",320,135,100,20);$.lblnation_code.setText("거주국");$.cmbnation_code=new FingerComboBox(host,"cmbnation_code",425,135,140,20);$.lblincome_sec=new FingerLabel(host,"lblincome_sec",0,165,100,20);$.lblincome_sec.setText("소득구분");$.cmbincome_sec=new FingerComboBox(host,"cmbincome_sec",105,165,210,20);$.lblincome_type=new FingerLabel(host,"lblincome_type",320,165,100,20);$.lblincome_type.setText("소득종류");$.cmbincome_type=new FingerComboBox(host,"cmbincome_type",425,165,140,20);$.lblremark=new FingerLabel(host,"lblremark",0,195,170,20);$.lblremark.setText("세액감면 및 제한세율근거");$.txtremark=new FingerEdit(host,"txtremark",175,195,390,20);$.lbladd_tax_yn=new FingerLabel(host,"lbladd_tax_yn",0,225,170,20);$.lbladd_tax_yn.setText("제한세율(주민세포함계산)");$.chkadd_tax_yn=new FingerCheckBox(host,"chkadd_tax_yn",175,225,20,20);$.chkadd_tax_yn.setText("");$.panList1.addButtons(["btnDelete","btnSave","btnNew"]);$.panList2.addButtons(["btnDelete","btnAdd"]);$.ymdjob_yyyy.setDateFormat("yyyy");$.ymdjob_yyyy1.setDateFormat("yyyy");$.ymdjob_yyyy.setValue(getToday(""));$.cmbsite_code1.setEmptyRow(true);$.cmbstatus.setEmptyRow(true);$.cmbbusiness_type.setEmptyRow(true);$.cmbreside_type.setEmptyRow(true);$.cmbnation_code.setEmptyRow(true);$.cmbincome_sec.setEmptyRow(true);$.cmbincome_type.setEmptyRow(true);$.ymdjob_yyyy.setAllowBlank(false,"귀속연도");$.cmbsite_code.setAllowBlank(false,"사업장");$.ymdjob_yyyy1.setAllowBlank(false,"귀속연도");$.cmbsite_code1.setAllowBlank(false,"사업장");$.txtearner_code1.setAllowBlank(false,"소득자코드");$.txtearner_name1.setAllowBlank(false,"소득자이름");$.cmbreside_type.setAllowBlank(false,"거주구분");$.cmbnation_code.setAllowBlank(false,"거주국");$.cmbsite_code1.setReadOnly(true);$.cmbstatus.setReadOnly(true);$.txtsocial_no1.setReadOnly(true);$.cmbbusiness_type.setReadOnly(true);$.txtcomp_name.setReadOnly(true);$.txtbiz_regno1.setReadOnly(true);$.cmbreside_type.setReadOnly(true);$.cmbnation_code.setReadOnly(true);$.cmbincome_sec.setReadOnly(true);$.cmbincome_type.setReadOnly(true);$.panList1.disableButton(["btnSave"]);$.grdMaster.setColumns([new FingerDataGridColumn("earner_code",90,"left","string","소득자코드"),new FingerDataGridColumn("earner_name",90,"left","string","소득자성명"),new FingerDataGridColumn("social_no",110,"left","string","주민등록번호"),new FingerDataGridColumn("belong_to",100,"left","string","소속"),new FingerDataGridColumn("comp_name",100,"left","string","상호"),new FingerDataGridColumn("biz_regno",120,"left","string","사업자등록번호")]);$.grdMaster.init({panel:$.panMaster,scroll:"xy",nonExcel:true,isFilter:false});$.grdMaster.setBorder(false);$.grdList2.setColumns([new FingerDataGridColumn("seq",100,"left","string","순번",{hidden:true}),new FingerDataGridColumn("pay_date",100,"left","date",{text:"지급일자",css:"col_chk"},{format:"ymd"}),new FingerDataGridColumn("job_mm",60,"left","string","귀속월"),new FingerDataGridColumn("income_sec",100,"left","string",{text:"소득구분",css:"col_chk"}),new FingerDataGridColumn("tax_rate",80,"right","string","세율",{format:"number",readonly:true}),new FingerDataGridColumn("total_pay_amt",80,"right","string","지급총액",{format:"int"}),new FingerDataGridColumn("expense_rate",80,"right","string","경비율",{format:"number",readonly:true}),new FingerDataGridColumn("need_expense_amt",80,"right","string","필요경비",{format:"int"}),new FingerDataGridColumn("income_amt",80,"right","string","소득금액",{format:"int"}),new FingerDataGridColumn("income_tax_amt",80,"right","string","소득세",{format:"int"}),new FingerDataGridColumn("corporate_tax_amt",80,"right","string","법인세",{format:"int"}),new FingerDataGridColumn("local_tax_amt",120,"right","string","지방소득세(주민세)",{format:"int"}),new FingerDataGridColumn("special_tax_amt",100,"right","string","농어촌특별세",{format:"int"}),new FingerDataGridColumn("total_tax_Amt",80,"right","string","세액 계",{format:"int"}),new FingerDataGridColumn("memo",100,"left","string","비고"),new FingerDataGridColumn("product_code",100,"left","string","관리품목"),new FingerDataGridColumn("remark",100,"left","string","분개장번호"),new FingerDataGridColumn("declaration_yyyymm",100,"left","date",{text:"신고연월",css:"col_chk"},{format:"ym"})]);$.grdList2.init({panel:$.panList2,leftSplit:4,scroll:"xy",nonExcel:true,isFilter:false});$.grdList2.setEditable(true);$.grdList2.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panMaster);$.panMain.add($.panList1);$.panMain.add($.panList2);$.panMaster.add($.grdMaster);$.panMaster.add($.btnSearch);$.panMaster.add($.lbljob_yyyy);$.panMaster.add($.ymdjob_yyyy);$.panMaster.add($.lblsite_code);$.panMaster.add($.cmbsite_code);$.panMaster.add($.lblearner_code);$.panMaster.add($.txtearner_code);$.panMaster.add($.txtearner_name);$.panMaster.add($.lblsocial_no);$.panMaster.add($.txtsocial_no);$.panList1.add($.lbljob_yyyy1);$.panList1.add($.ymdjob_yyyy1);$.panList1.add($.lblsite_code1);$.panList1.add($.cmbsite_code1);$.panList1.add($.lblearner_code1);$.panList1.add($.txtearner_code1);$.panList1.add($.txtearner_name1);$.panList1.add($.lblstatus);$.panList1.add($.cmbstatus);$.panList1.add($.lblsocial_no1);$.panList1.add($.txtsocial_no1);$.panList1.add($.lblbusiness_type);$.panList1.add($.cmbbusiness_type);$.panList1.add($.lblcomp_name);$.panList1.add($.txtcomp_name);$.panList1.add($.lblbiz_regno1);$.panList1.add($.txtbiz_regno1);$.panList1.add($.lblreside_type);$.panList1.add($.cmbreside_type);$.panList1.add($.lblnation_code);$.panList1.add($.cmbnation_code);$.panList1.add($.lblincome_sec);$.panList1.add($.cmbincome_sec);$.panList1.add($.lblincome_type);$.panList1.add($.cmbincome_type);$.panList1.add($.lblremark);$.panList1.add($.txtremark);$.panList1.add($.lbladd_tax_yn);$.panList1.add($.chkadd_tax_yn);$.panList2.add($.grdList2);var ds1=bizComponentData2($,"Q1","L_ORG001");$.cmbsite_code.setColumn("site_code","site_name");setComboBind([$.cmbsite_code],ds1);var ds2=bizComponentData2($,"Q1","L_ORG001|L_HRA019|L_HRA014|L_HRA015|L_COM015|L_HRA023|L_HRA020");$.cmbsite_code1.setColumn("site_code","site_name");$.cmbstatus.setColumn("sub_code","code_name");$.cmbbusiness_type.setColumn("sub_code","code_name");$.cmbreside_type.setColumn("sub_code","code_name");$.cmbnation_code.setColumn("nation_code","nation_name");$.cmbincome_sec.setColumn("sub_code","code_name");$.cmbincome_type.setColumn("sub_code","code_name");setComboBind([$.cmbsite_code1,$.cmbstatus,$.cmbbusiness_type,$.cmbreside_type,$.cmbnation_code,$.cmbincome_sec,$.cmbincome_type],ds2);var ds=bizComponentData2($,"Q1","L_HRA038|L_HRA025");$.grdList2.setColumnDropDownList("job_mm",ds.resultList[0],{key:"sub_code",name:"code_name"});$.grdList2.setColumnDropDownList("product_code",ds.resultList[1],{key:"sub_code",name:"code_name"});if($.cmbreside_type.getValue()=="1"){var ds=bizComponentData2($,"Q1","L_HRA023");$.grdList2.setColumnDropDownList("income_sec",ds.resultList[0],{key:"sub_code",name:"code_name"})}else{if($.cmbreside_type.getValue()=="2"){var ds=bizComponentData2($,"Q1","L_HRA024");$.grdList2.setColumnDropDownList("income_sec",ds.resultList[0],{key:"sub_code",name:"code_name"})}}$.cmbsite_code.setValue(g_main.session.obj.SiteCode)};$.callback=function(type,ds){if(type=="MASTER"){for(var i=0;i<ds.resultList[0].length;i++){ds.resultList[0][i].social_no=ds.resultList[0][i].social_no.substring(0,6)+"-"+ds.resultList[0][i].social_no.substring(6,13)}if(ds.errorCode=="MSG0006"){$.panList1.clear();$.grdList2.clear()}setDataGrid([$.grdMaster],ds);$.grdMaster.selectRow(0);$.panList1.disableButton(["btnSave"])}else{if(type=="DETAIL"){$.ymdjob_yyyy1.setValue(ds.resultList[0][0].job_yyyy);$.cmbsite_code1.setValue(ds.resultList[0][0].site_code);$.txtearner_code1.setValue(ds.resultList[0][0].earner_code);$.txtearner_name1.setValue(ds.resultList[0][0].earner_name);$.cmbstatus.setValue(ds.resultList[0][0].status);$.txtsocial_no1.setValue(ds.resultList[0][0].social_no.substring(0,6)+"-"+ds.resultList[0][0].social_no.substring(6,13));$.cmbbusiness_type.setValue(ds.resultList[0][0].business_type);$.txtcomp_name.setValue(ds.resultList[0][0].comp_name);$.txtbiz_regno1.setValue(ds.resultList[0][0].biz_regno);$.cmbreside_type.setValue(ds.resultList[0][0].reside_type);$.cmbnation_code.setValue(ds.resultList[0][0].nation_code);$.cmbincome_sec.setValue(ds.resultList[0][0].income_sec);$.cmbincome_type.setValue(ds.resultList[0][0].income_type);$.txtremark.setValue(ds.resultList[0][0].remark);$.chkadd_tax_yn.setValue(ds.resultList[0][0].add_tax_yn);var ds=ds.resultList[1];setDataGrid([$.grdList2],ds,true);var aRow=$.grdList2.getAllRows();for(var i in aRow){ds[i].pay_date=extFormat(ds[i].pay_date,"yyyyMMdd");ds[i].declaration_yyyymm=extFormat(ds[i].declaration_yyyymm,"yyyyMM")}strStatus=true;$.grdList2.selectRow(0);$.panList1.disableButton(["btnSave"])}else{if(type=="income_sec"){var rId=$.grdList2.getSelectedRowIdx();if(ds!=null){if(ds.errorCode=="MSG0001"){if(ds.resultList==""){$.grdList2.setValue(rId,"tax_rate",0);$.grdList2.setValue(rId,"expense_rate",0);calcMaster()}else{strTaxRate=ds.resultList[0][0].tax_rate2;if($.grdList2.getValue(rId,"income_sec")!="69"){$.grdList2.setValue(rId,"tax_rate",ds.resultList[0][0].tax_rate);$.grdList2.setValue(rId,"expense_rate",ds.resultList[0][0].expense_rate);calcMaster()}else{var strRate=ds.resultList[0][0].tax_rate2.split("|");if(strRate.length==3){dAmtRate=strRate[0];dTaxRateL=strRate[1];dTaxRateH=strRate[2]}if($.grdList2.getValue(rId,"income_amt")>dAmtRate&&$.grdList2.getValue(rId,"tax_rate")!=dTaxRateH){$.grdList2.setValue(rId,"tax_rate",dTaxRateH);$.grdList2.setValue(rId,"expense_rate",ds.resultList[0][0].expense_rate);calcMaster()}else{if($.grdList2.getValue(rId,"income_amt")<=dAmtRate&&$.grdList2.getValue(rId,"tax_rate")!=dTaxRateL){$.grdList2.setValue(rId,"tax_rate",dTaxRateL);$.grdList2.setValue(rId,"expense_rate",ds.resultList[0][0].expense_rate);calcMaster()}else{if($.grdList2.getValue(rId,"income_amt")>dAmtRate&&$.grdList2.getValue(rId,"tax_rate")==dTaxRateH||$.grdList2.getValue(rId,"income_amt")<=dAmtRate&&$.grdList2.getValue(rId,"tax_rate")==dTaxRateL){$.grdList2.setValue(rId,"tax_rate",20);$.grdList2.setValue(rId,"expense_rate",0);calcMaster()}}}}}}else{MessageBoxShow(ds.ErrorCode);return}}}else{if(type=="D"){var bResult=false;if(ds!=null){if(ds.errorCode=="MSG0003"){MessageBoxShow("정상적으로 삭제가 되었습니다.");bResult=true}else{MessageBoxShow(ds.errorCode)}}QueryClick()}else{if(type=="N"||type=="U"){var bResult=false;if(ds!=null){if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0004"){bResult=true}else{if(ds.errorCode=="P_HRA3200_S1_001"){MessageBoxShow("귀속연도의 소득자가 이미 존재합니다.")}else{MessageBoxShow(ds.errorCode)}}}if(bResult==true){fnSET_P_HRA3200_S2("")}QueryClick()}else{if(type=="DEL"){QueryClick()}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){QueryClick()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="txtearner_name"){var param={earner_code:$.txtearner_code.getValue(),earner_name:$.txtearner_name.getText()};g_main.openPopup("popHRA021.html","popHRA021","소득자정보",400,585,"","",param,"","")}else{if(id=="txtearner_name1"){var param={earner_code:$.txtearner_code1.getValue(),earner_name:$.txtearner_name1.getText()};g_main.openPopup("popHRA021.html","popHRA021","소득자정보",400,585,"","",param,"","")}}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chkadd_tax_yn"){$.panList1.enableButton(["btnSave"])}};$.fingercombobox_change=function(id,value){if(id=="cmbreside_type"){if($.cmbreside_type.getValue()=="1"){var ds=bizComponentData2($,"Q1","L_HRA023");$.grdList2.setColumnDropDownList("income_sec",ds.resultList[0],{key:"sub_code",name:"code_name"});$.cmbincome_sec.clear();var ds=bizComponentData2($,"Q1","L_HRA023");$.cmbincome_sec.setColumn("sub_code","code_name");setComboBind([$.cmbincome_sec],ds)}else{if($.cmbreside_type.getValue()=="2"){var ds=bizComponentData2($,"Q1","L_HRA024");$.grdList2.setColumnDropDownList("income_sec",ds.resultList[0],{key:"sub_code",name:"code_name"});$.cmbincome_sec.clear();var ds=bizComponentData2($,"Q1","L_HRA024");$.cmbincome_sec.setColumn("sub_code","code_name");setComboBind([$.cmbincome_sec],ds)}}}else{if(id=="cmbincome_sec"){$.panList1.enableButton(["btnSave"])}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdMaster"){fnQRY_P_HRA3200_Q("DETAIL");fnControlSetting(false)}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList2"){var rId=$.grdList2.getSelectedRowIdx();if(cInd=="income_sec"){fnQRY_P_HRA3200_Q("income_sec");$.panList2.enableButton(["btnSave"])}else{if(cInd=="job_mm"){var dt=$.ymdjob_yyyy1.getValue()+$.grdList2.getValue(rId,"job_mm")+"01";dt2=extFormat(getCalcMonth(dt,1),"yyyyMM");$.grdList2.setValue(rId,"declaration_yyyymm",dt2)}else{if(cInd=="total_pay_amt"){var dExpenseRate=$.grdList2.getValue(rId,"expense_rate");var dTotalAmt=$.grdList2.getValue(rId,"total_pay_amt");$.grdList2.setValue(rId,"need_expense_amt",Math.floor(dTotalAmt*dExpenseRate/100));incomeAmt();incomeTax();localTax();icls()}else{if(cInd=="need_expense_amt"){if($.grdList2.getValue(rId,"need_expense_amt")==0){$.grdList2.setValue(rId,"income_amt",$.grdList2.getValue(rId,"total_pay_amt"));incomeTax();localTax();icls()}else{var dtotAmt=$.grdList2.getValue(rId,"total_pay_amt");var dNeedAmt=$.grdList2.getValue(rId,"need_expense_amt");$.grdList2.setValue(rId,"income_amt",(dtotAmt-dNeedAmt));incomeTax();localTax();icls()}}else{if(cInd=="income_amt"){incomeTax();localTax();icls()}else{if(cInd=="income_tax_amt"){var dTaxAmt=$.grdList2.getValue(rId,"income_tax_amt");if($.cmbbusiness_type.getValue()=="C"){$.grdList2.setValue(rId,"corporate_tax_amt",Math.floor(dTaxAmt/10));icls()}else{if($.cmbbusiness_type.getValue()=="P"){localTax();icls()}}}else{if(cInd=="corporate_tax_amt"||cInd=="local_tax_amt"||cInd=="special_tax_amt"){icls()}else{if(cInd=="pay_date"){$.grdList2.setValue(rId,"job_mm",$.grdList2.getValue(rId,"pay_date").substring(5,7));var dt=$.ymdjob_yyyy1.getValue()+$.grdList2.getValue(rId,"job_mm")+"01";dt2=extFormat(getCalcMonth(dt,1),"yyyyMM");$.grdList2.setValue(rId,"declaration_yyyymm",dt2)}}}}}}}}$.panList1.enableButton(["btnSave"])}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txtremark"){$.panList1.enableButton(["btnSave"])}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList1"){if(btnId=="btnNew"){NewClick()}else{if(btnId=="btnDelete"){var strMSG="["+$.txtearner_name1.getValue()+"] 정보를 삭제하시겠습니까?";confirmBoxShow(strMSG,function(){if(g_main.msgShare==true){fnSET_P_HRA3200_S1("D")}})}else{if(btnId=="btnSave"){if(strStatus==false){strStatus1="N"}else{strStatus1="U"}fnSET_P_HRA3200_S1(strStatus1)}}}}else{if(panelId=="panList2"){if(btnId=="btnAdd"){var dt=getToday("");var j_nm=dt.substring(4,6);var dt2=getCalcMonth(getToday(""),1);var irate=0;$.grdList2.addRow({pay_date:extFormat(dt,"yyyyMMdd"),job_mm:j_nm,seq:0,income_sec:$.cmbincome_sec.getValue(),tax_rate:$.cmbincome_sec.getValue("extra_field1")||0,total_pay_amt:0,expense_rate:$.cmbincome_sec.getValue("extra_field2")||0,need_expense_amt:0,income_amt:0,income_tax_amt:0,corporate_tax_amt:0,local_tax_amt:0,special_tax_amt:0,total_tax_Amt:0,memo:"",product_code:"",remark:"",declaration_yyyymm:extFormat(dt2,"yyyyMM")});$.panList1.enableButton(["btnSave"])}else{if(btnId=="btnDelete"){if($.grdList2.getRowCount()>0){var rId=$.grdList2.getSelectedRowIdx();var rType=$.grdList2.getRowStatus(rId);if(rType=="N"){$.grdList2.deleteRow(rId)}else{confirmBoxShow("정말 삭제하시겠습니까?",function(){if(g_main.msgShare==true){fnSET_P_HRA3200_S3("DEL")}})}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(id=="popHRA021"){if($.popUpCallId=="txtearner_name"){if(popResult!=null){$.txtearner_code.setValue(popResult.earner_code);$.txtearner_name.setText(popResult.earner_name)}}else{if($.popUpCallId=="txtearner_name1"){if(popResult!=null){$.txtearner_code1.setValue(popResult.earner_code);$.txtearner_name1.setText(popResult.earner_name);$.txtsocial_no1.setValue(popResult.social_no.substring(0,6)+"-"+popResult.social_no.substring(6,13));$.txtcomp_name.setValue(popResult.comp_name);$.cmbbusiness_type.setValue(popResult.business_type);$.txtbiz_regno1.setValue(popResult.biz_regno);$.cmbreside_type.setValue(popResult.reside_type);$.cmbnation_code.setValue(popResult.nation_code);$.cmbincome_sec.setReadOnly(false)}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>