<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panInfo=null;$.panDetail1=null;$.panDetail2=null;$.lblGroupId=null;$.lblGroupName=null;$.grdGroup=null;$.lblIGroupId=null;$.lblIGroupName=null;$.txtIGroupId=null;$.txtIGroupName=null;$.grdDetail1=null;$.grdDetail2=null;$.txtGroupId=null;$.txtGroupName=null;$.btnSearch=null;$.btnAdd=null;$.btnDelete=null;$.varGroupId="";$.varUpdateList=[];$.varPath=[];function createJSON_Q1(workType){var json=createExecuteParamInfo("P_MOR2000_Q1",[workType,$.txtGroupId.getValue(),$.txtGroupName.getValue()]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_MOR2000_Q2",[workType,$.varGroupId]);return json}function createJSON_S1(workType){var json=createExecuteParamInfo("P_MOR2000_S1",[workType,$.txtIGroupId.getValue(),$.txtIGroupName.getValue(),"#UserID#"]);return json}function createJSON_S2(workType){var json="";if($.varUpdateList.length<1){return}var rows=[];for(var i in $.varUpdateList){rows.push([$.varUpdateList[i].rowType,$.varGroupId,$.varUpdateList[i].KeyID,"#UserID#"])}json=createExecuteParamInfo("P_MOR2000_S2",rows);return json}function searchMOR2000(workType){var json=createJSON_Q1(workType);callQuery(["req",json],workType,$)}function searchMOR2000Sub(workType){if($.varGroupId==""){return}var json=createJSON_Q2(workType);callQuery(["req",json],"SUB_"+workType,$)}function saveMOR2000(workType){var json=createJSON_S1(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"||ds.errorCode=="MSG0004"){$.varGroupId=$.txtIGroupId.getValue();if(workType!="D"&&$.varUpdateList.length>0){saveMOR2000Sub("N")}else{if(workType=="D"){$.varGroupId=""}searchMOR2000("Q")}}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("저장도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0030"){MessageBoxShow("수정도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0031"){$.varGroupId="";searchMOR2000("Q")}else{if(ds.errorCode=="ERR0002"){5;MessageBoxShow("이미 사용중인 그룹아이디 입니다.");return}}}}}}}function saveMOR2000Sub(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$,false);if(ds){if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"){$.varUpdateList=[];searchMOR2000("Q")}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("저장도중 오류가 발생하였습니다.");return}else{if(ds.errorCode=="MSG0031"){MessageBoxShow("삭제도중 오류가 발생하였습니다.");return}}}}else{$.varUpdateList=[];searchMOR2000("Q")}}}function convertTreeToArray(rs){for(var i in rs){$.varPath=[];if(rs[i].ParentID!=""){getPath(rs,rs[i].ParentID);rs[i].path="|";for(var j in $.varPath){rs[i].path+=$.varPath[j]+"|"}}else{rs[i].path="|"+rs[i].KeyID+"|"}}return rs}function getPath(rs,pID){for(var i in rs){if(pID==rs[i].KeyID){$.varPath.push(rs[i].KeyID);if(rs[i].ParentID!=""){getPath(rs,rs[i].ParentID)}else{return}}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,810);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,300,800);$.panQuery.setText("권한 그룹 리스트");$.panQuery.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",310,0,890,120);$.panInfo.setText("그룹 정보");$.panInfo.setBottomLine(false);$.panDetail1=new FingerPanel(host,"panDetail1",310,130,410,670);$.panDetail1.setText("전체 윤리 강령");$.panDetail1.setBottomLine(true);$.panDetail2=new FingerPanel(host,"panDetail2",790,130,410,670);$.panDetail2.setText("권한 그룹 윤리 강령");$.panDetail2.setBottomLine(true);$.lblGroupId=new FingerLabel(host,"lblGroupId",0,10,100,20);$.lblGroupId.setText("그룹아이디");$.lblGroupName=new FingerLabel(host,"lblGroupName",0,40,100,20);$.lblGroupName.setText("그룹명");$.grdGroup=new FingerDataGrid(host,"grdGroup",0,80,300,675);$.lblIGroupId=new FingerLabel(host,"lblIGroupId",0,10,100,20);$.lblIGroupId.setText("그룹아이디");$.lblIGroupName=new FingerLabel(host,"lblIGroupName",0,40,100,20);$.lblIGroupName.setText("그룹명");$.txtIGroupId=new FingerEdit(host,"txtIGroupId",105,10,200,20);$.txtIGroupName=new FingerEdit(host,"txtIGroupName",105,40,400,20);$.grdDetail1=new FingerDataGrid(host,"grdDetail1",0,0,410,620);$.grdDetail2=new FingerDataGrid(host,"grdDetail2",0,0,410,620);$.txtGroupId=new FingerEdit(host,"txtGroupId",105,10,160,20);$.txtGroupName=new FingerEdit(host,"txtGroupName",105,40,160,20);$.btnSearch=new FingerButton(host,"btnSearch",220,-37.5,80,20);$.btnSearch.setText("조회");$.btnAdd=new FingerButton(host,"btnAdd",735,410,60,40);$.btnAdd.setText("▶");$.btnDelete=new FingerButton(host,"btnDelete",735,470,60,40);$.btnDelete.setText("◀");$.panInfo.addButtons(["btnDelete","btnSave","btnNew"]);$.grdGroup.setColumns([new FingerDataGridColumn("group_id",120,"left","string","그룹ID"),new FingerDataGridColumn("group_name",160,"left","string","그룹명")]);$.grdGroup.init();$.grdGroup.setBorder(false);$.grdDetail1.setColumns([new FingerDataGridColumn("KeyID",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("ParentID",99,"left","string","상위윤령ID",{hidden:true}),new FingerDataGridColumn("title",390,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("sort_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","윤령순서",{hidden:true})]);$.grdDetail1.init({view:"treetable",treeKey:{id:"KeyID",parent:"ParentID"}});$.grdDetail1.setBorder(false);$.grdDetail2.setColumns([new FingerDataGridColumn("KeyID",99,"left","string","윤령ID",{hidden:true}),new FingerDataGridColumn("ParentID",99,"left","string","상위윤령ID",{hidden:true}),new FingerDataGridColumn("title",390,"left","string","제목",{template:"tree"}),new FingerDataGridColumn("sort_seq",99,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","윤령순서",{hidden:true})]);$.grdDetail2.init({view:"treetable",treeKey:{id:"KeyID",parent:"ParentID"}});$.grdDetail2.setBorder(false);$.txtIGroupId.setAllowBlank(false,"그룹ID");$.txtIGroupName.setAllowBlank(false,"그룹명");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panInfo);$.panMain.add($.panDetail1);$.panMain.add($.panDetail2);$.panMain.add($.btnDelete);$.panMain.add($.btnAdd);$.panQuery.add($.lblGroupId);$.panQuery.add($.lblGroupName);$.panQuery.add($.grdGroup);$.panQuery.add($.txtGroupName);$.panQuery.add($.txtGroupId);$.panQuery.add($.btnSearch);$.panInfo.add($.lblIGroupId);$.panInfo.add($.lblIGroupName);$.panInfo.add($.txtIGroupId);$.panInfo.add($.txtIGroupName);$.panDetail1.add($.grdDetail1);$.panDetail2.add($.grdDetail2);searchMOR2000("Q");relocateChildIndexInPanel([$.panQuery,$.panInfo])};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdGroup],ds);if(ds.resultList[0].length<=0){return}if($.varGroupId!=""){$.grdGroup.selectRow($.grdGroup.getGridRowIndex("group_id",$.varGroupId,0))}else{$.grdGroup.selectRow(0)}searchMOR2000("Q1")}else{if(type=="Q1"){ds.resultList[0]=convertTreeToArray(ds.resultList[0]);setDataGrid([$.grdDetail1],ds);$.grdDetail1.openNode("all")}else{if(type=="SUB_Q"){ds.resultList[0]=convertTreeToArray(ds.resultList[0]);setDataGrid([$.grdDetail2],ds);$.grdDetail2.openNode("all")}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){$.varGroupId="";searchMOR2000("Q")}else{if(id=="btnAdd"){var aRow1=$.grdDetail1.getAllRows(),aRow2=$.grdDetail2.getAllRows();var rId=$.grdDetail1.getSelectedRowIdx();if(!rId){return}var keyId=$.grdDetail1.getValue(rId,"KeyID");var path=$.grdDetail1.getValue(rId,"path");for(var i in aRow1){if(aRow1[i].KeyID==keyId||path.indexOf("|"+aRow1[i].KeyID+"|")!=-1||aRow1[i].path.indexOf("|"+keyId+"|")!=-1){var overlap=0;if(aRow2.length>0){for(var j in aRow2){if(aRow1[i].KeyID==aRow2[j].KeyID){overlap++}}}if(overlap>0){continue}aRow2.push({rowType:"N",ParentID:aRow1[i].ParentID,KeyID:aRow1[i].KeyID,title:aRow1[i].title,sort_seq:aRow1[i].sort_seq,path:aRow1[i].path});$.varUpdateList.push({rowType:"N",KeyID:aRow1[i].KeyID})}}$.grdDetail2.setData(aRow2);$.grdDetail2.openNode("all")}else{if(id=="btnDelete"){var rId=$.grdDetail2.getSelectedRowIdx();if(!rId){return}var keyId=$.grdDetail2.getValue(rId,"KeyID");var aRow=$.grdDetail2.getAllRows();for(var i in aRow){if(aRow[i].KeyID==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varUpdateList){if($.varUpdateList[j].KeyID==aRow[i].KeyID){overlap++}}if(overlap>0){$.grdDetail2.deleteCurrentRow();continue}else{$.varUpdateList.push({rowType:"D",KeyID:aRow[i].KeyID});$.grdDetail2.deleteCurrentRow()}}else{$.grdDetail2.deleteCurrentRow()}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdGroup"){$.varGroupId=$.grdGroup.getValue(rId,"group_id");$.txtIGroupId.setValue($.grdGroup.getValue(rId,"group_id"));$.txtIGroupName.setValue($.grdGroup.getValue(rId,"group_name"));$.txtIGroupId.setReadOnly(true);searchMOR2000Sub("Q")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txtGroupId"||id=="txtGroupName")&&value=="13"){searchMOR2000("Q")}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnNew"){$.varGroupId="";$.panInfo.clear();$.grdDetail2.setData("");$.txtIGroupId.setReadOnly(false);$.txtIGroupId.setAllowBlank(false,"그룹ID");$.txtIGroupId.setFocus()}else{if(btnId=="btnSave"){if(!validateControls([$.txtIGroupId,$.txtIGroupName])){return}saveMOR2000($.varGroupId!=""?"U":"N")}else{if(btnId=="btnDelete"){confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveMOR2000("D");$.grdGroup.deleteCurrentRow()}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>