<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panInfo=null;$.panTree=null;$.panTab1=null;$.panTab2=null;$.tabMain=null;$.panMenuAuth=null;$.panEmp=null;$.lblGroupIdQ=null;$.lblGroupNameQ=null;$.lblGroupIdInfo=null;$.lblGroupNameInfo=null;$.lblUseYnInfo=null;$.lblDescrInfo=null;$.txtGroupIdQ=null;$.txtGroupNameQ=null;$.txtGroupIdInfo=null;$.txtGroupNameInfo=null;$.chkUseYnInfo=null;$.txtDescrInfo=null;$.grdList=null;$.grdEmp=null;$.btnSearch=null;$.grdMenu=null;$.grdMenuAuth=null;$.btnAdd=null;$.btnDelete=null;$.varUserGroupId="";$.varDeleteRow=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_SYS2100_Q2",[workType,(workType=="Q1"?$.txtGroupIdQ.getValue():$.varUserGroupId),$.txtGroupNameQ.getValue(),""]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_SYS2100_S",[workType,$.txtGroupIdInfo.getValue(),$.txtGroupNameInfo.getValue(),$.txtDescrInfo.getValue(),"#UserID#","",$.chkUseYnInfo.getValue()]);return json}function createJSON_S2(workType){var aRows=$.grdMenuAuth.getAllRows();if(aRows.length<1&&$.varDeleteRow.length<1){return false}var rows=[];for(var i in $.varDeleteRow){workType="D";rows.push([workType,$.varUserGroupId,$.varDeleteRow[i].menu_id,"","","","","#UserID#",""])}for(var i in aRows){workType=(aRows[i].row_state=="Q"?"U":aRows[i].row_state);rows.push([workType,$.varUserGroupId,aRows[i].menu_id,(aRows[i].form_view_yn==true||aRows[i].form_view_yn=="Y"?"Y":"N"),(aRows[i].form_print_yn==true||aRows[i].form_print_yn=="Y"?"Y":"N"),(aRows[i].form_save_yn==true||aRows[i].form_save_yn=="Y"?"Y":"N"),(aRows[i].form_delete_yn==true||aRows[i].form_delete_yn=="Y"?"Y":"N"),"#UserID#",""])}return createExecuteParamInfo("P_SYS2100_S1",rows)}function searchList(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveAuthGroup(workType){var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],"S",$,false);if(json){if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0004"){if(workType=="N"){$.varUserGroupId=$.txtGroupIdInfo.getValue();searchList("Q1")}saveMenuAuth()}else{if(ds.errorCode=="MSG0003"){$.varUserGroupId="";$.panInfo.clear();searchList("Q1")}else{log(ds);MessageBoxShow("권한 그룹 정보를 저장하는 도중 오류가 발생하였습니다.<br><br>등록하려는 그룹ID값이 존재하는지 확인해 주시기 바랍니다.");return}}}}function saveMenuAuth(){var json=createJSON_S2();if(json){callExecute(["req",json],"S2",$,false)}}function convertTreeToArray(rs){for(var i in rs){$.varPath=[];if(rs[i].parent_menu_id!=""){getPath(rs,rs[i].parent_menu_id);rs[i].path="|";for(var j in $.varPath){rs[i].path+=$.varPath[j]+"|"}}else{rs[i].path="|"+rs[i].menu_id+"|"}}return rs}function getPath(rs,pID){for(var i in rs){if(pID==rs[i].menu_id){$.varPath.push(rs[i].menu_id);if(rs[i].parent_menu_id!=""){getPath(rs,rs[i].parent_menu_id)}else{return}}}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,805);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,300,800);$.panQuery.setText("권한그룹 목록");$.panQuery.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",310,0,890,120);$.panInfo.setText("권한그룹 정보");$.panInfo.setBottomLine(false);$.panTree=new FingerPanel(host,"panTree",0,0,410,640);$.panTree.setText("전체 프로그램 메뉴");$.panTree.setBottomLine(true);$.panTab1=new FingerPanel(host,"panTab1",0,0,890,640);$.panTab1.setText("");$.panTab1.setBottomLine(true);$.panTab2=new FingerPanel(host,"panTab2",0,0,890,640);$.panTab2.setText("");$.panTab2.setBottomLine(true);$.tabMain=new FingerTab(host,"tabMain",310,130,890,670);$.panMenuAuth=new FingerPanel(host,"panMenuAuth",475,0,410,640);$.panMenuAuth.setText("권한그룹 소속 프로그램 메뉴");$.panMenuAuth.setBottomLine(true);$.panEmp=new FingerPanel(host,"panEmp",0,0,885,640);$.panEmp.setText("소속 사용자");$.panEmp.setBottomLine(true);$.lblGroupIdQ=new FingerLabel(host,"lblGroupIdQ",5,10,100,20);$.lblGroupIdQ.setText("사용자그룹ID");$.lblGroupNameQ=new FingerLabel(host,"lblGroupNameQ",5,40,100,20);$.lblGroupNameQ.setText("사용자그룹명");$.lblGroupIdInfo=new FingerLabel(host,"lblGroupIdInfo",15,10,100,20);$.lblGroupIdInfo.setText("사용자그룹ID");$.lblGroupNameInfo=new FingerLabel(host,"lblGroupNameInfo",290,10,100,20);$.lblGroupNameInfo.setText("사용자그룹명");$.lblUseYnInfo=new FingerLabel(host,"lblUseYnInfo",540,10,100,20);$.lblUseYnInfo.setText("사용여부");$.lblDescrInfo=new FingerLabel(host,"lblDescrInfo",15,40,100,20);$.lblDescrInfo.setText("적요");$.txtGroupIdQ=new FingerEdit(host,"txtGroupIdQ",110,10,170,20);$.txtGroupNameQ=new FingerEdit(host,"txtGroupNameQ",110,40,170,20);$.txtGroupIdInfo=new FingerEdit(host,"txtGroupIdInfo",120,10,140,20);$.txtGroupNameInfo=new FingerEdit(host,"txtGroupNameInfo",395,10,140,20);$.chkUseYnInfo=new FingerCheckBox(host,"chkUseYnInfo",640,12.5,140,20);$.chkUseYnInfo.setText("");$.txtDescrInfo=new FingerEdit(host,"txtDescrInfo",120,40,540,20);$.grdList=new FingerDataGrid(host,"grdList",0,80,300,670);$.grdEmp=new FingerDataGrid(host,"grdEmp",0,0,885,590);$.btnSearch=new FingerButton(host,"btnSearch",220,-37.5,80,20);$.btnSearch.setText("조회");$.grdMenu=new FingerDataGrid(host,"grdMenu",0,0,410,595);$.grdMenuAuth=new FingerDataGrid(host,"grdMenuAuth",0,0,410,595);$.btnAdd=new FingerButton(host,"btnAdd",430,270,50,20);$.btnAdd.setText("▶");$.btnDelete=new FingerButton(host,"btnDelete",430,310,50,20);$.btnDelete.setText("◀");$.panQuery.setBorder(false);$.panInfo.addButton("btnDelete","삭제");$.panInfo.addButton("btnSave","수정");$.panInfo.addButton("btnNew","신규");$.panInfo.setButtonAction("btnDelete","delete");$.panInfo.setButtonAction("btnSave","save");$.panInfo.setButtonAction("btnNew","new");colMap=$.grdList.setColumns([new FingerDataGridColumn("user_group_id",120,"left","string","사용자 그룹ID"),new FingerDataGridColumn("user_group_name",160,"left","string","사용자 그룹명")]);$.grdList.init();$.grdList.setBorder(false);colMap=$.grdEmp.setColumns([new FingerDataGridColumn("user_id",200,"left","string","사용자ID"),new FingerDataGridColumn("user_name",170,"left","string","사용자명"),new FingerDataGridColumn("user_category",200,"left","string","사용자 유형"),new FingerDataGridColumn("emp_code",150,"left","string","사원코드"),new FingerDataGridColumn("access_all_site_yn",150,"center","string","전체 사업장 권한")]);$.grdEmp.init();$.grdEmp.setBorder(false);colMap=$.grdMenu.setColumns([new FingerDataGridColumn("parent_menu_id",99,"left","string","상위메뉴ID",{hidden:true}),new FingerDataGridColumn("menu_id",99,"left","string","메뉴ID",{hidden:true}),new FingerDataGridColumn("menu_name",250,"left","string","메뉴명",{template:"tree"}),new FingerDataGridColumn("form_id",140,"left","string","폼ID"),new FingerDataGridColumn("sort_seq",99,"center","int","시퀀스",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","PATH",{hidden:true})]);$.grdMenu.init({view:"treetable",treeKey:{id:"menu_id",parent:"parent_menu_id"},scroll:"xy"});$.grdMenu.setBorder(false);colMap=$.grdMenuAuth.setColumns([new FingerDataGridColumn("parent_menu_id",99,"left","string","상위메뉴ID",{hidden:true}),new FingerDataGridColumn("menu_id",99,"left","string","메뉴ID",{hidden:true}),new FingerDataGridColumn("menu_name",250,"left","string","메뉴명",{readonly:true,template:"tree"}),new FingerDataGridColumn("form_id",140,"left","string","폼ID",{readonly:true}),new FingerDataGridColumn("sort_seq",99,"center","string","시퀀스",{hidden:true}),new FingerDataGridColumn("form_view_yn",50,"center","checkbox","조회",{hidden:true}),new FingerDataGridColumn("form_print_yn",50,"center","checkbox","출력",{hidden:true}),new FingerDataGridColumn("form_save_yn",50,"center","checkbox","저장",{hidden:true}),new FingerDataGridColumn("form_delete_yn",50,"center","checkbox","삭제",{hidden:true}),new FingerDataGridColumn("row_state",99,"center","string","행상태",{hidden:true}),new FingerDataGridColumn("path",99,"left","string","PATH",{hidden:true})]);$.grdMenuAuth.init({view:"treetable",treeKey:{id:"menu_id",parent:"parent_menu_id"},scroll:"xy",leftSplit:3});$.grdMenuAuth.setBorder(false);$.grdMenuAuth.setEditable(true);$.txtGroupIdInfo.setReadOnly(true);$.txtGroupNameInfo.setReadOnly(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panInfo);$.panMain.add($.tabMain);$.panQuery.add($.lblGroupIdQ);$.panQuery.add($.lblGroupNameQ);$.panQuery.add($.txtGroupIdQ);$.panQuery.add($.txtGroupNameQ);$.panQuery.add($.grdList);$.panQuery.add($.btnSearch);$.panInfo.add($.lblGroupIdInfo);$.panInfo.add($.lblGroupNameInfo);$.panInfo.add($.lblUseYnInfo);$.panInfo.add($.lblDescrInfo);$.panInfo.add($.txtGroupIdInfo);$.panInfo.add($.txtGroupNameInfo);$.panInfo.add($.chkUseYnInfo);$.panInfo.add($.txtDescrInfo);$.panTree.add($.grdMenu);$.panTab1.add($.panTree);$.panTab1.add($.panMenuAuth);$.panTab1.add($.btnAdd);$.panTab1.add($.btnDelete);$.panTab2.add($.panEmp);$.panMenuAuth.add($.grdMenuAuth);$.panEmp.add($.grdEmp);var ds=bizComponentData2($,"Q1","L_SYS005|L_COM014");$.grdEmp.setColumnDropDownList("user_category",ds.resultList[0]);$.grdEmp.setColumnDropDownList("access_all_site_yn",ds.resultList[1]);$.tabMain.addTab([{text:"권한 그룹 메뉴 설정",body:$.panTab1},{text:"권한그룹 소속 사용자",body:$.panTab2}]);searchList("Q1")};$.callback=function(type,ds){if(type=="Q1"){setDataGrid([$.grdList],ds);if(ds.resultList[0].length>0){if($.varUserGroupId==""){$.grdList.selectRow(0)}else{$.grdList.selectRow($.grdList.getGridRowIndex("user_group_id",$.varUserGroupId,0))}}}else{if(type=="Q2"){var result1=ds.resultList[0][0];$.txtGroupIdInfo.setValue(result1.user_group_id);$.txtGroupNameInfo.setValue(result1.user_group_name);$.chkUseYnInfo.setValue(result1.use_yn);$.txtDescrInfo.setValue(result1.descr);ds.resultList[1]=convertTreeToArray(ds.resultList[1]);ds.resultList[2]=convertTreeToArray(ds.resultList[2]);setDataGrid([null,$.grdMenu,$.grdMenuAuth,$.grdEmp],ds);$.grdMenu.openNode("all");$.grdMenuAuth.openNode("all")}else{if(type=="S2"){if(ds.errorCode==""||ds.errorCode=="MSG0002"||ds.errorCode=="MSG0003"||ds.errorCode=="MSG0004"){$.panQuery.clear();searchList("Q1")}else{MessageBoxShow("권한 그룹 메뉴를 저장하는 도중 오류가 발생하였습니다.<br>관리자에게 문의하여 주시기 바랍니다.");return}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){$.varUserGroupId="";searchList("Q1")}else{if(id=="btnAdd"){var aRow1=$.grdMenu.getAllRows(),aRow2=$.grdMenuAuth.getAllRows();var rId=$.grdMenu.getSelectedRowIdx();if(!rId){return}var keyId=$.grdMenu.getValue(rId,"menu_id");var path=$.grdMenu.getValue(rId,"path");for(var i in aRow1){if(aRow1[i].menu_id==keyId||path.indexOf("|"+aRow1[i].menu_id+"|")!=-1||aRow1[i].path.indexOf("|"+keyId+"|")!=-1){var overlap=0;if(aRow2.length>0){for(var j in aRow2){if(aRow1[i].menu_id==aRow2[j].menu_id){overlap++}}}if(overlap>0){continue}aRow2.push({parent_menu_id:aRow1[i].parent_menu_id,menu_id:aRow1[i].menu_id,menu_name:aRow1[i].menu_name,form_id:aRow1[i].form_id,sort_seq:aRow1[i].sort_seq,row_state:"N",path:aRow1[i].path})}}$.grdMenuAuth.setData(aRow2);$.grdMenuAuth.openNode("all")}else{if(id=="btnDelete"){var rId=$.grdMenuAuth.getSelectedRowIdx();if(!rId){return}var keyId=$.grdMenuAuth.getValue(rId,"menu_id");var aRow=$.grdMenuAuth.getAllRows();for(var i in aRow){if(aRow[i].menu_id==keyId||aRow[i].path.indexOf("|"+keyId+"|")!=-1){var subRowId=aRow[i].id;if(aRow[i].rowType!="N"){var overlap=0;for(var j in $.varDeleteRow){if($.varDeleteRow[j].menu_id==aRow[i].menu_id){overlap++}}if(overlap>0){$.grdMenuAuth.deleteRow(subRowId);continue}else{$.varDeleteRow.push({row_state:"D",menu_id:$.grdMenuAuth.getValue(rId,"menu_id")});$.grdMenuAuth.deleteRow(subRowId)}}else{$.grdMenuAuth.deleteRow(subRowId)}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){if(rId==-1){return}$.varUserGroupId=$.grdList.getValue(rId,"user_group_id");$.txtGroupIdInfo.setReadOnly(true);$.txtGroupNameInfo.setReadOnly(true);searchList("Q2");$.panInfo.enableButton(["btnDelete"])}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txtGroupIdQ"||id=="txtGroupNameQ")&&value=="13"){searchList("Q1")}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnNew"){$.varUserGroupId="";$.txtGroupIdInfo.setValue("");$.txtGroupNameInfo.setValue("");$.chkUseYnInfo.setValue("Y");$.txtDescrInfo.setValue("");$.txtGroupIdInfo.setReadOnly(false);$.txtGroupNameInfo.setReadOnly(false);$.grdList.selectRow(-1);$.grdMenuAuth.setData("");$.grdEmp.setData("");$.panInfo.disableButton(["btnDelete"]);$.txtGroupIdInfo.setFocus()}else{if(btnId=="btnSave"){if($.txtGroupIdInfo.getValue()==""){MessageBoxShow("사용자그룹ID 은(는) 필수 입력 항목 입니다.");return}else{if($.txtGroupNameInfo.getValue()==""){MessageBoxShow("사용자그룹명 은(는) 필수 입력 항목 입니다.");return}}var workType=$.varUserGroupId==""?"N":"U";saveAuthGroup(workType)}else{if(btnId=="btnDelete"){if($.varUserGroupId==""){MessageBoxShow("삭제할 권한그룹을 선택하여 주십시오.");return}confirmBoxShow("정말 삭제하시겠습니까?<br/>삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){saveAuthGroup("D")}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>