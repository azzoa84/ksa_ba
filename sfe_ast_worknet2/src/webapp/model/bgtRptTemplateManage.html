<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.panTree=null;$.panRowSet=null;$.lblRptTemplate=null;$.cmbRptTemplate=null;$.lblRemark=null;$.txtRemark=null;$.btnAdd=null;$.lblParentRow=null;$.txtParentRow=null;$.lblRowDisp=null;$.txtRowDisp=null;$.lblOrderSeq=null;$.speOrderSeq=null;$.lblRowType=null;$.cmbRowType=null;$.chkUseYn=null;$.lblUseYn=null;$.panRowData=null;$.grdRowData=null;$.panInput=null;$.grdInput=null;$.panAppr=null;$.grdAppr=null;$.btnChange=null;$.treeReport=null;$.lblCompanyType=null;$.cmbCompanyType=null;$.lblProduct=null;$.mtBrand=null;$.rptTemplateData=[];$.reportId="";$.rowSeq=0;$.parentRowSeq=0;$.parentId=null;$.saveType="N";function createJSON_Q(workType){var json=createExecuteParamInfo("P_bgtRptTemplate_Q",[workType,$.reportId,$.rowSeq,"#UserID#"]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_bgtCommon_Q",[workType,"","","","","","ALL","#UserID#"]);return json}function createJSON_S(workType,popResult,gubun){var json="";json=createExecuteParamInfo("P_bgtRptTemplate_S2",[workType,$.reportId,parseInt($.rowSeq),parseInt($.parentRowSeq),(gubun=="MASTER"?$.txtRowDisp.getValue():""),(gubun=="MASTER"?$.cmbRowType.getValue():""),(gubun=="MASTER"?$.speOrderSeq.getValue():""),(gubun=="MASTER"?$.chkUseYn.getValue():""),(gubun=="MASTER"?$.cmbCompanyType.getValue():""),(gubun=="ROW"?getConcatData(popResult,"product_code"):($.mtBrand.getSelectedCodeList().replace("EMPTY","")||"")),(gubun=="INPUT"?getConcatData(popResult,"employee_id"):""),(gubun=="APPR"?getConcatData(popResult,"employee_id"):""),"#UserID#"]);return json}function getConcatData(arr,key){var str=arr.map(function(item){return item[key]}).join("|")||"";return str}function searchReportTemplateCombo(workType){var json=createJSON_Q(workType);callQuery(["req",json],"REPORT_TEMPLATE_COMBO_Q",$)}function searchReportTemplateTree(workType){var json=createJSON_Q(workType);callQuery(["req",json],"REPORT_TEMPLATE_TREE_Q",$)}function searchReportLine(workType){var json=createJSON_Q(workType);callQuery(["req",json],"REPORT_TEMPLATE_LINE_Q",$)}function searchReportGrid(workType,gubun){var json=createJSON_Q(workType);callQuery(["req",json],"REPORT_TEMPLATE_"+gubun+"_Q",$)}function searchBrand(workType){var json=createJSON_Q1(workType);callQuery(["req",json],"REPORT_BRAND",$)}function saveReportLine(workType){var json=createJSON_S(workType,"","MASTER");callExecute(["req",json],"REPORT_TEMPLATE_LINE_S",$)}function saveReportGrid(workType,popResult,gubun){var json=createJSON_S(workType,popResult,gubun);var ds=callExecuteSync(["req",json],"REPORT_TEMPLATE_"+gubun+"_S");MessageBoxShow("정상적으로 저장 되었습니다.");searchReportGrid("Q_"+gubun,gubun)}function chkDuplicateData(gridId,popResult,key,msg){var dt=gridId.getAllRows();var rowData={};var compData={};for(var i=0;i<dt.length;i++){rowData=dt[i];for(var j=0;j<popResult.length;j++){var compData=popResult[j];if(rowData[key]==compData[key]){MessageBoxShow("중복된 "+msg+" 존재");return false}}}return true}function getHelpComment(value){var str=value+'&nbsp;&nbsp;<span style="font-size: 11px; color:red;">(* 추가/삭제 시, 자동저장)</span>';return str}function initData(){$.reportId="";$.rowSeq=0;$.parentRowSeq=0;$.parentId=null}function initReport(){$.panRowSet.clear();$.grdRowData.clear();$.grdInput.clear();$.grdAppr.clear();$.chkUseYn.setValue("Y");$.mtBrand.setAllCheck(false)}function deleteChk(gridId){var checkedRow=gridId.getCheckedRows("chk");if(!checkedRow.length){MessageBoxShow("삭제할 내역을 선택하세요.");return false}return true}function setReportVisible(val){if(val=="Y"){$.panRowData.disableButton(["btnDelete","btnAdd"]);$.panInput.disableButton(["btnDelete","btnAdd"]);$.panAppr.disableButton(["btnDelete","btnAdd"])}else{$.panRowData.enableButton(["btnDelete","btnAdd"]);$.panInput.enableButton(["btnDelete","btnAdd"]);$.panAppr.enableButton(["btnDelete","btnAdd"])}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,945);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,55);$.panTop.setText("");$.panTop.setBottomLine();$.panTree=new FingerPanel(host,"panTree",0,65,330,820);$.panTree.setText("리포트");$.panTree.setBottomLine(true);$.panRowSet=new FingerPanel(host,"panRowSet",340,65,860,820);$.panRowSet.setText("라인별 설정 ");$.panRowSet.setBottomLine(true);$.lblRptTemplate=new FingerLabel(host,"lblRptTemplate",0,15,100,20);$.lblRptTemplate.setText("리포트템플릿");$.cmbRptTemplate=new FingerComboBox(host,"cmbRptTemplate",105,15,330,20);$.lblRemark=new FingerLabel(host,"lblRemark",540,15,100,20);$.lblRemark.setText("설명");$.txtRemark=new FingerEdit(host,"txtRemark",645,15,525,20);$.btnAdd=new FingerButton(host,"btnAdd",440,15,80,20);$.btnAdd.setText("추가");$.lblParentRow=new FingerLabel(host,"lblParentRow",0,15,100,20);$.lblParentRow.setText("상위라인");$.txtParentRow=new FingerEdit(host,"txtParentRow",105,15,155,20);$.lblRowDisp=new FingerLabel(host,"lblRowDisp",0,50,100,20);$.lblRowDisp.setText("라인표시명칭");$.txtRowDisp=new FingerEdit(host,"txtRowDisp",105,50,155,20);$.lblOrderSeq=new FingerLabel(host,"lblOrderSeq",390,50,100,20);$.lblOrderSeq.setText("표시(정렬)순서");$.speOrderSeq=new FingerSpinEdit(host,"speOrderSeq",495,50,135,20);$.lblRowType=new FingerLabel(host,"lblRowType",0,85,100,20);$.lblRowType.setText("라인구분");$.cmbRowType=new FingerComboBox(host,"cmbRowType",105,85,160,20);$.chkUseYn=new FingerCheckBox(host,"chkUseYn",490,17,120,20);$.chkUseYn.setText("");$.lblUseYn=new FingerLabel(host,"lblUseYn",390,15,100,20);$.lblUseYn.setText("사용여부");$.panRowData=new FingerPanel(host,"panRowData",10,240,625,300);$.panRowData.setText("라인데이터");$.panRowData.setBottomLine(true);$.grdRowData=new FingerDataGrid(host,"grdRowData",0,0,625,255);$.panInput=new FingerPanel(host,"panInput",10,552,415,200);$.panInput.setText("입력 권한");$.panInput.setBottomLine(true);$.grdInput=new FingerDataGrid(host,"grdInput",0,0,415,155);$.panAppr=new FingerPanel(host,"panAppr",435,552,415,200);$.panAppr.setText("승인 권한");$.panAppr.setBottomLine(true);$.grdAppr=new FingerDataGrid(host,"grdAppr",0,0,415,155);$.btnChange=new FingerButton(host,"btnChange",270,14,100,20);$.btnChange.setText("변경");$.treeReport=new FingerTree(host,"treeReport",0,0,330,770);$.lblCompanyType=new FingerLabel(host,"lblCompanyType",390,85,100,20);$.lblCompanyType.setText("회사구분");$.cmbCompanyType=new FingerComboBox(host,"cmbCompanyType",495,85,140,20);$.lblProduct=new FingerLabel(host,"lblProduct",0,120,100,20);$.lblProduct.setText("품목구분");$.mtBrand=new FingerMultiSelect(host,"mtBrand",105,125,155,90);$.panTop.setBorder(true);$.panTree.setText("' ' 리포트");$.panRowData.setText(getHelpComment("라인데이터"));$.panInput.setText(getHelpComment("입력 권한"));$.panAppr.setText(getHelpComment("승인 권한"));$.panRowSet.addButtons(["btnDelete","btnSave","btnNew"]);$.panRowData.addButtons(["btnDelete","btnAdd"]);$.panInput.addButtons(["btnDelete","btnAdd"]);$.panAppr.addButtons(["btnDelete","btnAdd"]);$.txtRowDisp.setAllowBlank(false,"라인표시명칭");$.cmbRowType.setEmptyRow(true);$.cmbRptTemplate.setEmptyRow(true);$.cmbRptTemplate.setColumn("report_id","report_type_name");$.cmbRptTemplate.setColumnConfig([{id:"report_id",width:100},{id:"report_type_name",width:150}]);$.cmbCompanyType.setEmptyRow(true);$.txtParentRow.setReadOnly(true);$.txtRemark.setReadOnly(true);$.grdRowData.setColumns([new FingerDataGridColumn("chk",46,"center","checkbox","masterCheckbox"),new FingerDataGridColumn("product_code",187,"left","string","품목코드",{readonly:true}),new FingerDataGridColumn("product_name",187,"left","string","품목명",{readonly:true}),new FingerDataGridColumn("eng_product_name",187,"left","string","품목명(영문)",{readonly:true})]);$.grdRowData.init({scroll:"xy"});$.grdRowData.setBorder(false);$.grdInput.setColumns([new FingerDataGridColumn("chk",44,"center","checkbox","masterCheckbox"),new FingerDataGridColumn("dept_name",222,"left","string","부서",{readonly:true}),new FingerDataGridColumn("emp_name",142,"left","string","담당자",{readonly:true})]);$.grdInput.init();$.grdInput.setBorder(false);$.grdAppr.setColumns([new FingerDataGridColumn("chk",44,"center","checkbox","masterCheckbox"),new FingerDataGridColumn("dept_name",222,"left","string","부서",{readonly:true}),new FingerDataGridColumn("emp_name",142,"142","string","담당자",{readonly:true})]);$.grdAppr.init();$.grdAppr.setBorder(false);$.lblCompanyType.setVisible(false);$.cmbCompanyType.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panTree);$.panMain.add($.panRowSet);$.panTop.add($.lblRptTemplate);$.panTop.add($.cmbRptTemplate);$.panTop.add($.lblRemark);$.panTop.add($.txtRemark);$.panTop.add($.btnAdd);$.panTree.add($.treeReport);$.panRowSet.add($.lblParentRow);$.panRowSet.add($.txtParentRow);$.panRowSet.add($.lblRowDisp);$.panRowSet.add($.txtRowDisp);$.panRowSet.add($.lblOrderSeq);$.panRowSet.add($.speOrderSeq);$.panRowSet.add($.lblRowType);$.panRowSet.add($.cmbRowType);$.panRowSet.add($.chkUseYn);$.panRowSet.add($.lblUseYn);$.panRowSet.add($.panRowData);$.panRowSet.add($.panInput);$.panRowSet.add($.panAppr);$.panRowSet.add($.btnChange);$.panRowSet.add($.lblCompanyType);$.panRowSet.add($.cmbCompanyType);$.panRowSet.add($.lblProduct);$.panRowSet.add($.mtBrand);$.panRowData.add($.grdRowData);$.panInput.add($.grdInput);$.panAppr.add($.grdAppr);var ds=bizComponentData2($,"Q1","L_BGT007|L_BGT009");setComboBind([$.cmbRowType,$.cmbCompanyType],ds);searchReportTemplateCombo("Q_COMBO");searchBrand("Q_BRAND")};$.callback=function(type,ds){if(type=="REPORT_TEMPLATE_COMBO_Q"){$.cmbRptTemplate.clear();setComboBind([$.cmbRptTemplate],ds)}else{if(type=="REPORT_TEMPLATE_TREE_Q"){$.treeReport.clearAll();$.treeReport.load(ds.resultList[0],"row_seq","parent_row_seq","row_disp","icon");var title=$.cmbRptTemplate.getValue("report_type_name");$.panTree.setText("' "+title+" ' 리포트");$.txtRemark.setValue(ds.resultList[1][0].remark||"")}else{if(type=="REPORT_TEMPLATE_LINE_Q"){initReport();if(ds){var rs=ds.resultList[0][0];$.parentRowSeq=rs.parent_row_seq;$.txtParentRow.setValue(rs.parent_row_disp);$.txtRowDisp.setValue(rs.row_disp);$.speOrderSeq.setValue(rs.order_seq);$.cmbRowType.setValue(rs.row_type);$.chkUseYn.setValue(rs.use_yn);$.cmbCompanyType.setValue(rs.company_type);if(rs.product_list){var sp=rs.product_list.split("|");var iLen=sp.length;var arr=[];for(var i=0;i<iLen;i++){$.mtBrand.setCheckByCode(sp[i],true)}}setDataGrid([null,$.grdRowData,$.grdInput,$.grdAppr],ds)}}else{if(type=="REPORT_TEMPLATE_LINE_S"){if(ds){if(ds.errorCode=="MSG0002"){$.rowSeq=ds.resultList[0][0].row_seq}else{if(ds.errorCode=="MSG0003"){$.rowSeq=0;$.saveType="N";initReport()}}MessageBoxShow("정상적으로 저장 되었습니다.");searchReportTemplateTree("Q_TREE")}}else{if(type=="REPORT_TEMPLATE_ROW_Q"){setDataGrid([$.grdRowData],ds)}else{if(type=="REPORT_TEMPLATE_INPUT_Q"){setDataGrid([$.grdInput],ds)}else{if(type=="REPORT_TEMPLATE_APPR_Q"){setDataGrid([$.grdAppr],ds)}else{if(type=="REPORT_BRAND"){$.mtBrand.setData1(ds.resultList[0],"product_code","product_short_name")}}}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnAdd"){g_main.openPopup("popRptTemplateManager.html","popRptTemplateManager","",0,0,"","",{},"","")}else{if(id=="btnChange"){if(!$.cmbRptTemplate.getValue()){MessageBoxShow("상위라인을 지정할 리포트템플릿을 선택하세요.");return}g_main.openPopup("popReportLineTree.html","popReportLineTree","",0,0,"","",{reportId:$.cmbRptTemplate.getValue()},"","")}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbRptTemplate"){$.reportId=value;if(value){searchReportTemplateTree("Q_TREE")}else{$.panTree.setText("' ' 리포트");$.treeReport.clearAll();$.txtRemark.setValue("");initReport();initData()}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panRowSet"){var nodeId=$.treeReport.getSelectedNodeId();if(!nodeId){MessageBoxShow("'"+$.cmbRptTemplate.getValue("report_type_name")+"' 리포트 트리에서<br>기준 노드를 선택해 주시기 바랍니다.");return}if(btnId=="btnNew"){$.rowSeq=0;$.saveType="N";setReportVisible("N");initReport();$.parentRowSeq=nodeId;$.txtParentRow.setText($.treeReport.getSelectedNodeText());$.speOrderSeq.setValue((parseInt($.treeReport.getUserData(nodeId,"row_level"))+1)*1000)}else{if(btnId=="btnDelete"){var msg="해당 라인데 설정된 라인데이터, 권한목록이 함께 삭제됩니다.<br>삭제 하시겠습니까?";confirmBoxShow(msg,function(){if(g_main.msgShare==true){saveReportLine("D_LINE")}},null,370)}else{if(btnId=="btnSave"){if(!$.panRowSet.validateControls()){return}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){var workType=($.saveType+"_LINE");saveReportLine(workType)}})}}}}else{if(panelId=="panRowData"){if(btnId=="btnAdd"){if($.saveType=="N"){MessageBoxShow("신규 리포트 템플릿은 저장 후 등록할 수 있습니다.");return}g_main.openPopup("popProductBgt.html","popProductBgt","품목 조회",500,535,"","",{isMulti:true},"","")}else{if(btnId=="btnDelete"){if(!deleteChk($.grdRowData)){return}saveReportGrid("D_ROW",$.grdRowData.getCheckedRows("chk"),"ROW")}}}else{if(panelId=="panInput"){if(btnId=="btnAdd"){if($.saveType=="N"){MessageBoxShow("신규 리포트 템플릿은 저장 후 등록할 수 있습니다.");return}$.popCallId=panelId;g_main.openPopup("popEmp.html","popEmp","",0,0,"","",{emp_name:""},"","")}else{if(btnId=="btnDelete"){if(!deleteChk($.grdInput)){return}saveReportGrid("D_INPUT",$.grdInput.getCheckedRows("chk"),"INPUT")}}}else{if(panelId=="panAppr"){if(btnId=="btnAdd"){if($.saveType=="N"){MessageBoxShow("신규 리포트 템플릿은 저장 후 등록할 수 있습니다.");return}$.popCallId=panelId;g_main.openPopup("popEmp.html","popEmp","",0,0,"","",{emp_name:""},"","")}else{if(btnId=="btnDelete"){if(!deleteChk($.grdAppr)){return}saveReportGrid("D_APPR",$.grdAppr.getCheckedRows("chk"),"APPR")}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popRptTemplateManager"){$.rowSeq=0;$.saveType="N";initReport();searchReportTemplateCombo("Q_COMBO")}else{if(id=="popProductBgt"){var rs=[];if(Array.isArray(popResult)){rs=popResult}else{rs.push(popResult)}if(!chkDuplicateData($.grdRowData,rs,"product_code","품목")){return}saveReportGrid("N_ROW",rs,"ROW")}else{if(id=="popProductList"){log(popResult)}else{if(id=="popEmp"){var gubun="";var gridId="";var dt=[];dt.push(popResult);if($.popCallId=="panInput"){gubun="INPUT";gridId=$.grdInput}else{if($.popCallId=="panAppr"){gubun="APPR";gridId=$.grdAppr}}if(!chkDuplicateData(gridId,dt,"employee_id","담당자")){return}saveReportGrid("N_"+gubun,dt,gubun)}else{if(id=="popReportLineTree"){$.parentRowSeq=popResult[0];$.txtParentRow.setValue(popResult[1])}}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){if(id=="treeReport"){var rowSeq=value.id;var childYn=$.treeReport.getUserData(rowSeq,"child_yn");var rowLevel=$.treeReport.getUserData(rowSeq,"row_level");$.reportId=$.treeReport.getUserData(rowSeq,"report_id");$.rowSeq=$.treeReport.getUserData(rowSeq,"row_seq");$.saveType="U";$.parentId=value.parents.length;if(rowLevel==3){$.lblCompanyType.setVisible(true);$.cmbCompanyType.setVisible(true)}else{$.lblCompanyType.setVisible(false);$.cmbCompanyType.setVisible(false)}setReportVisible(childYn);searchReportLine("Q_LINE")}};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){if(id=="treeReport"){$.treeReport.expandAll();if($.rowSeq!=""){$.treeReport.setFocusNode($.rowSeq)}}};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>