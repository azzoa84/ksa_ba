<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panStandard=null;$.panAdjust=null;$.lblYear=null;$.cmbBudgetHalf=null;$.lblDept=null;$.cmbDept=null;$.lblEmp=null;$.cmbEmp=null;$.lblProduct=null;$.cmbProduct=null;$.btnSearch=null;$.lblTarget=null;$.speTarget=null;$.lblTargetAdd=null;$.speTargetAdd=null;$.lblBudget=null;$.speBudget=null;$.lblTargetSum=null;$.speTargetSum=null;$.lblTargetAddSum=null;$.speTargetAddSum=null;$.lblBudgetSum=null;$.speBudgetSum=null;$.panList=null;$.grdList=null;$.btnSave=null;$.btnConfirm=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmAM_target_adjust_Q",[workType,$.cmbBudgetHalf.getValue().substring(0,4),$.cmbBudgetHalf.getValue().substring(5,6),$.cmbDept.getValue(),$.cmbEmp.getValue(),$.cmbProduct.getValue()]);return json}function createJSON_S(workType){var json="";var rows=[];var changedRows=$.grdList.getChangedRows();if(workType!="C"&&workType!="S1"){if(changedRows.length<1){MessageBoxShow("저장할 내용이 존재하지 않습니다.");return false}}if(workType=="S1"){json=createExecuteParamInfo("P_crmAM_target_adjust_S",[workType,$.grdList.getValue(0,"base_yyyy"),$.grdList.getValue(0,"base_half"),$.grdList.getValue(0,"dept_code"),"","","",$.grdList.getValue(0,"product_code"),0]);return json}else{for(var i in changedRows){rows.push([workType,changedRows[i].base_yyyy,changedRows[i].base_half,changedRows[i].dept_code,changedRows[i].employee_id,changedRows[i].company_id,changedRows[i].sidogu_code,changedRows[i].product_code,Number(changedRows[i].target_add)||0])}json=createExecuteParamInfo("P_crmAM_target_adjust_S",rows);return json}}function searchList(workType){if(!validateControls([$.cmbBudgetHalf,$.cmbDept,$.cmbProduct])){return}var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveList(workType){var deTargetAdd=0;var deTargetAddSum=0;var deTarget=0;var deTargetResultSum=0;if($.grdList.getRowCount()<=0){return}deTargetAdd=$.speTargetAdd.getValue();deTarget=$.speTarget.getValue();for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"'target_add")<=-1){MessageBoxShow("-(마이너스) 값을 넣을 수 없습니다!");return false}if(($.grdList.getValue(i,"company_id")=="H00000000"&&$.grdList.getValue(i,"product_code")=="P04"&&$.grdList.getValue(i,"target_add")!==0)){MessageBoxShow("수정 불가능한 거래처가 있습니다. <br> 기획팀에 문의 하세요.");return false}deTargetAddSum=deTargetAddSum+Number($.grdList.getValue(i,"target_add"));deTargetResultSum=deTargetResultSum+Number($.grdList.getValue(i,"target_result"))}if(workType=="C"&&deTargetAdd!=deTargetAddSum){MessageBoxShow("AM 조정할 목표와 실제 조정한 목표의 합계가 같아야 합니다.");return false}if(workType=="C"&&deTarget!=deTargetResultSum){MessageBoxShow("영업소 총 목표와 실제 영업소 목표 합계가 같아야 합니다.");return false}if(workType!="C"&&workType!="S1"){var changedRows=$.grdList.getChangedRows();if(changedRows.length<1){MessageBoxShow("저장할 내용이 존재하지 않습니다.");return false}}var json=createJSON_S(workType);callExecute(["req",json],workType,$)}function changeColor(){return{background:"#FFE08C !important"}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,770);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panStandard=new FingerPanel(host,"panStandard",0,65,300,165);$.panStandard.setText("영업소 기준 목표");$.panStandard.setBottomLine(true);$.panAdjust=new FingerPanel(host,"panAdjust",310,65,300,165);$.panAdjust.setText("영업소 AM 조정 확인");$.panAdjust.setBottomLine(true);$.lblYear=new FingerLabel(host,"lblYear",0,15,100,20);$.lblYear.setText("년도/반기");$.cmbBudgetHalf=new FingerComboBox(host,"cmbBudgetHalf",105,15,140,20);$.lblDept=new FingerLabel(host,"lblDept",225,15,100,20);$.lblDept.setText("부서");$.cmbDept=new FingerComboBox(host,"cmbDept",330,15,160,20);$.lblEmp=new FingerLabel(host,"lblEmp",470,15,100,20);$.lblEmp.setText("이름");$.cmbEmp=new FingerComboBox(host,"cmbEmp",575,15,140,20);$.lblProduct=new FingerLabel(host,"lblProduct",695,15,100,20);$.lblProduct.setText("품목");$.cmbProduct=new FingerComboBox(host,"cmbProduct",800,15,140,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.lblTarget=new FingerLabel(host,"lblTarget",0,15,120,20);$.lblTarget.setText("영업소 총 목표");$.speTarget=new FingerSpinEdit(host,"speTarget",125,15,140,20);$.lblTargetAdd=new FingerLabel(host,"lblTargetAdd",0,45,120,20);$.lblTargetAdd.setText("AM 조정할 목표");$.speTargetAdd=new FingerSpinEdit(host,"speTargetAdd",125,45,140,20);$.lblBudget=new FingerLabel(host,"lblBudget",0,75,120,20);$.lblBudget.setText("영업소 배정 예산");$.speBudget=new FingerSpinEdit(host,"speBudget",125,75,140,20);$.lblTargetSum=new FingerLabel(host,"lblTargetSum",0,15,120,20);$.lblTargetSum.setText("영업소 목표 합계");$.speTargetSum=new FingerSpinEdit(host,"speTargetSum",125,15,140,20);$.lblTargetAddSum=new FingerLabel(host,"lblTargetAddSum",0,45,120,20);$.lblTargetAddSum.setText("조정 목표 합계");$.speTargetAddSum=new FingerSpinEdit(host,"speTargetAddSum",125,45,140,20);$.lblBudgetSum=new FingerLabel(host,"lblBudgetSum",0,75,120,20);$.lblBudgetSum.setText("기준 예산 합계");$.speBudgetSum=new FingerSpinEdit(host,"speBudgetSum",125,75,140,20);$.panList=new FingerPanel(host,"panList",0,240,1200,520);$.panList.setText("목표 조정");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,475);$.btnSave=new FingerButton(host,"btnSave",873,-40.5,95,30);$.btnSave.setText("임시저장");$.btnConfirm=new FingerButton(host,"btnConfirm",955,-40.5,95,30);$.btnConfirm.setText("확정");$.panQuery.setBorder(true);$.panStandard.setTitleType("SMALL");$.panAdjust.setTitleType("SMALL");var checkPositiveNumber=function(value){return value>=0};var preEvHandler=[{name:"onValidationError",handler:function(id,obj,details){if(details.target_add){MessageBoxShow("조정목표(수량)값은 양수로 입력해 주시기 바랍니다.");obj.target_add=""}}}];$.fixedGrdColumns=[new FingerDataGridColumn("base_yyyy",70,"left","string",[{text:"",colspan:13},"년도"],{hidden:true}),new FingerDataGridColumn("base_half",70,"left","string",["","반기"],{hidden:true}),new FingerDataGridColumn("dept_code",150,"left","string",["","부서코드"],{hidden:true}),new FingerDataGridColumn("dept_name",100,"left","string",["","부서"],{readonly:true,hidden:true}),new FingerDataGridColumn("employee_id",100,"left","string",["","사원명"],{hidden:true}),new FingerDataGridColumn("emp_name",100,"left","string",["","이름"],{hidden:true}),new FingerDataGridColumn("product_code",100,"left","string",["","제품코드"],{hidden:true}),new FingerDataGridColumn("product_name",70,"left","string",["","품목"],{readonly:true}),new FingerDataGridColumn("company_id",100,"left","string",["","거래처코드"],{hidden:true}),new FingerDataGridColumn("company_name",100,"left","string",["","거래처/지역"],{readonly:true}),new FingerDataGridColumn("sidogu_name",100,"left","string",["","거래처/지역"],{hidden:true}),new FingerDataGridColumn("channel",100,"left","string",["","구분"],{hidden:true}),new FingerDataGridColumn("channel_name",100,"left","string",["","구분"],{hidden:true}),new FingerDataGridColumn("target_month",100,"right","int",[{text:"1차목표배분",colspan:3},"기준목표(월)"],{format:"int",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("target",110,"right","int",["","기준목표(반기)"],{format:"int",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("target_share",100,"right","int",["","영업소내%"],{format:"percent_2",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("target_growth",100,"right","string",[{text:"영업소AM진행",colspan:7},""],{hidden:true}),new FingerDataGridColumn("target_add",120,"right","int",["",{text:"조정목표(수량)",css:"col_edit"}],{cssFormat:changeColor,format:"int",footer:{content:"summColumn"},validation:checkPositiveNumber}),new FingerDataGridColumn("target_result",110,"right","int",["","확정목표(수량)"],{format:"int",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("product_amt",100,"right","string",["",""],{hidden:true}),new FingerDataGridColumn("target_result_amt",110,"right","int",["","확정목표(금액)"],{format:"int",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("target_result_share",100,"right","int",["","영업소내%"],{format:"percent_2",readonly:true,footer:{content:"summColumn"}}),new FingerDataGridColumn("target_result_growth",110,"right","int",["","확정기준성장률"],{readonly:true}),new FingerDataGridColumn("budget30",100,"right","int",[{text:"예산",colspan:1},"기준예산"],{format:"int",readonly:true,footer:{content:"summColumn"}})];$.grdList.saveColumns($.fixedGrdColumns);$.grdList.colIdx=$.grdList.setColumns($.fixedGrdColumns);$.grdList.init({panel:$.panList,scroll:"xy",footer:true,eventCellReadOnly:true,leftSplit:13,preEventHandler:preEvHandler});$.grdList.setEditable(true);$.cmbDept.setEmptyRow(true);$.cmbEmp.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbBudgetHalf.setAllowBlank(false,"년도/반기");$.cmbDept.setAllowBlank(false,"부서");$.cmbProduct.setAllowBlank(false,"품목");$.speTarget.setEnable(false);$.speTargetAdd.setEnable(false);$.speBudget.setEnable(false);$.speTargetSum.setEnable(false);$.speTargetAddSum.setEnable(false);$.speBudgetSum.setEnable(false);$.btnSave.setClass("btn_save");$.btnConfirm.setClass("btn_save");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panStandard);$.panMain.add($.panAdjust);$.panMain.add($.panList);$.panQuery.add($.lblYear);$.panQuery.add($.cmbBudgetHalf);$.panQuery.add($.lblDept);$.panQuery.add($.cmbDept);$.panQuery.add($.lblEmp);$.panQuery.add($.cmbEmp);$.panQuery.add($.lblProduct);$.panQuery.add($.cmbProduct);$.panQuery.add($.btnSearch);$.panStandard.add($.lblTarget);$.panStandard.add($.speTarget);$.panStandard.add($.lblTargetAdd);$.panStandard.add($.speTargetAdd);$.panStandard.add($.lblBudget);$.panStandard.add($.speBudget);$.panAdjust.add($.lblTargetSum);$.panAdjust.add($.speTargetSum);$.panAdjust.add($.lblTargetAddSum);$.panAdjust.add($.speTargetAddSum);$.panAdjust.add($.lblBudgetSum);$.panAdjust.add($.speBudgetSum);$.panList.add($.grdList);$.panList.add($.btnSave);$.panList.add($.btnConfirm);$.cmbDept.setColumn("dept_code","dept_name");$.cmbProduct.setColumn("product_code","product_name");var ds=bizComponentData2($,"Q1","L_CRM195|L_CRM0059");setComboBind([$.cmbDept,$.cmbProduct],ds);var ds2=bizComponentData2($,"Q2","S_9999_2");setComboBind([$.cmbBudgetHalf],ds2);if((g_main.session.getValue("SystemDeveloper")=="Y"||g_main.session.getValue("DeptCode").substring(0,1)=="F")||(g_main.session.getValue("DeptCode").substring(0,3)=="J11")||(g_main.session.getValue("DeptCode").substring(2,2)=="00")||(g_main.session.getValue("DeptCode").substring(0,4)=="S000")||(g_main.session.getValue("DeptCode").substring(0,4)=="S400")||(g_main.session.getValue("DeptCode").substring(0,4)=="S300")||(g_main.session.getValue("DeptCode").substring(0,4)=="S500")||(g_main.session.getValue("DeptCode").substring(0,4)=="T000")||(g_main.session.getValue("DeptCode").substring(0,4)=="T300")||(g_main.session.getValue("DeptCode").substring(0,4)=="T100")){$.cmbDept.setEnable(true);$.cmbDept.setValue(g_main.session.getValue("DeptCode"));$.cmbEmp.setValue(g_main.session.getValue("UserID"))}else{$.cmbDept.setEnable(false);$.cmbDept.setValue(g_main.session.getValue("DeptCode"));$.cmbEmp.setValue(g_main.session.getValue("UserID"))}if(g_main.session.getValue("DeptCode").substring(0,2)=="S4"){$.cmbProduct.setValue("P04")}else{if(g_main.session.getValue("DeptCode").substring(0,2)=="S5"){$.cmbProduct.setValue("P16")}else{if(g_main.session.getValue("DeptCode").substring(0,2)=="T1"){$.cmbProduct.setValue("P11")}else{if(g_main.session.getValue("DeptCode").substring(0,2)=="T3"){$.cmbProduct.setValue("P16")}else{if(g_main.session.getValue("DeptCode")=="S030"){$.cmbProduct.setValue("P07")}}}}}};$.callback=function(type,ds){if(type=="Q"){var ds1=ds.resultList[0];var ds2=ds.resultList[1][0];var ds3=ds.resultList[2][0];var ds4=ds.resultList[3][0];$.panStandard.clear();$.panAdjust.clear();if(ds2){$.speTarget.setValue(ds2.target);$.speTargetAdd.setValue(ds2.target_add);$.speBudget.setValue(ds2.budget)}if(ds3){$.speTargetSum.setValue(ds3.target_sum);$.speTargetAddSum.setValue(ds3.target_add_sum);$.speBudgetSum.setValue(ds3.budget_sum)}var tmpCols=$.grdList.getSaveColumns();var tmpNumber=2;tmpCols.splice(13,0,new FingerDataGridColumn("target1",90,"right","int",[{text:"이전목표배분현황",colspan:3},ds4.target1],{format:"int",readonly:true,footer:{content:"summColumn"}}));tmpCols.splice(14,0,new FingerDataGridColumn("target2",90,"right","int",["",ds4.target2],{format:"int",readonly:true,footer:{content:"summColumn"}}));tmpCols.splice(15,0,new FingerDataGridColumn("target3",90,"right","int",["",ds4.target3],{format:"int",readonly:true,footer:{content:"summColumn"}}));tmpCols.splice(16,0,new FingerDataGridColumn("sale1_qty",90,"right","int",[{text:"이전실적현황",colspan:3},ds4.target1],{format:"int",readonly:true,footer:{content:"summColumn"}}));tmpCols.splice(17,0,new FingerDataGridColumn("sale2_qty",90,"right","int",["",ds4.target2],{format:"int",readonly:true,footer:{content:"summColumn"}}));tmpCols.splice(18,0,new FingerDataGridColumn("sale3_qty",90,"right","int",["",ds4.target3],{format:"int",readonly:true,footer:{content:"summColumn"}}));$.grdList.resetColumns(tmpCols);setDataGrid([$.grdList],ds1,true)}else{if(type=="S"||type=="C"){saveList("S1")}else{if(type=="S1"){searchList("Q")}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchList("Q")}else{if(id=="btnSave"){confirmBoxShow("임시저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("S")}})}else{if(id=="btnConfirm"){confirmBoxShow("확정처리 하시겠습니까?",function(){if(g_main.msgShare==true){saveList("C")}})}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){$.cmbEmp.clear();$.cmbEmp.setColumn("employee_id","emp_name");var strQuery=" and dept_code = '"+$.cmbDept.getValue()+"'and delete_yn <> 'Y'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery);setComboBind([$.cmbEmp],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList"){if(cInd=="target_add"){var dsumTargetAdd=0;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"'target_add")<=-1){MessageBoxShow("-(마이너스) 값을 넣을 수 없습니다!");return false}dsumTargetAdd+=Number($.grdList.getValue(i,"target_add"))}}$.speTargetAddSum.setValue(dsumTargetAdd)}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>