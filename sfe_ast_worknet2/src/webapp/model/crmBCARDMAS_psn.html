<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.panMiddle=null;$.panBottom=null;$.grdTop=null;$.grdBottom=null;$.btnHandle=null;$.btnCancel=null;$.lblLabel1=null;$.txtTitle=null;$.varWFDocId="";$.varBusinessId="";$.varWFType="";$.varOldValue="";function createJSON_Q(workType,formID){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","",formID]);return json}function createJSON_Q1(workType){var json=createExecuteParamInfo("P_crmBCARDMAS_psn_Q",[workType,g_main.session.obj.UserID]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmBCARDMAS_psn_Q1",[workType,g_main.session.obj.UserID]);return json}function createJSON_S(workType){var json="";var rows=[];var seq=1;var cRow=$.grdTop.getCheckedRows("chk");for(var i in cRow){rows.push([workType,$.varWfDocId,seq,g_main.session.obj.DeptCode,g_main.session.obj.UserID,cRow[i].APPDAT,cRow[i].CARDNO,cRow[i].APPRNO,Number(cRow[i].APPAMT),cRow[i].VENKNM,cRow[i].MEMO]);seq++}json=createExecuteParamInfo("P_crmWFCardPSNReq_S",rows);return json}function createJSON_S1(workType){var json=createExecuteParamInfo("P_crmWFCardPSNReq_S",[workType,$.varWfDocId,0,g_main.session.obj.DeptCode,g_main.session.obj.UserID,"","","",0,"",$.grdBottom.getValue($.grdBottom.getSelectedRowIdx(),"wf_doc_id")]);return json}function searchWFDocument(formID){var json=createJSON_Q("Q3",formID);callQuery(["req",json],"Q3",$)}function searchCalcList(){var json=createJSON_Q1("Q");callQuery(["req",json],"Q",$)}function searchCalcWFList(){var json=createJSON_Q2("Q");callQuery(["req",json],"Q1",$)}function savePSNList(){var json=createJSON_S("N");var ds=callExecuteSync(["req",json],"N",$,false);var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function makeCancelWFDocu(){var json=createJSON_S1("N1");var ds=callExecuteSync(["req",json],"N1",$,false);var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,950);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,350);$.panTop.setText("미정산 영수증");$.panTop.setBottomLine(true);$.panMiddle=new FingerPanel(host,"panMiddle",0,360,1200,80);$.panMiddle.setText("");$.panMiddle.setBottomLine(true);$.panBottom=new FingerPanel(host,"panBottom",0,450,1200,300);$.panBottom.setText("개인정산처리내역");$.panBottom.setBottomLine(true);$.grdTop=new FingerDataGrid(host,"grdTop",0,0,1200,300);$.grdBottom=new FingerDataGrid(host,"grdBottom",0,0,1200,350);$.btnHandle=new FingerButton(host,"btnHandle",250,20,120,40);$.btnHandle.setText("개인정산 ▼");$.btnCancel=new FingerButton(host,"btnCancel",875,20,120,40);$.btnCancel.setText("취소기안 ▲");$.lblLabel1=new FingerLabel(host,"lblLabel1",355,25,460,20);$.lblLabel1.setText("개인정산처리 및 신용개설용으로 승인된 건들에 대해 처리하실 수 있습니다.");$.txtTitle=new FingerEdit(host,"txtTitle",300,10,140,20);$.panMiddle.setBorder(true);$.grdTop.setColumns([new FingerDataGridColumn("chk",50,"center","checkbox","선택"),new FingerDataGridColumn("CHGDAT0",100,"center","date","결재예정일"),new FingerDataGridColumn("APPDAT",130,"center","string","승인일시"),new FingerDataGridColumn("CARDNO",99,"left","string","카드번호",{hidden:true}),new FingerDataGridColumn("CARDNM",200,"left","string","카드정보"),new FingerDataGridColumn("APPRNO",90,"center","string","승인번호"),new FingerDataGridColumn("APPAMT",90,"right","string","승인금액",{format:"int"}),new FingerDataGridColumn("VENKNM",150,"left","string","가맹점"),new FingerDataGridColumn("MEMO",250,"left","string","개인정산사유"),new FingerDataGridColumn("VENADD",150,"left","string","가맹점주소"),new FingerDataGridColumn("VENGRP",150,"left","string","가맹점업태")]);$.grdTop.init({panel:$.panTop,scroll:"xy"});$.grdTop.setEditable(false);$.panTop.setBorder(false);$.grdBottom.setColumns([new FingerDataGridColumn("wf_doc_id",180,"center","string","기안문서번호"),new FingerDataGridColumn("employee_id",120,"center","string","기안자"),new FingerDataGridColumn("cardno",200,"center","string","카드번호"),new FingerDataGridColumn("amount",120,"right","string","개인정산금액",{format:"int"}),new FingerDataGridColumn("wf_status",120,"center","string","결재여부"),new FingerDataGridColumn("wf_date",120,"center","date","결재일")]);$.grdBottom.init({panel:$.panBottom,scroll:"xy"});$.grdBottom.setEditable(false);$.panBottom.setBorder(false);$.txtTitle.setAllowBlank(false,"문서제목");$.txtTitle.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panMiddle);$.panMain.add($.panBottom);$.panMain.add($.txtTitle);$.panTop.add($.grdTop);$.panMiddle.add($.btnHandle);$.panMiddle.add($.btnCancel);$.panMiddle.add($.lblLabel1);$.panBottom.add($.grdBottom);searchCalcList("Q");searchCalcWFList("Q1");var ds=bizComponentData2($,"Q1","L_CRM0219|L_CRM0006");$.grdBottom.setColumnDropDownList("employee_id",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdBottom.setColumnDropDownList("wf_status",ds.resultList[1])};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdTop],ds)}else{if(type=="Q1"){setDataGrid([$.grdBottom],ds)}else{if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue(result.business_title)}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnHandle"){if($.grdTop.getRowCount<1||$.grdTop.getCheckedRows("chk").length<1){return}confirmBoxShow("개인정산을 진행 하시겠습니까?",function(){if(g_main.msgShare==true){searchWFDocument("crmBCARDMAS_psn");var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmBCARDMAS_psn"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{return}})}else{if(id=="btnCancel"){if($.grdBottom.getRowCount<1||$.grdBottom.getValue($.grdBottom.getSelectedRowIdx(),"wf_status")!="90"){return}confirmBoxShow("개인정산내역을 취소 하시겠습니까?",function(){if(g_main.msgShare==true){searchWFDocument("crmBCARDMAS_psn1");var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmBCARDMAS_psn1"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{return}})}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnHandle"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){savePSNList()}}}else{if($.popUpCallId=="btnCancel"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){makeCancelWFDocu()}}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>