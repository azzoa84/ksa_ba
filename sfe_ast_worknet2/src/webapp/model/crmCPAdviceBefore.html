<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panFile=null;$.grdFile=null;$.btnConfirm=null;$.btnCancel=null;$.memcp_descr=null;$.btnMemoSave=null;$.panContact=null;$.grdContact=null;$.btnAdd=null;$.btnDel=null;$.btnLimitFree=null;$.panBottom=null;$.lbl_cp_id=null;$.txt_cp_id=null;$.lbl_employee_pm=null;$.cmb_employee_pm=null;$.cmb_Status=null;$.lbl_cp_advice_type=null;$.rbo_cp_advice_type=null;$.lbl_cp_supervise=null;$.rbo_cp_supervise=null;$.lbl_cp_advice_purpose=null;$.mem_cp_advice_purpose=null;$.lbl_cp_advice_total=null;$.spe_cp_advice_total=null;$.lbl_cp_advice_cnt=null;$.spe_cp_advice_amt=null;$.lbl_Txt1=null;$.lbl_cp_advice_company=null;$.lbl_app_date=null;$.dte_app_date=null;$.txt_cp_doc_no=null;$.txt_modify_yn=null;$.txt_wf_doc_id=null;$.txt_cp_code=null;$.txt_cp_etc_desc=null;$.txt_cp_advice_company=null;$.btnMAConfirm=null;$.btnMACancel=null;$.lbletc_descr=null;$.memoetc_descr=null;$.lbl_cp_advice_purpose2=null;$.com_cp_advice_title=null;$.lbl_cp_advice_title=null;$.bAllReport=false;$.bMyReport=false;$.bConfirm=false;$.bSave=false;function createJson_S(workType){var json=createExecuteParamInfo("P_crmCPExtraFunction_S",[workType,$.txt_cp_id.getValue()||"","","#UserID#"]);return json}function createJson_S1(workType){var strcontact_yn="N";var strcontact_id="";var strcompany_id="";var stradvice_amt="";var strproduct_code="";var strcp_advice_date1="";var strcp_place="";var strcp_start_date="";var strcp_end_date="";var stradvice_desc1_1="";var stradvice_desc1_2="";var strcp_etc1="";var stradvice_desc1_3="";var strcp_advice_subject="";var strcp_choice_desc="";var strcp_advice_date2="";var strcp_HH_fr="";var strcp_MM_fr="";var strcp_HH_to="";var strcp_MM_to="";var stradvice_desc2_1="";var stradvice_desc2_2="";var strcp_etc2="";var strmeal_yn="";var strtrans_yn="";var strstay_yn="";var strmeal_amt="";var strtrans_amt="";var strstay_amt="";var stretc_expense_sum="";var strbank_account="";var strfileYn="N";var strfile_type="";var strseq="";var strserver_path="";var strserver_fname="";var strlocal_fname="";if(workType=="N"||workType=="U"||workType=="NT"||workType=="UT"){if($.grdContact.getRowCount()>0){for(var i=0;i<$.grdContact.getRowCount();i++){if(i>0){strcontact_id+="|";strcompany_id+="|";stradvice_amt+="|";strproduct_code+="|";strcp_advice_date1+="|";strcp_place+="|";strcp_start_date+="|";strcp_end_date+="|";stradvice_desc1_1+="|";stradvice_desc1_2+="|";strcp_etc1+="|";stradvice_desc1_3+="|";strcp_advice_subject+="|";strcp_choice_desc+="|";strcp_advice_date2+="|";strcp_HH_fr+="|";strcp_MM_fr+="|";strcp_HH_to+="|";strcp_MM_to+="|";stradvice_desc2_1+="|";stradvice_desc2_2+="|";strcp_etc2+="|";strmeal_yn+="|";strtrans_yn+="|";strstay_yn+="|";strmeal_amt+="|";strtrans_amt+="|";strstay_amt+="|";stretc_expense_sum+="|";strbank_account+="|"}strcontact_id+=$.grdContact.getValue(i,"contact_id");strcompany_id+=$.grdContact.getValue(i,"company_id");stradvice_amt+=$.grdContact.getValue(i,"advice_amt");strproduct_code+=$.grdContact.getValue(i,"product_code");if($.grdContact.getValue(i,"cp_advice_date1")==""||$.grdContact.getValue(i,"cp_advice_date1")==null){strcp_advice_date1+=""}else{strcp_advice_date1+=$.grdContact.getValue(i,"cp_advice_date1")}strcp_place+=$.grdContact.getValue(i,"cp_place");strcp_start_date+=getFormatDate($.grdContact.getValue(i,"cp_start_date"),"yyyyMMdd").substring(0,8);strcp_end_date+=getFormatDate($.grdContact.getValue(i,"cp_end_date"),"yyyyMMdd").substring(0,8);stradvice_desc1_1+=$.grdContact.getValue(i,"advice_desc1_1");stradvice_desc1_2+=$.grdContact.getValue(i,"advice_desc1_2");strcp_etc1+=$.grdContact.getValue(i,"cp_etc1");stradvice_desc1_3+=$.grdContact.getValue(i,"advice_desc1_3");strcp_advice_subject+=$.grdContact.getValue(i,"cp_advice_subject");strcp_choice_desc+=$.grdContact.getValue(i,"cp_choice_desc");strcp_advice_date2+=$.grdContact.getValue(i,"cp_advice_date2");strcp_HH_fr+=$.grdContact.getValue(i,"cp_HH_fr");strcp_MM_fr+=$.grdContact.getValue(i,"cp_MM_fr");strcp_HH_to+=$.grdContact.getValue(i,"cp_HH_to");strcp_MM_to+=$.grdContact.getValue(i,"cp_MM_to");stradvice_desc2_1+=$.grdContact.getValue(i,"advice_desc2_1");stradvice_desc2_2+=$.grdContact.getValue(i,"advice_desc2_2");strcp_etc2+=$.grdContact.getValue(i,"cp_etc2");strmeal_yn+=$.grdContact.getValue(i,"meal_yn");strtrans_yn+=$.grdContact.getValue(i,"trans_yn");strstay_yn+=$.grdContact.getValue(i,"stay_yn");strmeal_amt+=$.grdContact.getValue(i,"meal_amt");strtrans_amt+=$.grdContact.getValue(i,"trans_amt");strstay_amt+=$.grdContact.getValue(i,"stay_amt");stretc_expense_sum+=$.grdContact.getValue(i,"etc_expense_sum");strbank_account+=$.grdContact.getValue(i,"advisor_bank_account")}}strcontact_yn="Y"}if(workType=="N"||workType=="U"||workType=="NT"||workType=="UT"){for(var i=0;i<$.grdFile.getRowCount();i++){if(i>0){strseq+="|";strfile_type+="|";strserver_path+="|";strserver_fname+="|";strlocal_fname+="|"}strfile_type+=$.grdFile.getValue(i,"file_type");strseq+=$.grdFile.getValue(i,"seq");strserver_path+=$.grdFile.getValue(i,"server_path");strserver_fname+=$.grdFile.getValue(i,"server_fname");strlocal_fname+=$.grdFile.getValue(i,"local_fname")}strfileYn="Y"}var json=createExecuteParamInfo("P_crmCPAdviceBefore_S",[workType,$.txt_cp_id.getValue()||"",$.txt_cp_doc_no.getValue()||"","#DeptCode#","#UserID#",$.cmb_employee_pm.getValue()||"",$.com_cp_advice_title.getValue(),$.mem_cp_advice_purpose.getValue()||"",Number($.spe_cp_advice_amt.getValue()),$.txt_cp_advice_company.getValue()||"",Number($.spe_cp_advice_total.getValue()),$.dte_app_date.getValue(),"CP20",$.txt_wf_doc_id.getValue()||"","#UserID#",strcontact_yn,$.rbo_cp_advice_type.getValue(),$.rbo_cp_supervise.getValue()||"",$.txt_cp_etc_desc.getValue(),$.memoetc_descr.getValue(),getFormatDate($.grdContact.getValue(0,"cp_start_date"),"yyyyMMdd"),$.dte_app_date.getValue(),strcontact_id,strcompany_id,stradvice_amt,strproduct_code,strcp_advice_date1,strcp_place,strcp_start_date,strcp_end_date,stradvice_desc1_1,stradvice_desc1_2,strcp_etc1,stradvice_desc1_3,strcp_advice_subject,strcp_choice_desc,strcp_advice_date2,strcp_HH_fr,strcp_MM_fr,strcp_HH_to,strcp_MM_to,stradvice_desc2_1,stradvice_desc2_2,strcp_etc2,strmeal_yn,strtrans_yn,strstay_yn,strmeal_amt,strtrans_amt,strstay_amt,stretc_expense_sum,strbank_account,strfileYn,strfile_type,strseq,strserver_path,strserver_fname,strlocal_fname]);return json}function saveCPExtraFunction(workType){var json=createJson_S(workType);callExecute(["req",json],workType,$)}function saveCPAdviceBefore(workType){if(!validateControls([$.mem_cp_advice_purpose,$.txt_cp_advice_company,$.txt_cp_etc_desc,$.rbo_cp_advice_type,$.rbo_cp_supervise,$.com_cp_advice_title])){return}if(workType=="N"||workType=="U"){if($.grdContact.getRowCount()<1){MessageBoxShow("최소 1명의 자문자는 입력되어야 합니다.");return}if($.grdFile.getRowCount()<1){MessageBoxShow("자문역 계약서는 필수 첨부 파일입니다.");return}else{var check1="";for(var i=0;i<$.grdFile.getRowCount();i++){if($.grdFile.getValue(i,"file_type")=="002"){check1="002"}if(check1=="002"){break}}if(check1!="002"){MessageBoxShow("자문역 계약서는 필수 첨부 파일입니다.");return}}}var json=createJson_S1(workType);callExecute(["req",json],"ADVICE",$)}function newClick(){$.panQuery.clear();$.grdContact.clear();$.grdFile.clear();$.memcp_descr.setValue("");$.memcp_descr.setReadOnly(true);$.panQuery.enableButton(["btnDelete","btnTemp","btnSave","btnNew"]);$.panFile.enableButton(["btnDelete","btnAdd"]);$.panBottom.setVisible(false);fnEnableSet(true);$.cmb_Status.setValue("10");$.panQuery.disableButton(["btnDelete"]);$.btnAdd.setText("추가");$.dte_app_date.setValue(getToday(""))}function saveClick(){if($.txt_modify_yn.getValue()=="Y"){$.dte_app_date.setValue(getToday(""));saveCPAdviceBefore($.txt_cp_id.getValue()==""?"N":"U")}else{var dt1=getToday("");var dt2=getCalcMonth(dt1,108);for(var i=0;i<$.grdContact.getRowCount();i++){if(dt2>getFormatDate($.grdContact.getValue(0,"cp_start_date"),"yyyyMMdd")){dt2=getFormatDate($.grdContact.getValue(0,"cp_start_date"),"yyyyMMdd")}}var tmp_dt1=new Date(dt1.substr(0,4),(dt1.substr(4,2)-1),dt1.substr(6,2));var tmp_dt2=new Date(dt2.substr(0,4),(dt2.substr(4,2)-1),dt2.substr(6,2));var btMs=tmp_dt2.getTime()-tmp_dt1.getTime();var btDay=btMs/(1000*60*60*24);if(btDay<5){MessageBoxShow("자문일로부터 5일 이전까지만 신청가능합니다.");return}saveCPAdviceBefore($.txt_cp_id.getValue()==""?"N":"U")}}function deleteClick(){if($.txt_cp_id.getValue()==""){return}confirmBoxShow("["+$.txt_cp_doc_no.getValue()+"] 삭제하시겠습니까?",function(){if(g_main.msgShare==true){saveCPAdviceBefore("D")}})}function fnEnableSet(bo){if(bo){$.panQuery.enableButton(["btnDelete","btnSave","btnTemp"]);$.panFile.enableButton(["btnAdd","btnDelete"])}else{$.panQuery.disableButton(["btnDelete","btnSave","btnTemp"]);$.panFile.disableButton(["btnAdd","btnDelete"])}$.grdFile.setEditable(bo);if(!bo){$.btnAdd.setText("상세보기")}$.btnDel.setEnable(bo);$.cmb_employee_pm.setEnable(bo);$.mem_cp_advice_purpose.setReadOnly(!bo);$.rbo_cp_advice_type.setEnable(bo);$.rbo_cp_supervise.setEnable(bo);$.txt_cp_etc_desc.setReadOnly(!bo);$.txt_cp_advice_company.setReadOnly(!bo);$.spe_cp_advice_amt.setEnable(bo);$.memoetc_descr.setReadOnly(!bo);$.com_cp_advice_title.setEnable(bo)}function fnTotalAdviceTotalSet(){var dcsupport_amt=0;if($.grdContact.getRowCount()>0){for(var i=0;i<$.grdContact.getRowCount();i++){dcsupport_amt+=Number($.grdContact.getValue(i,"advice_amt"))}}$.spe_cp_advice_total.setValue(Number(dcsupport_amt))}function radioChange1(){log($.rbo_cp_advice_type.getValue());if($.rbo_cp_advice_type.getValue()==null){return}if($.rbo_cp_advice_type.getValue()=="2"){$.rbo_cp_supervise.setEnable(true);$.rbo_cp_supervise.setAllowBlank(false,"감수/up-date")}else{$.rbo_cp_supervise.setEnable(false);$.rbo_cp_supervise.setValue("");$.rbo_cp_supervise.setAllowBlank(true,"감수/up-date")}radioChange2()}function radioChange2(){if($.rbo_cp_advice_type.getValue()==null||$.rbo_cp_supervise.getValue()==null){return}if($.rbo_cp_advice_type.getValue()=="2"&&$.rbo_cp_supervise.getValue()=="E"){$.txt_cp_etc_desc.setEnable(true);$.txt_cp_etc_desc.setAllowBlank(false,"기타")}else{$.txt_cp_etc_desc.setAllowBlank(true,"기타");$.txt_cp_etc_desc.setEnable(false);$.txt_cp_etc_desc.setValue("")}}function tmpSave(){if($.grdContact.getRowCount()<1){MessageBoxShow("최소 1명의 자문자는 입력되어야 합니다.");return false}if($.txt_modify_yn=="Y"){$.dte_app_date.setValue(getToday(""));saveCPAdviceBefore($.txt_cp_id.getValue()==""?"NT":"UT")}else{var dt1=getToday("");var dt2=getCalcMonth(dt1,108);for(var i=0;i<$.grdContact.getRowCount();i++){if(dt2>getFormatDate($.grdContact.getValue(0,"cp_start_date"),"yyyyMMdd")){dt2=getFormatDate($.grdContact.getValue(0,"cp_start_date"),"yyyyMMdd")}}var tmp_dt1=new Date(dt1.substr(0,4),(dt1.substr(4,2)-1),dt1.substr(6,2));var tmp_dt2=new Date(dt2.substr(0,4),(dt2.substr(4,2)-1),dt2.substr(6,2));var btMs=tmp_dt2.getTime()-tmp_dt1.getTime();var btDay=btMs/(1000*60*60*24);if(btDay<5){MessageBoxShow("자문일로부터 5일 이전까지만 신청가능합니다.");return}saveCPAdviceBefore($.txt_cp_id.getValue()==""?"NT":"UT")}}function getObjectDate(objDate){var year=parseInt(objDate.year)+1900;var month=parseInt(objDate.month)+1;var date=objDate.date;if(parseInt(month)<10){month="0"+month}if(parseInt(date)<10){date="0"+date}return year+""+month+""+date}function setSeq(grd,colId){var seq=0;if(grd.getRowCount()>0){for(var i=0;i<grd.getRowCount();i++){if(seq<grd.getValue(i,colId)){seq=grd.getValue(i,colId)}}}return(seq+1)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1100);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,385);$.panQuery.setText("자문 - 사전");$.panQuery.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,695,1200,280);$.panFile.setText("첨부파일");$.panFile.setBottomLine(true);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,1200,235);$.btnConfirm=new FingerButton(host,"btnConfirm",10,5,100,40);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",10,60,100,40);$.btnCancel.setText("승인취소");$.memcp_descr=new FingerMemoEdit(host,"memcp_descr",100,995,840,90);$.btnMemoSave=new FingerButton(host,"btnMemoSave",950,5,90,95);$.btnMemoSave.setText("메모저장");$.panContact=new FingerPanel(host,"panContact",0,395,1200,280);$.panContact.setText("자문자");$.panContact.setBottomLine(true);$.grdContact=new FingerDataGrid(host,"grdContact",0,0,1200,235);$.btnAdd=new FingerButton(host,"btnAdd",1040,-40,95,30);$.btnAdd.setText("추가");$.btnDel=new FingerButton(host,"btnDel",1120,-40,95,30);$.btnDel.setText("삭제");$.btnLimitFree=new FingerButton(host,"btnLimitFree",1025,5,90,95);$.btnLimitFree.setText("기한해제");$.panBottom=new FingerPanel(host,"panBottom",0,990,1200,110);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.lbl_cp_id=new FingerLabel(host,"lbl_cp_id",0,10,100,20);$.lbl_cp_id.setText("문서번호");$.txt_cp_id=new FingerEdit(host,"txt_cp_id",105,10,200,20);$.lbl_employee_pm=new FingerLabel(host,"lbl_employee_pm",275,10,100,20);$.lbl_employee_pm.setText("PM");$.cmb_employee_pm=new FingerComboBox(host,"cmb_employee_pm",380,10,170,20);$.cmb_Status=new FingerComboBox(host,"cmb_Status",1000,10,140,20);$.lbl_cp_advice_type=new FingerLabel(host,"lbl_cp_advice_type",0,40,100,20);$.lbl_cp_advice_type.setText("자문유형");$.rbo_cp_advice_type=new FingerRadioBox(host,"rbo_cp_advice_type",105,40,230,20);$.lbl_cp_supervise=new FingerLabel(host,"lbl_cp_supervise",0,70,100,20);$.lbl_cp_supervise.setText("감수/up-date");$.rbo_cp_supervise=new FingerRadioBox(host,"rbo_cp_supervise",105,70,260,20);$.lbl_cp_advice_purpose=new FingerLabel(host,"lbl_cp_advice_purpose",0,160,100,20);$.lbl_cp_advice_purpose.setText("자문주제");$.mem_cp_advice_purpose=new FingerMemoEdit(host,"mem_cp_advice_purpose",105,130,855,100);$.lbl_cp_advice_total=new FingerLabel(host,"lbl_cp_advice_total",0,300,100,20);$.lbl_cp_advice_total.setText("자문총액");$.spe_cp_advice_total=new FingerSpinEdit(host,"spe_cp_advice_total",105,300,200,20);$.lbl_cp_advice_cnt=new FingerLabel(host,"lbl_cp_advice_cnt",310,300,100,20);$.lbl_cp_advice_cnt.setText("자문자수");$.spe_cp_advice_amt=new FingerSpinEdit(host,"spe_cp_advice_amt",415,300,85,20);$.lbl_Txt1=new FingerLabel(host,"lbl_Txt1",500,300,20,20);$.lbl_Txt1.setText("명");$.lbl_cp_advice_company=new FingerLabel(host,"lbl_cp_advice_company",525,300,100,20);$.lbl_cp_advice_company.setText("기관(수)");$.lbl_app_date=new FingerLabel(host,"lbl_app_date",720,300,100,20);$.lbl_app_date.setText("승인요청일");$.dte_app_date=new FingerDateEdit(host,"dte_app_date",825,300,140,20);$.txt_cp_doc_no=new FingerEdit(host,"txt_cp_doc_no",1000,70,15,20);$.txt_modify_yn=new FingerEdit(host,"txt_modify_yn",1030,70,15,20);$.txt_wf_doc_id=new FingerEdit(host,"txt_wf_doc_id",1060,70,15,20);$.txt_cp_code=new FingerEdit(host,"txt_cp_code",1090,70,15,20);$.txt_cp_etc_desc=new FingerEdit(host,"txt_cp_etc_desc",340,70,305,20);$.txt_cp_advice_company=new FingerEdit(host,"txt_cp_advice_company",630,300,75,20);$.btnMAConfirm=new FingerButton(host,"btnMAConfirm",1105,5,110,45);$.btnMAConfirm.setText("MA승인");$.btnMACancel=new FingerButton(host,"btnMACancel",1105,55,110,45);$.btnMACancel.setText("MA승인취소");$.lbletc_descr=new FingerLabel(host,"lbletc_descr",0,255,100,20);$.lbletc_descr.setText("기타사항");$.memoetc_descr=new FingerMemoEdit(host,"memoetc_descr",105,240,855,50);$.lbl_cp_advice_purpose2=new FingerLabel(host,"lbl_cp_advice_purpose2",0,180,100,20);$.lbl_cp_advice_purpose2.setText("(250자 이내)");$.com_cp_advice_title=new FingerComboBox(host,"com_cp_advice_title",105,100,350,20);$.lbl_cp_advice_title=new FingerLabel(host,"lbl_cp_advice_title",0,100,100,20);$.lbl_cp_advice_title.setText("자문목적");$.panQuery.setBorder(true);$.panQuery.addButtons(["btnDelete","btnTemp","btnSave","btnNew"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.txt_cp_doc_no.setVisible(false);$.txt_modify_yn.setVisible(false);$.txt_wf_doc_id.setVisible(false);$.txt_cp_code.setVisible(false);$.mem_cp_advice_purpose.setAllowBlank(false,"자문목적");$.spe_cp_advice_amt.setAllowBlank(false,"자문자수");$.txt_cp_advice_company.setAllowBlank(false,"기관(수)");$.dte_app_date.setAllowBlank(false,"승인요청일");$.rbo_cp_advice_type.addButtons([{sub_code:"1",code_name:"자문위원회"},{sub_code:"2",code_name:"감수/up-date"}]);$.rbo_cp_supervise.addButtons([{sub_code:"D",code_name:"Detail Map"},{sub_code:"B",code_name:"Brochure"},{sub_code:"E",code_name:"기타"}]);$.mem_cp_advice_purpose.setAllowBlank(false,"자문목적");$.spe_cp_advice_amt.setAllowBlank(false,"자문자수");$.txt_cp_advice_company.setAllowBlank(false,"기관(수)");$.dte_app_date.setAllowBlank(false,"승인요청일");$.rbo_cp_advice_type.setAllowBlank(false,"자문유형");$.com_cp_advice_title.setAllowBlank(false,"자문목적");$.txt_cp_id.setReadOnly(true);$.cmb_Status.setEnable(false);$.dte_app_date.setEnable(false);$.spe_cp_advice_total.setEnable(false);$.btnAdd.setClass("btn_new");$.memcp_descr.setReadOnly(true);$.btnMAConfirm.setVisible(false);$.btnMACancel.setVisible(false);$.grdContact.setColumns([new FingerDataGridColumn("contact_name",100,"left","string","자문자"),new FingerDataGridColumn("company_name",200,"left","string","소속"),new FingerDataGridColumn("cp_start_date",100,"left","string","시작일",{format:"ymd"}),new FingerDataGridColumn("cp_end_date",100,"left","string","종료일",{format:"ymd"}),new FingerDataGridColumn("advice_desc2_1",500,"left","string","자문내용"),new FingerDataGridColumn("advice_amt",100,"right","int","자문비",{format:"int"}),new FingerDataGridColumn("cp_advice_subject",470,"left","string","자문주제",{hidden:true}),new FingerDataGridColumn("contact_id",280,"left","string","자문자아이디",{hidden:true}),new FingerDataGridColumn("company_id",280,"left","string","소속아이디",{hidden:true}),new FingerDataGridColumn("product_code",280,"left","string","품목",{hidden:true}),new FingerDataGridColumn("cp_advice_date1",280,"left","string","자문일",{hidden:true}),new FingerDataGridColumn("cp_place",280,"left","string","장소",{hidden:true}),new FingerDataGridColumn("advice_desc1_1",280,"left","string","자문안건",{hidden:true}),new FingerDataGridColumn("advice_desc1_2",280,"left","string","자문내역",{hidden:true}),new FingerDataGridColumn("cp_etc1",280,"left","string","기타사항",{hidden:true}),new FingerDataGridColumn("advice_desc1_3",280,"left","string","자문내역사후활용계획",{hidden:true}),new FingerDataGridColumn("cp_choice_desc",280,"left","string","선정사유",{hidden:true}),new FingerDataGridColumn("cp_advice_date2",280,"left","string","자문일시",{hidden:true}),new FingerDataGridColumn("cp_HH_fr",280,"left","string","시",{hidden:true}),new FingerDataGridColumn("cp_MM_fr",280,"left","string","분",{hidden:true}),new FingerDataGridColumn("cp_HH_to",280,"left","string","시",{hidden:true}),new FingerDataGridColumn("cp_MM_to",280,"left","string","분",{hidden:true}),new FingerDataGridColumn("advice_desc2_2",280,"left","string","자문내역활용방안",{hidden:true}),new FingerDataGridColumn("cp_etc2",280,"left","string","기타2",{hidden:true}),new FingerDataGridColumn("trans_yn",280,"left","checkbox","교통비여부",{hidden:true}),new FingerDataGridColumn("stay_yn",280,"left","checkbox","숙박비여부",{hidden:true}),new FingerDataGridColumn("meal_yn",280,"left","checkbox","식음료비여부",{hidden:true}),new FingerDataGridColumn("trans_amt",280,"left","string","교통여비",{hidden:true}),new FingerDataGridColumn("stay_amt",280,"left","string","숙박비",{hidden:true}),new FingerDataGridColumn("meal_amt",280,"left","string","식음료비",{hidden:true}),new FingerDataGridColumn("advisor_bank_account",280,"left","string","계좌번호",{hidden:true}),new FingerDataGridColumn("etc_expense_sum",280,"left","string","자문여비",{hidden:true})]);$.grdContact.init({isFilter:false});$.grdContact.setEditable(false);$.grdContact.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("seq",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("file_type",300,"left","string","자료유형"),new FingerDataGridColumn("local_fname",900,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",800,"left","string","사이즈",{hidden:true})]);$.grdFile.init({isFilter:false});$.grdFile.setEditable(true);$.grdFile.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panFile);$.panMain.add($.panContact);$.panMain.add($.panBottom);$.panMain.add($.memcp_descr);$.panQuery.add($.txt_cp_code);$.panQuery.add($.txt_wf_doc_id);$.panQuery.add($.txt_modify_yn);$.panQuery.add($.txt_cp_doc_no);$.panQuery.add($.dte_app_date);$.panQuery.add($.lbl_app_date);$.panQuery.add($.lbl_cp_advice_company);$.panQuery.add($.lbl_Txt1);$.panQuery.add($.spe_cp_advice_amt);$.panQuery.add($.lbl_cp_advice_cnt);$.panQuery.add($.spe_cp_advice_total);$.panQuery.add($.lbl_cp_advice_total);$.panQuery.add($.mem_cp_advice_purpose);$.panQuery.add($.lbl_cp_advice_purpose);$.panQuery.add($.rbo_cp_supervise);$.panQuery.add($.lbl_cp_supervise);$.panQuery.add($.rbo_cp_advice_type);$.panQuery.add($.lbl_cp_advice_type);$.panQuery.add($.cmb_Status);$.panQuery.add($.cmb_employee_pm);$.panQuery.add($.lbl_employee_pm);$.panQuery.add($.txt_cp_id);$.panQuery.add($.lbl_cp_id);$.panQuery.add($.txt_cp_etc_desc);$.panQuery.add($.txt_cp_advice_company);$.panQuery.add($.memoetc_descr);$.panQuery.add($.lbletc_descr);$.panQuery.add($.lbl_cp_advice_purpose2);$.panQuery.add($.com_cp_advice_title);$.panQuery.add($.lbl_cp_advice_title);$.panFile.add($.grdFile);$.panContact.add($.grdContact);$.panContact.add($.btnAdd);$.panContact.add($.btnDel);$.panBottom.add($.btnMemoSave);$.panBottom.add($.btnLimitFree);$.panBottom.add($.btnCancel);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnMAConfirm);$.panBottom.add($.btnMACancel);relocateChildIndexInPanel([$.panQuery]);var ds=bizComponentData2($,"Q1","L_CRM0111|L_CRM192|L_CRM0304");$.cmb_employee_pm.setColumn("employee_id","emp_name");setComboBind([$.cmb_Status,$.cmb_employee_pm,$.com_cp_advice_title],ds);var subQuery1=" AND sub_code in ('002', '015', '016', '034')";var ds2=bizComponentData2($,"Q4","L_CRM0110",subQuery1);$.grdFile.setColumnDropDownList("file_type",ds2.resultList[0],null,true);if($.p_argument){$.cmb_Status.setValue($.p_argument[0][0].cp_status);$.memcp_descr.setValue($.p_argument[0][0].cp_descr);$.bAllReport=$.p_argument[0][0].AllReport;$.bMyReport=$.p_argument[0][0].MyReport;$.bConfirm=$.p_argument[0][0].Confirm;if(!$.bConfirm){$.panBottom.setVisible(false)}else{$.panBottom.setVisible(true);$.memcp_descr.setReadOnly(false)}if($.p_argument[0][0].save_yn=="Y"){$.bSave=true}if(!$.bSave){fnEnableSet(false)}$.dte_app_date.setEnable(false);$.txt_cp_id.setValue($.p_argument[0][0].cp_id);$.cmb_employee_pm.setValue($.p_argument[0][0].cp_emp_pm);$.cmb_Status.setValue($.p_argument[0][0].cp_status);$.rbo_cp_advice_type.setValue($.p_argument[0][0].cp_advice_type);$.rbo_cp_supervise.setValue($.p_argument[0][0].cp_supervise);$.com_cp_advice_title.setValue($.p_argument[0][0].cp_advice_title);radioChange1();radioChange2();$.mem_cp_advice_purpose.setValue($.p_argument[0][0].cp_advice_purpose);$.spe_cp_advice_total.setValue($.p_argument[0][0].cp_advice_total);$.spe_cp_advice_amt.setValue($.p_argument[0][0].cp_advice_cnt);$.dte_app_date.setValue(getObjectDate($.p_argument[0][0].create_time));$.txt_cp_doc_no.setValue($.p_argument[0][0].cp_doc_no);$.txt_modify_yn.setValue($.p_argument[0][0].modify_yn);$.txt_wf_doc_id.setValue($.p_argument[0][0].wf_doc_id);$.txt_cp_code.setValue($.p_argument[0][0].cp_code);$.txt_cp_etc_desc.setValue($.p_argument[0][0].cp_etc_desc);$.txt_cp_advice_company.setValue($.p_argument[0][0].cp_advice_company);$.memoetc_descr.setValue($.p_argument[0][0].cp_etc_descr);setDataGrid([$.grdContact],$.p_argument[1],true);for(var i=0;i<$.p_argument[1].length;i++){$.grdContact.setValue(i,"cp_start_date",extFormat($.p_argument[1][i].cp_start_date,"yyyyMMdd"));$.grdContact.setValue(i,"cp_end_date",extFormat($.p_argument[1][i].cp_end_date,"yyyyMMdd"))}$.grdContact.selectRow(0);if($.p_argument[2].length>0){setDataGrid([$.grdFile],$.p_argument[2],true);$.grdFile.selectRow(0)}if($.cmb_Status.getValue()=="10"){$.btnConfirm.setEnable(true);if(!$.bSave){$.panQuery.disableButton(["btnDelete"])}}else{if($.cmb_Status.getValue()=="90"){$.btnConfirm.setEnable(false);$.btnCancel.setEnable(true);$.panQuery.disableButton(["btnTemp"]);if(g_main.session.getValue("EmpCode")=="ka951012"){$.panBottom.setVisible(true);$.btnConfirm.setVisible(false);$.btnCancel.setVisible(false);$.btnLimitFree.setVisible(false);$.btnMemoSave.setVisible(false);$.btnMAConfirm.setVisible(true);$.btnMACancel.setVisible(true)}}}}else{newClick();$.panBottom.setVisible(false);$.memcp_descr.setVisible(false)}};$.callback=function(type,ds){if(type=="ADVICE"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{if(ds.errorCode=="MSG0002"){if(ds.returnStr!=""){var id=ds.returnStr.split("|");if(id.length>1){$.txt_cp_id.setValue(id[0]);$.txt_cp_doc_no.setValue(id[1])}}MessageBoxShow("정상적으로 저장되었습니다.")}else{if(ds.errorCode=="MSG0004"){MessageBoxShow("정상적으로 수정되었습니다.")}else{if(ds.errorCode=="MSG0003"){MessageBoxShow("정상적으로 삭제되었습니다.");newClick();if($.p_argument){var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}}}}}}}else{if(type=="LimitFree"){if(ds){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{if(ds.errorCode=="MSG0004"){MessageBoxShow("정상적으로 해제되었습니다.")}else{if(ds.errorCode=="MSG0030"){MessageBoxShow("수정된 레코드가 없습니다.")}}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMemoSave"){var share={save_mode:"MEMO",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMAConfirm"){var share={save_mode:"MACONFIRM",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMACancel"){var share={save_mode:"MACANCEL",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnLimitFree"){confirmBoxShow("입력 기한을 해제하시겠습니까?",function(){if(g_main.msgShare==true){saveCPExtraFunction("LimitFree")}})}else{if(id=="btnAdd"){$.popUpCallId=id;var rows=[];if($.grdContact.getRowCount()>0){rows=copyArray($.grdContact.getAllRows())}var param={save_mode:$.btnAdd.getText()=="상세보기"?"N":"Y",source:rows,cp_code:"CP20"};g_main.openPopup("crmCPAdviceSub.html","crmCPAdviceSub","자문상세내역등록",1200,955,"","",param,"","")}else{if(id=="btnDel"){if($.grdContact.getRowCount()<1){return}confirmBoxShow("삭제하시겠습니까?",function(){if(g_main.msgShare==true){$.grdContact.deleteRow($.grdContact.getSelectedRowIdx());$.grdContact.selectRow(0);fnTotalAdviceTotalSet()}})}}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panQuery"){if(btnId=="btnNew"){newClick()}else{if(btnId=="btnSave"){saveClick()}else{if(btnId=="btnDelete"){deleteClick()}else{if(btnId=="btnTemp"){tmpSave()}}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();var seq=setSeq($.grdFile,"seq");for(var i=0;i<fileList.length;i++){fileList[i].file_type="";fileList[i].seq=seq+i;for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(fileList)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요.",function(){if(g_main.msgShare==true){if(result){MessageBoxShow("파일 삭제 되었습니다.");$.grdFile.deleteRow(rId);$.grdFile.selectRow(0)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="crmCPAdviceSub"){if($.popUpCallId=="btnAdd"){if(popResult.confirm_yn=="Y"){setDataGrid([$.grdContact],popResult.source,true);$.grdContact.selectRow(0);fnTotalAdviceTotalSet()}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){if(id=="rbo_cp_advice_type"){radioChange1()}else{if(id=="rbo_cp_supervise"){radioChange2()}}};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>