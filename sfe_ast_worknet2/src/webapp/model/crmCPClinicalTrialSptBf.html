<script>function Main(){var $=this;$.host=null;$.panMain=null;$.lbldept=null;$.lblemployee=null;$.cbodept=null;$.cboemployee=null;$.lblcp_id=null;$.lblcp_doc_no=null;$.txtcp_id=null;$.txtcp_doc_no=null;$.lblcreate_date=null;$.dtdcreate_date=null;$.lblstudy_name=null;$.memostudy_name=null;$.panBase=null;$.panList=null;$.grdList=null;$.lblstudy_type=null;$.comstudy_type=null;$.lblapprove_no=null;$.lblapprove_date=null;$.dtdapprove_date=null;$.txtapprove_no=null;$.btnDone=null;$.btnNew=null;$.btnSave=null;$.btnDelete=null;$.lblproduct=null;$.cboproduct=null;$.lblquantity=null;$.numquantity=null;$.lblquantity2=null;$.panBottom=null;$.btnConfirm=null;$.btnCancel=null;$.btnMemoSave=null;$.memoCPMemo=null;$.cboStatus=null;$.lblStatus=null;$.varCPId="";$.varCPCode="";$.varWFDocId="";$.varCPDocNo="";$.varModify="";function createJSON_S(workType){if(!validateControls([$.cbodept,$.cboemployee,$.memostudy_name,$.comstudy_type,$.dtdapprove_date,$.txtapprove_no,$.comStatus])){return}if($.grdList.getRowCount()<=0){MessageBoxShow("등록 된 연구자가 존재하지 않습니다.");return}var seq="",con_type="",con_id="",com_id="",irb_approve_no="",irb_approve_date="",contract_date="",product="",quantity="";var contactRow=$.grdList.getAllRows();for(var i in contactRow){seq+=(seq?"|":"")+contactRow[i].seq||" ";con_type+=(con_type?"|":"")+contactRow[i].contact_type||" ";con_id+=(con_id?"|":"")+contactRow[i].contact_id||" ";com_id+=(com_id?"|":"")+contactRow[i].company_id||" ";irb_approve_no+=(irb_approve_no?"|":"")+contactRow[i].irb_approve_no||" ";irb_approve_date+=(irb_approve_date?"|":"")+getFormatDate(contactRow[i].irb_approve_date,"yyyyMMdd").substring(0,8)||" ";contract_date+=(contract_date?"|":"")+getFormatDate(contactRow[i].contract_date,"yyyyMMdd").substring(0,8)||" ";product+=(product?"|":"")+contactRow[i].product_code||" ";quantity+=(quantity?"|":"")+contactRow[i].quantity||"0"}var json=createExecuteParamInfo("P_crmCPClinicalTrialSptBf_S",[workType,$.varCPId||"",$.varCPDocNo||"",$.cbodept.getValue(),$.cboemployee.getValue(),$.comstudy_type.getValue(),$.memostudy_name.getValue(),$.dtdapprove_date.getValue(),$.txtapprove_no.getValue(),seq,con_type,con_id,com_id,irb_approve_no,irb_approve_date,contract_date,product,quantity]);return json}function createJSON_S2(workType){var json;if(workType=="MATCH"){json=createExecuteParamInfo("P_crmCPExtraFunction_S",[workType,$.txtcp_id.getValue()||"","","#UserID#"])}return json}function saveClinicalTrialSptBf(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$,false)}}function saveCPExtraFunction(workType){var json=createJSON_S2(workType);callExecute(["req",json],workType,$)}function clearInfo(){$.panBase.clear();$.varCPId="";$.varCPDocNo="";$.grdList.setData("");setControlEnable(true);setAllowBlank();$.cbodept.setValue(g_main.session.getValue("DeptCode"));$.cboemployee.setValue(g_main.session.getValue("EmpCode"));$.dtdcreate_date.setValue(getToday(""));$.cboStatus.setValue("10")}function setControlEnable(bo){if(bo){$.panList.enableButton(["btnAdd","btnDelete"])}else{$.panList.disableButton(["btnAdd","btnDelete"])}$.comstudy_type.setEnable(bo);$.dtdapprove_date.setReadOnly(!bo);$.txtapprove_no.setReadOnly(!bo);$.memostudy_name.setReadOnly(!bo);$.txtcp_id.setReadOnly(true);$.cboemployee.setEnable(false);$.cbodept.setEnable(false);$.dtdcreate_date.setEnable(false);$.cboStatus.setEnable(false)}function setAllowBlank(){$.cbodept.setAllowBlank(false,"부서");$.cboemployee.setAllowBlank(false,"담당자");$.comstudy_type.setAllowBlank(false,"구분");$.dtdapprove_date.setAllowBlank(false,"식약처승인일자");$.txtapprove_no.setAllowBlank(false,"식약처승인번호");$.memostudy_name.setAllowBlank(false,"명칭(연구제목)")}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,670);$.panMain.setText("임상시험지원(사전)");$.panMain.setBottomLine(true);$.lbldept=new FingerLabel(host,"lbldept",0,50,100,20);$.lbldept.setText("소속부서");$.lblemployee=new FingerLabel(host,"lblemployee",250,50,100,20);$.lblemployee.setText("담당자");$.cbodept=new FingerComboBox(host,"cbodept",100,50,160,20);$.cboemployee=new FingerComboBox(host,"cboemployee",350,50,140,20);$.lblcp_id=new FingerLabel(host,"lblcp_id",0,20,100,20);$.lblcp_id.setText("CP번호");$.lblcp_doc_no=new FingerLabel(host,"lblcp_doc_no",800,50,100,20);$.lblcp_doc_no.setText("CP문서번호");$.txtcp_id=new FingerEdit(host,"txtcp_id",100,20,155,20);$.txtcp_doc_no=new FingerEdit(host,"txtcp_doc_no",900,50,50,20);$.lblcreate_date=new FingerLabel(host,"lblcreate_date",800,20,100,20);$.lblcreate_date.setText("등록일자");$.dtdcreate_date=new FingerDateEdit(host,"dtdcreate_date",900,20,140,20);$.lblstudy_name=new FingerLabel(host,"lblstudy_name",0,120,100,20);$.lblstudy_name.setText("명칭(연구제목)");$.memostudy_name=new FingerMemoEdit(host,"memostudy_name",100,110,495,40);$.panBase=new FingerPanel(host,"panBase",0,0,1200,210);$.panBase.setText("");$.panBase.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,210,1200,300);$.panList.setText("연구자");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,250);$.lblstudy_type=new FingerLabel(host,"lblstudy_type",0,80,100,20);$.lblstudy_type.setText("구분");$.comstudy_type=new FingerComboBox(host,"comstudy_type",100,80,500,20);$.lblapprove_no=new FingerLabel(host,"lblapprove_no",800,80,100,20);$.lblapprove_no.setText("식약처승인번호");$.lblapprove_date=new FingerLabel(host,"lblapprove_date",800,110,100,20);$.lblapprove_date.setText("식약처승인일자");$.dtdapprove_date=new FingerDateEdit(host,"dtdapprove_date",900,110,140,20);$.txtapprove_no=new FingerEdit(host,"txtapprove_no",900,80,200,20);$.btnDone=new FingerButton(host,"btnDone",1060,-40,150,30);$.btnDone.setText("연구종료");$.btnNew=new FingerButton(host,"btnNew",805,-40,100,30);$.btnNew.setText("신규");$.btnSave=new FingerButton(host,"btnSave",890,-40,100,30);$.btnSave.setText("저장");$.btnDelete=new FingerButton(host,"btnDelete",975,-40,100,30);$.btnDelete.setText("삭제");$.lblproduct=new FingerLabel(host,"lblproduct",0,160,100,20);$.lblproduct.setText("의약품");$.cboproduct=new FingerComboBox(host,"cboproduct",100,160,170,20);$.lblquantity=new FingerLabel(host,"lblquantity",250,160,100,20);$.lblquantity.setText("수량");$.numquantity=new FingerSpinEdit(host,"numquantity",350,160,60,20);$.lblquantity2=new FingerLabel(host,"lblquantity2",400,160,40,20);$.lblquantity2.setText(".");$.panBottom=new FingerPanel(host,"panBottom",0,510,1200,110);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.btnConfirm=new FingerButton(host,"btnConfirm",10,10,120,40);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",10,65,120,40);$.btnCancel.setText("승인취소");$.btnMemoSave=new FingerButton(host,"btnMemoSave",1100,10,100,95);$.btnMemoSave.setText("메모저장");$.memoCPMemo=new FingerMemoEdit(host,"memoCPMemo",130,10,950,90);$.cboStatus=new FingerComboBox(host,"cboStatus",900,50,145,20);$.lblStatus=new FingerLabel(host,"lblStatus",800,50,100,20);$.lblStatus.setText("승인상태");$.lblcp_doc_no.setVisible(false);$.txtcp_doc_no.setVisible(false);$.lblproduct.setVisible(false);$.cboproduct.setVisible(false);$.lblquantity.setVisible(false);$.numquantity.setVisible(false);$.lblquantity2.setVisible(false);$.cbodept.setReadOnly(true);$.cboemployee.setReadOnly(true);$.txtcp_id.setReadOnly(true);$.memoCPMemo.setReadOnly(true);$.dtdcreate_date.setReadOnly(true);$.dtdcreate_date.setValue(getToday(""));$.panBase.setBorder(true);$.panList.setBorder(true);$.panList.addButtons(["btnDelete","btnAdd"]);$.grdList.setColumns([new FingerDataGridColumn("seq",45,"center","string","순번",{readonly:true}),new FingerDataGridColumn("contact_type",99,"center","string","역할"),new FingerDataGridColumn("company_id",99,"left","string","소속기관아이디",{hidden:true}),new FingerDataGridColumn("company_name",180,"left","string","소속기관/병원",{readonly:true}),new FingerDataGridColumn("speciality_code",99,"left","string","진료과목코드",{hidden:true}),new FingerDataGridColumn("speciality",120,"left","string","부서/진료과목",{readonly:true}),new FingerDataGridColumn("contact_id",99,"left","string","고객아이디",{hidden:true}),new FingerDataGridColumn("contact_name",100,"center","string","연구자명",{readonly:true}),new FingerDataGridColumn("irb_approve_no",120,"left","string","IRB승인번호"),new FingerDataGridColumn("irb_approve_date",100,"center","date","IRB승인일자",{format:"ymd"}),new FingerDataGridColumn("contract_date",100,"center","date","계약일",{format:"ymd"}),new FingerDataGridColumn("product_code",200,"left","string","임상시험용의약품 품목"),new FingerDataGridColumn("quantity",80,"center","int","수량",{format:"int"})]);$.grdList.init({panel:$.panList,scroll:"y",footer:false});$.grdList.setEditable(true);$.grdList.setBorder(false);$.btnNew.setClass("btn_new");$.btnSave.setClass("btn_save");$.btnDone.setClass("btn_info");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panBase);$.panMain.add($.panList);$.panMain.add($.panBottom);$.panBase.add($.lbldept);$.panBase.add($.lblemployee);$.panBase.add($.cbodept);$.panBase.add($.cboemployee);$.panBase.add($.lblcp_id);$.panBase.add($.lblcp_doc_no);$.panBase.add($.txtcp_id);$.panBase.add($.txtcp_doc_no);$.panBase.add($.lblcreate_date);$.panBase.add($.dtdcreate_date);$.panBase.add($.lblstudy_name);$.panBase.add($.memostudy_name);$.panBase.add($.lblstudy_type);$.panBase.add($.comstudy_type);$.panBase.add($.lblapprove_no);$.panBase.add($.lblapprove_date);$.panBase.add($.dtdapprove_date);$.panBase.add($.txtapprove_no);$.panBase.add($.lblproduct);$.panBase.add($.cboproduct);$.panBase.add($.lblquantity);$.panBase.add($.numquantity);$.panBase.add($.lblquantity2);$.panBase.add($.btnDone);$.panBase.add($.btnNew);$.panBase.add($.btnSave);$.panBase.add($.btnDelete);$.panBase.add($.cboStatus);$.panBase.add($.lblStatus);$.panList.add($.grdList);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnMemoSave);$.panBottom.add($.btnCancel);$.panBottom.add($.memoCPMemo);$.cbodept.setEmptyRow(false);$.cboemployee.setEmptyRow(false);var ds=bizComponentData2($,"Q1","L_CRM0051|L_CRM0285|L_CRM0111|L_CRM0286|L_CRM0132");$.cbodept.setColumn("dept_code","dept_name");setComboBind([$.cbodept,$.comstudy_type,$.cboStatus],ds);$.grdList.setColumnDropDownList("contact_type",ds.resultList[3]);$.grdList.setColumnDropDownList("product_code",ds.resultList[4],{key:"PRODUCT_CODE",name:"PRODUCT_NAME"});clearInfo();if($.p_argument&&$.p_argument.length>0){var day=$.p_argument[0][0].create_time.day;convertJavaDateToJs($.p_argument);var rs=$.p_argument[0][0];$.varCPId=rs.cp_id;$.varCPDocNo=rs.cp_doc_no;$.varPopupType="Y";$.varCPCode=rs.cp_type;$.varWFDocId=rs.wf_doc_id;$.txtcp_id.setValue(rs.cp_id);$.txtcp_doc_no.setValue(rs.cp_doc_no);$.cbodept.setValue(rs.cp_dept_code);$.cboemployee.setValue(rs.cp_emp_id);$.cboStatus.setValue(rs.cp_status);$.memostudy_name.setValue(rs.study_name);$.comstudy_type.setValue(rs.study_type);$.dtdapprove_date.setValue(rs.approve_date);$.txtapprove_no.setValue(rs.approve_no);$.memoCPMemo.setValue(rs.cp_descr);$.dtdcreate_date.setValue(rs.create_time);setAllowBlank();if(rs.Confirm){$.panBottom.setVisible(true);$.memoCPMemo.setReadOnly(false);setControlEnable(true)}else{$.panBottom.setVisible(false);$.memoCPMemo.setVisible(true);setControlEnable(false)}if(rs.save_yn!="Y"){setControlEnable(false);$.panList.disableButton(["btnAdd","btnDelete"]);$.btnNew.setEnable(false);$.btnSave.setEnable(false);$.btnDelete.setEnable(false)}else{setControlEnable(true)}if(rs.cp_status=="10"){$.btnConfirm.setEnable(true)}else{if(rs.cp_status=="90"){$.btnConfirm.setEnable(false);$.btnCancel.setEnable(true)}}if($.p_argument[1].length>0){setDataGrid([$.grdList],$.p_argument[1],true);for(var i=0;i<$.p_argument[1].length;i++){$.grdList.setValue(i,"irb_approve_date",extFormat($.p_argument[1][i].irb_approve_date,"yyyyMMdd"));$.grdList.setValue(i,"contract_date",extFormat($.p_argument[1][i].contract_date,"yyyyMMdd"))}}if(rs.CallType=="BUCall"){$.btnConfirm.setVisible(false);$.btnCancel.setVisible(false);$.btnMemoSave.setVisible(false)}}else{clearInfo();$.panBottom.setVisible(false)}};$.callback=function(type,ds){if(type=="N"){$.varCPId=ds.returnStr;$.txtcp_doc_no.setValue(ds.returnStr);$.txtcp_id.setValue($.varCPId);MessageBoxShow("정상적으로 저장되었습니다.")}else{if(type=="U"){MessageBoxShow("정상적으로 수정되었습니다.")}else{if(type=="D"){var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:$.memoCPMemo.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:$.memoCPMemo.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMemoSave"){var share={save_mode:"MEMO",cp_descr:$.memoCPMemo.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnNew"){clearInfo()}else{if(id=="btnSave"){var workType=($.varCPId?"U":"N");saveClinicalTrialSptBf(workType)}else{if(id=="btnDelete"){saveClinicalTrialSptBf("D")}else{if(id=="btnDone"){log(1)}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cbodept"){var strQuery=" and dept_code = '"+$.cbodept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cboemployee.clear();$.cboemployee.setColumn("employee_id","emp_name");setComboBind([$.cboemployee],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnAdd"){$.popUpCallId="contact_btnAdd";var param={contact_name:"",check_yn:"Y"};g_main.openPopup("popCPContact.html","popCPContact","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){$.grdList.deleteCurrentRow();var contRow=$.grdList.getAllRows();for(var i in contRow){contRow[i].seq=Number(i)+1}$.grdList.selectRow(0)}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popCPContact"){if($.popUpCallId=="contact_btnAdd"){var popRows=popResult.popRows;for(var i in popRows){if(popRows[i].contact_id.substr(0,2)=="ka"){MessageBoxShow("자사직원 등록은 불가능합니다.");continue}$.grdList.addRow({seq:$.grdList.getRowCount()>0?$.grdList.getValue($.grdList.getRowCount()-1,"seq")+1:1,contact_id:popRows[i].contact_id,contact_name:popRows[i].contact_name,company_id:popRows[i].company_id,company_name:popRows[i].company_name,speciality:popRows[i].speciality,quantity:0})}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>