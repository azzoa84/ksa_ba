<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panCompany=null;$.grdCompany=null;$.panCPTraining=null;$.panContact=null;$.panAuditDue=null;$.panEtc=null;$.panMemoTag=null;$.grdCPTraining=null;$.grdContact=null;$.grdAuditDue=null;$.grdEtc=null;$.lblTx1=null;$.lblTx2=null;$.mem_Descr=null;$.txt_MaxCompCode=null;$.panQuery=null;$.btnSave=null;$.varCompanyId="";function createJson_Q(workType){var json=createExecuteParamInfo("P_crmCPCoPromoList_Q",[workType]);return json}function createJson_Q1(workType){var rId=$.grdCompany.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmCPCoPromoFileList_Q",[workType,$.grdCompany.getValue(rId,"CompanyId")]);return json}function createJson_S(workType){var json;if(workType=="D"){json=createExecuteParamInfo("P_crmCPCoPromoFileList_S",[workType,$.varCompanyId,"",parseInt(0),"","","","",""])}else{if(workType=="MEMO"){json=createExecuteParamInfo("P_crmCPCoPromoFileList_S",[workType,$.varCompanyId,"MEMO",parseInt(0),"",$.mem_Descr.getValue()||"","","","#UserID#"])}else{var rows=[];if($.grdCPTraining.getRowCount()>0){for(var i=0;i<$.grdCPTraining.getRowCount();i++){rows.push([workType,$.varCompanyId,"CPTraining",parseInt($.grdCPTraining.getValue(i,"Seq")),$.grdCPTraining.getValue(i,"Type")||"",$.grdCPTraining.getValue(i,"Server_Path"),$.grdCPTraining.getValue(i,"Server_Fname"),$.grdCPTraining.getValue(i,"FileName"),"#UserID#"])}}if($.grdContact.getRowCount()>0){for(var i=0;i<$.grdContact.getRowCount();i++){rows.push([workType,$.varCompanyId,"Contact",parseInt($.grdContact.getValue(i,"Seq")),$.grdContact.getValue(i,"Type")||"",$.grdContact.getValue(i,"Server_Path"),$.grdContact.getValue(i,"Server_Fname"),$.grdContact.getValue(i,"FileName"),"#UserID#"])}}if($.grdAuditDue.getRowCount()>0){for(var i=0;i<$.grdAuditDue.getRowCount();i++){rows.push([workType,$.varCompanyId,"AuditDue",parseInt($.grdAuditDue.getValue(i,"Seq")),$.grdAuditDue.getValue(i,"Type")||"",$.grdAuditDue.getValue(i,"Server_Path"),$.grdAuditDue.getValue(i,"Server_Fname"),$.grdAuditDue.getValue(i,"FileName"),"#UserID#"])}}if($.grdEtc.getRowCount()>0){for(var i=0;i<$.grdEtc.getRowCount();i++){rows.push([workType,$.varCompanyId,"Etc",parseInt($.grdEtc.getValue(i,"Seq")),$.grdEtc.getValue(i,"Type")||"",$.grdEtc.getValue(i,"Server_Path"),$.grdEtc.getValue(i,"Server_Fname"),$.grdEtc.getValue(i,"FileName"),"#UserID#"])}}json=createExecuteParamInfo("P_crmCPCoPromoFileList_S",rows)}}return json}function serchCPCoPromoList(workType){var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function serchCPCoPromoFileList(workType){var json=createJson_Q1(workType);callQuery(["req",json],"FILE",$)}function saveCPCoPromoFileList(workType){var json=createJson_S(workType);callExecute(["req",json],workType,$)}function getObjectDate(objDate){var year=parseInt(objDate.year)+1900;var month=parseInt(objDate.month)+1;var date=objDate.date;if(parseInt(month)<10){month="0"+month}if(parseInt(date)<10){date="0"+date}return year+""+month+""+date}function getFileAdd(objGrid){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=objGrid.getRowCount();var seq=getSeq(objGrid,"Seq");for(var i=0;i<fileList.length;i++){fileList[i].Type="";fileList[i].Server_Path=ds.resultList[0][i].server_path;fileList[i].Server_Fname=ds.resultList[0][i].server_fname;fileList[i].FileName=ds.resultList[0][i].local_fname;fileList[i].Date=extFormat(getToday(""),"yyyyMMdd");fileList[i].User=g_main.session.obj.EmpCode;fileList[i].Seq=seq+i;for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==objGrid.getValue(j,"FileName")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}objGrid.addRows(fileList);saveButton(true)})}function getFileDel(objGrid){var rId=objGrid.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:(objGrid.getValue(rId,"Server_Path")+objGrid.getValue(rId,"Server_Fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요",function(){if(g_main.msgShare==true){if(result){objGrid.deleteRow(rId);objGrid.selectRow(0);saveButton(true)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}function saveButton(bo){$.btnSave.setEnable(bo)}function getSeq(grd,colId){var seq=0;if(grd.getRowCount()>0){for(var i=0;i<grd.getRowCount();i++){if(seq<grd.getValue(i,colId)){seq=grd.getValue(i,colId)}}}return Number(seq+1)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,895);$.panMain.setText("");$.panMain.setBottomLine(true);$.panCompany=new FingerPanel(host,"panCompany",0,65,250,825);$.panCompany.setText("회사");$.panCompany.setBottomLine(true);$.grdCompany=new FingerDataGrid(host,"grdCompany",0,0,250,780);$.panCPTraining=new FingerPanel(host,"panCPTraining",260,65,465,350);$.panCPTraining.setText("CP Training");$.panCPTraining.setBottomLine(true);$.panContact=new FingerPanel(host,"panContact",735,65,465,350);$.panContact.setText("Contact");$.panContact.setBottomLine(true);$.panAuditDue=new FingerPanel(host,"panAuditDue",260,430,465,350);$.panAuditDue.setText("Audit / Due-Diligence");$.panAuditDue.setBottomLine(true);$.panEtc=new FingerPanel(host,"panEtc",735,430,465,350);$.panEtc.setText("기타자료");$.panEtc.setBottomLine(true);$.panMemoTag=new FingerPanel(host,"panMemoTag",260,795,940,97);$.panMemoTag.setText("");$.panMemoTag.setBottomLine(true);$.grdCPTraining=new FingerDataGrid(host,"grdCPTraining",0,0,465,305);$.grdContact=new FingerDataGrid(host,"grdContact",0,0,465,305);$.grdAuditDue=new FingerDataGrid(host,"grdAuditDue",0,0,465,305);$.grdEtc=new FingerDataGrid(host,"grdEtc",0,0,465,305);$.lblTx1=new FingerLabel(host,"lblTx1",25,25,50,20);$.lblTx1.setText("기타");$.lblTx2=new FingerLabel(host,"lblTx2",0,45,90,20);$.lblTx2.setText("메모 사항");$.mem_Descr=new FingerMemoEdit(host,"mem_Descr",105,15,815,60);$.txt_MaxCompCode=new FingerEdit(host,"txt_MaxCompCode",5,70,15,15);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.btnSave=new FingerButton(host,"btnSave",1115,10,95,30);$.btnSave.setText("저장");$.panQuery.setBorder(true);$.panCompany.setBorder(true);$.panCPTraining.setBorder(true);$.panContact.setBorder(true);$.panAuditDue.setBorder(true);$.panEtc.setBorder(true);$.panMemoTag.setBorder(true);$.panCPTraining.addButtons(["btnDelete","btnAdd"]);$.panContact.addButtons(["btnDelete","btnAdd"]);$.panAuditDue.addButtons(["btnDelete","btnAdd"]);$.panEtc.addButtons(["btnDelete","btnAdd"]);$.btnSave.setClass("btn_save");$.btnSave.setEnable(false);$.txt_MaxCompCode.setVisible(false);$.grdCompany.setColumns([new FingerDataGridColumn("CompanyName",235,"center","string","회사명"),new FingerDataGridColumn("CompanyId",0,"left","string","회사코드",{hidden:true})]);$.grdCompany.init({isFilter:false});$.grdCompany.setEditable(false);$.grdCompany.setBorder(false);$.grdCPTraining.setColumns([new FingerDataGridColumn("Type",120,"left","string","자료유형"),new FingerDataGridColumn("Seq",0,"left","string","연번",{hidden:true}),new FingerDataGridColumn("Server_Path",0,"left","string","서벼경로",{hidden:true}),new FingerDataGridColumn("Server_Fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("FileName",200,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["Server_Path","Server_Fname"]}),new FingerDataGridColumn("Date",100,"left","date","등록일자",{format:"ymd"}),new FingerDataGridColumn("User",100,"left","string","등록자")]);$.grdCPTraining.init({isFilter:false,scroll:"xy"});$.grdCPTraining.setEditable(true);$.grdCPTraining.setBorder(false);$.grdContact.setColumns([new FingerDataGridColumn("Type",120,"left","string","자료유형"),new FingerDataGridColumn("Seq",0,"left","string","연번",{hidden:true}),new FingerDataGridColumn("Server_Path",0,"left","string","서벼경로",{hidden:true}),new FingerDataGridColumn("Server_Fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("FileName",200,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["Server_Path","Server_Fname"]}),new FingerDataGridColumn("Date",100,"left","date","등록일자",{format:"ymd"}),new FingerDataGridColumn("User",100,"left","string","등록자")]);$.grdContact.init({isFilter:false,scroll:"xy"});$.grdContact.setEditable(true);$.grdContact.setBorder(false);$.grdAuditDue.setColumns([new FingerDataGridColumn("Type",120,"left","string","자료유형"),new FingerDataGridColumn("Seq",0,"left","string","연번",{hidden:true}),new FingerDataGridColumn("Server_Path",0,"left","string","서벼경로",{hidden:true}),new FingerDataGridColumn("Server_Fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("FileName",200,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["Server_Path","Server_Fname"]}),new FingerDataGridColumn("Date",100,"left","date","등록일자",{format:"ymd"}),new FingerDataGridColumn("User",100,"left","string","등록자")]);$.grdAuditDue.init({isFilter:false,scroll:"xy"});$.grdAuditDue.setEditable(true);$.grdAuditDue.setBorder(false);$.grdEtc.setColumns([new FingerDataGridColumn("Type",120,"left","string","자료유형",{readonly:true}),new FingerDataGridColumn("Seq",0,"left","string","연번",{hidden:true}),new FingerDataGridColumn("Server_Path",0,"left","string","서벼경로",{hidden:true}),new FingerDataGridColumn("Server_Fname",0,"left","string","서버파일명",{hidden:true}),new FingerDataGridColumn("FileName",200,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["Server_Path","Server_Fname"]}),new FingerDataGridColumn("Date",100,"left","date","등록일자",{format:"ymd"}),new FingerDataGridColumn("User",100,"left","string","등록자",{readonly:true})]);$.grdEtc.init({isFilter:false,scroll:"xy"});$.grdEtc.setEditable(true);$.grdEtc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panCompany);$.panMain.add($.panCPTraining);$.panMain.add($.panContact);$.panMain.add($.panAuditDue);$.panMain.add($.panEtc);$.panMain.add($.panMemoTag);$.panMain.add($.panQuery);$.panCompany.add($.grdCompany);$.panCPTraining.add($.grdCPTraining);$.panContact.add($.grdContact);$.panAuditDue.add($.grdAuditDue);$.panEtc.add($.grdEtc);$.panMemoTag.add($.txt_MaxCompCode);$.panMemoTag.add($.mem_Descr);$.panMemoTag.add($.lblTx2);$.panMemoTag.add($.lblTx1);$.panQuery.add($.btnSave);var ds=bizComponentData2($,"Q1","L_CRM259|L_CRM260|L_CRM261|L_CRM0219");$.grdContact.setColumnDropDownList("Type",ds.resultList[0],null,true);$.grdCPTraining.setColumnDropDownList("Type",ds.resultList[1],null,true);$.grdAuditDue.setColumnDropDownList("Type",ds.resultList[2],null,true);$.grdContact.setColumnDropDownList("User",ds.resultList[3],{key:"employee_id",name:"emp_name"});$.grdCPTraining.setColumnDropDownList("User",ds.resultList[3],{key:"employee_id",name:"emp_name"});$.grdAuditDue.setColumnDropDownList("User",ds.resultList[3],{key:"employee_id",name:"emp_name"});serchCPCoPromoList("Q")};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdCompany],ds);$.grdCompany.selectRow(0);saveButton(false)}else{if(type=="FILE"){if(!ds){return}for(var i=0;i<ds.resultList.length-1;i++){for(var j=0;j<ds.resultList[i].length;j++){ds.resultList[i][j].Date=extFormat(getObjectDate(ds.resultList[i][j].Date),"yyyyMMdd")}}setDataGrid([$.grdCPTraining],ds.resultList[0],true);$.grdCPTraining.selectRow(0);setDataGrid([$.grdContact],ds.resultList[1],true);$.grdContact.selectRow(0);setDataGrid([$.grdAuditDue],ds.resultList[2],true);$.grdAuditDue.selectRow(0);setDataGrid([$.grdEtc],ds.resultList[3],true);$.grdEtc.selectRow(0);$.mem_Descr.setValue(ds.resultList[4][0].memo);saveButton(false)}else{if(type=="D"||type=="MEMO"){if(ds){if(ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{if(ds.errorCode=="MSG0001"||ds.errorCode=="MSG0006"){if(type=="D"){saveCPCoPromoFileList("MEMO")}else{if(type=="MEMO"){saveCPCoPromoFileList("S")}}}}}}else{if(type=="S"){if(ds){var rs=ds.resultList;var msg="정상적으로 저장되었습니다.";if(rs.length>1){for(var i in rs){if(rs[i].errorCode&&(rs[i].errorCode.substr(0,1)=="P"||rs[i].errorCode.substr(0,1)=="E")){msg=rs[i].errorCode+"</br>"+rs[i].errorMsg}}}else{if(ds.errorCode&&(ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E")){msg=ds.errorCode+"</br>"+ds.errorMsg}}MessageBoxShow(msg);serchCPCoPromoFileList("Q")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSave"){confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare==true){saveCPCoPromoFileList("D")}})}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdCompany"){$.varCompanyId=$.grdCompany.getValue(rId,"CompanyId");serchCPCoPromoFileList("Q")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){saveButton(true);if(id=="CPCPTraining"){var rId=$.grdCPTraining.getSelectedRowIdx();var data=$.grdCPTraning.getValue(rId);log(data)}else{if(id=="panContact"){var rId=$.grdContact.getSelectedRowIdx()}else{if(id=="panAuditDue"){var rId=$.grdAuditDue.getSelectedRowIdx()}else{if(id=="panEtc"){var rId=$.grdEtc.getSelectedRowIdx()}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="mem_Descr"){saveButton(true)}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panCPTraining"){if(btnId=="btnAdd"){getFileAdd($.grdCPTraining)}else{if(btnId=="btnDelete"){getFileDel($.grdCPTraining)}}}else{if(panelId=="panContact"){if(btnId=="btnAdd"){getFileAdd($.grdContact)}else{if(btnId=="btnDelete"){getFileDel($.grdContact)}}}else{if(panelId=="panAuditDue"){if(btnId=="btnAdd"){getFileAdd($.grdAuditDue)}else{if(btnId=="btnDelete"){getFileDel($.grdAuditDue)}}}else{if(panelId=="panEtc"){if(btnId=="btnAdd"){getFileAdd($.grdEtc)}else{if(btnId=="btnDelete"){getFileDel($.grdEtc)}}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>