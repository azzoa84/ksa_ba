<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panInfo=null;$.panContact=null;$.panCard=null;$.panBottom=null;$.lblCPDocNo=null;$.lblStartDate=null;$.lblReportDate=null;$.lblEmp=null;$.lblStatus=null;$.lblAppEmp=null;$.lblLabel1=null;$.txtCPDocNo=null;$.dteStartDate=null;$.dteReportDate=null;$.cmbEmp=null;$.cmbStatus=null;$.txtAppEmp=null;$.grdContact=null;$.grdCard=null;$.imgPicture1=null;$.imgPicture2=null;$.imgPicture3=null;$.imgPicture4=null;$.memDesc=null;$.lblDesc=null;$.btnConfirm=null;$.btnCancel=null;$.btnReject=null;$.btnCPConfirm=null;$.memCPDescr=null;$.grdEsero=null;$.btnAppReq=null;$.lblLeader=null;$.lblPM=null;$.lblProduct=null;$.lblTheme=null;$.lblTime=null;$.cmbLeader=null;$.cmbPM=null;$.cmbProduct=null;$.cmbTheme=null;$.cmbTime=null;$.lblAgenda=null;$.lblQnA=null;$.memAgenda=null;$.memQnA=null;$.chkTime=null;$.lblDetailPlace=null;$.lblMealPlace=null;$.cboDetailPlace=null;$.txtMealPlace=null;$.cboFromHH=null;$.cboFromMM=null;$.lblColon=null;$.btnUpload=null;$.btnView=null;$.lblLabel2=null;$.btnBatchUpload=null;$.memMgrDescr=null;$.lblMessage1=null;$.rdoMessage1=null;$.txtdistance_cnt=null;$.varCPId="";$.varWFDocId="";$.varCPCode="";$.varAppEmp="";$.varDeptCode="";$.varSupportTotal=0;$.varAPPAMTTotal=0;$.varBillType="Card";$.varLeaderId="";$.varCPDocNo="";$.varCPBeforeId="";$.cardAddCash=false;$.varPopupNo=true;$.varContactCnt=0;$.varContactCnt2=0;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmCPDetailTheme_Q",[workType,$.cmbTheme.getValue()]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmCPDetailBefore_Q",[workType,$.varCPBeforeId,"","","",""]);return json}function createJSON_S(workType){var contRow=$.grdContact.getAllRows();var cardRow=$.grdCard.getAllRows();var eseroRow=$.grdEsero.getAllRows();if($.varBillType=="Card"){for(var i in cardRow){$.varAPPAMTTotal+=Number(cardRow[i].APPAMT)}}else{if($.varBillType=="Esero"){for(var i in eseroRow){$.varAPPAMTTotal+=Number(eseroRow[i].appamt)}}}var pic1Yn=$.imgPicture1.getValue()?"Y":"N";var pic2Yn=$.imgPicture2.getValue()?"Y":"N";var pic3Yn=$.imgPicture3.getValue()?"Y":"N";var pic4Yn=$.imgPicture4.getValue()?"Y":"N";var compId="",contId="",special="",suppAmt="",suppAmt2="",filePath="",fileName="",edityn="",receipt_type="",APPRNO="",APPDAT="",CARDNO="",APPAMT="",VENKNM="",VENADD="",VENGRP="",BIZNAME="",PRODUCT="",PRODUCT1="",pic1URL="",pic2URL="",pic3URL="",pic4URL="";var today=getToday("");var year=today.substr(0,4);var month=today.substr(4,2);var url=year+"/"+month+"/";if(workType!="D"){var imgRs=$.imgGroup.uploadBase64();if(imgRs){var imgURL=imgRs.resultList[0]}var imgIdx=0;if(pic1Yn=="Y"&&$.imgPicture1.isDataUrL){pic1URL=imgURL[imgIdx].file_url;imgIdx++}else{if(pic1Yn=="Y"){pic1URL=$.varPic1Url||""}}if(pic2Yn=="Y"&&$.imgPicture2.isDataUrL){pic2URL=imgURL[imgIdx].file_url;imgIdx++}else{if(pic2Yn=="Y"){pic2URL=$.varPic2Url||""}}if(pic3Yn=="Y"&&$.imgPicture3.isDataUrL){pic3URL=imgURL[imgIdx].file_url;imgIdx++}else{if(pic3Yn=="Y"){pic3URL=$.varPic3Url||""}}if(pic4Yn=="Y"&&$.imgPicture4.isDataUrL){pic4URL=imgURL[imgIdx].file_url;imgIdx++}else{if(pic4Yn=="Y"){pic4URL=$.varPic4Url||""}}}if($.varBillType=="Card"){if(cardRow.length<=0){MessageBoxShow("법인카드내역이 등록되지 않았습니다.");return}for(var i in cardRow){receipt_type+=(receipt_type?"|":"")+cardRow[i].receipt_type||" ";APPRNO+=(APPRNO?"|":"")+cardRow[i].APPRNO||" ";APPDAT+=(APPDAT?"|":"")+cardRow[i].APPDAT||" ";CARDNO+=(CARDNO?"|":"")+cardRow[i].CARDNO||" ";APPAMT+=(APPAMT?"|":"")+cardRow[i].APPAMT||" ";VENKNM+=(VENKNM?"|":"")+cardRow[i].VENKNM||" ";VENADD+=(VENADD?"|":"")+cardRow[i].VENADD||" ";VENGRP+=(VENGRP?"|":"")+cardRow[i].VENGRP||" "}}else{if($.varBillType=="Esero"){if(eseroRow.length<=0){MessageBoxShow("전자세금계산서내역이 등록되지 않았습니다.");return}for(var i in eseroRow){APPRNO+=(APPRNO?"|":"")+cardRow[i].apprno||" ";APPDAT+=(APPDAT?"|":"")+cardRow[i].appdat||" ";APPAMT+=(APPAMT?"|":"")+cardRow[i].appamt||" ";BIZNAME+=(APPAMT?"|":"")+cardRow[i].bizname||" ";PRODUCT+=(APPAMT?"|":"")+cardRow[i].product||" ";PRODUCT1+=(APPAMT?"|":"")+cardRow[i].product1||" "}}}if(contRow.length<=0){MessageBoxShow("고객정보가 등록되지 않았습니다.");return}$.varSupportTotal=0;for(var i=0;i<$.grdContact.getRowCount();i++){compId+=$.grdContact.getValue(i,"company_id")+"|";contId+=$.grdContact.getValue(i,"contact_id")+"|";special+=$.grdContact.getValue(i,"speciality")+"|";suppAmt+=$.grdContact.getValue(i,"support_amt")+"|";suppAmt2+=$.grdContact.getValue(i,"support_amt2")+"|";filePath+=$.grdContact.getValue(i,"file_path")+"|";fileName+=$.grdContact.getValue(i,"file_name")+"|";edityn+=$.grdContact.getValue(i,"edit_yn")+"|";$.varSupportTotal+=Number(contRow[i].support_amt);$.varSupportTotal+=Number(contRow[i].support_amt2)}if($.grdContact.getRowCount()>0){compId=compId.substring(0,compId.length-1);contId=contId.substring(0,contId.length-1);special=special.substring(0,special.length-1);suppAmt=suppAmt.substring(0,suppAmt.length-1);suppAmt2=suppAmt2.substring(0,suppAmt2.length-1);filePath=filePath.substring(0,filePath.length-1);fileName=fileName.substring(0,fileName.length-1);edityn=edityn.substring(0,edityn.length-1)}var json=createExecuteParamInfo("P_crmCPDetailAfter_S",[workType,$.varCPId,$.varCPDocNo||"",$.cmbEmp.getValue()||"",$.cmbPM.getValue()||"",$.dteReportDate.getValue()||"",$.varDeptCode,$.cmbLeader.getValue()||"",$.dteStartDate.getValue()||"",$.cboFromHH.getValue(),$.cboFromMM.getValue(),$.cmbProduct.getValue(),$.cmbTheme.getValue(),$.varSupportTotal||0,$.chkTime.getValue(),$.cboDetailPlace.getValue(),$.txtMealPlace.getValue(),$.memAgenda.getValue()||"",$.memDesc.getValue()||"",$.memQnA.getValue()||"",$.rdoMessage1.getValue(),pic1Yn,pic2Yn,pic3Yn,pic4Yn,pic1URL,pic2URL,pic3URL,pic4URL,$.varCPCode,$.varWFDocId,$.varCPBeforeId,g_main.session.obj.UserID,compId,contId,special,suppAmt,suppAmt2,filePath,fileName,edityn,receipt_type,APPRNO,APPDAT,CARDNO,APPAMT,VENKNM,VENADD,VENGRP,BIZNAME,PRODUCT,PRODUCT1,$.varBillType]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmCPExtraFunction_S",[workType,$.varCPId,"","#UserID#"]);return json}function searchTheme(){if($.cmbTheme.getValue("use_yn")=="N"&&$.varPopupNo){MessageBoxShow("사용 중지 된 테마가 선택되었습니다.");$.cmbTheme.setValue("");return}var json=createJSON_Q("Q");var ds=callQuerySync(["req",json],"Q");if(ds.resultList[0].length>0){$.memDesc.setValue(ds.resultList[0][0].cp_desc)}}function saveDetailAfter(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$)}}function saveExtraFunction(workType){var json=createJSON_S2(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);if(ds){if(ds.errorCode=="MSG0004"){$.cmbStatus.setValue("05")}}}}function chkExpense(){var contRow=$.grdContact.getAllRows();var cardRow=$.grdCard.getAllRows();if(contRow.length<=0||cardRow.length<=0){return false}var supAmt=0,cardAmt=0;for(var i in contRow){supAmt+=Number(contRow[i].support_amt);supAmt+=Number(contRow[i].support_amt2)}for(var i in cardRow){cardAmt+=Number(cardRow[i].APPAMT)}if(supAmt==parseInt(cardAmt)){return true}else{return false}}function akrMember(){var akrMember=false;var contRow=$.grdContact.getAllRows();for(var i in contRow){if(contRow[i].contact_id.substr(0,2)=="ka"||contRow[i].contact_id.substr(0,2)=="ypc"){akrMember=true;break}}return akrMember}function setEnable(bo){if(bo){$.panInfo.enableButton(["btnSave","btnTemp"]);$.panContact.enableButton(["btnAdd","btnDelete"])}else{$.panInfo.disableButton(["btnSave","btnTemp","btnLoad"]);$.panContact.disableButton(["btnAdd","btnDelete"])}$.memDesc.setReadOnly(!bo)}function chkTimeZone(){if($.cardAddCash){return true}var chkTime=false,chkAmt=true;var start="0600",end="1000";var apptime=unmask($.grdCard.getValue(0,"APPDAT").substr(10,5));if(start<=apptime&&end>=apptime){chkTime=true}else{chkTime=false}var aRow=$.grdContact.getAllRows();for(var i in aRow){if(aRow[i].support_amt>20000&&aRow[i].contact_id.substr(0,2)!="ka"){chkAmt=false}}if(chkTime&&chkAmt){return true}else{return false}}function calcSupportAmt(){if($.grdContact.getRowCount()<1||$.grdCard.getRowCount()<1){return}else{var contRow=$.grdContact.getAllRows();var cardRow=$.grdCard.getAllRows();var amt_sum_food=0;var amt_sum_gift=0;var contact_cnt=$.grdContact.getRowCount();var quotient_food=0;var remainder_food=0;var quotient_gift=0;var remainder_gift=0;for(var i in cardRow){if(cardRow[i].receipt_type=="10"){amt_sum_food+=Number(cardRow[i].APPAMT)}else{if(cardRow[i].receipt_type=="20"){amt_sum_gift+=Number(cardRow[i].APPAMT)}}}quotient_food=amt_sum_food/contact_cnt;remainder_food=amt_sum_food%contact_cnt;quotient_gift=amt_sum_gift/contact_cnt;remainder_gift=amt_sum_gift%contact_cnt;for(var i in contRow){if(contRow[i].contact_id==g_main.session.obj.EmpCode){$.grdContact.setValue(i,"support_amt",parseInt(quotient_food+remainder_food));$.grdContact.setValue(i,"support_amt2",parseInt(quotient_gift+remainder_gift))}else{$.grdContact.setValue(i,"support_amt",parseInt(quotient_food));$.grdContact.setValue(i,"support_amt2",parseInt(quotient_gift))}}}}function chkContactList(){var chkList=true;for(var i=0;i<$.grdContact.getRowCount();i++){for(var j=i+1;j<$.grdContact.getRowCount();j++){if($.grdContact.getValue(i,"contact_id")==$.grdContact.getValue(j,"contact_id")){chkList=false}}}return chkList}function chkContact(){var chkContact=false;$.varContactCnt2=0;for(var i=0;i<$.grdContact.getRowCount();i++){if($.grdContact.getValue(i,"contact_id").substr(0,1)=="D"||$.grdContact.getValue(i,"contact_id").substr(0,2)=="EC"){chkContact=true;$.varContactCnt2+=1}}return chkContact}function chkAggrementList(){var chkAggrement=true;for(var i=0;i<$.grdContact.getRowCount();i++){if($.grdContact.getValue(i,"company_id")!="H99999999"&&$.grdContact.getValue(i,"upload_yn")=="N"&&Number($.grdContact.getValue(i,"support_amt"))>10000){chkAggrement=false}}return chkAggrement}function makeDetailPlaceList(){var list=[];var list2=[];for(var i=0;i<$.grdContact.getRowCount();i++){if($.grdContact.getValue(i,"company_name")&&$.grdContact.getValue(i,"company_id")!="H99999999"){if(list.indexOf($.grdContact.getValue(i,"company_name"))==-1){list.push($.grdContact.getValue(i,"company_name"));list2.push($.grdContact.getValue(i,"company_id"))}}}var comboList=[];for(var i=0;i<list.length;i++){comboList.push({sub_code:list2[i],code_name:list[i]})}comboList.unshift({sub_code:"거래처 코드",code_name:"거래처명"});$.cboDetailPlace.setData(comboList)}function searchContact(){var json=createJSON_Q2("CONTACT");callQuery(["req",json],"CONTACT",$)}function calc_date(start,end){if(!start||!end||start.length!=8||end.length!=8){return}var dt1=new Date(start.substr(0,4),(start.substr(4,2)-1),start.substr(6,2));var dt2=new Date(end.substr(0,4),(end.substr(4,2)-1),end.substr(6,2));var btMs=dt2.getTime()-dt1.getTime();var btDay=btMs/(1000*60*60*24);return btDay}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,790);$.panMain.setText("");$.panMain.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",0,0,1200,780);$.panInfo.setText("제품디테일링(사후)");$.panInfo.setBottomLine(true);$.panContact=new FingerPanel(host,"panContact",0,105,705,305);$.panContact.setText("참석자 정보");$.panContact.setBottomLine(true);$.panCard=new FingerPanel(host,"panCard",10,420,705,200);$.panCard.setText("법인카드내역");$.panCard.setBottomLine(true);$.panBottom=new FingerPanel(host,"panBottom",0,790,1200,110);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.lblCPDocNo=new FingerLabel(host,"lblCPDocNo",0,10,100,20);$.lblCPDocNo.setText("문서번호");$.lblStartDate=new FingerLabel(host,"lblStartDate",600,40,100,20);$.lblStartDate.setText("개최일시");$.lblReportDate=new FingerLabel(host,"lblReportDate",890,70,100,20);$.lblReportDate.setText("보고일자");$.lblEmp=new FingerLabel(host,"lblEmp",0,40,100,20);$.lblEmp.setText("담당자");$.lblStatus=new FingerLabel(host,"lblStatus",600,10,100,20);$.lblStatus.setText("승인상태");$.lblAppEmp=new FingerLabel(host,"lblAppEmp",890,10,100,20);$.lblAppEmp.setText("승인자");$.lblLabel1=new FingerLabel(host,"lblLabel1",895,100,100,20);$.lblLabel1.setText("영수증 내역서");$.txtCPDocNo=new FingerEdit(host,"txtCPDocNo",105,10,140,20);$.dteStartDate=new FingerDateEdit(host,"dteStartDate",705,40,135,20);$.dteReportDate=new FingerDateEdit(host,"dteReportDate",995,70,140,20);$.cmbEmp=new FingerComboBox(host,"cmbEmp",105,40,140,20);$.cmbStatus=new FingerComboBox(host,"cmbStatus",705,10,140,20);$.txtAppEmp=new FingerEdit(host,"txtAppEmp",995,10,140,20);$.grdContact=new FingerDataGrid(host,"grdContact",0,0,700,260);$.grdCard=new FingerDataGrid(host,"grdCard",0,0,700,155);$.imgPicture1=new FingerImage(host,"imgPicture1",720,150,230,145);$.imgPicture2=new FingerImage(host,"imgPicture2",955,150,230,145);$.imgPicture3=new FingerImage(host,"imgPicture3",720,300,230,145);$.imgPicture4=new FingerImage(host,"imgPicture4",955,300,230,145);$.memDesc=new FingerMemoEdit(host,"memDesc",760,540,420,80);$.lblDesc=new FingerLabel(host,"lblDesc",700,560,55,20);$.lblDesc.setText("설명회 내용");$.btnConfirm=new FingerButton(host,"btnConfirm",10,5,120,40);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",10,60,120,40);$.btnCancel.setText("승인취소");$.btnReject=new FingerButton(host,"btnReject",125,5,120,40);$.btnReject.setText("메모저장");$.btnCPConfirm=new FingerButton(host,"btnCPConfirm",125,60,120,40);$.btnCPConfirm.setText("CP승인요청");$.memCPDescr=new FingerMemoEdit(host,"memCPDescr",680,5,500,90);$.grdEsero=new FingerDataGrid(host,"grdEsero",0,0,700,155);$.btnAppReq=new FingerButton(host,"btnAppReq",665,-40,140,30);$.btnAppReq.setText("소, 팀장 승인요청");$.lblLeader=new FingerLabel(host,"lblLeader",295,10,100,20);$.lblLeader.setText("영업소장");$.lblPM=new FingerLabel(host,"lblPM",295,40,100,20);$.lblPM.setText("PM");$.lblProduct=new FingerLabel(host,"lblProduct",0,70,100,20);$.lblProduct.setText("품목");$.lblTheme=new FingerLabel(host,"lblTheme",295,70,100,20);$.lblTheme.setText("디테일링 테마");$.lblTime=new FingerLabel(host,"lblTime",925,40,100,20);$.lblTime.setText("시간대");$.cmbLeader=new FingerComboBox(host,"cmbLeader",400,10,140,20);$.cmbPM=new FingerComboBox(host,"cmbPM",400,40,140,20);$.cmbProduct=new FingerComboBox(host,"cmbProduct",105,70,140,20);$.cmbTheme=new FingerComboBox(host,"cmbTheme",400,70,500,20);$.cmbTime=new FingerComboBox(host,"cmbTime",905,70,20,20);$.lblAgenda=new FingerLabel(host,"lblAgenda",0,660,80,20);$.lblAgenda.setText("Agenda 및 기타사항");$.lblQnA=new FingerLabel(host,"lblQnA",695,670,60,20);$.lblQnA.setText("QnA");$.memAgenda=new FingerMemoEdit(host,"memAgenda",90,635,620,85);$.memQnA=new FingerMemoEdit(host,"memQnA",760,635,420,85);$.chkTime=new FingerCheckBox(host,"chkTime",1075,40,60,20);$.chkTime.setText("아침");$.lblDetailPlace=new FingerLabel(host,"lblDetailPlace",700,480,100,20);$.lblDetailPlace.setText("설명회 장소");$.lblMealPlace=new FingerLabel(host,"lblMealPlace",705,510,95,20);$.lblMealPlace.setText("식사 장소");$.cboDetailPlace=new FingerComboBox(host,"cboDetailPlace",805,480,385,20);$.txtMealPlace=new FingerEdit(host,"txtMealPlace",805,510,380,20);$.cboFromHH=new FingerComboBox(host,"cboFromHH",845,40,55,20);$.cboFromMM=new FingerComboBox(host,"cboFromMM",910,40,55,20);$.lblColon=new FingerLabel(host,"lblColon",890,40,15,20);$.lblColon.setText(":");$.btnUpload=new FingerButton(host,"btnUpload",329,-40,120,30);$.btnUpload.setText("동의서 업로드");$.btnView=new FingerButton(host,"btnView",435,-40,120,30);$.btnView.setText("동의서 보기");$.lblLabel2=new FingerLabel(host,"lblLabel2",740,125,365,20);$.lblLabel2.setText(" *최소한 하나의 영수증 사진이 등록되어야 합니다.");$.btnBatchUpload=new FingerButton(host,"btnBatchUpload",183,-40,160,30);$.btnBatchUpload.setText("동의서 일괄 업로드");$.memMgrDescr=new FingerMemoEdit(host,"memMgrDescr",235,5,430,90);$.lblMessage1=new FingerLabel(host,"lblMessage1",690,450,335,20);$.lblMessage1.setText("병원에서 식사장소까지의 직선거리가 10km 이내입니까?");$.rdoMessage1=new FingerRadioBox(host,"rdoMessage1",1030,450,110,20);$.txtdistance_cnt=new FingerEdit(host,"txtdistance_cnt",1130,450,55,20);$.panInfo.addButtons(["btnLoad","btnDelete","btnTemp","btnSave","btnNew"]);$.panContact.addButtons(["btnDelete","btnAdd"]);$.panCard.addButtons(["btnDelete","btnAdd"]);$.grdContact.setColumns([new FingerDataGridColumn("seq",45,"center","string","순번",{readonly:true}),new FingerDataGridColumn("company_id",99,"left","string","소속기관아이디",{hidden:true}),new FingerDataGridColumn("company_name",200,"left","string","소속기관/병원",{readonly:true}),new FingerDataGridColumn("speciality_code",99,"left","string","진료과목코드",{hidden:true}),new FingerDataGridColumn("speciality",120,"left","string","부서/진료과목",{readonly:true}),new FingerDataGridColumn("contact_id",99,"left","string","고객아이디",{hidden:true}),new FingerDataGridColumn("contact_name",75,"center","string","고객명",{readonly:true}),new FingerDataGridColumn("support_amt",80,"right","string","식음료",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("support_amt2",80,"right","string","기념품",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("upload_yn",80,"center","string","동의서",{readonly:true}),new FingerDataGridColumn("file_path",80,"center","string","동의서 파일 경로",{readonly:true,hidden:true}),new FingerDataGridColumn("file_name",80,"center","string","동의서 파일명",{readonly:true,hidden:true}),new FingerDataGridColumn("edit_yn",80,"center","string","수정 가능여부",{readonly:true,hidden:true})]);$.grdContact.init({footer:true});$.grdContact.setEditable(true);$.grdContact.setBorder(false);$.grdCard.setColumns([new FingerDataGridColumn("APPRNO",99,"left","string","승인번호",{hidden:true}),new FingerDataGridColumn("APPDAT",110,"left","string","승인시간",{readonly:true}),new FingerDataGridColumn("CARDNO",130,"left","string","카드정보",{readonly:true}),new FingerDataGridColumn("EMPNO",80,"left","string","소유자",{readonly:true}),new FingerDataGridColumn("APPAMT",90,"right","string","승인금액",{format:"int",readonly:true}),new FingerDataGridColumn("VENKNM",90,"left","checkBox","가맹점",{readonly:true}),new FingerDataGridColumn("VENADD",120,"left","checkBox","가맹점 주소",{readonly:true}),new FingerDataGridColumn("VENGRP",100,"left","checkBox","업태",{readonly:true}),new FingerDataGridColumn("receipt_type",110,"left","string","영수증 구분")]);$.grdCard.init({scroll:"xy"});$.grdCard.setBorder(false);$.grdCard.setEditable(true);$.grdEsero.setColumns([new FingerDataGridColumn("appdat",120,"left","string","발행일자"),new FingerDataGridColumn("bizname",99,"left","string","상호",{hidden:true}),new FingerDataGridColumn("appamt",120,"right","string","공급가액",{format:"int"}),new FingerDataGridColumn("product",99,"left","string","품목",{hidden:true}),new FingerDataGridColumn("product1",99,"left","string","품목1",{hidden:true}),new FingerDataGridColumn("apprno",99,"left","string","승인번호",{hidden:true})]);$.grdEsero.init({scroll:"xy"});$.grdEsero.setBorder(false);$.grdEsero.setVisible(false);$.dteStartDate.setAllowBlank(false,"개최일시");$.dteReportDate.setAllowBlank(false,"보고일자");$.cmbEmp.setAllowBlank(false,"담당자");$.cmbLeader.setAllowBlank(false,"영업소장");$.cmbProduct.setAllowBlank(false,"품목");$.cmbTheme.setAllowBlank(false,"디테일링 테마");$.cmbTime.setAllowBlank(false,"시간대");$.memDesc.setAllowBlank(false,"설명회 내용");$.memAgenda.setAllowBlank(false,"Agenda 및 기타사항");$.memQnA.setAllowBlank(false,"QnA");$.cboFromHH.setAllowBlank(false,"개최시간");$.cboFromMM.setAllowBlank(false,"개최시간");$.cboDetailPlace.setAllowBlank(false,"설명회 장소");$.txtMealPlace.setAllowBlank(false,"식사 장소");$.cmbTime.setVisible(false);$.dteReportDate.setValue(getToday(""));$.rdoMessage1.addButtons([{sub_code:"Y",code_name:"예"},{sub_code:"N",code_name:"아니오"}]);$.btnAppReq.setEnable(false);$.txtCPDocNo.setReadOnly(true);$.dteStartDate.setEnable(false);$.dteReportDate.setEnable(false);$.cmbEmp.setEnable(false);$.cmbStatus.setEnable(false);$.txtAppEmp.setReadOnly(true);$.cmbLeader.setEnable(false);$.txtdistance_cnt.setEnable(false);$.panInfo.disableButton(["btnDelete"]);$.varDeptCode=g_main.session.obj.DeptCode;$.imgGroup=new FingerImageGroup([$.imgPicture1,$.imgPicture2,$.imgPicture3,$.imgPicture4],"CPImages");$.imgPicture1.setMode("N");$.imgPicture2.setMode("N");$.imgPicture3.setMode("N");$.imgPicture4.setMode("N");$.imgPicture1.setZooming(true,true,true);$.imgPicture2.setZooming(true,true,true);$.imgPicture3.setZooming(true,true,true);$.imgPicture4.setZooming(true,true,true);$.cmbTheme.setColumnConfig([{id:"theme_id",width:60},{id:"call_message",width:500},{id:"use_yn",width:30}]);;$.host=host;$.args=args};$.start=function(){$.panMain.add($.panInfo);$.panMain.add($.panBottom);$.panInfo.add($.panContact);$.panInfo.add($.panCard);$.panInfo.add($.lblCPDocNo);$.panInfo.add($.lblStartDate);$.panInfo.add($.lblReportDate);$.panInfo.add($.lblEmp);$.panInfo.add($.lblStatus);$.panInfo.add($.lblAppEmp);$.panInfo.add($.lblLabel1);$.panInfo.add($.txtCPDocNo);$.panInfo.add($.dteStartDate);$.panInfo.add($.dteReportDate);$.panInfo.add($.cmbEmp);$.panInfo.add($.cmbStatus);$.panInfo.add($.txtAppEmp);$.panInfo.add($.imgPicture1);$.panInfo.add($.imgPicture2);$.panInfo.add($.imgPicture3);$.panInfo.add($.imgPicture4);$.panInfo.add($.memDesc);$.panInfo.add($.lblDesc);$.panInfo.add($.btnAppReq);$.panInfo.add($.lblLeader);$.panInfo.add($.lblPM);$.panInfo.add($.lblProduct);$.panInfo.add($.lblTheme);$.panInfo.add($.lblTime);$.panInfo.add($.cmbLeader);$.panInfo.add($.cmbPM);$.panInfo.add($.cmbProduct);$.panInfo.add($.cmbTheme);$.panInfo.add($.cmbTime);$.panInfo.add($.lblAgenda);$.panInfo.add($.lblQnA);$.panInfo.add($.memAgenda);$.panInfo.add($.memQnA);$.panInfo.add($.chkTime);$.panInfo.add($.lblDetailPlace);$.panInfo.add($.lblMealPlace);$.panInfo.add($.txtMealPlace);$.panInfo.add($.cboDetailPlace);$.panInfo.add($.cboFromHH);$.panInfo.add($.cboFromMM);$.panInfo.add($.lblColon);$.panInfo.add($.lblLabel2);$.panInfo.add($.lblMessage1);$.panInfo.add($.rdoMessage1);$.panInfo.add($.txtdistance_cnt);$.panContact.add($.grdContact);$.panContact.add($.btnUpload);$.panContact.add($.btnView);$.panContact.add($.btnBatchUpload);$.panCard.add($.grdCard);$.panCard.add($.grdEsero);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnCancel);$.panBottom.add($.btnReject);$.panBottom.add($.btnCPConfirm);$.panBottom.add($.memCPDescr);$.panBottom.add($.memMgrDescr);relocateChildIndexInPanel([$.panInfo]);if(g_main.session.obj.UserID!="AKR-A00001"){$.cmbEmp.setEmptyRow(true);$.cmbStatus.setEmptyRow(true);$.cmbPM.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbTime.setEmptyRow(true);$.cmbTheme.setEmptyRow(true);$.cboDetailPlace.setEmptyRow(true);$.cmbEmp.setColumn("employee_id","emp_name");$.cmbLeader.setColumn("line1empno","line1empname");$.cmbPM.setColumn("employee_id","emp_name");$.cmbProduct.setColumn("product_code","product_name");$.cmbTheme.setColumn("theme_id","call_message");$.cboDetailPlace.setColumn("sub_code","code_name");var ds=bizComponentData2($,"Q1","L_CRM0052|L_CRM0111|L_CRM192|L_CRM0131|L_COM024");setComboBind([$.cmbEmp,$.cmbStatus,$.cmbPM,$.cmbProduct,$.cmbTime],ds);var ds=bizComponentData2($,"Q3","L_CRM0108","","",g_main.session.obj.UserID);setComboBind([$.cmbLeader],ds);$.varLeaderId=ds.resultList[0][0].line1empno;var ds=bizComponentData2($,"Q1","L_CRM0259","detail");setComboBind([$.cmbTheme],ds);var ds1=bizComponentData2($,"Q1","L_CRM0284");$.grdCard.setColumnDropDownList("receipt_type",ds1.resultList[0],{key:"sub_code",name:"code_name"});var ds2=bizComponentData2($,"Q1","L_CRM0219");$.grdCard.setColumnDropDownList("EMPNO",ds2.resultList[0],{key:"employee_id",name:"emp_name"});var ds=bizComponentData2($,"Q1","L_COM017|L_COM018");setComboBind([$.cboFromHH,$.cboFromMM],ds);$.cmbLeader.setValue($.varLeaderId);$.cmbEmp.setValue(g_main.session.obj.UserID);$.cmbStatus.setValue("10");$.panBottom.setVisible(false);$.memCPDescr.setReadOnly(true);$.memMgrDescr.setReadOnly(true)}else{$.cmbEmp.setEmptyRow(true);$.cmbStatus.setEmptyRow(true);$.cmbPM.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbTime.setEmptyRow(true);$.cmbTheme.setEmptyRow(true);$.cboDetailPlace.setEmptyRow(true);$.cmbEmp.setColumn("employee_id","emp_name");$.cmbLeader.setColumn("line1empno","line1empname");$.cmbPM.setColumn("employee_id","emp_name");$.cmbProduct.setColumn("product_code","product_name");$.cmbTheme.setColumn("theme_id","call_message");$.cboDetailPlace.setColumn("sub_code","code_name");var ds=bizComponentData2($,"Q1","L_CRM0052|L_CRM0111|L_CRM192|L_CRM0131|L_COM024");setComboBind([$.cmbEmp,$.cmbStatus,$.cmbPM,$.cmbProduct,$.cmbTime],ds);var ds=bizComponentData2($,"Q3","L_CRM0108","","","ka981029");setComboBind([$.cmbLeader],ds);$.varLeaderId="ka080073";var ds=bizComponentData2($,"Q1","L_CRM0259","detail");setComboBind([$.cmbTheme],ds);var ds1=bizComponentData2($,"Q1","L_CRM0284");$.grdCard.setColumnDropDownList("receipt_type",ds1.resultList[0],{key:"sub_code",name:"code_name"});var ds=bizComponentData2($,"Q1","L_COM017|L_COM018");setComboBind([$.cboFromHH,$.cboFromMM],ds);$.cmbLeader.setValue($.varLeaderId);$.cmbEmp.setValue(g_main.session.obj.UserID);$.cmbStatus.setValue("10");$.panBottom.setVisible(false)}if($.p_argument){$.varPopupNo=false;var ds=bizComponentData2($,"Q3","L_CRM0108");setComboBind([$.cmbLeader],ds);$.panBottom.setVisible(true);$.btnConfirm.setVisible(false);$.btnCancel.setVisible(false);$.btnReject.setVisible(false);$.btnCPConfirm.setVisible(false);var rs=$.p_argument[0][0];$.varCPId=rs.cp_id;$.varWFDocId=rs.wf_doc_id||"";$.varCPCode=rs.cp_code;$.varCPDocNo=rs.cp_doc_no;$.varDeptCode=rs.cp_dept_code;$.varCPBeforeId=rs.before_cp_id;$.varContactCnt=rs.org_contact_cnt;$.cmbLeader.setValue(rs.team_leader);$.cmbPM.setValue(rs.cp_emp_pm);$.varAppEmp=rs.approval_id;$.cmbProduct.setValue(rs.product_code);var ds=bizComponentData2($,"Q3","L_CRM0259","detail",rs.product_code);setComboBind([$.cmbTheme],ds);$.cmbTheme.setValue(rs.report_theme);$.chkTime.setValue(rs.cp_time_zone);$.txtCPDocNo.setValue(rs.cp_id);$.dteStartDate.setValue(rs.cp_start_date);$.cboFromHH.setValue(rs.cp_start_date_hh);$.cboFromMM.setValue(rs.cp_start_date_mm);$.dteReportDate.setValue(rs.report_date);$.cmbEmp.setValue(rs.cp_emp_id);$.cmbStatus.setValue(rs.cp_status);$.txtAppEmp.setValue(rs.approval_name);$.memAgenda.setValue(rs.agenda);$.memDesc.setValue(rs.cp_desc);$.memQnA.setValue(rs.memo_qna);$.memCPDescr.setValue(rs.cp_descr);$.memMgrDescr.setValue(rs.cp_mgr_memo);$.rdoMessage1.setValue(rs.distance_yn);$.txtdistance_cnt.setValue(rs.distance_cnt);$.txtMealPlace.setValue(rs.meal_place);setDataGrid([$.grdContact],$.p_argument[1],true);if(rs.cp_place!=""){var comboList=[];comboList.push({sub_code:rs.cp_place_code,code_name:rs.cp_place});$.cboDetailPlace.setData(comboList);$.cboDetailPlace.setValue(rs.cp_place_code)}else{makeDetailPlaceList()}setDataGrid([$.grdCard],$.p_argument[4],true);if(rs.pic1_url){$.varPic1Url=rs.pic1_url;$.imgPicture1.setValue(getServerFileUrl("CPImages/"+rs.pic1_url))}if(rs.pic2_url){$.varPic2Url=rs.pic2_url;$.imgPicture2.setValue(getServerFileUrl("CPImages/"+rs.pic2_url))}if(rs.pic3_url){$.varPic3Url=rs.pic3_url;$.imgPicture3.setValue(getServerFileUrl("CPImages/"+rs.pic3_url))}if(rs.pic4_url){$.varPic4Url=rs.pic4_url;$.imgPicture4.setValue(getServerFileUrl("CPImages/"+rs.pic4_url))}if(rs.Confirm){$.panCard.disableButton(["btnAdd","btnDelete"]);$.panContact.disableButton(["btnAdd","btnDelete"]);$.cmbPM.setEnable(false);$.cmbProduct.setEnable(false);$.cmbTheme.setEnable(false);$.cmbTime.setEnable(false);$.btnUpload.setEnable(false);$.cboFromHH.setEnable(false);$.cboFromMM.setEnable(false);$.cboDetailPlace.setEnable(false);$.txtMealPlace.setEnable(false);$.memAgenda.setEnable(false);$.memQnA.setEnable(false);$.rdoMessage1.setEnable(false)}else{$.panCard.enableButton(["btnAdd","btnDelete"])}if(rs.save_yn=="Y"){setEnable(true);$.panInfo.enableButton(["btnSave","btnDelete","btnLoad"])}else{setEnable(false);$.btnUpload.setEnable(false);$.panInfo.disableButton(["btnSave","btnDelete","btnLoad"]);$.panContact.disableButton(["btnAdd","btnDelete"])}if(rs.cp_status=="05"){if(g_main.session.obj.DutyCode!="09"&&g_main.session.obj.UserID!="ka041184"){$.btnConfirm.setVisible(true);$.btnCPConfirm.setVisible(true);$.btnReject.setVisible(true);$.memMgrDescr.setReadOnly(false);$.cmbPM.setEnable(false);$.cmbProduct.setEnable(false);$.cmbTheme.setEnable(false);$.cmbTime.setEnable(false);$.btnUpload.setEnable(false);$.cboFromHH.setEnable(false);$.cboFromMM.setEnable(false);$.cboDetailPlace.setEnable(false);$.txtMealPlace.setEnable(false);$.memAgenda.setEnable(false);$.memQnA.setEnable(false);$.rdoMessage1.setEnable(false)}}else{if(rs.cp_status=="10"){if(g_main.session.obj.DeptCode==g_main.session.obj.CPDeptCode){$.btnConfirm.setVisible(true);$.memCPDescr.setReadOnly(false)}}else{if(rs.cp_status=="90"){$.panCard.disableButton(["btnAdd","btnDelete"]);$.panContact.disableButton(["btnAdd","btnDelete"]);$.panInfo.disableButton(["btnSave","btnTemp","btnDelete","btnLoad"]);$.cmbPM.setEnable(false);$.cmbProduct.setEnable(false);$.cmbTheme.setEnable(false);$.cmbTime.setEnable(false);$.memAgenda.setEnable(false);$.memQnA.setEnable(false);$.grdCard.setEditable(false);$.grdContact.setEditable(false);$.cboFromHH.setEnable(false);$.cboFromMM.setEnable(false);$.cboDetailPlace.setEnable(false);$.txtMealPlace.setEnable(false);$.btnUpload.setEnable(false);$.chkTime.setEnable(false);$.rdoMessage1.setEnable(false);if(g_main.session.obj.DutyCode!="09"&&$.varAppEmp==g_main.session.obj.UserID){if(!$.varWFDocId||$.varWFDocId==""){$.btnCancel.setVisible(true)}}if(g_main.session.obj.UserID=="ka041184"){if(!$.varWFDocId||$.varWFDocId==""){$.btnCancel.setVisible(true)}}if(g_main.session.obj.UserID==$.cmbEmp.getValue()&&$.varWFDocId==""&&$.varCPId!=""){$.btnAppReq.setVisible(true)}}}}}else{$.grdContact.addRow({seq:1,contact_id:g_main.session.obj.UserID,contact_name:g_main.session.obj.UserName,company_id:"H99999999",company_name:"한국아스텔라스제약",speciality:g_main.session.obj.DeptName,support_amt:0,support_amt2:0,upload_yn:"N",file_path:" ",file_name:" ",edit_yn:"Y"})}};$.callback=function(type,ds){if(type=="N"||type=="NT"||type=="U"||type=="UT"){if(ds.errorCode=="crmCPDetailAfter_011"){MessageBoxShow("참석자 중 월 4회 한도를 초과한 고객이 존재합니다.");return}if(type=="N"||type=="NT"){var rStr=ds.returnStr.split("|");$.varCPId=rStr[0];$.txtCPDocNo.setValue(rStr[0]);$.varCPDocNo=rStr[1];MessageBoxShow("정상적으로 저장 되었습니다.")}else{if(type=="U"||type=="UT"){MessageBoxShow("정상적으로 수정 되었습니다.")}}if(g_main.session.obj.UserID==$.cmbEmp.getValue()&&$.varWFDocId==""&&$.varCPId!=""){$.btnAppReq.setEnable(true)}}else{if(type=="D"){var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}else{if(type=="CONTACT"){setDataGrid([$.grdContact],ds);$.grdContact.addRow({seq:"",contact_id:g_main.session.obj.UserID,contact_name:g_main.session.obj.UserName,company_id:"H99999999",company_name:"한국아스텔라스제약",speciality:g_main.session.obj.DeptName,support_amt:0,support_amt2:0,upload_yn:"N",file_path:" ",file_name:" ",edit_yn:"Y"});for(var i=0;i<$.grdContact.getRowCount();i++){$.grdContact.setValue(i,"seq",i+1)}makeDetailPlaceList()}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnAppReq"){confirmBoxShow("해당 디테일링건에 대해 승인요청 하시겠습니까?",function(){if(g_main.msgShare==true){saveExtraFunction("ApprReq")}})}else{if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:$.memCPDescr.getValue(),approval_id:g_main.session.obj.UserID};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCPConfirm"){var share={save_mode:"CPCONFIRM",cp_descr:$.memCPDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnReject"){var share={save_mode:"MEMO",cp_descr:$.memMgrDescr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnUpload"){if($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"company_id")=="H99999999"){return}OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"file_path",ds.resultList[0][0].server_path);$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"file_name",ds.resultList[0][0].server_fname);$.grdContact.setValue($.grdContact.getSelectedRowIdx(),"upload_yn","Y")})}else{if(id=="btnBatchUpload"){if($.grdContact.getRowCount()<1){MessageBoxShow("고객이 추가 되어야 업로드가 가능합니다.");return}OpenPdfFileUploader("CPFiles",function(ds){hideToast();if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}if(ds.resultList[0]&&ds.resultList[0].length){var param="";$.popUpCallId="btnUpload";if(ds.resultList[0][0].file_type=="IMG"){var fileArray=ds.resultList[0];var imgUrlList=[],imgNameList=[];for(var i=0;i<fileArray.length;i++){imgUrlList.push(fileArray[i].file_url);imgNameList.push(fileArray[i].server_fname)}param={imgUrlList:imgUrlList,imgNameList:imgNameList,contactList:$.grdContact.getAllRows(),serverPath:fileArray[0].server_path}}else{var fileList=ds.resultList[0][0];param={imgUrlList:fileList.img_url_list,imgNameList:fileList.img_name_list,contactList:$.grdContact.getAllRows(),serverPath:fileList.server_path}}g_main.openPopup("popCPAgreementImgView.html","popCPAgreementImgView","",0,0,"","",param,"","")}})}else{if(id=="btnView"){if($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"upload_yn")=="Y"){g_fileBrowser.download(getServerFileUrl($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"file_path")+$.grdContact.getValue($.grdContact.getSelectedRowIdx(),"file_name")))}}}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbProduct"){$.cmbTheme.clear();if(value==""){return}var subQuery=" where theme_type = 'detail' and product_code ='"+$.cmbProduct.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0259",subQuery);setComboBind([$.cmbTheme],ds)}else{if(id=="cmbTheme"){searchTheme()}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdCard"){calcSupportAmt()}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnNew"){$.panInfo.clear();$.varCPId="";$.varWFDocId="";$.varCPCode="";$.varAppEmp="";$.varDeptCode=g_main.session.obj.DeptCode;$.varCPBeforeId="";$.panInfo.enableButton(["btnSave","btnTemp"]);$.grdContact.setData("");$.grdCard.setData("");$.grdEsero.setData("");$.cmbEmp.setValue(g_main.session.obj.UserID);$.cmbLeader.setValue($.varLeaderId);$.cmbStatus.setValue("10");$.dteReportDate.setValue(getToday(""));$.panContact.enableButton(["btnAdd","btnDelete"]);$.panCard.enableButton(["btnAdd","btnDelete"]);$.cmbPM.setEnable(true);$.cmbProduct.setEnable(true);$.cmbTheme.setEnable(true);$.cmbTime.setEnable(true);$.memAgenda.setEnable(true);$.memQnA.setEnable(true);$.memDesc.setEnable(true);$.cboFromHH.setValue("00");$.cboFromMM.setValue("00");$.imgPicture1.setValue(null);$.imgPicture2.setValue("");$.imgPicture3.setValue("");$.imgPicture4.setValue("");$.imgPicture1.setMode("N");$.imgPicture2.setMode("N");$.imgPicture3.setMode("N");$.imgPicture4.setMode("N");$.grdContact.addRow({seq:1,contact_id:g_main.session.obj.UserID,contact_name:g_main.session.obj.UserName,company_id:"H99999999",company_name:"한국아스텔라스제약",speciality:g_main.session.obj.DeptName,support_amt:0,support_amt2:0,upload_yn:"N",file_path:" ",file_name:" "})}else{if(btnId=="btnSave"){if(!validateControls([$.cmbProduct,$.cmbTheme,$.memDesc,$.memAgenda,$.memQnA,$.cboDetailPlace,$.txtMealPlace,$.cboFromHH,$.cboFromMM,$.rdoMessage1])){return}var pic_count=0;if(!$.imgPicture1.getValue()){pic_count++}if(!$.imgPicture2.getValue()){pic_count++}if(!$.imgPicture3.getValue()){pic_count++}if(!$.imgPicture4.getValue()){pic_count++}if(pic_count>3){MessageBoxShow("최소한 하나의 영수증 사진이<br>등록되어야 합니다.");return}if(!chkExpense()){MessageBoxShow("영수증 합계 금액과 지원금액의 총합이 일치하지 않습니다.");return}if(!akrMember()){MessageBoxShow("적어도 한명 이상의 자사 직원이 등록되어야 합니다.");return}if(!chkContactList()){MessageBoxShow("중복입력 된 고객이 있습니다. 확인하시기 바랍니다.");return}if(!chkContact()){MessageBoxShow("최소 1명 이상의 고객이 등록되어야 합니다.");return}if(!chkAggrementList()){MessageBoxShow("동의서가 첨부되지 않은 고객이 있습니다. 확인하시기 바랍니다.");return}if($.cboFromHH.getValue()=="00"||$.cboFromHH.getValue()==""){MessageBoxShow("개최 시간을 올바르게 입력해 주시기 바랍니다.");return}if($.rdoMessage1.getValue()==""){MessageBoxShow("병원에서 식사장소까지의 거리가 가이드라인과 일치하는 지 확인하시기 바랍니다.");return}if($.chkTime.getValue()=="Y"){if(!chkTimeZone()){MessageBoxShow("아침시간대는 인당 2만원 이하, 오전 6시~10시 사이의 영수증만 등록 가능합니다.");return}}if($.varCPBeforeId!=""){if($.varContactCnt!=$.varContactCnt2){MessageBoxShow("(사전), (사후) 고객의 숫자가 동일하지 않습니다.");return}}log($.varContactCnt);log($.varContactCnt2);if($.varCPBeforeId==""){MessageBoxShow("제품디테일링(사전)이 연결되지 않았습니다.");return}if($.varBillType=="Card"){for(var i=0;i<$.grdCard.getRowCount();i++){var strTemp1=$.grdCard.getValue(i,"APPDAT").substr(0,8);log(strTemp1);for(var j=i+1;j<$.grdCard.getRowCount();j++){var strTemp2=$.grdCard.getValue(j,"APPDAT").substr(0,8);if(strTemp1!=strTemp2){MessageBoxShow("법인카드의 승인일자는 동일해야합니다.");return}}}}if(saveDetailAfter($.varCPId==""?"N":"U")){MessageBoxShow("정상적으로 저장 되었습니다.");if(g_main.session.obj.UserID==$.cmbEmp.getValue()&&$.varWFDocId==""&&$.varCPId!=""){$.btnAppReq.setEnable(true)}}}else{if(btnId=="btnDelete"){if($.varCPId==""){return}confirmBoxShow("["+$.txtCPDocNo.getValue()+"] 제품디테일링(사후)을(를) 삭제하시겠습니까?",function(){if(g_main.msgShare==true){saveDetailAfter("D")}})}else{if(btnId=="btnTemp"){if($.varBillType=="Card"){for(var i=0;i<$.grdCard.getRowCount();i++){var strTemp1=$.grdCard.getValue(i,"APPDAT").substr(0,8);log(strTemp1);for(var j=i+1;j<$.grdCard.getRowCount();j++){var strTemp2=$.grdCard.getValue(j,"APPDAT").substr(0,8);if(strTemp1!=strTemp2){MessageBoxShow("법인카드의 승인일자는 동일해야합니다.");return}}}}if(saveDetailAfter($.varCPId==""?"NT":"UT")){MessageBoxShow("정상적으로 임시저장 되었습니다.")}}else{if(btnId=="btnLoad"){$.popUpCallId="btnLoad";var param={cp_type:"CP03",cp_case:"LIST"};g_main.openPopup("popCPBefore.html","popCPBefore","",0,0,"","",param,"","")}}}}}}else{if(panelId=="panContact"){if(btnId=="btnAdd"){$.popUpCallId="contact_btnAdd";var param={contact_name:"",check_yn:"Y",inquiry_type:"detail"};g_main.openPopup("popCPContact.html","popCPContact","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){if($.grdContact.getValue($.grdContact.getSelectedRowIdx(),"edit_yn")=="N"){MessageBoxShow("불러오기 한 고객은 삭제할 수 없습니다.");return}else{$.grdContact.deleteCurrentRow()}var contRow=$.grdContact.getAllRows();for(var i in contRow){contRow[i].seq=Number(i)+1}$.grdContact.selectRow(0);calcSupportAmt();makeDetailPlaceList()}}}else{if(panelId=="panCard"){if(btnId=="btnAdd"){$.popUpCallId="card_btnAdd";var param={};g_main.openPopup("popCardApprovalSub.html","popCardApprovalSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){if($.varBillType=="Card"){$.grdCard.deleteCurrentRow();if($.varCPBeforeId==""){$.dteStartDate.setValue("20"+$.grdCard.getValue(0,"APPDAT").substr(0,2)+$.grdCard.getValue(0,"APPDAT").substr(3,2)+$.grdCard.getValue(0,"APPDAT").substr(6,2))}}else{$.grdEsero.deleteCurrentRow()}calcSupportAmt()}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popCPContact"){if($.popUpCallId=="contact_btnAdd"){var popRows=popResult.popRows;for(var i in popRows){$.grdContact.addRow({seq:$.grdContact.getRowCount()>0?$.grdContact.getValue($.grdContact.getRowCount()-1,"seq")+1:1,contact_id:popRows[i].contact_id,contact_name:popRows[i].contact_name,company_id:popRows[i].company_id,company_name:popRows[i].company_name,speciality:popRows[i].speciality,support_amt:0,support_amt2:0,upload_yn:"N",file_path:" ",file_name:" ",edit_yn:"Y",})}calcSupportAmt();makeDetailPlaceList()}}else{if(id=="popCPBefore"){if($.popUpCallId=="btnLoad"){var rs=popResult.rs;$.varCPBeforeId=rs.cp_id;$.dteStartDate.setValue(rs.cp_start_date);$.varContactCnt=rs.contact_cnt;if($.varCPBeforeId!=""){searchContact()}}}else{if(id=="popCardApprovalSub"){if($.popUpCallId=="card_btnAdd"){var rs=popResult;if($.varBillType=="Card"){for(var i in rs){$.grdCard.addRow({receipt_type:"10",APPRNO:rs[i].APPRNO,APPDAT:rs[i].APPDAT,APPAMT:rs[i].APPAMT,VENKNM:rs[i].VENKNM,CARDNO:rs[i].CARDNO,VENADD:rs[i].VENADD,VENGRP:rs[i].VENGRP,EMPNO:rs[i].EMPNUM})}if($.varCPBeforeId==""){$.dteStartDate.setValue("20"+$.grdCard.getValue(0,"APPDAT").substr(0,2)+$.grdCard.getValue(0,"APPDAT").substr(3,2)+$.grdCard.getValue(0,"APPDAT").substr(6,2))}}else{if($.varBillType=="Esero"){for(var i in rs){$.grdEsero.addRow({apprno:rs[i].APPRNO,appdat:rs[i].APPDAT,appamt:rs[i].APPAMT,bizname:rs[i].BIZNAME,product:rs[i].PRODUCT,product1:rs[i].PRODUCT1})}$.dteStartDate.setValue($.grdEsero.getValue(0,"appdat"))}}calcSupportAmt()}}else{if(id=="popCPAgreementImgView"){webix.alert({ok:"확인",text:'동의서에 대한 의료인 연결이 완료 되었습니다.<br>실제 동의서는 "저장"시에 최종 저장됩니다.',width:"290px"});var dt=popResult.saveContactList;if(dt.length){for(var i=0;i<dt.length;i++){for(var j=0;j<$.grdContact.getRowCount();j++){var rowData=$.grdContact.getValue(j);if(dt[i].contactId==rowData.contact_id){$.grdContact.setValue(j,"file_path",dt[i].serverPath);$.grdContact.setValue(j,"file_name",dt[i].fileName);$.grdContact.setValue(j,"upload_yn","Y")}}}}}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>