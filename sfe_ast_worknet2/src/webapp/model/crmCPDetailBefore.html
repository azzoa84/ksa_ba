<script>function Main(){var $=this;$.host=null;$.panMain=null;$.lblemployee=null;$.cboemployee=null;$.lblcp_id=null;$.lblcp_doc_no=null;$.txtcp_id=null;$.txtcp_doc_no=null;$.lblcreate_date=null;$.dtdcreate_date=null;$.panBase=null;$.panList=null;$.grdList=null;$.panBottom=null;$.btnConfirm=null;$.btnCancel=null;$.cboStatus=null;$.lblStatus=null;$.lblcp_start_date=null;$.lblcp_time_zone=null;$.dtecp_start_date=null;$.comcp_time_zone=null;$.lblLeader=null;$.cmbLeader=null;$.varCPId="";$.varCPCode="";$.varWFDocId="";$.varCPDocNo="";$.varModify="";$.varLeaderId="";function createJSON_S(workType){if($.grdList.getRowCount()<=0){MessageBoxShow("등록 된 참석자가 존재하지 않습니다.");return}var com_id="",con_id="";var contactRow=$.grdList.getAllRows();for(var i in contactRow){com_id+=(com_id?",":"")+contactRow[i].company_id||" ";con_id+=(con_id?",":"")+contactRow[i].contact_id||" "}var json=createExecuteParamInfo("P_crmCPDetailBefore_S",[workType,$.varCPId||"",$.varCPDocNo||"",$.cboemployee.getValue(),$.dtecp_start_date.getValue(),$.comcp_time_zone.getValue(),com_id,con_id,g_main.session.obj.UserID,g_main.session.obj.DeptCode]);return json}function saveDetailBefore(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$,false)}}function clearInfo(){$.panBase.clear();$.varCPId="";$.varCPDocNo="";$.grdList.setData("");setControlEnable(true);setAllowBlank();$.cboemployee.setValue(g_main.session.getValue("EmpCode"));$.dtdcreate_date.setValue(getToday(""));$.cboStatus.setValue("10");$.cmbLeader.setValue($.varLeaderId)}function setControlEnable(bo){$.txtcp_id.setReadOnly(true);$.cboemployee.setEnable(false);$.cmbLeader.setEnable(false);$.dtdcreate_date.setEnable(false);$.cboStatus.setEnable(false)}function setAllowBlank(){$.cmbLeader.setAllowBlank(false,"영업소장");$.cboemployee.setAllowBlank(false,"담당자");$.dtecp_start_date.setAllowBlank(false,"진행일자");$.comcp_time_zone.setAllowBlank(false,"시간대")}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,600);$.panMain.setText("제품디테일링(사전)");$.panMain.setBottomLine(true);$.lblemployee=new FingerLabel(host,"lblemployee",0,50,100,20);$.lblemployee.setText("담당자");$.cboemployee=new FingerComboBox(host,"cboemployee",100,50,140,20);$.lblcp_id=new FingerLabel(host,"lblcp_id",0,20,100,20);$.lblcp_id.setText("CP번호");$.lblcp_doc_no=new FingerLabel(host,"lblcp_doc_no",800,50,100,20);$.lblcp_doc_no.setText("CP문서번호");$.txtcp_id=new FingerEdit(host,"txtcp_id",100,20,155,20);$.txtcp_doc_no=new FingerEdit(host,"txtcp_doc_no",900,50,50,20);$.lblcreate_date=new FingerLabel(host,"lblcreate_date",650,20,100,20);$.lblcreate_date.setText("등록일자");$.dtdcreate_date=new FingerDateEdit(host,"dtdcreate_date",755,20,140,20);$.panBase=new FingerPanel(host,"panBase",0,0,1200,120);$.panBase.setText("");$.panBase.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,120,1200,350);$.panList.setText("참석자");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,300);$.panBottom=new FingerPanel(host,"panBottom",0,480,1200,60);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.btnConfirm=new FingerButton(host,"btnConfirm",10,10,120,40);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",170,10,120,40);$.btnCancel.setText("승인취소");$.cboStatus=new FingerComboBox(host,"cboStatus",1005,20,145,20);$.lblStatus=new FingerLabel(host,"lblStatus",900,20,100,20);$.lblStatus.setText("승인상태");$.lblcp_start_date=new FingerLabel(host,"lblcp_start_date",650,50,100,20);$.lblcp_start_date.setText("실시일자");$.lblcp_time_zone=new FingerLabel(host,"lblcp_time_zone",900,50,100,20);$.lblcp_time_zone.setText("시간대");$.dtecp_start_date=new FingerDateEdit(host,"dtecp_start_date",755,50,140,20);$.comcp_time_zone=new FingerComboBox(host,"comcp_time_zone",1005,50,140,20);$.lblLeader=new FingerLabel(host,"lblLeader",300,50,100,20);$.lblLeader.setText("영업소장");$.cmbLeader=new FingerComboBox(host,"cmbLeader",400,50,140,20);$.lblcp_doc_no.setVisible(false);$.txtcp_doc_no.setVisible(false);$.cmbLeader.setReadOnly(true);$.cboemployee.setReadOnly(true);$.txtcp_id.setReadOnly(true);$.dtdcreate_date.setReadOnly(true);$.dtdcreate_date.setValue(getToday(""));$.panMain.addButtons(["btnDelete","btnSave","btnNew"]);$.panList.setBorder(true);$.panList.addButtons(["btnDelete","btnAdd"]);$.grdList.setColumns([new FingerDataGridColumn("row_num",55,"center","string","순번",{readonly:true}),new FingerDataGridColumn("company_id",99,"left","string","소속기관아이디",{hidden:true}),new FingerDataGridColumn("company_name",300,"left","string","소속기관/병원",{readonly:true}),new FingerDataGridColumn("speciality_code",99,"left","string","진료과목코드",{hidden:true}),new FingerDataGridColumn("speciality",200,"left","string","부서/진료과목",{readonly:true}),new FingerDataGridColumn("contact_id",99,"left","string","고객아이디",{hidden:true}),new FingerDataGridColumn("contact_name",130,"center","string","고객명",{readonly:true}),new FingerDataGridColumn("detail_before_cnt",110,"center","int","계획 횟수",{format:"int",readonly:true}),new FingerDataGridColumn("detail_cnt3",110,"center","int","실행 횟수",{format:"int",readonly:true})]);$.grdList.init({panel:$.panList,scroll:"y",footer:false});$.grdList.setEditable(true);$.grdList.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panBase);$.panMain.add($.panList);$.panMain.add($.panBottom);$.panBase.add($.lblemployee);$.panBase.add($.cboemployee);$.panBase.add($.lblcp_id);$.panBase.add($.lblcp_doc_no);$.panBase.add($.txtcp_id);$.panBase.add($.txtcp_doc_no);$.panBase.add($.lblcreate_date);$.panBase.add($.dtdcreate_date);$.panBase.add($.cboStatus);$.panBase.add($.lblStatus);$.panBase.add($.lblcp_start_date);$.panBase.add($.lblcp_time_zone);$.panBase.add($.dtecp_start_date);$.panBase.add($.comcp_time_zone);$.panBase.add($.lblLeader);$.panBase.add($.cmbLeader);$.panList.add($.grdList);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnCancel);$.cmbLeader.setEmptyRow(false);$.cboemployee.setEmptyRow(false);$.cmbLeader.setColumn("line1empno","line1empname");$.cboemployee.setColumn("employee_id","emp_name");var ds=bizComponentData2($,"Q1","L_CRM0052|L_CRM0111|L_COM024");setComboBind([$.cboemployee,$.cboStatus,$.comcp_time_zone],ds);$.cboemployee.setValue(g_main.session.obj.UserID);if(g_main.session.obj.UserID!="AKR-A00001"){var ds2=bizComponentData2($,"Q3","L_CRM0108","","",g_main.session.obj.UserID);setComboBind([$.cmbLeader],ds2);$.varLeaderId=ds2.resultList[0][0].line1empno;$.cmbLeader.setValue($.varLeaderId)}else{var ds2=bizComponentData2($,"Q3","L_CRM0108","","","ka110192");setComboBind([$.cmbLeader],ds2);$.varLeaderId=ds2.resultList[0][0].line1empno;$.cmbLeader.setValue($.varLeaderId)}clearInfo();if($.p_argument&&$.p_argument.length>0){var ds=bizComponentData2($,"Q3","L_CRM0108");setComboBind([$.cmbLeader],ds);var rs=$.p_argument[0][0];$.varCPId=rs.cp_id;$.varCPDocNo=rs.cp_doc_no;$.varPopupType="Y";$.varCPCode=rs.cp_type;$.varWFDocId=rs.wf_doc_id;$.txtcp_id.setValue(rs.cp_id);$.txtcp_doc_no.setValue(rs.cp_doc_no);$.cboemployee.setValue(rs.cp_emp_id);$.cboStatus.setValue(rs.cp_status);$.cmbLeader.setValue(rs.team_leader);$.dtecp_start_date.setValue(rs.dm_start_date);$.comcp_time_zone.setValue(rs.dm_time);$.dtdcreate_date.setValue(rs.create_time);setAllowBlank();setDataGrid([$.grdList],$.p_argument[1],true);if(rs.Confirm){$.panBottom.setVisible(true);setControlEnable(true)}else{$.panBottom.setVisible(false);setControlEnable(false)}if(rs.save_yn!="Y"){setControlEnable(false);if($.cboemployee.getValue()!=g_main.session.obj.UserID){$.panList.disableButton(["btnAdd","btnDelete"]);$.panMain.disableButton(["btnDelete","btnSave","btnNew"]);$.dtecp_start_date.setReadOnly(true);$.comcp_time_zone.setReadOnly(true)}if(rs.extra_field1=="Y"){$.panList.disableButton(["btnAdd","btnDelete"]);$.panMain.disableButton(["btnDelete","btnSave","btnNew"]);$.dtecp_start_date.setReadOnly(true);$.comcp_time_zone.setReadOnly(true)}}else{setControlEnable(true)}if(rs.cp_status=="05"&&g_main.session.obj.DutyCode!="09"){$.panBottom.setVisible(true);$.btnConfirm.setEnable(true)}else{if(rs.cp_status=="90"){$.btnConfirm.setEnable(false);$.btnCancel.setEnable(true)}}}else{clearInfo();$.panBottom.setVisible(false)}};$.callback=function(type,ds){if(type=="N"){$.varCPId=ds.returnStr;$.txtcp_doc_no.setValue(ds.returnStr);$.txtcp_id.setValue($.varCPId);MessageBoxShow("정상적으로 저장되었습니다.")}else{if(type=="U"){MessageBoxShow("정상적으로 수정되었습니다.")}else{if(type=="D"){if(ds.errorCode=="crmCPDetailBefore_001"){MessageBoxShow("제품디테일링(사후)와 연동되어 삭제가 불가능합니다.");return}var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:""};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:""};g_popupStack.setData(share);g_popupStack.close()}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cbodept"){var strQuery=" and dept_code = '"+$.cbodept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery,"","");$.cboemployee.clear();$.cboemployee.setColumn("employee_id","emp_name");setComboBind([$.cboemployee],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnAdd"){if($.dtecp_start_date.getValue()==""||$.comcp_time_zone.getValue()==""){MessageBoxShow("진행일자 및 시간대가 선택되어야 합니다.");return}$.popUpCallId="contact_btnAdd";var param={contact_name:"",check_yn:"Y",inquiry_type:"plan"};g_main.openPopup("popCPContact.html","popCPContact","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){$.grdList.deleteCurrentRow();var contRow=$.grdList.getAllRows();for(var i in contRow){contRow[i].seq=Number(i)+1}$.grdList.selectRow(0)}}}else{if(panelId=="panMain"){if(btnId=="btnNew"){clearInfo()}else{if(btnId=="btnSave"){var workType=($.varCPId?"U":"N");saveDetailBefore(workType)}else{if(btnId=="btnDelete"){saveDetailBefore("D")}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popCPContact"){if($.popUpCallId=="contact_btnAdd"){var popRows=popResult.popRows;for(var i in popRows){if(popRows[i].contact_id.substr(0,2)=="ka"){MessageBoxShow("자사직원 등록은 불가능합니다.");continue}$.grdList.addRow({row_num:$.grdList.getRowCount()>0?$.grdList.getValue($.grdList.getRowCount()-1,"row_num")+1:1,contact_id:popRows[i].contact_id,contact_name:popRows[i].contact_name,company_id:popRows[i].company_id,company_name:popRows[i].company_name,speciality:popRows[i].speciality,detail_before_cnt:popRows[i].detail_before_cnt,detail_cnt3:popRows[i].detail_cnt})}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>