<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTop=null;$.lblDate=null;$.dteStartDate=null;$.lblEx1=null;$.lblInst=null;$.txtInst=null;$.btnSearch=null;$.dteEndDate=null;$.panButtonGroup=null;$.panProvideSample=null;$.panSymp=null;$.panClinic=null;$.panProductMulti=null;$.panProductSingle=null;$.panPms=null;$.grdProvideSample=null;$.grdSymp=null;$.grdClinic=null;$.grdProductMulti=null;$.grdProductSingle=null;$.grdPms=null;$.cmbProvideSample=null;$.htmlProvideSampleButton=null;$.htmlSympButton=null;$.htmlClinicButton=null;$.htmlProductMultiButton=null;$.htmlProductSingleButton=null;$.htmlPmsButton=null;$.lblHcp=null;$.txtHcp=null;$.cmbSymp=null;$.cmbClinic=null;$.cmbProductMulti=null;$.cmbProductSingle=null;$.cmbPms=null;$.htmlIdList=[];$.buttonNameList=["견본품 제공","학술대회지원","임상시험지원","복수 대상 제품설명회","개별 대상 제품설명회","시판 후 조사"];$.isSearch=false;$.session=g_main.session.obj;function createJson_Q(workType){var json=createExecuteParamInfo("P_crmCPExpenseReportSubmit_Q",[workType,"#DeptCode#","#UserID#",(workType=="Q_COUNT"?"":$.varCategory),$.dteStartDate.getValue(),$.dteEndDate.getValue(),$.txtHcp.getValue(),$.txtInst.getValue(),(workType=="Q_DOWNLOAD"?getFileCategory($.varCategory):(workType=="Q_DOWNLOAD2"?getFileCategory($.varCategory):""))]);return json}function createJSON_Q32(loadQuery){if(loadQuery=="P_crmCPDetailAfter_Q"){var json=createExecuteParamInfo(loadQuery,["Q",$.grdProductSingle.getValue($.grdProductSingle.getSelectedRowIdx(),"cp_id")])}else{if(loadQuery=="P_crmCPSeminarAfter_Q"){var json=createExecuteParamInfo(loadQuery,["Q",$.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"cp_id"),"#UserID#"])}else{if(loadQuery=="P_crmCPSeminarStayAfter_Q"){var json=createExecuteParamInfo(loadQuery,["Q",$.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"cp_id"),"#UserID#"])}else{if(loadQuery=="P_crmCPSympAttendBef_Q"){var json=createExecuteParamInfo(loadQuery,["Q",$.grdSymp.getValue($.grdSymp.getSelectedRowIdx(),"cp_id"),"#UserID#"])}else{if(loadQuery=="P_crmCPSympAttendAft_Q"){var json=createExecuteParamInfo(loadQuery,["Q",$.grdSymp.getValue($.grdSymp.getSelectedRowIdx(),"cp_id"),"#UserID#"])}}}}}return json}function searchList(workType){if(!$.panTop.validateControls()){return}var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function searchList2(){if(!$.panTop.validateControls()){return}var json=createJson_Q("Q_DOWNLOAD2");callQuery(["req",json],"Q_DOWNLOAD2",$)}function setVisiblePanel(type){var panelIdList=[$.panProvideSample,$.panSymp,$.panClinic,$.panProductMulti,$.panProductSingle,$.panPms];for(var i=0;i<panelIdList.length;i++){panelIdList[i].setVisible(false)}if(type){panelIdList[type-1].setVisible(true)}}function panelButtonSettings(){var panelIdList=[$.panProvideSample,$.panSymp,$.panClinic,$.panProductMulti,$.panProductSingle,$.panPms];for(var i=0;i<panelIdList.length;i++){panelIdList[i].addButton("btnExcelDown","엑셀다운로드");panelIdList[i].setButtonAction("btnExcelDown","excel_down");panelIdList[i].addButton("btnDownLoad","근거자료 일괄 다운로드");panelIdList[i].setButtonAction("btnDownLoad","custom",160)}}function setHtmlButtonStyle(cntList){$.htmlIdList=[$.htmlProvideSampleButton,$.htmlSympButton,$.htmlClinicButton,$.htmlProductMultiButton,$.htmlProductSingleButton,$.htmlPmsButton];for(var i=0;i<$.htmlIdList.length;i++){$.htmlIdList[i].setButtonMode(true);$.htmlIdList[i].setStyle("text-align","center");$.htmlIdList[i].setStyle("font-size","14px");$.htmlIdList[i].setStyle("background","#da1e48");$.htmlIdList[i].setStyle("color","white");$.htmlIdList[i].setStyle("box-shadow","2px 2px 5px 3px #bbb");$.htmlIdList[i].setStyle("font-weight","normal");$.htmlIdList[i].setStyle("border","0");if(cntList&&cntList.length){$.htmlIdList[i].setHTML($.buttonNameList[i]+"<br>("+cntList[i]+")");$.htmlIdList[i].setStyle("line-height","24px")}else{$.htmlIdList[i].setHTML($.buttonNameList[i]);$.htmlIdList[i].setStyle("line-height","49px")}}}function getHtmlIdListIndex(id){if(id=="htmlProvideSampleButton"){$.grdProvideSample.clear();return[0,"SAMPLE"]}else{if(id=="htmlSympButton"){$.grdSymp.clear();return[1,"SYMPOSIUM"]}else{if(id=="htmlClinicButton"){$.grdClinic.clear();return[2,"CLINIC_TEST"]}else{if(id=="htmlProductMultiButton"){$.grdProductMulti.clear();return[3,"DM_SEMINAR_MULTI"]}else{if(id=="htmlProductSingleButton"){$.grdProductSingle.clear();return[4,"DM_SEMINAR_SINGLE"]}else{$.grdPms.clear();return[5,"PMS"]}}}}}}function getClinicData(rs){if(rs.length){var data=rs;var afterData=[];var obj={};var before_no="";var study_main_name="",study_main_company="";var row_cnt=1,rnum=0;var approveNo=[],mainNameList=[],mainCompanyList=[];for(var index=0;index<data.length;index++){var changeObj={};var bo=true;if(before_no==data[index].study_no){}else{row_cnt=1;rnum++;before_no=data[index].study_no;approveNo.push(before_no)}if(data[index].study_main_yn=="Y"){study_main_name=data[index].contact_name;study_main_company=data[index].company_name;mainNameList.push(study_main_name);mainCompanyList.push(study_main_company);bo=false;changeObj.rnum=rnum;changeObj.study_name=data[index].study_name;changeObj.study_type=data[index].study_type;changeObj.study_approve_no=data[index].study_approve_no;changeObj.study_approve_date=data[index].study_approve_date;changeObj.main_contact_name=study_main_name;changeObj.main_company_name=study_main_company;changeObj.contact_name="";changeObj.company_name="";changeObj.study_total_amt=data[index].study_total_amt;changeObj.product_name=data[index].product_name;changeObj.product_qty=data[index].product_qty;changeObj.contract_date=data[index].contract_date;changeObj.study_no=data[index].study_no;changeObj.create_user=data[index].create_user;changeObj.row_cnt=row_cnt;changeObj.tot_cnt=data[index].tot_cnt;bo=true}else{changeObj.rnum=rnum;changeObj.study_name=data[index].study_name;changeObj.study_type=data[index].study_type;changeObj.study_approve_no=data[index].study_approve_no;changeObj.study_approve_date=data[index].study_approve_date;changeObj.main_contact_name="";changeObj.main_company_name="";changeObj.contact_name=data[index].contact_name||"";changeObj.company_name=data[index].company_name||"";changeObj.study_total_amt=data[index].study_total_amt;changeObj.product_name=data[index].product_name;changeObj.product_qty=data[index].product_qty;changeObj.contract_date=data[index].contract_date;changeObj.study_no=data[index].study_no;changeObj.create_user=data[index].create_user;changeObj.row_cnt=row_cnt;changeObj.tot_cnt=data[index].tot_cnt-1}row_cnt++;if(bo){afterData.push(changeObj)}}for(var index=0;index<afterData.length;index++){var rowData=afterData[index];for(var cnt=0;cnt<approveNo.length;cnt++){if(rowData.study_approve_no==approveNo[cnt]){rowData.main_contact_name=mainNameList[cnt];rowData.main_company_name=mainCompanyList[cnt]}}if(rowData.tot_cnt==1&&row_cnt!=1){rowData.row_cnt=1}}return afterData}else{return[]}}function customExcelDown(fileName){var cols=$.grdClinic.getColumnms();var xlsCols=[];for(var i in cols){xlsCols.push({header:cols[i].header,datatype:cols[i].type,datafield:cols[i].id,width:(cols[i].width+"px"),ishidden:(cols[i].excelHidden===true?true:(cols[i].hidden?true:false)),docNum:(cols[i].docNum?true:false),instId:(cols[i].instId?true:false)})}var result="<table id='cprReportTable'>";result+="<thead>";var colRows=[];jQuery(xlsCols).each(function(key,value){if(this.ishidden!=true&&this.headerHidden!=true){if(this.header&&Array.isArray(this.header)){for(var i in this.header){if(!colRows[i]){colRows[i]=[]}if(i==0&&this.header[i]){this.header[i].width=this.width}colRows[i].push(this.header[i])}}}});for(var i in colRows){result+="<tr>";for(var j in colRows[i]){var header=colRows[i][j];if(header==null){continue}var colspan=header.colspan;var rowspan=header.rowspan;result+="<th";if(colspan>0){result+=" colspan = '"+colspan+"' "}else{if(rowspan>0){result+=" rowspan = '"+rowspan+"' "}}if(i==0&&header.width){if(colspan>0){header.width=(Number(unmask(header.width))*colspan)+"px"}result+=" style='width: "+header.width+"'"}result+=">";if(header.text){result+=checkTag(header.text)}result+="</th>"}result+="</tr>"}result+="</thead><tbody>";var tableData=$.grdClinic.getAllRows();var rowCnt=1,totCnt=1;for(var i=0;i<tableData.length;i++){result+="<tr>";rowCnt=tableData[i].row_cnt;totCnt=tableData[i].tot_cnt;for(var j=0;j<xlsCols.length;j++){if(!xlsCols[j].ishidden){var isStyle=false;if(xlsCols[j].width!=null){isStyle=true}if(xlsCols[j].datafield!="contact_name"&&xlsCols[j].datafield!="company_name"){if(rowCnt==1){result+="<td rowspan='"+totCnt+"'"}else{continue}}else{result+="<td"}if(xlsCols[j].datatype!=null){if(xlsCols[j].datatype=="int"){result+=" class='mso_number_format' "}if(xlsCols[j].docNum){result+=" class='mso_number_string' "}if(xlsCols[j].instId){result+=" class='mso_zero_string' "}}if(isStyle){result+=' style="'}if(xlsCols[j].width!=null){result+=" width: "+xlsCols[j].width+";"}if(isStyle){result+='"'}result+=">";result+=tableData[i][xlsCols[j].datafield];result+="</td>"}}result+="</tr>"}result+="</tbody>";result+="</table>";excelexportjs({containerid:"dvtable",datatype:"tablecss",dataset:result,worksheetName:"Sheet1",tableBorder:true,xlsFileName:(fileName||"다운로드")})}function checkTag(value){if(value.substr(0,4)=="<br>"){return value.substr(4)}return value}function getFileCategory(category){if(!category){return""}if(category=="SAMPLE"){return $.cmbProvideSample.getValue()||""}else{if(category=="SYMPOSIUM"){return $.cmbSymp.getValue()||""}else{if(category=="CLINIC_TEST"){return $.cmbClinic.getValue()||""}else{if(category=="DM_SEMINAR_MULTI"){return $.cmbProductMulti.getValue()||""}else{if(category=="DM_SEMINAR_SINGLE"){return $.cmbProductSingle.getValue()||""}else{if(category=="PMS"){return $.cmbPms.getValue()||""}}}}}}}function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function createProcessCprFile(cate){if(!$.panTop.validateControls()){return}var params={category:cate,cp_date_fr:$.dteStartDate.getValue(),cp_date_to:$.dteEndDate.getValue(),contact_name:$.txtHcp.getValue()||"",company_name:$.txtInst.getValue()||"",file_category:getFileCategory($.varCategory)};fileZipDownload(params)}function searchCP(loadQuery){var json=createJSON_Q32(loadQuery);return callQuerySync(["req",json],"Q")}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1000);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTop=new FingerPanel(host,"panTop",0,0,1200,55);$.panTop.setText("");$.panTop.setBottomLine();$.lblDate=new FingerLabel(host,"lblDate",0,15,100,20);$.lblDate.setText("기간");$.dteStartDate=new FingerDateEdit(host,"dteStartDate",105,15,140,20);$.lblEx1=new FingerLabel(host,"lblEx1",245,15,20,20);$.lblEx1.setText("~");$.lblInst=new FingerLabel(host,"lblInst",435,15,100,20);$.lblInst.setText("요양기관");$.txtInst=new FingerEdit(host,"txtInst",540,15,185,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.dteEndDate=new FingerDateEdit(host,"dteEndDate",270,15,140,20);$.panButtonGroup=new FingerPanel(host,"panButtonGroup",0,65,1200,70);$.panButtonGroup.setText("");$.panButtonGroup.setBottomLine(true);$.panProvideSample=new FingerPanel(host,"panProvideSample",0,145,1200,840);$.panProvideSample.setText("견본품 제공");$.panProvideSample.setBottomLine(true);$.panSymp=new FingerPanel(host,"panSymp",0,145,1200,840);$.panSymp.setText("학술대회지원");$.panSymp.setBottomLine(true);$.panClinic=new FingerPanel(host,"panClinic",0,145,1200,840);$.panClinic.setText("임상시험지원");$.panClinic.setBottomLine(true);$.panProductMulti=new FingerPanel(host,"panProductMulti",0,145,1200,840);$.panProductMulti.setText("복수 요양기관 대상 제품설명회");$.panProductMulti.setBottomLine(true);$.panProductSingle=new FingerPanel(host,"panProductSingle",0,145,1200,840);$.panProductSingle.setText("개별 요양기관 대상 제품설명회");$.panProductSingle.setBottomLine(true);$.panPms=new FingerPanel(host,"panPms",0,145,1200,840);$.panPms.setText("시판 후 조사");$.panPms.setBottomLine(false);$.grdProvideSample=new FingerDataGrid(host,"grdProvideSample",0,0,1200,795);$.grdSymp=new FingerDataGrid(host,"grdSymp",0,0,1200,795);$.grdClinic=new FingerDataGrid(host,"grdClinic",0,0,1200,795);$.grdProductMulti=new FingerDataGrid(host,"grdProductMulti",0,0,1200,795);$.grdProductSingle=new FingerDataGrid(host,"grdProductSingle",0,0,1200,795);$.grdPms=new FingerDataGrid(host,"grdPms",0,0,1200,795);$.cmbProvideSample=new FingerComboBox(host,"cmbProvideSample",590,-37.5,270,20);$.htmlProvideSampleButton=new FingerHTMLView(host,"htmlProvideSampleButton",43,10,170,50);$.htmlSympButton=new FingerHTMLView(host,"htmlSympButton",233,10,170,50);$.htmlClinicButton=new FingerHTMLView(host,"htmlClinicButton",423,10,170,50);$.htmlProductMultiButton=new FingerHTMLView(host,"htmlProductMultiButton",613,10,170,50);$.htmlProductSingleButton=new FingerHTMLView(host,"htmlProductSingleButton",803,10,170,50);$.htmlPmsButton=new FingerHTMLView(host,"htmlPmsButton",993,10,170,50);$.lblHcp=new FingerLabel(host,"lblHcp",700,15,100,20);$.lblHcp.setText("고객");$.txtHcp=new FingerEdit(host,"txtHcp",805,15,140,20);$.cmbSymp=new FingerComboBox(host,"cmbSymp",590,-37.5,270,20);$.cmbClinic=new FingerComboBox(host,"cmbClinic",590,-37.5,270,20);$.cmbProductMulti=new FingerComboBox(host,"cmbProductMulti",590,-37.5,270,20);$.cmbProductSingle=new FingerComboBox(host,"cmbProductSingle",590,-37.5,270,20);$.cmbPms=new FingerComboBox(host,"cmbPms",590,-37.5,270,20);$.panTop.setBorder(true);$.dteStartDate.setAllowBlank(false,"시작일");$.dteEndDate.setAllowBlank(false,"종료일");$.cmbProvideSample.setEmptyRow(true);$.cmbSymp.setEmptyRow(true);$.cmbClinic.setEmptyRow(true);$.cmbProductMulti.setEmptyRow(true);$.cmbProductSingle.setEmptyRow(true);$.cmbPms.setEmptyRow(true);$.grdProvideSample.colIdx=$.grdProvideSample.setColumns([new FingerDataGridColumn("rnum",60,"right","int","①연번",{format:"int",bordeCss:true}),new FingerDataGridColumn("company_name",213,"left","string",[{text:"요양기관 정보",colspan:2},"②기관명칭"],{bordeCss:true}),new FingerDataGridColumn("ykiho",120,"left","string",["","③요양기관기호"],{bordeCss:true}),new FingerDataGridColumn("product_name",250,"left","string",[{text:"의약품 정보",colspan:5},"④제품명<br>(표준코드명칭)"],{bordeCss:true}),new FingerDataGridColumn("product_code",120,"left","string",["","⑤표준코드<br>(제품코드)"],{bordeCss:true,docNum:true}),new FingerDataGridColumn("product_unit",100,"right","int",["","⑥포장 내<br>총수량(규격)"],{format:"int",bordeCss:true}),new FingerDataGridColumn("product_qty",100,"right","int",["","⑦제공수량"],{format:"int",bordeCss:true}),new FingerDataGridColumn("total_qty",100,"right","int",["","⑧계<br>(⑥×⑦)"],{format:"int",bordeCss:true}),new FingerDataGridColumn("seminar_date",120,"left","string","⑨제공일자",{bordeCss:true}),new FingerDataGridColumn("contact_name",100,"left","string","고객명",{bordeCss:true}),new FingerDataGridColumn("create_user",100,"left","string","담당자",{bordeCss:true}),new FingerDataGridColumn("cp_id",150,"left","string","관리번호"),new FingerDataGridColumn("delivery_form",60,"center","string","인수증",{isLink:true}),new FingerDataGridColumn("delivery_form_path",0,"left","string","동의서경로",{hidden:true})]);$.grdProvideSample.init({panel:$.panProvideSample,scroll:"xy",headerRowHeight:40,nonExcel:true});$.grdProvideSample.setBorder(false);$.grdSymp.colIdx=$.grdSymp.setColumns([new FingerDataGridColumn("rnum",60,"right","int","①연번",{format:"int",bordeCss:true}),new FingerDataGridColumn("symposium_host",200,"left","string",[{text:"학술대회 정보",colspan:4},"②주최기관"],{bordeCss:true}),new FingerDataGridColumn("symposium_title",350,"left","string",["","③대회명칭"],{bordeCss:true}),new FingerDataGridColumn("symposium_place",200,"left","string",["","④대회장소"],{bordeCss:true}),new FingerDataGridColumn("symposium_date",200,"left","string",["","⑤대회일시"],{bordeCss:true}),new FingerDataGridColumn("symposium_amt",120,"right","int","⑥지원금액",{format:"int",bordeCss:true}),new FingerDataGridColumn("create_user",100,"left","string","담당자",{bordeCss:true}),new FingerDataGridColumn("payment_date",100,"center","string","지급일자",{bordeCss:true}),new FingerDataGridColumn("wf_doc_id",150,"left","string","기안문서번호",{bordeCss:true}),new FingerDataGridColumn("expense_type",150,"left","string","지급유형",{hidden:true}),new FingerDataGridColumn("cp_id",120,"left","string","관리번호",{isLink:true})]);$.grdSymp.init({panel:$.panSymp,scroll:"xy",headerRowHeight:40,nonExcel:true});$.grdSymp.setBorder(false);$.grdClinic.colIdx=$.grdClinic.setColumns([new FingerDataGridColumn("rnum",60,"center","int","①연번",{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_name",190,"left","string",[{text:"임상시험정보",colspan:4},"②명칭"],{multiLine:true,verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_type",80,"left","string",["","③구분"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_approve_no",120,"left","string",["","④승인번호"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_approve_date",120,"left","string",["","⑤승인일자"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("main_contact_name",100,"left","string",[{text:"임상시험책임자",colspan:2},"⑥성명"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("main_company_name",120,"left","string",["","⑦소속"],{multiLine:true,verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("contact_name",100,"left","string",[{text:"공동연구자",colspan:2},"⑧성명"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("company_name",120,"left","string",["","⑨소속"],{multiLine:true,verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_total_amt",90,"right","int",[{text:"지원내역",colspan:3},"⑩연구비"],{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("product_name",120,"left","string",["",{text:"의약품",colspan:2},"⑪제품명"],{multiLine:true,verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("product_qty",90,"right","float",["","","⑫수량"],{format:"float",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("contract_date",90,"left","string","⑮계약일",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("create_user",120,"center","string","담당자",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("study_no",150,"center","string","AKR 연구관리번호",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("row_cnt",100,"left","string","",{hidden:true}),new FingerDataGridColumn("tot_cnt",100,"left","string","",{hidden:true}),new FingerDataGridColumn("cp_id",150,"left","string","관리번호",{hidden:true})]);$.grdClinic.init({panel:$.panClinic,scroll:"xy",headerRowHeight:40,nonExcel:true,rowHeight:100});$.grdClinic.setBorder(false);$.grdProductMulti.colIdx=$.grdProductMulti.setColumns([new FingerDataGridColumn("rnum",60,"right","int","①연번",{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("product_name",140,"left","string","<br>②제품명<br>(표준코드명칭)",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("contact_name",100,"left","string",[{text:"의료인 정보",colspan:2},"③성명"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("company_name",150,"left","string",["","④소속"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("trans_amt",100,"right","int",[{text:"의약품 정보",colspan:4},"⑤교통비"],{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("gift_amt",100,"right","int",["","⑥기념품비"],{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("stay_amt",100,"right","int",["","⑦숙박비"],{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("meal_amt",100,"right","int",["","⑧식음료비"],{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("seminar_place",173,"left","string","⑨장소",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("seminar_date",230,"left","string","⑩일시",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("create_user",120,"left","string","담당자",{bordeCss:true}),new FingerDataGridColumn("cp_id",120,"left","string","CP번호",{isLink:true}),new FingerDataGridColumn("invitation",60,"center","string","초대장",{isLink:true}),new FingerDataGridColumn("invitation_path",0,"left","string","초대장경로",{hidden:true}),new FingerDataGridColumn("cp_type",0,"left","string","CP유형",{hidden:true}),new FingerDataGridColumn("cp_descr",200,"left","string","메모(사후)",{hidden:true}),new FingerDataGridColumn("cp_descr2",200,"left","string","메모(사전)",{hidden:true}),new FingerDataGridColumn("report_theme",200,"left","string","테마")]);$.grdProductMulti.init({panel:$.panProductMulti,scroll:"xy",headerRowHeight:40,nonExcel:true});$.grdProductMulti.setBorder(false);$.grdProductSingle.colIdx=$.grdProductSingle.setColumns([new FingerDataGridColumn("rnum",60,"right","int","①연번",{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("product_name",170,"left","string","<br>②제품명<br>(표준코드명칭)",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("company_name",223,"left","string",[{text:"요양기관 정보",colspan:2},"③기관명칭"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("ykiho",140,"left","string",["","④요양기관번호"],{docNum:true,verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("contact_name",120,"left","string",["의료인 정보","⑤성명"],{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("meal_amt",120,"right","int","<br>⑥지원금액<br>(식음료)",{format:"int",verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("seminar_place",220,"left","string","⑦장소",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("seminar_date",130,"left","string","⑧일시",{verticalMiddle:true,bordeCss:true}),new FingerDataGridColumn("create_user",120,"left","string","담당자",{bordeCss:true}),new FingerDataGridColumn("cp_id",120,"left","string","CP번호",{isLink:true}),new FingerDataGridColumn("cp_descr",150,"left","string","메모",{hidden:true}),new FingerDataGridColumn("report_theme",150,"left","string","테마")]);$.grdProductSingle.init({panel:$.panProductSingle,scroll:"xy",headerRowHeight:40,nonExcel:true});$.grdProductSingle.setBorder(false);$.grdPms.colIdx=$.grdPms.setColumns([new FingerDataGridColumn("rnum",70,"right","int","①연번",{format:"int",bordeCss:true}),new FingerDataGridColumn("product_name",270,"left","string",["의료인 정보","②제품명<br>(표준코드명칭)"],{bordeCss:true}),new FingerDataGridColumn("reexam_yn",150,"left","string",[{text:"의료인 정보",colspan:3},"③재심사 대상여부"],{bordeCss:true}),new FingerDataGridColumn("contact_name",100,"left","string",["","④성명"],{bordeCss:true}),new FingerDataGridColumn("company_name",230,"left","string",["","⑤소속"],{bordeCss:true}),new FingerDataGridColumn("study_each_amt",110,"right","int",[{text:"지원내역",colspan:2},"⑥단가/건"],{format:"int",bordeCss:true}),new FingerDataGridColumn("study_cnt",110,"right","int",["","⑦건수"],{format:"int",bordeCss:true}),new FingerDataGridColumn("create_user",120,"left","string","담당자",{bordeCss:true}),new FingerDataGridColumn("cp_id",150,"left","string","관리번호")]);$.grdPms.init({panel:$.panPms,scroll:"xy",headerRowHeight:40,nonExcel:true});$.grdPms.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTop);$.panMain.add($.panButtonGroup);$.panMain.add($.panProvideSample);$.panMain.add($.panSymp);$.panMain.add($.panClinic);$.panMain.add($.panProductMulti);$.panMain.add($.panProductSingle);$.panMain.add($.panPms);$.panTop.add($.lblDate);$.panTop.add($.dteStartDate);$.panTop.add($.lblEx1);$.panTop.add($.lblInst);$.panTop.add($.txtInst);$.panTop.add($.btnSearch);$.panTop.add($.dteEndDate);$.panTop.add($.lblHcp);$.panTop.add($.txtHcp);$.panButtonGroup.add($.htmlProvideSampleButton);$.panButtonGroup.add($.htmlSympButton);$.panButtonGroup.add($.htmlClinicButton);$.panButtonGroup.add($.htmlProductMultiButton);$.panButtonGroup.add($.htmlProductSingleButton);$.panButtonGroup.add($.htmlPmsButton);$.panProvideSample.add($.grdProvideSample);$.panProvideSample.add($.cmbProvideSample);$.panSymp.add($.grdSymp);$.panSymp.add($.cmbSymp);$.panClinic.add($.grdClinic);$.panClinic.add($.cmbClinic);$.panProductMulti.add($.grdProductMulti);$.panProductMulti.add($.cmbProductMulti);$.panProductSingle.add($.grdProductSingle);$.panProductSingle.add($.cmbProductSingle);$.panPms.add($.grdPms);$.panPms.add($.cmbPms);relocateChildIndexInPanel([$.panTop]);setHtmlButtonStyle();panelButtonSettings();setVisiblePanel(false);$.dteStartDate.setValue(getToday().substr(0,4)+"0101");$.dteEndDate.setValue(getToday());var ds=bizComponentData2($,"Q1","L_CRM0219");$.grdProvideSample.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdSymp.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdClinic.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdProductMulti.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdProductSingle.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"});$.grdPms.setColumnDropDownList("create_user",ds.resultList[0],{key:"employee_id",name:"emp_name"})};$.callback=function(type,ds){if(type=="Q_COUNT"){var cntList=[];if(ds){if(ds.resultList[0]&&ds.resultList[0].length){var rt=ds.resultList[0][0];cntList.push(numberWithCommas(rt.SAMPLE)||0);cntList.push(numberWithCommas(rt.SYMPOSIUM)||0);cntList.push(numberWithCommas(rt.CLINIC_TEST)||0);cntList.push(numberWithCommas(rt.DM_SEMINAR_MULTI)||0);cntList.push(numberWithCommas(rt.DM_SEMINAR_SINGLE)||0);cntList.push(numberWithCommas(rt.PMS)||0)}}setHtmlButtonStyle(cntList)}else{if(type=="Q_REPORT"){if($.varCategory=="SAMPLE"){$.cmbProvideSample.clear();setComboBind([$.cmbProvideSample],ds);setDataGrid([$.grdProvideSample],ds.resultList[1],true)}else{if($.varCategory=="SYMPOSIUM"){$.cmbSymp.clear();setComboBind([$.cmbSymp],ds);setDataGrid([$.grdSymp],ds.resultList[1],true)}else{if($.varCategory=="CLINIC_TEST"){$.cmbClinic.clear();setComboBind([$.cmbClinic],ds);setDataGrid([$.grdClinic],ds.resultList[1],true)}else{if($.varCategory=="DM_SEMINAR_MULTI"){$.cmbProductMulti.clear();setComboBind([$.cmbProductMulti],ds);setDataGrid([$.grdProductMulti],ds.resultList[1],true)}else{if($.varCategory=="DM_SEMINAR_SINGLE"){$.cmbProductSingle.clear();setComboBind([$.cmbProductSingle],ds);setDataGrid([$.grdProductSingle],ds.resultList[1],true)}else{if($.varCategory=="PMS"){$.cmbPms.clear();setComboBind([$.cmbPms],ds);setDataGrid([$.grdPms],ds.resultList[1],true)}}}}}}}else{if(type=="Q_DOWNLOAD2"){if($.varCategory=="CLINIC_TEST"){var column=[{headertext:"연구관리번호",datatype:"string",datafield:"isn",ishidden:false,width:"130px"},{headertext:"소속기관",datatype:"string",datafield:"company_name",ishidden:false,width:"150px"},{headertext:"연구자성명",datatype:"string",datafield:"contact_name",ishidden:false,width:"80px"},{headertext:"대조약명",datatype:"string",datafield:"product_name",ishidden:false,width:"150px"},{headertext:"제공수량",datatype:"float",datafield:"req_qty",ishidden:false,width:"100px"}];var json=ds.resultList[0];excelDown(json,column,"대조약 내역")}else{if($.varCategory=="DM_SEMINAR_MULTI"){var column=[{headertext:"CP번호",datatype:"string",datafield:"cp_id",ishidden:false,width:"130px"},{headertext:"카드승인일시",datatype:"string",datafield:"appdat",ishidden:false,width:"150px"},{headertext:"카드번호",datatype:"string",datafield:"cardno",ishidden:false,width:"150px"},{headertext:"승인번호",datatype:"string",datafield:"apprno",ishidden:false,width:"100px"},{headertext:"사용금액",datatype:"int",datafield:"use_amt",ishidden:false,width:"100px"},{headertext:"가맹점명",datatype:"string",datafield:"venknm",ishidden:false,width:"300px"},{headertext:"업태",datatype:"string",datafield:"vengrp",ishidden:false,width:"150px"}];var json=ds.resultList[0];excelDown(json,column,"법인카드 승인내역")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id.indexOf("html")>-1){if(!$.isSearch){MessageBoxShow("조회 후 상세내역을 확인할 수 있습니다.");return}if(!$.panTop.validateControls()){return}var index=getHtmlIdListIndex(id);for(var i=0;i<$.htmlIdList.length;i++){if(i==index[0]){$.htmlIdList[i].setStyle("background","white");$.htmlIdList[i].setStyle("color","#e4174e");$.htmlIdList[i].setStyle("font-weight","600");$.htmlIdList[i].setStyle("border","1px solid red")}else{$.htmlIdList[i].setStyle("background","#da1e48");$.htmlIdList[i].setStyle("color","white");$.htmlIdList[i].setStyle("font-weight","normal");$.htmlIdList[i].setStyle("border","0")}}$.varCategory=index[1];setVisiblePanel(index[0]+1);searchList("Q_REPORT",index[1])}else{if(id=="btnSearch"){$.isSearch=true;$.varCategory="";setHtmlButtonStyle();setVisiblePanel(false);searchList("Q_COUNT")}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbProvideSample"){}else{if(id=="cmbSymp"){}else{if(id=="cmbClinic"){}else{if(id=="cmbProductMulti"){}else{if(id=="cmbProductSingle"){}else{if(id=="cmbPms"){}}}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteStartDate"){var endDate=$.dteEndDate.getValue();if(value>endDate){$.dteEndDate.setValue(value)}}else{if(id=="dteEndDate"){var startDate=$.dteStartDate.getValue();if(value<startDate){$.dteStartDate.setValue(value)}}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdProductMulti"){if(cInd=="cp_id"){if($.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"cp_type")=="CP02"){var x=1200;var y=1350;var ds=searchCP("P_crmCPSeminarAfter_Q");if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;if($.bIsPopup){param[0][0].CallType="BUCall"}param[0][0].Confirm=$.bConfirm;param[0][0].AllReport=$.bAllReport;param[0][0].MyReport=$.bMyReport;param[0][0].cp_status="90";param[0][0].cp_descr="";param[0][0].save_yn="N";var strSaveYN="N";var popName="crmCPSeminarAfter";var popHtml=popName+".html";g_main.openPopup(popHtml,popName,"자사제품설명회(사후)",x,y,"","",param,"","")}else{if($.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"cp_type")=="CP22"){var x=1200;var y=1200;var ds=searchCP("P_crmCPSeminarStayAfter_Q");if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;if($.bIsPopup){param[0][0].CallType="BUCall"}param[0][0].Confirm=$.bConfirm;param[0][0].AllReport=$.bAllReport;param[0][0].MyReport=$.bMyReport;param[0][0].cp_status="90";param[0][0].cp_descr="";param[0][0].save_yn="N";var strSaveYN="N";var popName="crmCPSeminarStayAf";var popHtml=popName+".html";g_main.openPopup(popHtml,popName,"자사제품설명회 숙박(사후)",x,y,"","",param,"","")}}}else{if(cInd=="invitation"){if($.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"invitation_path")!=""){g_fileBrowser.download(getServerFileUrl($.grdProductMulti.getValue($.grdProductMulti.getSelectedRowIdx(),"invitation_path")))}}}}else{if(id=="grdProductSingle"){if($.grdProductSingle.getRowCount()<1){return}else{if(cInd=="cp_id"){var x=1200;var y=935;var ds=searchCP("P_crmCPDetailAfter_Q");if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;if($.bIsPopup){param[0][0].CallType="BUCall"}param[0][0].Confirm=$.bConfirm;param[0][0].AllReport=$.bAllReport;param[0][0].MyReport=$.bMyReport;param[0][0].cp_status="90";param[0][0].cp_descr="";param[0][0].save_yn="N";var strSaveYN="N";var popName="crmCPDetailAfter";var popHtml=popName+".html";g_main.openPopup(popHtml,popName,"제품디테일링(사후)",x,y,"","",param,"","")}}}else{if(id=="grdProvideSample"){if(cInd=="delivery_form"){g_fileBrowser.download(getServerFileUrl($.grdProvideSample.getValue($.grdProvideSample.getSelectedRowIdx(),"delivery_form_path")))}}else{if(id=="grdSymp"){if($.grdSymp.getRowCount()<1){return}else{if(cInd=="cp_id"&&$.grdSymp.getValue($.grdSymp.getSelectedRowIdx(),"expense_type")=="CP08"){var x=1200;var y=850;var ds=searchCP("P_crmCPSympAttendBef_Q");if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;if($.bIsPopup){param[0][0].CallType="BUCall"}param[0][0].Confirm=$.bConfirm;param[0][0].AllReport=$.bAllReport;param[0][0].MyReport=$.bMyReport;param[0][0].cp_status="90";param[0][0].cp_descr="";param[0][0].save_yn="N";var strSaveYN="N";var popName="crmCPSympAttendBef";var popHtml=popName+".html";g_main.openPopup(popHtml,popName,"국내외 학술대회 참가지원(사전)",x,y,"","",param,"","")}else{if(cInd=="cp_id"&&$.grdSymp.getValue($.grdSymp.getSelectedRowIdx(),"expense_type")=="CP37"){var x=1200;var y=710;var ds=searchCP("P_crmCPSympAttendAft_Q");if(ds==null||ds.resultList[0].length<1){return}var param=ds.resultList;if($.bIsPopup){param[0][0].CallType="BUCall"}param[0][0].Confirm=$.bConfirm;param[0][0].AllReport=$.bAllReport;param[0][0].MyReport=$.bMyReport;param[0][0].cp_status="90";param[0][0].cp_descr="";param[0][0].save_yn="N";var strSaveYN="N";var popName="crmCPSympAttendAft";var popHtml=popName+".html";g_main.openPopup(popHtml,popName,"국내외 학술대회 참가지원(사후)",x,y,"","",param,"","")}else{MessageBoxShow("조회 후 상세내역을 확인할 수 있습니다.");return}}}}}}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txtInst"||id=="txtHcp")&&value=="13"){$.isSearch=true;$.varCategory="";setHtmlButtonStyle();setVisiblePanel(false);searchList("Q_COUNT")}};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panProvideSample"){if(btnId=="btnDownLoad"){if($.grdProvideSample.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){createProcessCprFile("SAMPLE")}})}else{if(btnId=="btnExcelDown"){$.grdProvideSample.excelDownCustom("견본품 제공",true)}}}else{if(panelId=="panSymp"){if(btnId=="btnDownLoad"){if($.grdSymp.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){createProcessCprFile("SYMPOSIUM")}})}else{if(btnId=="btnExcelDown"){$.grdSymp.excelDownCustom("학술대회 지원",true)}}}else{if(panelId=="panClinic"){if(btnId=="btnDownLoad"){if($.grdClinic.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){if($.cmbClinic.getValue()=="40"){searchList2()}else{createProcessCprFile("CLINIC_TEST")}}})}else{if(btnId=="btnExcelDown"){$.grdClinic.excelDownCustom("임상시험 지원",true)}}}else{if(panelId=="panProductMulti"){if(btnId=="btnDownLoad"){if($.grdProductMulti.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){if($.cmbProductMulti.getValue()=="066"){searchList2()}else{createProcessCprFile("DM_SEMINAR_MULTI")}}})}else{if(btnId=="btnExcelDown"){$.grdProductMulti.excelDownCustom("복수 요양기관 대상 제품설명회",true)}}}else{if(panelId=="panProductSingle"){if(btnId=="btnDownLoad"){if($.grdProductSingle.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){createProcessCprFile("DM_SEMINAR_SINGLE")}})}else{if(btnId=="btnExcelDown"){$.grdProductSingle.excelDownCustom("개별 요양기관 대상 제품설명회",true)}}}else{if(panelId=="panPms"){if(btnId=="btnDownLoad"){if($.grdPms.getRowCount()<1){MessageBoxShow("근거자료를 다운할 내역이 없습니다.");return}confirmBoxShow("근거자료를 다운로드 하시겠습니까?",function(){if(g_main.msgShare==true){createProcessCprFile("PMS")}})}else{if(btnId=="btnExcelDown"){$.grdPms.excelDownCustom("시판 후 조사",true)}}}}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>