<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panList=null;$.panFile=null;$.grdFile=null;$.panBottom=null;$.btnConfirm=null;$.btnCancel=null;$.btnMemoSave=null;$.memcp_descr=null;$.lbl_cp_id=null;$.txt_cp_id=null;$.lbl_emp_id=null;$.cmb_emp_id=null;$.lbl_emp_pm=null;$.cmb_emp_pm=null;$.cmb_status=null;$.lbl_cp_start_date=null;$.dte_start=null;$.dte_end=null;$.lbl_wave=null;$.lbl_ad_media=null;$.txt_ad_media=null;$.lbl_ad_totalamt=null;$.txt_ad_totalamt=null;$.lbl_won=null;$.lbl_ad_host=null;$.txt_ad_host=null;$.lbl_agency=null;$.txt_agency=null;$.lbl_app_date=null;$.dte_app_date=null;$.lbl_ad_detail=null;$.lbl_ad_purpose=null;$.me_ad_purpose=null;$.lbl_cp_etc=null;$.me_cp_etc=null;$.txt_ad_detail=null;$.txt_cp_doc_no=null;$.txt_cp_code=null;$.txt_before_cp_id=null;function newClick(){$.panList.clear();$.grdFile.clear();$.panList.enableButton(["btnSave","btnDelete"]);$.panFile.enableButton(["btnAdd","btnDelete"]);$.panBottom.setVisible(false);fnEnableSet(true);$.cmb_emp_id.setValue(g_main.session.obj.EmpCode);$.cmb_status.setValue("10");$.dte_app_date.setValue(getToday(""))}function fnEnableSet(bo){$.grdFile.setEditable(bo);$.txt_ad_host.setReadOnly(!bo);$.dte_start.setReadOnly(!bo);$.dte_end.setReadOnly(!bo);$.cmb_emp_pm.setReadOnly(!bo);$.txt_ad_media.setReadOnly(!bo);$.txt_ad_detail.setReadOnly(!bo);$.me_ad_purpose.setReadOnly(!bo);$.txt_ad_totalamt.setReadOnly(!bo);$.txt_agency.setReadOnly(!bo);$.me_cp_etc.setReadOnly(!bo)}function deleteClick(){if($.txt_cp_doc_no.getValue()==""){MessageBoxShow("사전 데이터가 없습니다.");return}confirmBoxShow("["+$.txt_cp_doc_no.getValue()+"] 기업홍보(사전)정보를 삭제 하시겠습니까?",function(){if(g_main.msgShare==true){if(saveList("D")){var share={save_mode:"DEL"};g_popupStack.setData(share);g_popupStack.close()}}})}function saveList(workType){if(!validateControls([$.cmb_emp_id,$.cmb_status,$.dte_start,$.dte_end,$.txt_ad_media,$.txt_ad_totalamt,$.txt_ad_host,$.dte_app_date,$.txt_ad_detail,$.me_ad_purpose])){return false}if(workType=="N"||workType=="U"){if($.grdFile.getRowCount()==""){MessageBoxShow("계약서는 필수 첨부파일 입니다.");return}else{var check1="";for(var i=0;i<=$.grdFile.getRowCount();i++){if($.grdFile.getValue(i,"file_type")=="009"){check1="009"}if(check1=="009"){break}}if(check1!="009"){MessageBoxShow("계약서는 필수 첨부파일 입니다.");return}}}var strfileYn="N";var strfile_type="";var strseq="";var strserver_path="";var strserver_fname="";var strlocal_fname="";if($.grdFile.getSelectedRowIdx()!=-1){for(var i=0;i<$.grdFile.getRowCount();i++){if(i>0){strseq+="|";strfile_type+="|";strserver_path+="|";strserver_fname+="|";strlocal_fname+="|"}strseq+=$.grdFile.getValue(i,"seq");strfile_type+=$.grdFile.getValue(i,"file_type");strserver_path+=$.grdFile.getValue(i,"server_path");strserver_fname+=$.grdFile.getValue(i,"server_fname");strlocal_fname+=$.grdFile.getValue(i,"local_fname")}strfileYn="Y"}var bResult=false;var json=createJSON_S(workType,strfileYn,strfile_type,strseq,strserver_path,strserver_fname,strlocal_fname);var ds=callExecuteSync(["req",json],workType,$,false);if(ds!=null){if(workType=="N"){if(ds.errorCode=="MSG0002"){if(ds.returnStr!=""){var id=ds.returnStr.split("|");if(id.length>1){$.txt_cp_id.setValue(id[0]);$.txt_cp_doc_no.setValue(id[1])}}}}if(ds.errorCode=="MSG0002"||ds.errorCode=="MSG0004"){bResult=true}else{if(ds.errorCode=="MSG0003"){MessageBoxShow("정상적으로 삭제가 되었습니다.");bResult=true;newClick()}else{if(ds.errorCode=="P_crmCPMaster_S_001"){MessageBoxShow("승인요청일 상태만 수정,삭제가 가능합니다.")}else{MessageBoxShow(ds.errorCode)}}}}return bResult}function createJSON_S(workType,strfileYn,strfile_type,strseq,strserver_path,strserver_fname,strlocal_fname){var json=createExecuteParamInfo("P_crmCPPromoteBefore_S",[workType,$.txt_cp_id.getValue()||"",$.txt_cp_doc_no.getValue()||"",$.cmb_emp_id.getValue(),g_main.session.obj.DeptCode,"","","","",$.cmb_emp_pm.getValue(),$.dte_start.getValue(),$.dte_end.getValue(),$.txt_ad_media.getValue(),Number($.txt_ad_totalamt.getValue()),$.txt_ad_host.getValue(),$.txt_ad_detail.getValue(),$.txt_agency.getValue(),$.me_ad_purpose.getValue(),$.me_cp_etc.getValue(),$.dte_app_date.getValue(),"CP28",g_main.session.obj.EmpCode,strfileYn,strfile_type,strseq,strserver_path,strserver_fname,strlocal_fname]);return json}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,665);$.panMain.setText("");$.panMain.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,0,1200,320);$.panList.setText("기업홍보(사전)");$.panList.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,335,1200,210);$.panFile.setText("첨부파일");$.panFile.setBottomLine(true);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,1200,165);$.panBottom=new FingerPanel(host,"panBottom",0,560,1200,110);$.panBottom.setText("");$.panBottom.setBottomLine(true);$.btnConfirm=new FingerButton(host,"btnConfirm",10,5,120,40);$.btnConfirm.setText("승인");$.btnCancel=new FingerButton(host,"btnCancel",10,60,120,40);$.btnCancel.setText("승인취소");$.btnMemoSave=new FingerButton(host,"btnMemoSave",1105,5,105,95);$.btnMemoSave.setText("메모저장");$.memcp_descr=new FingerMemoEdit(host,"memcp_descr",130,565,950,90);$.lbl_cp_id=new FingerLabel(host,"lbl_cp_id",0,10,100,20);$.lbl_cp_id.setText("CP번호");$.txt_cp_id=new FingerEdit(host,"txt_cp_id",105,10,265,20);$.lbl_emp_id=new FingerLabel(host,"lbl_emp_id",420,10,100,20);$.lbl_emp_id.setText("담당자");$.cmb_emp_id=new FingerComboBox(host,"cmb_emp_id",525,10,140,20);$.lbl_emp_pm=new FingerLabel(host,"lbl_emp_pm",670,10,50,20);$.lbl_emp_pm.setText("PM");$.cmb_emp_pm=new FingerComboBox(host,"cmb_emp_pm",725,10,140,20);$.cmb_status=new FingerComboBox(host,"cmb_status",975,10,160,20);$.lbl_cp_start_date=new FingerLabel(host,"lbl_cp_start_date",0,40,100,20);$.lbl_cp_start_date.setText("광고 기간");$.dte_start=new FingerDateEdit(host,"dte_start",105,40,140,20);$.dte_end=new FingerDateEdit(host,"dte_end",275,40,140,20);$.lbl_wave=new FingerLabel(host,"lbl_wave",250,40,20,20);$.lbl_wave.setText("~");$.lbl_ad_media=new FingerLabel(host,"lbl_ad_media",420,40,100,20);$.lbl_ad_media.setText("광고 매체");$.txt_ad_media=new FingerEdit(host,"txt_ad_media",525,40,340,20);$.lbl_ad_totalamt=new FingerLabel(host,"lbl_ad_totalamt",870,40,100,20);$.lbl_ad_totalamt.setText("광고 총액");$.txt_ad_totalamt=new FingerSpinEdit(host,"txt_ad_totalamt",975,40,140,20);$.lbl_won=new FingerLabel(host,"lbl_won",1115,40,20,20);$.lbl_won.setText("원");$.lbl_ad_host=new FingerLabel(host,"lbl_ad_host",0,70,100,20);$.lbl_ad_host.setText("광고 대상");$.txt_ad_host=new FingerEdit(host,"txt_ad_host",105,70,265,20);$.lbl_agency=new FingerLabel(host,"lbl_agency",375,70,145,20);$.lbl_agency.setText("광고대행업체(Agency)");$.txt_agency=new FingerEdit(host,"txt_agency",525,70,340,20);$.lbl_app_date=new FingerLabel(host,"lbl_app_date",870,70,100,20);$.lbl_app_date.setText("승인요청일");$.dte_app_date=new FingerDateEdit(host,"dte_app_date",975,70,165,20);$.lbl_ad_detail=new FingerLabel(host,"lbl_ad_detail",0,100,100,20);$.lbl_ad_detail.setText("광고 내역");$.lbl_ad_purpose=new FingerLabel(host,"lbl_ad_purpose",0,150,100,20);$.lbl_ad_purpose.setText("광고 목적");$.me_ad_purpose=new FingerMemoEdit(host,"me_ad_purpose",105,130,1030,55);$.lbl_cp_etc=new FingerLabel(host,"lbl_cp_etc",0,215,100,20);$.lbl_cp_etc.setText("기타사항");$.me_cp_etc=new FingerMemoEdit(host,"me_cp_etc",105,195,1030,60);$.txt_ad_detail=new FingerEdit(host,"txt_ad_detail",105,100,1035,20);$.txt_cp_doc_no=new FingerEdit(host,"txt_cp_doc_no",0,0,140,20);$.txt_cp_code=new FingerEdit(host,"txt_cp_code",0,0,140,20);$.txt_before_cp_id=new FingerEdit(host,"txt_before_cp_id",0,0,140,20);$.panBottom.setBorder(true);$.panList.addButtons(["btnDelete","btnSave","btnNew"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.txt_cp_doc_no.setVisible(false);$.txt_cp_code.setVisible(false);$.txt_before_cp_id.setVisible(false);$.txt_cp_id.setReadOnly(true);$.cmb_emp_id.setReadOnly(true);$.cmb_status.setReadOnly(true);$.dte_app_date.setReadOnly(true);$.dte_start.setAllowBlank(false,"시작일");$.dte_end.setAllowBlank(false,"종료일");$.txt_ad_media.setAllowBlank(false,"광고매체");$.txt_ad_totalamt.setAllowBlank(false,"광고총액");$.txt_ad_host.setAllowBlank(false,"광고대상");$.dte_app_date.setAllowBlank(false,"승인요청일");$.txt_ad_detail.setAllowBlank(false,"광고내역");$.me_ad_purpose.setAllowBlank(false,"광고목적");$.grdFile.setColumns([new FingerDataGridColumn("seq",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("file_type",400,"left","string","자료유형"),new FingerDataGridColumn("local_fname",800,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]})]);$.grdFile.init({isFilter:false});$.grdFile.setEditable(true);$.grdFile.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panList);$.panMain.add($.panFile);$.panMain.add($.panBottom);$.panMain.add($.memcp_descr);$.panList.add($.lbl_cp_id);$.panList.add($.txt_cp_id);$.panList.add($.lbl_emp_id);$.panList.add($.cmb_emp_id);$.panList.add($.lbl_emp_pm);$.panList.add($.cmb_emp_pm);$.panList.add($.cmb_status);$.panList.add($.lbl_cp_start_date);$.panList.add($.dte_start);$.panList.add($.dte_end);$.panList.add($.lbl_wave);$.panList.add($.lbl_ad_media);$.panList.add($.txt_ad_media);$.panList.add($.lbl_ad_totalamt);$.panList.add($.txt_ad_totalamt);$.panList.add($.lbl_won);$.panList.add($.lbl_ad_host);$.panList.add($.txt_ad_host);$.panList.add($.lbl_agency);$.panList.add($.txt_agency);$.panList.add($.lbl_app_date);$.panList.add($.dte_app_date);$.panList.add($.lbl_ad_detail);$.panList.add($.lbl_ad_purpose);$.panList.add($.me_ad_purpose);$.panList.add($.lbl_cp_etc);$.panList.add($.me_cp_etc);$.panList.add($.txt_ad_detail);$.panList.add($.txt_cp_doc_no);$.panList.add($.txt_cp_code);$.panList.add($.txt_before_cp_id);$.panFile.add($.grdFile);$.panBottom.add($.btnConfirm);$.panBottom.add($.btnCancel);$.panBottom.add($.btnMemoSave);relocateChildIndexInPanel([$.panList]);var ds=bizComponentData2($,"Q1","L_CRM0052|L_CRM0111|L_CRM192");$.cmb_emp_id.setColumn("employee_id","emp_name");$.cmb_status.setColumn("sub_code","code_name");$.cmb_emp_pm.setColumn("employee_id","emp_name");setComboBind([$.cmb_emp_id,$.cmb_status,$.cmb_emp_pm],ds);var subQuery=" AND extra_field1 LIKE '%CP28%'";var ds1=bizComponentData2($,"Q4","L_CRM0110",subQuery);$.grdFile.setColumnDropDownList("file_type",ds1.resultList[0],null,true);if($.p_argument){$.cmb_status.setValue($.p_argument[0][0].cp_status);$.memcp_descr.setValue($.p_argument[0][0].cp_descr);$.bConfirm=$.p_argument[0][0].Confirm;if(!$.bConfirm){$.panBottom.setVisible(false)}else{$.panBottom.setVisible(true)}if($.p_argument[0][0].save_yn=="Y"){$.bSave=true}if(!$.bSave){fnEnableSet(false);$.panList.disableButton(["btnDelete","btnSave"]);$.panFile.disableButton(["btnDelete","btnAdd"])}$.txt_cp_id.setValue($.p_argument[0][0].cp_id);$.cmb_emp_id.setValue($.p_argument[0][0].cp_emp_id);$.cmb_emp_pm.setValue($.p_argument[0][0].cp_emp_pm);$.cmb_status.setValue($.p_argument[0][0].cp_status);$.dte_start.setValue($.p_argument[0][0].cp_start_date);$.dte_end.setValue($.p_argument[0][0].cp_end_date);$.txt_ad_media.setValue($.p_argument[0][0].ad_media);$.txt_ad_totalamt.setValue($.p_argument[0][0].cp_total_amt);$.txt_ad_host.setValue($.p_argument[0][0].ad_host);$.txt_agency.setValue($.p_argument[0][0].agency);$.dte_app_date.setValue($.p_argument[0][0].app_date.trim());$.txt_ad_detail.setValue($.p_argument[0][0].ad_detail);$.me_ad_purpose.setValue($.p_argument[0][0].ad_purpose);$.me_cp_etc.setValue($.p_argument[0][0].cp_etc);$.txt_cp_doc_no.setValue($.p_argument[0][0].cp_doc_no);$.txt_cp_code.setValue($.p_argument[0][0].cp_code);$.txt_before_cp_id.setValue($.p_argument[0][0].cp_id);if($.p_argument[1].length>0){setDataGrid([$.grdFile],$.p_argument[1],true)}if($.cmb_status.getValue()=="10"){$.btnConfirm.setEnable(true);if(!$.bSave){$.panList.disableButton(["btnDelete","btnSave"]);$.panFile.disableButton(["btnDelete","btnAdd"]);$.btnCancel.setEnable(false)}}else{if($.cmb_status.getValue()=="90"){$.btnConfirm.setEnable(false);$.btnCancel.setEnable(true);$.panList.disableButton(["btnDelete","btnSave"]);$.panFile.disableButton(["btnDelete","btnAdd"])}}}else{newClick();$.panBottom.setVisible(false);$.memcp_descr.setVisible(false)}};$.callback=function(type,ds){};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnConfirm"){var share={save_mode:"CONFIRM",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnCancel"){var share={save_mode:"CANCEL",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}else{if(id=="btnMemoSave"){var share={save_mode:"MEMO",cp_descr:$.memcp_descr.getValue()};g_popupStack.setData(share);g_popupStack.close()}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dte_start"||id=="dte_end"){if($.dte_start.getValue()==null||$.dte_end.getValue()==null){return}if($.dte_start.getValue()>$.dte_end.getValue()){MessageBoxShow("광고 종료일이 광고 시작일 보다 빠를수 없습니다.");$.dte_end.setValue($.dte_start.getValue());return}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnSave"){if($.dte_start.getValue()<$.dte_app_date.getValue()){MessageBoxShow("광고일자는 승인요청일보다 이후 일자로만 신청 가능합니다.");return}else{var workType=$.txt_cp_id.getValue()==""?"N":"U";if(saveList(workType)){$.dte_app_date.setReadOnly(true)}}}else{if(btnId=="btnNew"){newClick()}else{if(btnId=="btnDelete"){deleteClick()}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("CPFiles",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){fileList[i].file_type="";for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(fileList);for(var i=0;i<$.grdFile.getRowCount();i++){$.grdFile.setValue(i,"seq",i+1)}})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요",function(){if(g_main.msgShare==true){if(result){MessageBoxShow("파일 삭제 되었습니다.");$.grdFile.deleteRow(rId);if($.grdFile.getRowCount()>0){for(var i=0;i<$.grdFile.getRowCount();i++){$.grdFile.setValue(i,"seq",i+1)}}}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>