<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.panInfo=null;$.panChart=null;$.lblDept=null;$.lblEmp=null;$.lblCompany=null;$.lblProduct=null;$.lblType=null;$.cmbDept=null;$.cmbEmp=null;$.cmbCompany=null;$.cmbProduct=null;$.cmbType=null;$.btnSearch=null;$.grdList=null;$.lblDate=null;$.lblCoding=null;$.lblProductInfo=null;$.lblCompanyInfo=null;$.lblTypeInfo=null;$.dteDate=null;$.cmbCoding=null;$.cmbProductInfo=null;$.cmbCompanyInfo=null;$.cmbTypeInfo=null;$.grdInfo=null;$.grdChartList=null;$.htmlChart=null;$.varWorkType="N";$.varFirst="Y";$.varWfDocId="";$.varBusinessId="";$.varWFType="";$.varDoc="";$.varOriginWfDocId="";$.varDeptLeader="";$.session=g_main.session.obj;$.varReturnData="";$.varApprDeptList=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmCodingMaster_Q",[workType,$.cmbCompany.getValue()||"",$.cmbProduct.getValue()||"",$.cmbType.getValue()||"",$.cmbEmp.getValue()||"",$.cmbDept.getValue()||""]);return json}function createJSON_Q2(workType){var rId=$.grdList.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmCodingDetail_Q",[workType,$.grdList.getValue(rId,"company_id"),$.grdList.getValue(rId,"product_code"),$.grdList.getValue(rId,"comp_type"),$.grdList.getValue(rId,"yyyymm")]);return json}function createJSON_Q3(workType){var rId=$.grdList.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmCodingSale_Q",[workType,$.grdList.getValue(rId,"company_id"),$.grdList.getValue(rId,"product_code"),$.grdList.getValue(rId,"comp_type")]);return json}function createJSON_Q4(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmCodingProgram"]);return json}function createJSON_Q5(workType){var json=createExecuteParamInfo("P_crmCodingMaster_Q",[workType,"","","","",$.session.DeptCode]);return json}function createJSON_S(workType){var rId=$.grdList.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmCoding_S",[workType,$.varWfDocId,$.cmbCompanyInfo.getValue(),$.cmbProductInfo.getValue(),$.cmbTypeInfo.getValue(),$.dteDate.getValue(),$.cmbCoding.getValue(),"",$.grdList.getValue(rId,"dept_code"),$.grdList.getValue(rId,"employee_id"),"#UserID#"]);return json}function searchList(){var json=createJSON_Q("Q");callQuery(["req",json],"Q",$)}function searchInfo(){var json=createJSON_Q2("Q");callQuery(["req",json],"Q_INFO",$)}function searchSale(){var json=createJSON_Q3("Q");callQuery(["req",json],"Q_SALE",$)}function saveCoding(workType){var json=createJSON_S(workType);if(json){var ds=callExecuteSync(["req",json],workType,$);if(ds){var rId=$.grdList.getSelectedRowIdx();var dt=$.grdList.getValue(rId);$.varReturnData={company_id:dt.company_id,product_code:dt.product_code,comp_type:dt.comp_type};searchList();if(workType=="N"){MessageBoxShow("Coding 등록/삭제 기안이 등록 되었습니다.<br>결재함/기안함에서 확인 가능하시며,<br>기안문서 승인 이후 품목관계등록/해지가 자동 반영됩니다.")}else{if(workType=="U"){MessageBoxShow("정상적으로 수정 되었습니다.")}else{if(workType=="D"){MessageBoxShow("정상적으로 삭제 되었습니다.")}}}}}}function initChart(){$.htmlChart.init({chart:{type:"column",width:590,height:180},title:{text:""},xAxis:{labels:{enabled:false}},yAxis:{title:{text:""},stackLabels:{enabled:true,style:{fontWeight:"bold",color:"gray"}},labels:{format:"{value}"}},legend:{enabled:false},tooltip:{enabled:false},plotOptions:{column:{stacking:"number",dataLabels:{enabled:false}}}})}function searchWFDocument(){var json=createJSON_Q4("Q3");callQuery(["req",json],"Q3",$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.varDoc,$.varBusinessId,$.varOriginWfDocId,wfLine,"","","",$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,950);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,55);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,65,1200,450);$.panList.setText("Coding 가장 최근 이력");$.panList.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",0,525,600,400);$.panInfo.setText("Coding 모든 이력");$.panInfo.setBottomLine(true);$.panChart=new FingerPanel(host,"panChart",610,525,590,400);$.panChart.setText("실적");$.panChart.setBottomLine(true);$.lblDept=new FingerLabel(host,"lblDept",0,15,100,20);$.lblDept.setText("영업소");$.lblEmp=new FingerLabel(host,"lblEmp",235,15,100,20);$.lblEmp.setText("담당자");$.lblCompany=new FingerLabel(host,"lblCompany",420,15,100,20);$.lblCompany.setText("거래처");$.lblProduct=new FingerLabel(host,"lblProduct",645,15,100,20);$.lblProduct.setText("품목");$.lblType=new FingerLabel(host,"lblType",870,15,100,20);$.lblType.setText("구분");$.cmbDept=new FingerComboBox(host,"cmbDept",105,15,140,20);$.cmbEmp=new FingerComboBox(host,"cmbEmp",340,15,90,20);$.cmbCompany=new FingerComboBox(host,"cmbCompany",525,15,140,20);$.cmbProduct=new FingerComboBox(host,"cmbProduct",750,15,140,20);$.cmbType=new FingerComboBox(host,"cmbType",975,15,80,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,15,80,20);$.btnSearch.setText("조회");$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,405);$.lblDate=new FingerLabel(host,"lblDate",0,10,80,20);$.lblDate.setText("적용년월");$.lblCoding=new FingerLabel(host,"lblCoding",185,10,80,20);$.lblCoding.setText("Coding");$.lblProductInfo=new FingerLabel(host,"lblProductInfo",350,10,80,20);$.lblProductInfo.setText("품목");$.lblCompanyInfo=new FingerLabel(host,"lblCompanyInfo",0,40,80,20);$.lblCompanyInfo.setText("거래처");$.lblTypeInfo=new FingerLabel(host,"lblTypeInfo",350,40,80,20);$.lblTypeInfo.setText("구분");$.dteDate=new FingerDateEdit(host,"dteDate",85,10,100,20);$.cmbCoding=new FingerComboBox(host,"cmbCoding",270,10,80,20);$.cmbProductInfo=new FingerComboBox(host,"cmbProductInfo",435,10,140,20);$.cmbCompanyInfo=new FingerComboBox(host,"cmbCompanyInfo",85,40,265,20);$.cmbTypeInfo=new FingerComboBox(host,"cmbTypeInfo",435,40,140,20);$.grdInfo=new FingerDataGrid(host,"grdInfo",0,80,600,275);$.grdChartList=new FingerDataGrid(host,"grdChartList",0,190,590,165);$.htmlChart=new FingerBarChart(host,"htmlChart",0,0,590,180);$.panQuery.setBorder(true);$.panInfo.addButtons(["btnDelete","btnSave","btnNew"]);$.grdList.setColumns([new FingerDataGridColumn("dept_code",180,"left","string","영업소"),new FingerDataGridColumn("employee_id",150,"left","string","MR"),new FingerDataGridColumn("company_id",120,"left","string","거래처코드"),new FingerDataGridColumn("company_name",225,"left","string","거래처"),new FingerDataGridColumn("product_code",80,"left","string","품목"),new FingerDataGridColumn("comp_type",60,"left","string","구분"),new FingerDataGridColumn("coding_code",80,"left","string","Coding"),new FingerDataGridColumn("yyyymm",120,"left","string","적용년월"),new FingerDataGridColumn("passTerm",120,"right","string","경과기간")]);$.grdList.init({panel:$.panList});$.grdList.setBorder(false);$.grdInfo.setColumns([new FingerDataGridColumn("yyyymm",200,"left","string","적용년월"),new FingerDataGridColumn("coding_code",200,"left","string","Coding"),new FingerDataGridColumn("approval",180,"left","string","상태"),new FingerDataGridColumn("company_id",99,"left","string","거래처",{hidden:true}),new FingerDataGridColumn("product_code",99,"left","string","품목",{hidden:true}),new FingerDataGridColumn("comp_type",99,"left","string","구분",{hidden:true})]);$.grdInfo.init();$.grdInfo.setBorder(false);$.dteDate.setDateFormat("yyyymm");$.cmbProductInfo.setEnable(false);$.cmbCompanyInfo.setEnable(false);$.cmbTypeInfo.setEnable(false);$.dteDate.setAllowBlank(false,"적용년월");$.cmbCoding.setAllowBlank(false,"Coding");$.panInfo.disableButton(["btnNew","btnSave","btnDelete"]);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panMain.add($.panInfo);$.panMain.add($.panChart);$.panQuery.add($.lblDept);$.panQuery.add($.lblEmp);$.panQuery.add($.lblCompany);$.panQuery.add($.lblProduct);$.panQuery.add($.lblType);$.panQuery.add($.cmbDept);$.panQuery.add($.cmbEmp);$.panQuery.add($.cmbCompany);$.panQuery.add($.cmbProduct);$.panQuery.add($.cmbType);$.panQuery.add($.btnSearch);$.panList.add($.grdList);$.panInfo.add($.lblDate);$.panInfo.add($.lblCoding);$.panInfo.add($.lblProductInfo);$.panInfo.add($.lblCompanyInfo);$.panInfo.add($.lblTypeInfo);$.panInfo.add($.dteDate);$.panInfo.add($.cmbCoding);$.panInfo.add($.cmbProductInfo);$.panInfo.add($.cmbCompanyInfo);$.panInfo.add($.cmbTypeInfo);$.panInfo.add($.grdInfo);$.panChart.add($.grdChartList);$.panChart.add($.htmlChart);$.cmbDept.setColumn("dept_code","dept_name");$.cmbEmp.setColumn("employee_id","emp_name");$.cmbCompany.setColumn("company_id","company_name");$.cmbProduct.setColumn("product_code","product_name");$.cmbCompanyInfo.setColumn("company_id","company_name");$.cmbProductInfo.setColumn("product_code","product_name");$.cmbDept.setEmptyRow(true);$.cmbEmp.setEmptyRow(true);$.cmbCompany.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbType.setEmptyRow(true);$.cmbCoding.setEmptyRow(true);var ds=bizComponentData2($,"Q1","L_CRM0195");setComboBind([$.cmbDept],ds);$.grdList.setColumnDropDownList("dept_code",ds.resultList[0],{key:"dept_code",name:"dept_name"});var ds=bizComponentData2($,"Q1","L_CRM0121");$.grdList.setColumnDropDownList("employee_id",ds.resultList[0],{key:"employee_id",name:"emp_name"});var ds=bizComponentData2($,"Q1","L_CRM228");setComboBind([$.cmbCompany],ds);setComboBind([$.cmbCompanyInfo],ds);$.grdList.setColumnDropDownList("company_id",ds.resultList[0],{key:"company_id",name:"company_id"});$.grdList.setColumnDropDownList("company_name",ds.resultList[0],{key:"company_id",name:"company_name"});var ds=bizComponentData2($,"Q1","L_CRM0202");setComboBind([$.cmbProduct],ds);setComboBind([$.cmbProductInfo],ds);$.grdList.setColumnDropDownList("product_code",ds.resultList[0],{key:"product_code",name:"product_name"});var ds=bizComponentData2($,"Q1","L_CRM0199");setComboBind([$.cmbType],ds);setComboBind([$.cmbTypeInfo],ds);$.grdList.setColumnDropDownList("comp_type",ds.resultList[0]);var ds=bizComponentData2($,"Q1","L_CRM0200");setComboBind([$.cmbCoding],ds);$.grdList.setColumnDropDownList("coding_code",ds.resultList[0]);$.grdInfo.setColumnDropDownList("coding_code",ds.resultList[0]);var ds=bizComponentData2($,"Q1","L_CRM0201");$.grdInfo.setColumnDropDownList("approval",ds.resultList[0]);var strQuery=" and dept_code = 'D112' and duty_code = '09' and position_code <> '99' order by position_code";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery);$.varApprDeptList=ds.resultList[0];if(g_main.session.obj.SystemDeveloper=="N"){$.cmbDept.setValue(g_main.session.obj.DeptCode);$.cmbEmp.setValue(g_main.session.obj.UserID)}searchWFDocument();initChart()};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);if($.varReturnData&&$.grdList.getRowCount()>0){for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"company_id")==$.varReturnData.company_id&&$.grdList.getValue(i,"product_code")==$.varReturnData.product_code&&$.grdList.getValue(i,"comp_type")==$.varReturnData.comp_type){$.grdList.selectRow(i);break}}}else{$.grdList.selectRow(0)}$.varReturnData=""}else{if(type=="Q_INFO"){setDataGrid([$.grdInfo],ds)}else{if(type=="Q_SALE"){var rs=ds.resultList[0][0];var column=[];var cnt=1;for(var i in rs){column.push(new FingerDataGridColumn("sale_0"+cnt,95,"right","string",rs[i]));cnt++}convertJavaDateToJs(ds.resultList);if($.varFirst=="Y"){$.grdChartList.init({});$.varFirst="N"}setTimeout(function(){$.grdChartList.resetColumns(column)},100);setTimeout(function(){setDataGrid([null,$.grdChartList],ds)},100);var rs=ds.resultList[1];var chart1=$.htmlChart.getChart();var cnt=chart1.series.length;if(cnt>0){for(var i=0;i<cnt;i++){chart1.series[0].remove()}}var data=[];for(var i in rs[0]){if(rs[0][i].substr(0,1)=="-"){data.push(Number("-"+unmask(rs[0][i])))}else{data.push(Number(unmask(rs[0][i])))}}var colors=getChartColor("fixed_4");chart1.addSeries({name:"",data:data,color:colors[0]})}else{if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.varDoc="["+g_main.session.obj.DeptName+"] "+result.business_title;var json=createJSON_Q5("Q_EMP");var ds=callExecuteSync(["req",json],"Q",$);$.varDeptLeader=ds.resultList[0][0].dept_leader}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.varDoc=cs.doc_title;$.varReturnData=args[6][0];searchList()}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){$.varWfDocId="";searchList()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDept"){$.cmbEmp.clear();$.cmbEmp.setColumn("employee_id","emp_name");var strQuery=" and dept_code = '"+$.cmbDept.getValue()+"'and delete_yn <> 'Y'";var ds=bizComponentData2($,"Q4","L_CRM0052",strQuery);setComboBind([$.cmbEmp],ds)}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){if($.grdList.getValue(rId,"yyyymm")!=""){var yyyymm=$.grdList.getValue(rId,"yyyymm").substr(0,4)+$.grdList.getValue(rId,"yyyymm").substr(6,2);$.dteDate.setValue(yyyymm)}else{$.dteDate.setValue("")}$.cmbCoding.setValue($.grdList.getValue(rId,"coding_code"));$.cmbProductInfo.setValue($.grdList.getValue(rId,"product_code"));$.cmbCompanyInfo.setValue($.grdList.getValue(rId,"company_id"));$.cmbTypeInfo.setValue($.grdList.getValue(rId,"comp_type"));searchInfo();searchSale();if(g_main.session.obj.SystemDeveloper=="N"){if(!$.grdList.getValue(rId,"employee_id")||g_main.session.obj.UserID!=$.grdList.getValue(rId,"employee_id")){$.panInfo.disableButton(["btnDelete","btnSave","btnNew"])}else{$.panInfo.enableButton(["btnDelete","btnSave","btnNew"])}}else{$.panInfo.enableButton(["btnDelete","btnSave","btnNew"])}if(g_main.session.obj.DeptCode.substr(0,2)=="F1"){$.panInfo.enableButton(["btnDelete","btnSave","btnNew"])}$.dteDate.setEnable(false);$.varWorkType="U";$.varWfDocId=""}else{if(id=="grdInfo"){var dt=$.grdInfo.getValue(rId);$.dteDate.setValue(dt.yyyymm2);$.cmbCoding.setValue(dt.coding_code)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnNew"){if(!$.grdList.getSelectedRowIdx()){return}$.dteDate.setValue(getToday(""));$.cmbCoding.setValue("");$.panInfo.enableButton(["btnSave"]);$.dteDate.setEnable(true);$.varWorkType="N";$.varWfDocId=""}else{if(btnId=="btnSave"){if(!validateControls([$.dteDate,$.cmbCoding])){return}if($.grdInfo.getAllRows().length>0){if(($.grdInfo.getValue(0,"yyyymm").substr(0,4)+$.grdInfo.getValue(0,"yyyymm").substr(6,2))>=$.dteDate.getValue()){MessageBoxShow("가장 최근 이력날짜 보다 앞선 날이나 같은 날은 등록할 수 없습니다.");return}if($.grdInfo.getValue(0,"coding_code")==$.cmbCoding.getValue()){MessageBoxShow("이미 "+($.cmbCoding.getValue()=="D"?"삭제":"등록")+"으로 저장되어 있습니다");return}}confirmBoxShow("저장 하시겠습니까?",function(){if(g_main.msgShare){if($.varWorkType=="N"){if(saveWFDocument("","N")){var str="";var strYn="";for(var i=0;i<$.varApprDeptList.length;i++){str+=$.varApprDeptList[i].employee_id+"|";strYn+="Y|"}str=str+"ka160376";strYn=strYn+"Y";var rm={appr:$.varDeptLeader,conf:"",refs:str,appr_yn:"Y",conf_yn:"",refs_yn:strYn,wf_doc_id:$.varWfDocId};saveWFDocument("","Y",rm)}}saveCoding($.varWorkType)}})}else{if(btnId=="btnDelete"){var rId=$.grdInfo.getSelectedRowIdx();if(!rId){return}var dt=$.grdInfo.getValue(rId);confirmBoxShow("삭제 하시겠습니까?",function(){if(g_main.msgShare){if(dt.wf_doc_id){removeWFDocument(dt.wf_doc_id)}saveCoding("D")}})}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>