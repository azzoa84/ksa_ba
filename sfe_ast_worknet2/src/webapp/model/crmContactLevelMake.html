<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panCompany=null;$.panCheck=null;$.panContact=null;$.panValueSave=null;$.grdCompany=null;$.grdContact=null;$.grdCheck=null;$.panFactor=null;$.grdFactor=null;$.lblHalf=null;$.cmbYYYYHalf=null;$.lblContact=null;$.txtContact=null;$.lblProduct=null;$.cmbProduct=null;$.lblTargetAmt=null;$.speTargetAmt=null;$.lblTargetPatient=null;$.speTargetPatient=null;$.lblContactRate=null;$.cmbContactRate=null;$.lblApData=null;$.cmbApData=null;$.lblContactPCount=null;$.speContactPCount=null;$.speEnterNumContact=null;$.btnConfirm=null;$.btnCancel=null;$.lblAl=null;$.cmbAl=null;$.txtAl=null;$.lblEx1=null;$.lblbeforegrade=null;$.txtbeforegrade=null;$.lblbeforeAL=null;$.txtbeforeAL=null;$.txtCompany_id_real="";$.txtCompany_id="";$.txtNew_yn="";$.txtSum_check="";$.txtContact_id="";$.txtOver_yn="";$.txtMin_rate="";$.txtDup_yn="";$.channel="";$.manualYn="N";$.selectGridKey1="";$.selectGridKey2="";$.savedcontact=0;function createJSON_Q(workType){var json="";var rows=[];if(workType=="Q1"){rows.push([workType,$.cmbYYYYHalf.getValue(),"#UserID#","",""])}else{if(workType=="Q2"){rows.push([workType,$.cmbYYYYHalf.getValue(),"#UserID#","",$.txtCompany_id])}else{if(workType=="Q3"){rows.push([workType,$.cmbYYYYHalf.getValue(),"#UserID#",$.cmbProduct.getValue(),$.txtCompany_id])}else{if(workType=="Q4"){rows.push([workType,$.cmbYYYYHalf.getValue(),"#UserID#","",$.txtCompany_id])}else{if(workType=="Q5"){rows.push([workType,$.cmbYYYYHalf.getValue(),"#UserID#","",""])}}}}}json=createExecuteParamInfo("P_crmContact_Level_make_Q",rows);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmContact_Level_check_Q",[workType,$.cmbYYYYHalf.getValue(),$.txtCompany_id,$.txtContact_id,$.cmbProduct.getValue(),$.cmbContactRate.getValue(),"#UserID#"]);return json}function createJSON_Q3(workType){var json=createExecuteParamInfo("P_crmContact_AL_Q",[workType,$.cmbYYYYHalf.getValue().substring(0,4),$.cmbYYYYHalf.getValue().substring($.cmbYYYYHalf.getValue().length-1),$.cmbProduct.getValue(),$.channel]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmContact_Level_make_S",[workType,$.cmbYYYYHalf.getValue(),"#UserID#",$.cmbProduct.getValue(),$.txtCompany_id,$.txtCompany_id_real,$.txtContact_id,$.speTargetAmt.getValue(),$.cmbContactRate.getValue(),$.speContactPCount.getValue(),"",$.cmbApData.getValue(),$.manualYn=="Y"?$.cmbAl.getValue():$.txtAl.getValue().trim(),$.manualYn,$.channel]);return json}function searchContactLevelMake(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function contactLevelCheck(workType){var json=createJSON_Q2(workType);var ds=callQuerySync(["req",json],workType);if(ds.resultList[0].length>0){if(workType=="H"){$.txtSum_check=ds.resultList[0][0].sum_check}else{if(workType=="S"){$.txtOver_yn=ds.resultList[0][0].over_yn;$.txtMin_rate=ds.resultList[0][0].min_rate}else{if(workType=="T"){$.txtDup_yn=ds.resultList[0][0].dup_yn}}}}}function contactAlCheck(workType){var json=createJSON_Q3(workType);var ds=callQuerySync(["req",json],workType);if(ds.resultList[0].length>0){if(workType=="AL_CHK"){$.manualYn=ds.resultList[0][0].manual_yn;if($.manualYn=="Y"){$.txtAl.setVisible(false);$.cmbAl.setVisible(true);for(var i=0;i<ds.resultList[0].length;i++){if(ds.resultList[0][i].al=="10"){ds.resultList[0][i].al_guide="(Loyalty) "+ds.resultList[0][i].al_guide}else{if(ds.resultList[0][i].al=="20"){ds.resultList[0][i].al_guide="(User) "+ds.resultList[0][i].al_guide}else{if(ds.resultList[0][i].al=="30"){ds.resultList[0][i].al_guide="(Try) "+ds.resultList[0][i].al_guide}else{if(ds.resultList[0][i].al=="40"){ds.resultList[0][i].al_guide="(Awareness) "+ds.resultList[0][i].al_guide}}}}}$.cmbAl.clear();$.cmbAl.setColumn("al","al_guide");setComboBind([$.cmbAl],ds)}else{$.txtAl.setVisible(true);$.txtAl.setEnable(false);$.cmbAl.setVisible(false);$.cmbAl.clear();$.txtAl.setPlaceholder("저장시 자동으로 계산 됩니다.")}}}else{$.txtAl.setVisible(true);$.txtAl.setEnable(false);$.cmbAl.setVisible(false);$.cmbAl.clear();$.txtAl.setPlaceholder("Adoption Ladder 정의가 되지 않았습니다.")}return true}function saveContactLevelMake(workType){var json=createJSON_S(workType);callQuery(["req",json],workType,$)}function calcEnterNumContact(rows){if($.grdFactor.getRowCount()>0){var tempSum=0;log(rows);log(rows.length);for(var i in rows){if(rows[i].product_code==$.cmbProduct.getValue()){tempSum+=Number(rows[i].contact_p_count)}}var enterNumContact=Number($.speTargetPatient.getValue())-Number(tempSum);$.speEnterNumContact.setValue(enterNumContact)}else{$.speEnterNumContact.setValue(Number($.speTargetPatient.getValue()))}}function selectAl(rId){if($.manualYn=="Y"){$.cmbAl.setValue($.grdFactor.getValue(rId,"al"))}else{$.txtAl.setValue($.grdFactor.getValue(rId,"al"))}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1150);$.panMain.setText("");$.panMain.setBottomLine(true);$.panCompany=new FingerPanel(host,"panCompany",0,0,595,300);$.panCompany.setText("거래처(지역)");$.panCompany.setBottomLine(true);$.panCheck=new FingerPanel(host,"panCheck",605,0,595,300);$.panCheck.setText("고객분류확정");$.panCheck.setBottomLine(true);$.panContact=new FingerPanel(host,"panContact",0,310,595,305);$.panContact.setText("고객");$.panContact.setBottomLine(true);$.panValueSave=new FingerPanel(host,"panValueSave",605,310,595,305);$.panValueSave.setText("분류작업");$.panValueSave.setBottomLine(true);$.grdCompany=new FingerDataGrid(host,"grdCompany",0,0,595,255);$.grdContact=new FingerDataGrid(host,"grdContact",0,0,595,260);$.grdCheck=new FingerDataGrid(host,"grdCheck",0,0,595,255);$.panFactor=new FingerPanel(host,"panFactor",0,630,1200,500);$.panFactor.setText("분류목록");$.panFactor.setBottomLine(true);$.grdFactor=new FingerDataGrid(host,"grdFactor",0,0,1200,455);$.lblHalf=new FingerLabel(host,"lblHalf",0,15,100,20);$.lblHalf.setText("반기");$.cmbYYYYHalf=new FingerComboBox(host,"cmbYYYYHalf",105,15,140,20);$.lblContact=new FingerLabel(host,"lblContact",0,55,100,20);$.lblContact.setText("고객");$.txtContact=new FingerEdit(host,"txtContact",105,55,485,20);$.lblProduct=new FingerLabel(host,"lblProduct",0,90,100,20);$.lblProduct.setText("품목");$.cmbProduct=new FingerComboBox(host,"cmbProduct",105,90,140,20);$.lblTargetAmt=new FingerLabel(host,"lblTargetAmt",245,90,60,20);$.lblTargetAmt.setText("목표");$.speTargetAmt=new FingerSpinEdit(host,"speTargetAmt",485,120,105,20);$.lblTargetPatient=new FingerLabel(host,"lblTargetPatient",435,90,80,20);$.lblTargetPatient.setText("기준환자수");$.speTargetPatient=new FingerSpinEdit(host,"speTargetPatient",520,90,70,20);$.lblContactRate=new FingerLabel(host,"lblContactRate",0,160,100,20);$.lblContactRate.setText("Share(%)");$.cmbContactRate=new FingerComboBox(host,"cmbContactRate",105,160,140,20);$.lblApData=new FingerLabel(host,"lblApData",85,135,220,20);$.lblApData.setText("세부전공(종병)/고객성향(개업의)");$.cmbApData=new FingerComboBox(host,"cmbApData",105,160,210,20);$.lblContactPCount=new FingerLabel(host,"lblContactPCount",0,125,100,20);$.lblContactPCount.setText("질환환자수");$.speContactPCount=new FingerSpinEdit(host,"speContactPCount",105,125,140,20);$.speEnterNumContact=new FingerSpinEdit(host,"speEnterNumContact",250,125,90,20);$.btnConfirm=new FingerButton(host,"btnConfirm",266,-40.5,95,30);$.btnConfirm.setText("확정");$.btnCancel=new FingerButton(host,"btnCancel",350,-40.5,95,30);$.btnCancel.setText("취소");$.lblAl=new FingerLabel(host,"lblAl",0,195,100,20);$.lblAl.setText("A/L");$.cmbAl=new FingerComboBox(host,"cmbAl",105,195,135,20);$.txtAl=new FingerEdit(host,"txtAl",105,195,100,20);$.lblEx1=new FingerLabel(host,"lblEx1",270,125,210,20);$.lblEx1.setText("※ 전반기 질환환자수");$.lblbeforegrade=new FingerLabel(host,"lblbeforegrade",0,195,100,20);$.lblbeforegrade.setText("전반기 등급");$.txtbeforegrade=new FingerEdit(host,"txtbeforegrade",105,195,140,20);$.lblbeforeAL=new FingerLabel(host,"lblbeforeAL",0,225,100,20);$.lblbeforeAL.setText("전반기 A/L");$.txtbeforeAL=new FingerEdit(host,"txtbeforeAL",105,225,140,20);$.grdCompany.colIdx=$.grdCompany.setColumns([new FingerDataGridColumn("code",100,"left","string","코드",{hidden:true}),new FingerDataGridColumn("name",250,"left","string","거래처(지역)"),new FingerDataGridColumn("target_amt",200,"right","string","전반기 목표",{format:"int"}),new FingerDataGridColumn("target_patient",128,"right","string","환자수",{format:"int"})]);$.grdCompany.init({panel:$.panCompany});$.grdCompany.setEditable(false);$.grdCheck.colIdx=$.grdCheck.setColumns([new FingerDataGridColumn("company_name",180,"left","string","거래처(지역)"),new FingerDataGridColumn("product_code",100,"left","string","품목",{hidden:true}),new FingerDataGridColumn("product_name",80,"left","string","품목"),new FingerDataGridColumn("sum_rate",70,"right","int","100%",{hidden:true}),new FingerDataGridColumn("sum_contact",90,"right","int","고객수",{format:"int"}),new FingerDataGridColumn("p_count_sum",100,"right","int","환자수",{format:"int"}),new FingerDataGridColumn("product_share",130,"right","int","ProductShare(%)",{format:"percent"}),new FingerDataGridColumn("fail_reason",80,"center","string","완료여부",{hidden:true})]);$.grdCheck.init({panel:$.panCheck});$.grdCheck.setEditable(false);$.grdContact.colIdx=$.grdContact.setColumns([new FingerDataGridColumn("contact_id",100,"left","string","고객코드",{hidden:true}),new FingerDataGridColumn("channel",100,"left","string","채널",{hidden:true}),new FingerDataGridColumn("ind_sp",200,"left","string","과목"),new FingerDataGridColumn("contact_name",308,"left","string","고객"),new FingerDataGridColumn("company_id",200,"left","string","실제거래처코드",{hidden:true}),new FingerDataGridColumn("sum_product",70,"right","int","등록")]);$.grdContact.init({panel:$.panContact});$.grdContact.setEditable(false);$.grdFactor.colIdx=$.grdFactor.setColumns([new FingerDataGridColumn("company_name",180,"left","string","거래처"),new FingerDataGridColumn("code_name",130,"left","string","진료과목"),new FingerDataGridColumn("contact_id",100,"left","string","고객코드"),new FingerDataGridColumn("contact_name",120,"left","string","고객"),new FingerDataGridColumn("product_name",130,"left","string","품목"),new FingerDataGridColumn("contact_p_count",150,"right","int","질환환자수",{format:"int"}),new FingerDataGridColumn("contact_company_rate",103,"right","int","환자Share"),new FingerDataGridColumn("contact_company_point",200,"right","int","환산목표",{format:"number"}),new FingerDataGridColumn("ap_data_name",130,"left","string","세부전공/고객성향",{hidden:true}),new FingerDataGridColumn("factor1",70,"left","string","factor1",{hidden:true}),new FingerDataGridColumn("factor2",70,"left","string","factor2",{hidden:true}),new FingerDataGridColumn("beforegrade",100,"left","string","전반기 등급",{hidden:true}),new FingerDataGridColumn("al",100,"left","string","A/L",{hidden:true}),new FingerDataGridColumn("al_calc",100,"left","string","A/L구분",{hidden:true}),new FingerDataGridColumn("make_yn",70,"left","string","확정"),new FingerDataGridColumn("company_id",158,"left","string","거래처코드",{hidden:true}),new FingerDataGridColumn("company_id_real",100,"left","string","거래처코드리얼",{hidden:true}),new FingerDataGridColumn("contact_name_real",70,"left","string","고객명리얼",{hidden:true}),new FingerDataGridColumn("product_code",70,"left","string","품목코드",{hidden:true}),new FingerDataGridColumn("ap_data",70,"left","string","",{hidden:true}),new FingerDataGridColumn("factor1_code",158,"left","string","",{hidden:true}),new FingerDataGridColumn("factor2_code",158,"left","string","",{hidden:true}),new FingerDataGridColumn("channel",100,"left","string","채널",{hidden:true})]);$.grdFactor.init({panel:$.panFactor,scroll:"xy"});$.grdFactor.setEditable(false);$.cmbYYYYHalf.setEmptyRow(true);$.cmbProduct.setEmptyRow(true);$.cmbContactRate.setEmptyRow(true);$.cmbApData.setEmptyRow(true);$.panValueSave.addButtons(["btnDelete","btnSave"]);$.cmbAl.setVisible(false);$.lblTargetAmt.setVisible(false);$.speTargetAmt.setVisible(false);$.lblAl.setVisible(false);$.cmbAl.setVisible(false);$.txtAl.setVisible(false);$.txtContact.setReadOnly(true);$.speTargetAmt.setReadOnly(true);$.speTargetPatient.setReadOnly(true);$.speEnterNumContact.setReadOnly(true);$.cmbYYYYHalf.setAllowBlank(false,"반기");$.cmbProduct.setAllowBlank(false,"품목");$.cmbContactRate.setAllowBlank(false,"고객점수");$.cmbApData.setEnable(false);$.lblApData.setVisible(false);$.cmbApData.setVisible(false);$.speContactPCount.setAllowBlank(false,"질환환자수");$.btnConfirm.setClass("btn_save");$.host=host;$.args=args};$.start=function(){$.panMain.add($.panCompany);$.panMain.add($.panCheck);$.panMain.add($.panContact);$.panMain.add($.panValueSave);$.panMain.add($.panFactor);$.panCompany.add($.grdCompany);$.panCheck.add($.grdCheck);$.panCheck.add($.btnConfirm);$.panCheck.add($.btnCancel);$.panContact.add($.grdContact);$.panValueSave.add($.lblHalf);$.panValueSave.add($.cmbYYYYHalf);$.panValueSave.add($.lblContact);$.panValueSave.add($.txtContact);$.panValueSave.add($.lblProduct);$.panValueSave.add($.cmbProduct);$.panValueSave.add($.lblTargetAmt);$.panValueSave.add($.speTargetAmt);$.panValueSave.add($.lblTargetPatient);$.panValueSave.add($.speTargetPatient);$.panValueSave.add($.lblContactRate);$.panValueSave.add($.cmbContactRate);$.panValueSave.add($.lblApData);$.panValueSave.add($.cmbApData);$.panValueSave.add($.lblContactPCount);$.panValueSave.add($.speContactPCount);$.panValueSave.add($.speEnterNumContact);$.panValueSave.add($.lblAl);$.panValueSave.add($.cmbAl);$.panValueSave.add($.txtAl);$.panValueSave.add($.lblEx1);$.panValueSave.add($.lblbeforegrade);$.panValueSave.add($.txtbeforegrade);$.panValueSave.add($.lblbeforeAL);$.panValueSave.add($.txtbeforeAL);$.panFactor.add($.grdFactor);var ds3=bizComponentData2($,"Q2","S_9999_2|L_CRM240");setComboBind([$.cmbYYYYHalf,$.cmbContactRate],ds3);$.cmbYYYYHalf.setValue(ds3.resultList[0][0].sub_code);var ds4=bizComponentData2($,"Q1","L_CRM0272");$.grdFactor.setColumnDropDownList("al",ds4.resultList[0]);if(g_main.session.getValue("EmpCode")=="ka070040"){g_main.session.EmpCode="ka130261";g_main.session.DeptCode="S350"}if(g_main.session.getValue("DeptCode").substring(0,1)=="S"||g_main.session.getValue("DeptCode").substring(0,1)=="T"){if(g_main.session.getValue("DeptCode")=="S030"){$.cmbProduct.setColumn("code","name");var ds=bizComponentData2($,"Q1","L_CRM239_1");setComboBind([$.cmbProduct],ds)}else{var strQuery=" and left(dept_code,2)='"+g_main.session.getValue("DeptCode").substring(0,2)+"'";$.cmbProduct.setColumn("code","name");var ds=bizComponentData2($,"Q4","L_CRM239_1",strQuery);setComboBind([$.cmbProduct],ds)}}var strQuery2=" and extra_field2=''";var ds2=bizComponentData2($,"Q4","L_CRM253",strQuery2);setComboBind([$.cmbApData],ds2);if($.txtCompany_id_real.substring(0,1)=="C"){}else{if($.txtCompany_id_real.substring(0,1)=="H"){}else{return}}};$.callback=function(type,ds){if(type=="Q1"){setDataGrid([$.grdCompany],ds);if(ds.resultList[0].length>0){$.grdCompany.selectRow(0)}}else{if(type=="Q2"){setDataGrid([$.grdContact],ds);if(ds.resultList[0].length>0){$.grdContact.selectRow(0)}}else{if(type=="Q3"){if(ds.resultList[0].length>0){$.speTargetAmt.setValue(ds.resultList[0][0].target_amt);$.speTargetPatient.setValue(ds.resultList[0][0].target_patient);calcEnterNumContact($.rows)}}else{if(type=="Q4"){for(var i=0;i<ds.resultList[0].length;i++){if(ds.resultList[0][i].manual_yn=="N"){ds.resultList[0][i].al_calc=ds.resultList[0][i].al_calc+"%"}}$.rows=ds.resultList[0];setDataGrid([$.grdFactor],ds);if(ds.resultList[0].length>0){if($.selectGridKey1==""||$.selectGridKey2==""){$.grdFactor.selectRow(0)}else{for(var i=0;i<ds.resultList[0].length;i++){if(ds.resultList[0][i].contact_id==$.selectGridKey1&&ds.resultList[0][i].product_code==$.selectGridKey2){$.grdFactor.selectRow(i);$.selectGridKey1="";$.selectGridKey2="";break}}}}}else{if(type=="Q5"){setDataGrid([$.grdCheck],ds);if(ds.resultList[0].length>0){$.grdCheck.selectRow(0)}}else{if(type=="U"||type=="S"||type=="D"){$.txtNew_yn="Y";$.cmbContactRate.setValue("");$.speContactPCount.setValue(0);$.cmbApData.setValue("");searchContactLevelMake("Q2");searchContactLevelMake("Q4");searchContactLevelMake("Q5")}else{if(type=="E"||type=="C"){$.txtNew_yn="Y";$.speContactPCount.setValue(0);$.cmbContactRate.setValue("");$.cmbApData.setValue("");searchContactLevelMake("Q4");searchContactLevelMake("Q5")}}}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnConfirm"){$.txtSum_check="";contactLevelCheck("H");log("$.txtSum_check : "+$.txtSum_check);if(!$.grdFactor.getRowCount()){MessageBoxShow("확정할 대상이 존재하지 않습니다.");return}else{$.selectGridKey1=$.grdFactor.getValue($.grdFactor.getSelectedRowIdx(),"contact_id");$.selectGridKey2=$.grdFactor.getValue($.grdFactor.getSelectedRowIdx(),"product_code");saveContactLevelMake("E")}}else{if(id=="btnCancel"){if(!$.grdCheck.getRowCount()){MessageBoxShow("취소할 대상이 존재하지 않습니다.");return}else{saveContactLevelMake("C")}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbYYYYHalf"){log($.cmbYYYYHalf.getValue());if($.cmbYYYYHalf.getValue()=="201801"){$.panValueSave.enableButton(["btnSave"]);$.panValueSave.enableButton(["btnDelete"])}else{$.panValueSave.disableButton(["btnSave"]);$.panValueSave.disableButton(["btnDelete"])}searchContactLevelMake("Q1");searchContactLevelMake("Q2");searchContactLevelMake("Q5")}else{if(id=="cmbProduct"){$.txtNew_yn="Y";$.speTargetAmt.setValue(0);$.speTargetPatient.setValue(0);searchContactLevelMake("Q3");contactAlCheck("AL_CHK");$.cmbApData.clear();var strQuery="";if($.txtCompany_id_real==""||$.txtCompany_id_real==null){strQuery=" and extra_field1=''"}else{if($.txtCompany_id.substring(0,1)=="H"||$.txtCompany_id=="C00010659"){strQuery=" and extra_field1='H' and extra_field2='"+$.cmbProduct.getValue()+"'";if($.cmbProduct.getValue()=="P16"||$.cmbProduct.getValue()=="P21"||$.cmbProduct.getValue()=="P05"||$.cmbProduct.getValue()=="P07"||$.cmbProduct.getValue()=="P06"||$.cmbProduct.getValue()=="P20"||$.cmbProduct.getValue()=="P22"){}else{if($.cmbProduct.getValue()=="P04"||$.cmbProduct.getValue()=="P12"||$.cmbProduct.getValue()=="P15"){}else{}}}else{if($.txtCompany_id.substring(0,1)=="1"){strQuery=" and extra_field1='1'";if($.cmbProduct.getValue()=="P04"||$.cmbProduct.getValue()=="P21"){}else{if($.cmbProduct.getValue()=="P16"){}else{}}}else{strQuery=" and extra_field1='"+$.txtCompany_id.substring(0,1)+"'"}}}var ds=bizComponentData2($,"Q4","L_CRM253|L_CRM271|L_CRM272",strQuery);setComboBind([$.cmbApData],ds)}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdCompany"){if(!$.grdCompany.getSelectedRowIdx()){return}$.txtCompany_id=$.grdCompany.getValue(rId,"code");$.txtCompany_id_real=$.grdCompany.getValue(rId,"code");$.txtNew_yn="Y";$.cmbContactRate.setValue("");$.cmbApData.setValue("");$.speContactPCount.setValue("0");$.txtContact.setValue("");$.speTargetAmt.setValue(0);$.speTargetPatient.setValue(0);searchContactLevelMake("Q2");if($.cmbProduct.getValue()==""||$.cmbProduct.getValue()==null){$.speTargetAmt.setValue(0);$.speTargetPatient.setValue(0)}else{$.speTargetAmt.setValue(0);$.speTargetPatient.setValue(0);searchContactLevelMake("Q3")}searchContactLevelMake("Q4");$.cmbApData.clear();var strQuery="";if($.txtCompany_id_real==""||$.txtCompany_id_real==null){strQuery=" and extra_field1=''"}else{if($.txtCompany_id.substring(0,1)=="H"||$.txtCompany_id.substring(0,1)=="C"){strQuery=" and extra_field1='H' and extra_field2='"+$.cmbProduct.getValue()+"'"}else{strQuery=" and extra_field1='"+$.txtCompany_id.substring(0,1)+"'"}}var ds=bizComponentData2($,"Q4","L_CRM253|L_CRM271|L_CRM272",strQuery);setComboBind([$.cmbApData],ds)}else{if(id=="grdContact"){if(!$.grdContact.getSelectedRowIdx()){return}$.txtContact_id=$.grdContact.getValue(rId,"contact_id");$.txtCompany_id_real=$.grdContact.getValue(rId,"company_id");$.channel=$.grdContact.getValue(rId,"channel");$.txtNew_yn="Y";$.cmbProduct.setValue("");$.cmbContactRate.setValue("");$.cmbApData.setValue("");$.speContactPCount.setValue(0);$.txtContact.setValue("");$.txtContact.setValue($.grdContact.getValue(rId,"contact_name"))}else{if(id=="grdFactor"){if(!$.grdFactor.getSelectedRowIdx()){return}$.txtContact_id=$.grdFactor.getValue(rId,"contact_id");$.txtCompany_id_real=$.grdFactor.getValue(rId,"company_id_real");$.channel=$.grdFactor.getValue(rId,"channel");$.cmbProduct.setValue($.grdFactor.getValue(rId,"product_code"));if(contactAlCheck("AL_CHK")){if($.manualYn=="Y"){$.cmbAl.setValue($.grdFactor.getValue(rId,"al").trim())}else{if($.grdFactor.getValue(rId,"al")=="10"){$.txtAl.setValue("Loyalty")}else{if($.grdFactor.getValue(rId,"al")=="20"){$.txtAl.setValue("User")}else{if($.grdFactor.getValue(rId,"al")=="30"){$.txtAl.setValue("Try")}else{if($.grdFactor.getValue(rId,"al")=="40"){$.txtAl.setValue("Awareness")}}}}}}$.txtContact.setValue($.grdFactor.getValue(rId,"contact_name_real"));$.cmbContactRate.setValue($.grdFactor.getValue(rId,"contact_company_rate"));$.speContactPCount.setValue($.grdFactor.getValue(rId,"contact_p_count"));$.txtbeforegrade.setValue($.grdFactor.getValue(rId,"beforegrade"));if($.grdFactor.getValue(rId,"al")=="10"){$.txtbeforeAL.setValue("Loyalty")}else{if($.grdFactor.getValue(rId,"al")=="20"){$.txtbeforeAL.setValue("User")}else{if($.grdFactor.getValue(rId,"al")=="30"){$.txtbeforeAL.setValue("Try")}else{if($.grdFactor.getValue(rId,"al")=="40"){$.txtbeforeAL.setValue("Awareness")}}}}$.cmbApData.setValue($.grdFactor.getValue(rId,"ap_data"));$.savedcontact=Number($.grdFactor.getValue(rId,"contact_company_rate"));$.savedcontact=Number($.grdFactor.getValue(rId,"contact_p_count"));$.txtNew_yn="N"}}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panValueSave"){if(btnId=="btnSave"){log("["+$.speContactPCount.getValue()+"]");if($.cmbContactRate.getValue()==""){MessageBoxShow("고객점수를 선택해 주세요.");return}else{if($.speContactPCount.getValue()===""){MessageBoxShow("환자수를 입력해 주세요.");return}else{if($.speContactPCount.getValue()<0){MessageBoxShow("환자수는 음수가 입력될수 없습니다.");return}else{if($.cmbProduct.getValue()==""){MessageBoxShow("품목을 선택해 주세요.");return}else{if($.txtContact.getValue()==""){MessageBoxShow("고객을 선택해 주세요.");return}else{if(($.cmbProduct.getValue()=="P06"||$.cmbProduct.getValue()=="P02")&&$.speContactPCount.getValue()!==1){MessageBoxShow("PD,OL 경우 1만 입력 가능");return}else{if((g_main.session.getValue("DeptCode").substring(0,2)=="S3")&&($.cmbProduct.getValue()=="P05"||$.cmbProduct.getValue()=="P07")&&$.speContactPCount.getValue()!==1){MessageBoxShow("개업의 BER,NA 경우 1만 입력 가능");return}else{$.txtOver_yn="N";contactLevelCheck("S");$.txtDup_yn="";contactLevelCheck("T");log("txtNew_yn : "+$.txtNew_yn);log("txtDup_yn : "+$.txtDup_yn);if($.txtDup_yn=="Y"){if($.txtNew_yn=="Y"){MessageBoxShow("이미 신규등록된 고객-품목 정보입니다.");return}else{if($.txtNew_yn=="N"){saveContactLevelMake("U")}}}else{if($.txtDup_yn=="N"){if($.txtNew_yn=="Y"){saveContactLevelMake("S")}else{if($.txtNew_yn=="N"){MessageBoxShow("오류가 발생했습니다.");return}}}}}}}}}}}}else{if(btnId=="btnDelete"){if($.txtNew_yn=="N"){$.txtDup_yn="";contactLevelCheck("T");if($.txtDup_yn=="N"){MessageBoxShow("삭제할 데이터가 없습니다.");return}else{saveContactLevelMake("D")}}else{MessageBoxShow("삭제할 데이터가 없습니다.");return}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>