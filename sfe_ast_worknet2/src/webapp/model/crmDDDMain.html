<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.grdList=null;$.lbl_yyyymm=null;$.dte_yyyymm=null;$.cmb_yyyymm=null;$.lbl_product_code=null;$.cmb_product_code=null;$.cmb_product_code1=null;$.lbl_Dept=null;$.cmb_Dept=null;$.cmb_Employee=null;$.cmb_CusAra=null;$.lbl_company_id=null;$.txt_company_id=null;$.bte_company_name=null;$.btnDelete=null;$.lbl_sido=null;$.cmb_sido=null;$.cmb_sigungu=null;$.cmb_Qtyamt=null;$.lbl_Channel=null;$.cmb_Channel=null;$.btnSearch=null;$.panChart=null;$.chart1=null;function createJson_Q(workType){var json=createExecuteParamInfo("P_crmDDDMain_Q",[workType,$.dte_yyyymm.getValue(),$.cmb_product_code.getValue(),$.cmb_product_code1.getValue()||"",$.txt_company_id.getValue()+$.cmb_Qtyamt.getValue(),$.cmb_Dept.getValue()||"",$.cmb_Employee.getValue()||"",$.cmb_sigungu.getValue()||"",$.cmb_Channel.getValue()||"",$.cmb_CusAra.getValue()||""]);return json}function searchDDDMain(workType){if(!$.panQuery.validateControls()){return}var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function isNullOrEmpty(value){return(!value||value==undefined||value==""||value.length==0)}function initChart(){$.chart1.init({chart:{width:1200,height:485},title:{text:"DDD점유율",x:-20},tooltip:{formatter:function(){return"The value for <b>"+this.x+"</b> is <b>"+this.y.toFixed(2)+"</b>"}},xAxis:{categories:[]},yAxis:{min:0,title:{text:""},lineWidth:1,plotLines:[{value:0,width:1,}],labels:{formatter:function(){return this.value}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",borderWidth:0},series:[{name:"Series 1",color:"#FF0000"},{name:"Series 2",color:"#1DDB16"}],})}function getColor(){return["#FF0000","#1DDB16","#6799FF","#FF5E00","#0100FF","#6B9900","#662500","#D9418C","#FF0000","#1DDB16","#6799FF","#FF5E00","#0100FF"]}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,915);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,85);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,95,1200,300);$.panList.setText("DDD점유율");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,255);$.lbl_yyyymm=new FingerLabel(host,"lbl_yyyymm",0,15,100,20);$.lbl_yyyymm.setText("기준월");$.dte_yyyymm=new FingerDateEdit(host,"dte_yyyymm",105,15,110,20);$.cmb_yyyymm=new FingerComboBox(host,"cmb_yyyymm",220,15,30,20);$.lbl_product_code=new FingerLabel(host,"lbl_product_code",190,15,100,20);$.lbl_product_code.setText("품목");$.cmb_product_code=new FingerComboBox(host,"cmb_product_code",295,15,120,20);$.cmb_product_code1=new FingerComboBox(host,"cmb_product_code1",420,15,95,20);$.lbl_Dept=new FingerLabel(host,"lbl_Dept",495,15,100,20);$.lbl_Dept.setText("담당");$.cmb_Dept=new FingerComboBox(host,"cmb_Dept",600,15,140,20);$.cmb_Employee=new FingerComboBox(host,"cmb_Employee",745,15,85,20);$.cmb_CusAra=new FingerComboBox(host,"cmb_CusAra",835,15,290,20);$.lbl_company_id=new FingerLabel(host,"lbl_company_id",0,45,100,20);$.lbl_company_id.setText("종합병원");$.txt_company_id=new FingerEdit(host,"txt_company_id",105,45,110,20);$.bte_company_name=new FingerButtonEdit(host,"bte_company_name",220,45,195,20);$.bte_company_name.setText("");$.btnDelete=new FingerButton(host,"btnDelete",420,45,80,20);$.btnDelete.setText("지우개");$.lbl_sido=new FingerLabel(host,"lbl_sido",495,45,100,20);$.lbl_sido.setText("개업의지역");$.cmb_sido=new FingerComboBox(host,"cmb_sido",600,45,80,20);$.cmb_sigungu=new FingerComboBox(host,"cmb_sigungu",685,45,110,25);$.cmb_Qtyamt=new FingerComboBox(host,"cmb_Qtyamt",800,45,90,20);$.lbl_Channel=new FingerLabel(host,"lbl_Channel",870,45,100,20);$.lbl_Channel.setText("채널");$.cmb_Channel=new FingerComboBox(host,"cmb_Channel",975,45,85,20);$.btnSearch=new FingerButton(host,"btnSearch",1120,45,80,20);$.btnSearch.setText("조회");$.panChart=new FingerPanel(host,"panChart",0,405,1200,500);$.panChart.setText("");$.panChart.setBottomLine(true);$.chart1=new FingerBarChart(host,"chart1",0,0,1200,500);$.panQuery.setBorder(true);$.panChart.setBorder(true);$.dte_yyyymm.setDateFormat("yyyymm");$.cmb_yyyymm.setVisible(false);$.cmb_product_code.setEmptyRow(true);$.cmb_Dept.setEmptyRow(true);$.cmb_Employee.setEmptyRow(true);$.cmb_CusAra.setEmptyRow(true);$.cmb_sido.setEmptyRow(true);$.cmb_sigungu.setEmptyRow(true);$.cmb_Channel.setEmptyRow(true);$.dte_yyyymm.setAllowBlank(false,"기준월");$.cmb_product_code.setAllowBlank(false,"품목");$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("",103,"left","string","품목"),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string",""),new FingerDataGridColumn("",90,"left","string","")]);$.grdList.init({panel:$.panList});$.grdList.setEditable(false);$.grdList.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panMain.add($.panChart);$.panQuery.add($.btnSearch);$.panQuery.add($.cmb_Channel);$.panQuery.add($.lbl_Channel);$.panQuery.add($.cmb_Qtyamt);$.panQuery.add($.cmb_sigungu);$.panQuery.add($.cmb_sido);$.panQuery.add($.lbl_sido);$.panQuery.add($.btnDelete);$.panQuery.add($.bte_company_name);$.panQuery.add($.txt_company_id);$.panQuery.add($.lbl_company_id);$.panQuery.add($.cmb_CusAra);$.panQuery.add($.cmb_Employee);$.panQuery.add($.cmb_Dept);$.panQuery.add($.lbl_Dept);$.panQuery.add($.cmb_product_code1);$.panQuery.add($.cmb_product_code);$.panQuery.add($.lbl_product_code);$.panQuery.add($.cmb_yyyymm);$.panQuery.add($.dte_yyyymm);$.panQuery.add($.lbl_yyyymm);$.panList.add($.grdList);$.panChart.add($.chart1);relocateChildIndexInPanel([$.panQuery]);var ds=bizComponentData2($,"Q1","L_CRM140|L_CRM0035");$.cmb_yyyymm.setColumn("yyyymm","yyyymm");$.cmb_sido.setColumn("sidogu_code","sidogu_name");setComboBind([$.cmb_yyyymm,$.cmb_sido],ds);var rs=ds.resultList[0][0];$.cmb_yyyymm.setValue(rs.yyyymm);var ds2=bizComponentData2($,"Q2","L_CRM00138|L_CRM00138_1|L_CRM0145|L_CRM0139");setComboBind([$.cmb_product_code,$.cmb_product_code1,$.cmb_Qtyamt,$.cmb_Channel],ds2);var subQuery=" and sales_dept_yn = 'Y'";var ds3=bizComponentData2($,"Q4","L_CRM0206",subQuery);$.cmb_Dept.setColumn("dept_code","dept_name");setComboBind([$.cmb_Dept],ds3);initChart();$.cmb_Qtyamt.setValue("Q");$.dte_yyyymm.setValue($.cmb_yyyymm.getValue());$.cmb_product_code.setValue("");$.cmb_Dept.setValue("");$.cmb_Employee.setValue("");if(g_main.session.obj.EmpName=="서정진"){$.cmb_Qtyamt.setVisible(true)}else{$.cmb_Qtyamt.setVisible(false)}var deptCode=g_main.session.obj.DeptCode;if(deptCode.substring(0,2)=="S1"||deptCode.substring(0,2)=="S2"||deptCode.substring(0,2)=="S3"||deptCode.substring(0,2)=="T1"||deptCode.substring(0,3)=="S03"||deptCode.substring(0,3)=="S04"||deptCode.substring(0,3)=="S05"){if(deptCode.substring(2,4)=="00"||deptCode.substring(2,4)=="90"){return}$.cmb_Dept.setValue(deptCode);if(g_main.session.obj.DutyCode=="08"){return}$.cmb_Employee.setValue(g_main.session.obj.EmpCode)}};$.callback=function(type,ds){if(type=="Q"){if(ds&&ds.resultList.length>0){var dt1=ds.resultList[0];var dt2=ds.resultList[1];var chart1=$.chart1.getChart();var cnt=chart1.series.length;if(cnt>0){for(var i=0;i<cnt;i++){chart1.series[0].remove()}}var categories=[];for(var i in dt1[0]){categories.push(dt1[0][i].substring(0,4)+"-"+dt1[0][i].substring(4,6))}chart1.xAxis[0].setCategories(categories);var colors=getColor();if(dt2.length>1){var tmpData=[];for(var i=0;i<dt2.length;i++){var rs=[];for(var j in dt2[i]){rs.push(dt2[i][j])}tmpData.push(rs)}for(var i=0;i<dt2.length;i++){var chartData=[];for(var j=1;j<tmpData[i].length;j++){chartData.push(tmpData[i][j])}chart1.addSeries({name:dt2[i].comp_product,data:chartData,color:colors[i]})}}else{chart1.addSeries({name:"No_data",data:[0,0,0,0,0,0,0,0,0,0,0,0],color:colors[0]})}$.grdList.removeColumns();var colId;var cols=[];var format_type=$.cmb_Qtyamt.getValue()=="Q"?"number":"int";if(dt2.length>0){colId=Object.keys(dt2[0])}for(var i=0;i<categories.length+1;i++){if(i>0){cols.push(new FingerDataGridColumn(!colId?"":colId[i],90,"right","int",categories[i-1],{format:format_type}))}else{cols.push(new FingerDataGridColumn(!colId?"":colId[i],103,"left","string","품목"))}}$.grdList.resetColumns(cols);setDataGrid([$.grdList],dt2,true);$.grdList.selectRow(0)}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){searchDDDMain("Q")}else{if(id=="btnDelete"){$.txt_company_id.setValue("");$.bte_company_name.setText("")}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bte_company_name"){var param={company_name:$.bte_company_name.getText()||""};g_main.openPopup("popCompanyNew.html","popCompanyNew","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmb_product_code"){if(value=="P22"){$.cmb_product_code1.setVisible(true);if(value==null||value==""){$.txt_company_id.setValue("");$.bte_company_name.setText("");$.cmb_sido.setValue("");$.cmb_sigungu.setValue("");$.cmb_Channel.setValue("");$.txt_company_id.setReadOnly(true);$.bte_company_name.setEnable(false);$.cmb_sido.setEnable(false);$.cmb_Channel.setEnable(false);$.cmb_Dept.setEnable(false)}else{$.txt_company_id.setReadOnly(false);$.bte_company_name.setEnable(true);$.cmb_sido.setEnable(true);$.cmb_Channel.setEnable(true);$.cmb_Dept.setEnable(true)}}else{$.cmb_product_code1.setVisible(false);if(value==null||value==""){$.txt_company_id.setValue("");$.bte_company_name.setText("");$.cmb_sido.setValue("");$.cmb_sigungu.setValue("");$.cmb_Channel.setValue("");$.txt_company_id.setReadOnly(true);$.bte_company_name.setEnable(false);$.cmb_sido.setEnable(false);$.cmb_Channel.setEnable(false);$.cmb_Dept.setEnable(false)}else{$.txt_company_id.setReadOnly(false);$.bte_company_name.setEnable(true);$.cmb_sido.setEnable(true);$.cmb_Channel.setEnable(true);$.cmb_Dept.setEnable(true)}}}else{if(id=="cmb_Dept"){if(value==null||value==""){$.cmb_Employee.setValue("");$.cmb_Employee.setEnable(false)}else{$.cmb_Employee.setEnable(true);$.cmb_Employee.clear();var subQuery=" and dept_code = '"+$.cmb_Dept.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM198",subQuery);$.cmb_Employee.setColumn("employee_id","emp_name");setComboBind([$.cmb_Employee],ds)}}else{if(id=="cmb_Employee"){if(value==null||value==""){$.cmb_CusAra.setValue("");$.cmb_CusAra.setEnable(false)}else{$.cmb_CusAra.setEnable(true);$.cmb_CusAra.clear();var subQuery=" and employee_id = '"+$.cmb_Employee.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM241",subQuery);$.cmb_CusAra.setColumn("company_id","company_name");setComboBind([$.cmb_CusAra],ds)}}else{if(id=="cmb_sido"){if(value==null||value==""){$.cmb_sigungu.setValue("");$.cmb_sigungu.setEnable(false)}else{$.cmb_sigungu.setEnable(true);$.cmb_sigungu.clear();var subQuery=" and parent_sidogu = '"+$.cmb_sido.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM00083",subQuery);$.cmb_sigungu.setColumn("sidogu_code","sidogu_name");setComboBind([$.cmb_sigungu],ds)}}else{if(id=="cmb_sigungu"){if(value==""){return}if($.dte_yyyymm.getValue()!=""&&!isNullOrEmpty($.cmb_product_code.getValue())){searchDDDMain("Q")}}else{if(id=="cmb_Channel"){if($.dte_yyyymm.getValue()!=""&&!isNullOrEmpty($.cmb_product_code.getValue())){searchDDDMain("Q")}}}}}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txt_company_id"){if(value==""){return}if($.dte_yyyymm.getValue()!=""&&!isNullOrEmpty($.cmb_product_code.getValue())){searchDDDMain("Q")}}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popCompanyNew"){if($.popUpCallId=="bte_company_name"){$.txt_company_id.setValue(popResult.company_id);$.bte_company_name.setText(popResult.company_name)}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>