<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTree=null;$.treDeptTree=null;$.panDeptPic=null;$.panDeptInfo=null;$.panDeptEmp=null;$.fpaDeptFile=null;$.panDeptFile=null;$.memDeptInfo=null;$.memDeptWorkInfo=null;$.grdDeptEmp=null;$.txtDeptCode=null;$.imgDept=null;$.btnSelfUpload=null;$.btnSelfVideoUpload=null;$.btnSelfBucketUpload=null;$.btnSave=null;$.lblDeptInfo=null;$.lblDeptWork=null;$.btnUpdate=null;$.btnChangePhoto=null;$.btnSavePhoto=null;$.htmDeptInfo=null;$.htmDeptWorkInfo=null;$.varImageFileName=null;$.fingerimage_change=function(){saveDept()};function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmDeptEmpview_tree_Q",[workType]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmDeptEmpview_dept_Q",[workType,$.txtDeptCode.getText()]);return json}function createJSON_Q3(workType){var json=createExecuteParamInfo("P_crmDeptEmpview_emp_Q",[workType,$.txtDeptCode.getText()]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmDeptEmpmake_dept_S_B64",[workType,$.txtDeptCode.getText(),$.imgDept.getValue()!=""?$.imgDept.getUploadParam().image_base64:"",$.memDeptWorkInfo.getText(),$.memDeptInfo.getText(),"","","",""]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmDeptEmpmake_emp_S_noimg",[workType,$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"employee_id"),"","",$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"server_path"),$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_self"),$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_video"),$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_bucket"),$.grdDeptEmp.getValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_vision")]);return json}function searchList(){var json=createJSON_Q("Q_TREE");callQuery(["req",json],"Q_TREE",$)}function searchDept(){var json=createJSON_Q2("Q");callQuery(["req",json],"Q",$)}function searchDeptEmp(){var json=createJSON_Q3("Q");callQuery(["req",json],"Q_EMP",$)}function saveDept(){var json=createJSON_S("S");callQuery(["req",json],"S",$)}function saveFile(workType){var json=createJSON_S2(workType);callQuery(["req",json],"S_FILE",$)}function changeUpdateMode(btnId){if(btnId=="btnUpdate"){$.memDeptInfo.setReadOnly(false);$.memDeptWorkInfo.setReadOnly(false);$.panDeptInfo.clearButton();$.panDeptInfo.addButton("btnDeptSave","저장");$.panDeptInfo.setButtonAction("btnDeptSave","save")}else{if(btnId=="btnSave"){$.memDeptInfo.setReadOnly(true);$.memDeptWorkInfo.setReadOnly(true);$.panDeptInfo.clearButton();$.panDeptInfo.addButton("btnDeptUpdate","수정");$.panDeptInfo.setButtonAction("btnDeptUpdate","modify")}}}function chkMyDept(){if(g_main.session.getValue("DeptCode")==$.treDeptTree.getSelectedNodeId()||g_main.session.obj.SystemDeveloper=="Y"){$.btnSavePhoto.setVisible(false);$.btnChangePhoto.setVisible(true)}else{$.btnSavePhoto.setVisible(false);$.btnChangePhoto.setVisible(false)}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,760);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTree=new FingerPanel(host,"panTree",0,0,330,755);$.panTree.setText("부서목록");$.panTree.setBottomLine(true);$.treDeptTree=new FingerTree(host,"treDeptTree",0,0,330,680);$.panDeptPic=new FingerPanel(host,"panDeptPic",335,0,425,300);$.panDeptPic.setText("부서원사진");$.panDeptPic.setBottomLine(true);$.panDeptInfo=new FingerPanel(host,"panDeptInfo",335,310,860,300);$.panDeptInfo.setText("부서소개 / 업무소개");$.panDeptInfo.setBottomLine(true);$.panDeptEmp=new FingerPanel(host,"panDeptEmp",765,0,430,300);$.panDeptEmp.setText("부서구성원");$.panDeptEmp.setBottomLine(true);$.fpaDeptFile=new FingerFilePanel(host,"fpaDeptFile",5,0,415,20);$.panDeptFile=new FingerPanel(host,"panDeptFile",335,620,425,135);$.panDeptFile.setText("파일명");$.panDeptFile.setBottomLine(true);$.memDeptInfo=new FingerMemoEdit(host,"memDeptInfo",0,35,420,210);$.memDeptWorkInfo=new FingerMemoEdit(host,"memDeptWorkInfo",430,35,420,210);$.grdDeptEmp=new FingerDataGrid(host,"grdDeptEmp",0,0,425,250);$.txtDeptCode=new FingerEdit(host,"txtDeptCode",130,245,140,20);$.imgDept=new FingerImage(host,"imgDept",0,0,425,253);$.btnSelfUpload=new FingerButton(host,"btnSelfUpload",178,-31.5,80,20);$.btnSelfUpload.setText("업로드");$.btnSelfVideoUpload=new FingerButton(host,"btnSelfVideoUpload",252,-31.5,80,20);$.btnSelfVideoUpload.setText("업로드");$.btnSelfBucketUpload=new FingerButton(host,"btnSelfBucketUpload",335,-31.5,80,20);$.btnSelfBucketUpload.setText("업로드");$.btnSave=new FingerButton(host,"btnSave",775,5,80,20);$.btnSave.setText("저장");$.lblDeptInfo=new FingerLabel(host,"lblDeptInfo",0,10,85,25);$.lblDeptInfo.setText("◎ 부서소개");$.lblDeptWork=new FingerLabel(host,"lblDeptWork",400,10,100,20);$.lblDeptWork.setText("◎ 업무소개");$.btnUpdate=new FingerButton(host,"btnUpdate",775,5,80,20);$.btnUpdate.setText("수정");$.btnChangePhoto=new FingerButton(host,"btnChangePhoto",340,-35,100,20);$.btnChangePhoto.setText("사진변경");$.btnSavePhoto=new FingerButton(host,"btnSavePhoto",340,-35,100,20);$.btnSavePhoto.setText("변경적용");$.htmDeptInfo=new FingerHTMLView(host,"htmDeptInfo",2,38,420,210);$.htmDeptWorkInfo=new FingerHTMLView(host,"htmDeptWorkInfo",431,38,420,210);$.panDeptInfo.addButton("btnDeptUpdate","수정");$.panDeptInfo.setButtonAction("btnDeptUpdate","modify");$.imgDept.setDownSizing(600);$.imgDept.setZooming(true,true,false);$.txtDeptCode.setVisible(false);$.memDeptInfo.setReadOnly(true);$.memDeptWorkInfo.setReadOnly(true);$.btnSavePhoto.setClass("btn_save");$.btnSavePhoto.setVisible(false);$.btnChangePhoto.setVisible(false);$.btnSave.setVisible(false);$.btnSave.setEnable(false);$.btnUpdate.setVisible(false);$.btnUpdate.setEnable(false);if(g_main.session.obj.UserID=="ypc08176"||g_main.session.obj.UserID=="ypc08600"){$.memDeptInfo.setVisible(false);$.memDeptWorkInfo.setVisible(false);$.htmDeptInfo.setBorder(true);$.htmDeptWorkInfo.setBorder(true)}else{$.htmDeptInfo.setVisible(false);$.htmDeptWorkInfo.setVisible(false)}$.grdDeptEmp.colIdx=$.grdDeptEmp.setColumns([new FingerDataGridColumn("emp_dept",85,"left","string","부서"),new FingerDataGridColumn("employee_id",90,"left","string","사원코드",{hidden:true}),new FingerDataGridColumn("emp_name",85,"left","string","성명"),new FingerDataGridColumn("server_path",90,"left","string","서버경로",{hidden:true}),new FingerDataGridColumn("server_fname_self",75,"center","string","자기소개",{hidden:true}),new FingerDataGridColumn("server_fname_self_view",75,"center","string","자기소개",{isLink:true,pathLinkCols:["server_path","server_fname_self"]}),new FingerDataGridColumn("server_fname_video",75,"center","string","동영상",{hidden:true}),new FingerDataGridColumn("server_fname_video_view",75,"center","string","동영상",{isLink:true,pathLinkCols:["server_path","server_fname_video"]}),new FingerDataGridColumn("server_fname_bucket",74,"center","string","버킷리스트",{hidden:true}),new FingerDataGridColumn("server_fname_bucket_view",90,"center","string","버킷리스트",{isLink:true,pathLinkCols:["server_path","server_fname_bucket"]})]);$.grdDeptEmp.init();$.grdDeptEmp.setBorder(false);$.imgGroup=new FingerImageGroup([$.imgDept]);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTree);$.panMain.add($.panDeptPic);$.panMain.add($.panDeptInfo);$.panMain.add($.panDeptFile);$.panMain.add($.panDeptEmp);$.panTree.add($.treDeptTree);$.panTree.add($.txtDeptCode);$.panDeptPic.add($.imgDept);$.panDeptPic.add($.btnChangePhoto);$.panDeptPic.add($.btnSavePhoto);$.panDeptInfo.add($.memDeptInfo);$.panDeptInfo.add($.memDeptWorkInfo);$.panDeptInfo.add($.btnSave);$.panDeptInfo.add($.lblDeptInfo);$.panDeptInfo.add($.lblDeptWork);$.panDeptInfo.add($.btnUpdate);$.panDeptInfo.add($.htmDeptInfo);$.panDeptInfo.add($.htmDeptWorkInfo);$.panDeptEmp.add($.grdDeptEmp);$.panDeptEmp.add($.btnSelfUpload);$.panDeptEmp.add($.btnSelfVideoUpload);$.panDeptEmp.add($.btnSelfBucketUpload);$.panDeptFile.add($.fpaDeptFile);searchList();if(g_main.session.getValue("DeptCode")=="C210"||g_main.session.getValue("DeptCode")=="C220"){$.btnSelfUpload.setVisible(true);$.btnSelfVideoUpload.setVisible(true);$.btnSelfBucketUpload.setVisible(true)}else{$.btnSelfUpload.setVisible(false);$.btnSelfVideoUpload.setVisible(false);$.btnSelfBucketUpload.setVisible(false)}chkMyDept()};$.callback=function(type,ds){if(type=="Q_TREE"){$.treDeptTree.clearAll();$.treDeptTree.load(ds.resultList[0],"baby_dept","mom_dept","dept_name",null,"order_seq")}else{if(type=="Q"){$.memDeptInfo.setValue(ds.get(0,0,"dept_intro"));$.memDeptWorkInfo.setValue(ds.get(0,0,"dept_work"));$.htmDeptInfo.setValue(ds.get(0,0,"dept_intro").replace(/\n/g,"<br>"));$.htmDeptWorkInfo.setValue(ds.get(0,0,"dept_work").replace(/\n/g,"<br>"));$.imgDept.setValue(ds.get(0,0,"dept_image"))}else{if(type=="Q_EMP"){for(var i=0;i<ds.resultList[0].length;i++){if(ds.resultList[0][i].server_fname_self!=""){ds.resultList[0][i].server_fname_self_view="[보기]"}if(ds.resultList[0][i].server_fname_video!=""){ds.resultList[0][i].server_fname_video_view="[보기]"}if(ds.resultList[0][i].server_fname_bucket!=""){ds.resultList[0][i].server_fname_bucket_view="[보기]"}}setDataGrid([$.grdDeptEmp],ds)}else{if(type=="S"){searchDept();searchDeptEmp()}else{if(type=="S_FILE"){searchDeptEmp()}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnChangePhoto"){$.imgDept.clickAddBtn()}else{if(id=="btnSavePhoto"){saveDept()}else{if(id=="btnSelfUpload"){if($.grdDeptEmp.getRowCount()<=0){return}if(!$.grdDeptEmp.getSelectedRowIdx()){MessageBoxShow("등록할 구성원을 선택하여 주세요.");return}OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];log(ds);$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_path",ds.resultList[0][0].server_path);$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_self",ds.resultList[0][0].server_fname);saveFile("SELF_S")})}else{if(id=="btnSelfVideoUpload"){if($.grdDeptEmp.getRowCount()<=0){return}if(!$.grdDeptEmp.getSelectedRowIdx()){MessageBoxShow("등록할 구성원을 선택하여 주세요.");return}OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];log(ds);$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_path",ds.resultList[0][0].server_path);$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_video",ds.resultList[0][0].server_fname);saveFile("VIDEO_S")})}else{if(id=="btnSelfBucketUpload"){if($.grdDeptEmp.getRowCount()<=0){return}if(!$.grdDeptEmp.getSelectedRowIdx()){MessageBoxShow("등록할 구성원을 선택하여 주세요.");return}OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_path",ds.resultList[0][0].server_path);$.grdDeptEmp.setValue($.grdDeptEmp.getSelectedRowIdx(),"server_fname_bucket",ds.resultList[0][0].server_fname);saveFile("BUCKET_S")})}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdDeptEmp"){if(cInd=="server_fname_self_view"){}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDeptInfo"){if(btnId=="btnDeptUpdate"){changeUpdateMode("btnUpdate")}else{if(btnId=="btnDeptSave"){changeUpdateMode("btnSave");saveDept()}}}else{if(panelId=="panDeptPic"){if(btnId=="btnSave"){saveDept()}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){if(id=="treDeptTree"){chkMyDept();$.txtDeptCode.setValue(value.id);searchDept();searchDeptEmp()}};$.fingertree_dblclick=function(id,nodeid){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){if(id=="fpaDeptFile"){OpenFileUploader(function(fsInfoList){if(!fsInfoList){MessageBoxShow("파일 업로드에 실패 하였습니다.");return}var oriFileNames=fsInfoList.oriFileNameList;var fileIDList=fsInfoList.fileIDList;for(var i in fileIDList){$.fpaDeptFile.addFile(fileIDList[i].oriFileNames[i])}$.fpaDeptFile.setMode("U")})}};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerscheduler_view_display=function(id,view){};$.fingertree_refresh=function(id){if(id=="treDeptTree"){$.treDeptTree.expandAll()}};$.fingerscheduler_event_reg=function(id,obj){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>