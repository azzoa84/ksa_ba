<script>function Main(){var $=this;$.host=null;$.tabMain=null;$.panMain=null;$.panTab1=null;$.panTab2=null;$.panTop1=null;$.panList1=null;$.panTop2=null;$.panList2=null;$.grdList1=null;$.grdList2=null;$.lblFTRFLG2=null;$.lblFTRFLG1=null;$.cboFTRFLG1=null;$.cboFTRFLG2=null;$.lblAPPDAT1=null;$.lblAPPDAT2=null;$.lblWave1=null;$.lblWave2=null;$.dtdStartDate1=null;$.dtdStartDate2=null;$.dtdEndDate1=null;$.dtdEndDate2=null;$.txtBIZNAME1=null;$.txtBIZNAME2=null;$.txtBIZNUM1=null;$.txtBIZNUM2=null;$.lblBIZNAME1=null;$.lblBIZNAME2=null;$.lblBIZNUM1=null;$.lblBIZNUM2=null;function createJSON_Q(workType){if(workType=="Q"){var json=createExecuteParamInfo("P_crmESEROMASmain_Q",[workType,$.cboFTRFLG1.getValue(),extFormat($.dtdStartDate1.getValue(),"yyyyMMdd"),extFormat($.dtdEndDate1.getValue(),"yyyyMMdd"),$.txtBIZNAME1.getValue(),$.txtBIZNUM1.getValue()]);return json}else{if(workType=="Q1"){var json=createExecuteParamInfo("P_crmESEROMASmain_Q",[workType,$.cboFTRFLG2.getValue(),extFormat($.dtdStartDate2.getValue(),"yyyyMMdd"),extFormat($.dtdEndDate2.getValue(),"yyyyMMdd"),$.txtBIZNAME2.getValue(),$.txtBIZNUM2.getValue()]);return json}}}function createJSON_Q3(workType){var rId=$.grdList1.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmEseroApprovalSub_Q2",[workType,$.grdList1.getValue(rId,"APPRNO")]);return json}function createJSON_Q4(workType){var rId=$.grdList2.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmEseroApprovalSub_Q2",[workType,$.grdList2.getValue(rId,"APPRNO")]);return json}function createJson_S(workType){if(workType=="S"){var json="";var rows=[];for(var i=0;i<$.grdList1.getRowCount();i++){if($.grdList1.getValue(i,"CHECKYN")=="Y"){rows.push([workType,$.grdList1.getValue(i,"FTRFLG"),$.grdList1.getValue(i,"APPRNO"),$.grdList1.getValue(i,"APPAMT"),$.grdList1.getValue(i,"BIZNUM"),$.grdList1.getValue(i,"Batchnum"),$.grdList1.getValue(i,"wf_doc_id"),$.grdList1.getValue(i,"MEMO")])}}json=createExecuteParamInfo("P_crmESEROMASmain_S",rows);return json}else{if(workType=="S1"){var json="";var rows=[];for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"CHECKYN")=="Y"){rows.push([workType,$.grdList2.getValue(i,"FTRFLG"),$.grdList2.getValue(i,"APPRNO"),$.grdList2.getValue(i,"APPAMT"),$.grdList2.getValue(i,"BIZNUM"),$.grdList2.getValue(i,"Batchnum"),$.grdList2.getValue(i,"wf_doc_id"),$.grdList2.getValue(i,"MEMO")])}}json=createExecuteParamInfo("P_crmESEROMASmain_S",rows);return json}}}function searchEsero(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function saveEsero(workType){var json=createJson_S(workType);callQuery(["req",json],workType,$)}function printEsero1(workType){var json=createJSON_Q3("Q");callQuery(["req",json],"Q3",$)}function printEsero2(workType){var json=createJSON_Q4("Q");callQuery(["req",json],"Q4",$)}function CheckCanselData1(){var check1=false;var chknum=0;var chknum2=0;var biznum1="";var biznum2="";var appamt1=0;var appamt2=0;var taxamt1=0;var taxamt2=0;for(var i=0;i<$.grdList1.getRowCount();i++){if($.grdList1.getValue(i,"CHECKYN")=="Y"&&$.grdList1.getValue(i,"FTRFLG")=="98"){check1=true}}if(check1){for(var i=0;i<$.grdList1.getRowCount();i++){if($.grdList1.getValue(i,"CHECKYN")=="Y"&&$.grdList1.getValue(i,"FTRFLG")=="98"){chknum++}}}else{return true}if(chknum==2){for(var i=0;i<$.grdList1.getRowCount();i++){if($.grdList1.getValue(i,"CHECKYN")=="Y"){chknum2++;if(chknum2==1){biznum1=$.grdList1.getValue(i,"BIZNUM");appamt1=Number($.grdList1.getValue(i,"APPAMT"));taxamt1=Number($.grdList1.getValue(i,"TAXAMT"))}else{if(chknum2==2){biznum2=$.grdList1.getValue(i,"BIZNUM");appamt2=Number($.grdList1.getValue(i,"APPAMT"));taxamt2=Number($.grdList1.getValue(i,"TAXAMT"))}}}}if(biznum1==biznum2&&Math.abs(appamt1)==Math.abs(appamt2)&&Math.abs(taxamt1)==Math.abs(taxamt2)){return true}else{return false}}else{return false}}function CheckCanselData2(){var check1=false;var chknum=0;var chknum2=0;var biznum1="";var biznum2="";var appamt1=0;var appamt2=0;for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"CHECKYN")=="Y"&&$.grdList2.getValue(i,"FTRFLG")=="98"){check1=true}}if(check1){for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"CHECKYN")=="Y"&&$.grdList2.getValue(i,"FTRFLG")=="98"){chknum++}}}else{return true}if(chknum==2){for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"CHECKYN")=="Y"){chknum2++;if(chknum2==1){biznum1=$.grdList2.getValue(i,"BIZNUM");appamt1=$.grdList2.getValue(i,"APPAMT")}else{if(chknum2==2){biznum2=$.grdList2.getValue(i,"BIZNUM");appamt2=$.grdList2.getValue(i,"APPAMT")}}}}if(biznum1==biznum2&&Math.abs(appamt1)==Math.abs(appamt2)){return true}else{return false}}else{return false}}$.init=function(host,args){$.tabMain=new FingerTab(host,"tabMain",0,0,1200,1000);$.panMain=new FingerPanel(host,"panMain",0,0,1200,1000);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTab1=new FingerPanel(host,"panTab1",0,0,1200,960);$.panTab1.setText("");$.panTab1.setBottomLine(true);$.panTab2=new FingerPanel(host,"panTab2",0,0,1200,960);$.panTab2.setText("");$.panTab2.setBottomLine(true);$.panTop1=new FingerPanel(host,"panTop1",0,0,1200,100);$.panTop1.setText("조회 정보");$.panTop1.setBottomLine(true);$.panList1=new FingerPanel(host,"panList1",0,105,1200,855);$.panList1.setText("전자세금계산서");$.panList1.setBottomLine(true);$.panTop2=new FingerPanel(host,"panTop2",0,0,1200,100);$.panTop2.setText("조회 정보");$.panTop2.setBottomLine(true);$.panList2=new FingerPanel(host,"panList2",0,105,1200,825);$.panList2.setText("전자계산서");$.panList2.setBottomLine(true);$.grdList1=new FingerDataGrid(host,"grdList1",0,0,1200,805);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,1200,805);$.lblFTRFLG2=new FingerLabel(host,"lblFTRFLG2",0,15,90,20);$.lblFTRFLG2.setText("전표 구분");$.lblFTRFLG1=new FingerLabel(host,"lblFTRFLG1",0,15,90,20);$.lblFTRFLG1.setText("전표 구분");$.cboFTRFLG1=new FingerComboBox(host,"cboFTRFLG1",100,15,140,20);$.cboFTRFLG2=new FingerComboBox(host,"cboFTRFLG2",100,15,140,20);$.lblAPPDAT1=new FingerLabel(host,"lblAPPDAT1",235,15,100,20);$.lblAPPDAT1.setText("작성일자");$.lblAPPDAT2=new FingerLabel(host,"lblAPPDAT2",235,15,100,20);$.lblAPPDAT2.setText("작성일자");$.lblWave1=new FingerLabel(host,"lblWave1",465,15,20,20);$.lblWave1.setText("~");$.lblWave2=new FingerLabel(host,"lblWave2",465,15,20,20);$.lblWave2.setText("~");$.dtdStartDate1=new FingerDateEdit(host,"dtdStartDate1",340,15,130,20);$.dtdStartDate2=new FingerDateEdit(host,"dtdStartDate2",340,15,130,20);$.dtdEndDate1=new FingerDateEdit(host,"dtdEndDate1",490,15,130,20);$.dtdEndDate2=new FingerDateEdit(host,"dtdEndDate2",490,15,130,20);$.txtBIZNAME1=new FingerEdit(host,"txtBIZNAME1",715,15,180,20);$.txtBIZNAME2=new FingerEdit(host,"txtBIZNAME2",715,15,140,20);$.txtBIZNUM1=new FingerEdit(host,"txtBIZNUM1",1010,15,140,20);$.txtBIZNUM2=new FingerEdit(host,"txtBIZNUM2",1010,15,140,20);$.lblBIZNAME1=new FingerLabel(host,"lblBIZNAME1",630,15,80,20);$.lblBIZNAME1.setText("상호");$.lblBIZNAME2=new FingerLabel(host,"lblBIZNAME2",610,15,100,20);$.lblBIZNAME2.setText("상호");$.lblBIZNUM1=new FingerLabel(host,"lblBIZNUM1",910,15,95,20);$.lblBIZNUM1.setText("사업자 번호");$.lblBIZNUM2=new FingerLabel(host,"lblBIZNUM2",905,15,100,20);$.lblBIZNUM2.setText("사업자 번호");$.tabMain.addTab([$.panTab1,$.panTab2]);$.tabMain.setTabText(0,"전자세금계산서");$.tabMain.setTabText(1,"전자계산서");$.panTop1.addButtons(["btnSave","btnSearch"]);$.panTop2.addButtons(["btnSave","btnSearch"]);$.panList1.addButtons(["btnPrint"]);$.panList2.addButtons(["btnPrint"]);$.cboFTRFLG1.setEmptyRow(true);$.cboFTRFLG2.setEmptyRow(true);$.panTop1.setBorder(true);$.panTop2.setBorder(true);log(2222);$.grdList1.colIdx=$.grdList1.setColumns([new FingerDataGridColumn("Seq",50,"center","string","순번",{readonly:true,format:"int",hidden:true}),new FingerDataGridColumn("CHECKYN",50,"center","checkbox","masterCheckbox",{sort:null}),new FingerDataGridColumn("FTRFLG",90,"center","string","구분"),new FingerDataGridColumn("APPDAT",100,"center","string","작성일자",{readonly:true}),new FingerDataGridColumn("APPDAT1",110,"center","string","증빙일(분개장)",{readonly:true}),new FingerDataGridColumn("emp_name",80,"center","string","수신자",{readonly:true}),new FingerDataGridColumn("BIZNAME",140,"left","string","상호",{readonly:true}),new FingerDataGridColumn("BIZNUM",120,"center","string","사업자번호",{readonly:true}),new FingerDataGridColumn("APPAMT",100,"right","int","공급가액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("TAXAMT",100,"right","int","세액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("TOTAMT",100,"right","int","합계액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("PRODUCT",200,"center","string","품목",{readonly:true}),new FingerDataGridColumn("PRODUCT1",110,"center","string","품목1",{readonly:true}),new FingerDataGridColumn("IMPORTNO",150,"center","string","수입신고번호",{readonly:true}),new FingerDataGridColumn("DESCR",120,"center","string","비고",{readonly:true}),new FingerDataGridColumn("APPRNO",120,"center","string","승인번호",{readonly:true}),new FingerDataGridColumn("Batchnum",100,"right","string","분개장번호"),new FingerDataGridColumn("Transid",100,"right","string","거래번호",{readonly:true}),new FingerDataGridColumn("wf_doc_id",110,"left","string","기안문서"),new FingerDataGridColumn("MEMO",200,"left","string","메모(회계팀전용)"),new FingerDataGridColumn("PayDate",100,"center","date","지급일",{readonly:true})]);$.grdList1.init({panel:$.panList1,scroll:"xy",footer:true});$.grdList1.setEditable(true);$.grdList2.colIdx=$.grdList2.setColumns([new FingerDataGridColumn("Seq",50,"center","string","순번",{readonly:true,format:"int",hidden:true}),new FingerDataGridColumn("CHECKYN",50,"center","checkbox","masterCheckbox",{sort:null}),new FingerDataGridColumn("FTRFLG",90,"center","string","구분"),new FingerDataGridColumn("APPDAT",100,"center","string","작성일자",{readonly:true}),new FingerDataGridColumn("emp_name",80,"center","string","수신자",{readonly:true}),new FingerDataGridColumn("BIZNAME",140,"left","string","상호",{readonly:true}),new FingerDataGridColumn("BIZNUM",120,"center","string","사업자번호",{readonly:true}),new FingerDataGridColumn("APPAMT",100,"right","int","공급가액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("TAXAMT",100,"right","int","세액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("TOTAMT",100,"right","int","합계액",{readonly:true,format:"int",footer:{css:{"text-align":"right"},content:"summColumn"}}),new FingerDataGridColumn("PRODUCT",200,"center","string","품목",{readonly:true}),new FingerDataGridColumn("PRODUCT1",110,"center","string","품목1",{readonly:true}),new FingerDataGridColumn("IMPORTNO",150,"center","string","수입신고번호",{readonly:true}),new FingerDataGridColumn("DESCR",120,"center","string","비고",{readonly:true}),new FingerDataGridColumn("APPRNO",120,"center","string","승인번호",{readonly:true}),new FingerDataGridColumn("Batchnum",100,"right","string","분개장번호"),new FingerDataGridColumn("Transid",100,"right","string","거래번호",{readonly:true}),new FingerDataGridColumn("wf_doc_id",110,"left","string","기안문서"),new FingerDataGridColumn("MEMO",200,"left","string","메모(회계팀전용)"),new FingerDataGridColumn("PayDate",100,"center","date","지급일",{readonly:true})]);$.grdList2.init({panel:$.panList2,scroll:"xy",footer:true});$.grdList2.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.tabMain);$.panTab1.add($.panTop1);$.panTab1.add($.panList1);$.panTab2.add($.panTop2);$.panTab2.add($.panList2);$.panTop1.add($.lblFTRFLG1);$.panTop1.add($.cboFTRFLG1);$.panTop1.add($.lblAPPDAT1);$.panTop1.add($.lblWave1);$.panTop1.add($.dtdStartDate1);$.panTop1.add($.dtdEndDate1);$.panTop1.add($.txtBIZNAME1);$.panTop1.add($.txtBIZNUM1);$.panTop1.add($.lblBIZNAME1);$.panTop1.add($.lblBIZNUM1);$.panList1.add($.grdList1);$.panTop2.add($.lblFTRFLG2);$.panTop2.add($.cboFTRFLG2);$.panTop2.add($.lblAPPDAT2);$.panTop2.add($.lblWave2);$.panTop2.add($.dtdStartDate2);$.panTop2.add($.dtdEndDate2);$.panTop2.add($.txtBIZNAME2);$.panTop2.add($.txtBIZNUM2);$.panTop2.add($.lblBIZNAME2);$.panTop2.add($.lblBIZNUM2);$.panList2.add($.grdList2);var ds=bizComponentData2($,"Q2","L_CRM0217");setComboBind([$.cboFTRFLG1],ds);setComboBind([$.cboFTRFLG2],ds);var ds1=bizComponentData2($,"Q2","L_CRM0217");$.grdList1.setColumnDropDownList("FTRFLG",ds1.resultList[0]);$.grdList2.setColumnDropDownList("FTRFLG",ds1.resultList[0]);$.dtdStartDate1.setValue(getToday().substring(0,6)+"01");$.dtdEndDate1.setValue(getCalcDate(getCalcMonth((getToday().substring(0,6)+"01"),1),-1));$.dtdStartDate2.setValue(getToday().substring(0,6)+"01");$.dtdEndDate2.setValue(getCalcDate(getCalcMonth((getToday().substring(0,6)+"01"),1),-1));log(1111)};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList1],ds)}else{if(type=="Q1"){setDataGrid([$.grdList2],ds)}else{if(type=="Q3"||type=="Q4"){var Prod=[];for(var i=1;i<ds.resultList.length;i++){if(ds.resultList[i][0]){Prod.push(ds.resultList[i][0])}}$.reportObj={};$.reportObj.Info=ds.resultList[0];$.reportObj.Prod=Prod;var params={report:"report_Esro",isPrint:false,data:$.reportObj};g_printBrowser.callPrint(params)}else{if(type=="S"){searchEsero("Q")}else{if(type=="S1"){searchEsero("Q1")}}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList1"){if(cInd=="CHECKYN"){if($.grdList1.getValue(rId,"FTRFLG")!="10"&&$.grdList1.getValue(rId,"FTRFLG")!="00"&&$.grdList1.getValue(rId,"FTRFLG")!="11"&&$.grdList1.getValue(rId,"FTRFLG")!="91"&&$.grdList1.getValue(rId,"FTRFLG")!="92"&&$.grdList1.getValue(rId,"FTRFLG")!="98"){$.grdList1.setValue(rId,cInd,"N");return}}}else{if(id=="grdList2"){if(cInd=="CHECKYN"){if($.grdList2.getValue(rId,"FTRFLG")!="10"&&$.grdList2.getValue(rId,"FTRFLG")!="00"&&$.grdList2.getValue(rId,"FTRFLG")!="11"&&$.grdList2.getValue(rId,"FTRFLG")!="91"&&$.grdList2.getValue(rId,"FTRFLG")!="92"&&$.grdList2.getValue(rId,"FTRFLG")!="98"){$.grdList2.setValue(rId,cInd,"N");return}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panTop1"){if(btnId=="btnSearch"){searchEsero("Q")}else{if(btnId=="btnSave"){if(CheckCanselData1()){saveEsero("S")}else{MessageBoxShow("취소분처리 시 사업자번호, 작성년월, 금액, 부가세액이 일치해야 합니다.");return}}}}else{if(panelId=="panTop2"){if(btnId=="btnSearch"){searchEsero("Q1")}else{if(btnId=="btnSave"){if(CheckCanselData2()){saveEsero("S1")}else{MessageBoxShow("취소분처리 시 사업자번호, 작성년월, 금액, 부가세액이 일치해야 합니다.");return}}}}else{if(panelId=="panList1"){if(btnId=="btnPrint"){printEsero1()}}else{if(panelId=="panList2"){if(btnId=="btnPrint"){printEsero2()}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>