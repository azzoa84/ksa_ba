<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panLeft=null;$.panQuery=null;$.panDept=null;$.panEmp=null;$.lblboard_name=null;$.txtboard_name=null;$.txtboard_id=null;$.lblparent_board_id=null;$.txtParentName=null;$.txtdept_code=null;$.lbldept_code=null;$.txtdept_name=null;$.lblorder_seq=null;$.numorder_seq=null;$.txtparent_board_id=null;$.btnSearch=null;$.lblgroup_yn=null;$.chk1=null;$.lbldelete_yn=null;$.chk2=null;$.txtRdept_code=null;$.grdTree=null;$.grdDept=null;$.grdEmp=null;var RoleRefreshYN="Y";var panQueryDataStatus="";var tmp1=[];var tmp2=[];function QueryClick(){if(g_main.session.obj.SystemDeptCode==g_main.session.obj.DeptCode){fnQRY_P_crmPostManageAction_Q("SYSTEM")}else{fnQRY_P_crmPostManageAction_Q("Q")}}function fnQRY_P_crmPostManageAction_Q(workType){var json=createJson_Q(workType);var ds=callExecuteSync(["req",json],workType,$);if(ds!=null){if(workType=="ROLE"){setDataGrid([$.grdDept],ds.resultList[0],true);$.grdDept.selectRow(0);setDataGrid([$.grdEmp],ds.resultList[1],true);$.grdEmp.selectRow(0);tmp1=[];tmp2=[]}else{setDataGrid([$.grdTree],ds);$.grdTree.openNode("all");$.grdTree.selectRow(1)}}}function createJson_Q(workType){var json=createExecuteParamInfo("P_crmPostManageAction_Q",[workType,$.txtboard_id.getValue(),"#DeptCode#"]);return json}function fnbtnvisible(bo){if(bo==false){$.panDept.disableButton(["btnDelete","btnSave","btnAdd"]);$.panEmp.disableButton(["btnDelete","btnSave","btnAdd"])}else{$.panDept.enableButton(["btnDelete","btnSave","btnAdd"]);$.panEmp.enableButton(["btnDelete","btnSave","btnAdd"])}}function fnReturn(){if(panQueryDataStatus=="N"){return false}else{if(g_main.session.obj.DeptCode==g_main.session.obj.SystemDeptCode){return true}else{if(g_main.session.obj.DeptCode==$.txtRdept_code){return true}else{MessageBoxShow("crmPostManageAction_001");return false}}}}function fnSET_P_crmPostManageAction_S(workType){var bResult=false;var json=createJson_S(workType);var ds=callExecuteSync(["req",json],workType,$);if(ds!=null){if(workType=="N"){if(ds!=null&&ds.errorCode.substring(0,1)!="E"&&ds.errorCode.substring(0,1)!="P"){$.txtboard_id.setValue(ds.returnStr);panQueryDataStatus="";bResult=true}}else{bResult=true}}return bResult}function createJson_S(workType){if(workType=="DEPT"){var json="";var changedRows=$.grdDept.getChangedRows();var rows=[];for(var i in changedRows){rowTypes=changedRows[i].rowType;rows.push([workType,rowTypes,$.txtboard_id.getValue(),$.txtboard_name.getValue(),$.txtdept_code.getValue(),Number($.numorder_seq.getValue()),$.txtparent_board_id.getValue(),$.chk1.getValue(),"#EmpCode#",$.chk2.getValue(),changedRows[i].dept_code,changedRows[i].rw_type,"",""])}if(tmp1!=null){rows.push(tmp1)}json=createExecuteParamInfo("P_crmPostManageAction_S",rows)}else{if(workType=="EMP"){var json="";var changedRows=$.grdEmp.getChangedRows();var rows=[];for(var i in changedRows){rowTypes=changedRows[i].rowType;rows.push([workType,rowTypes,$.txtboard_id.getValue(),$.txtboard_name.getValue(),$.txtdept_code.getValue(),Number($.numorder_seq.getValue()),$.txtparent_board_id.getValue(),$.chk1.getValue(),"#EmpCode#",$.chk2.getValue(),"","",changedRows[i].employee_id,changedRows[i].rw_type])}if(tmp2!=null){rows.push(tmp2)}json=createExecuteParamInfo("P_crmPostManageAction_S",rows)}else{var json=createExecuteParamInfo("P_crmPostManageAction_S",[workType,"",$.txtboard_id.getValue(),$.txtboard_name.getValue(),$.txtdept_code.getValue(),Number($.numorder_seq.getValue()),$.txtparent_board_id.getValue(),$.chk1.getValue(),"#EmpCode#",$.chk2.getValue(),"","","",""]);log(JSON.stringify(json))}}return json}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,700);$.panMain.setText("");$.panMain.setBottomLine(true);$.panLeft=new FingerPanel(host,"panLeft",0,0,355,700);$.panLeft.setText("게시판 리스트");$.panLeft.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",365,0,835,185);$.panQuery.setText("게시판 정보");$.panQuery.setBottomLine(true);$.panDept=new FingerPanel(host,"panDept",365,195,415,505);$.panDept.setText("부서 권한");$.panDept.setBottomLine(true);$.panEmp=new FingerPanel(host,"panEmp",785,195,415,505);$.panEmp.setText("개인 권한");$.panEmp.setBottomLine(true);$.lblboard_name=new FingerLabel(host,"lblboard_name",0,15,100,20);$.lblboard_name.setText("게시판명");$.txtboard_name=new FingerEdit(host,"txtboard_name",105,15,550,20);$.txtboard_id=new FingerEdit(host,"txtboard_id",660,15,140,20);$.lblparent_board_id=new FingerLabel(host,"lblparent_board_id",0,45,100,20);$.lblparent_board_id.setText("상위게시판");$.txtParentName=new FingerButtonEdit(host,"txtParentName",105,45,550,20);$.txtParentName.setText("");$.txtdept_code=new FingerEdit(host,"txtdept_code",660,45,140,20);$.lbldept_code=new FingerLabel(host,"lbldept_code",0,75,100,20);$.lbldept_code.setText("소유부서");$.txtdept_name=new FingerButtonEdit(host,"txtdept_name",105,75,190,20);$.txtdept_name.setText("");$.lblorder_seq=new FingerLabel(host,"lblorder_seq",410,75,100,20);$.lblorder_seq.setText("정렬순서");$.numorder_seq=new FingerSpinEdit(host,"numorder_seq",515,75,140,20);$.txtparent_board_id=new FingerEdit(host,"txtparent_board_id",660,75,140,20);$.btnSearch=new FingerButton(host,"btnSearch",275,-40.5,80,20);$.btnSearch.setText("조회");$.lblgroup_yn=new FingerLabel(host,"lblgroup_yn",0,105,100,20);$.lblgroup_yn.setText("그룹여부");$.chk1=new FingerCheckBox(host,"chk1",105,105,140,20);$.chk1.setText("");$.lbldelete_yn=new FingerLabel(host,"lbldelete_yn",410,105,100,20);$.lbldelete_yn.setText("삭제여부");$.chk2=new FingerCheckBox(host,"chk2",515,105,135,20);$.chk2.setText("");$.txtRdept_code=new FingerEdit(host,"txtRdept_code",660,105,140,20);$.grdTree=new FingerDataGrid(host,"grdTree",0,0,355,655);$.grdDept=new FingerDataGrid(host,"grdDept",0,0,415,460);$.grdEmp=new FingerDataGrid(host,"grdEmp",0,0,415,460);$.txtboard_id.setVisible(false);$.txtdept_code.setVisible(false);$.txtparent_board_id.setVisible(false);$.txtRdept_code.setVisible(false);$.chk2.setVisible(false);$.lbldelete_yn.setVisible(false);$.txtboard_name.setAllowBlank(false,"게시판명");$.txtdept_name.setAllowBlank(false,"소유부서");$.panQuery.addButtons(["btnDelete","btnSave","btnNew"]);$.panDept.addButtons(["btnDelete","btnSave","btnAdd"]);$.panEmp.addButtons(["btnDelete","btnSave","btnAdd"]);$.panQuery.disableButton(["btnSave"]);$.grdTree.setColumns([new FingerDataGridColumn("KeyID",50,"left","string","keyId",{hidden:true}),new FingerDataGridColumn("board_id",70,"left","string","게시판아이디",{hidden:true}),new FingerDataGridColumn("board_name",195,"left","string","게시판명",{template:"tree"}),new FingerDataGridColumn("board_count",70,"right","string","게시글수"),new FingerDataGridColumn("dept_code",70,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("dept_name",70,"left","string","소유부서"),new FingerDataGridColumn("order_seq",70,"left","string","정렬순서",{hidden:true}),new FingerDataGridColumn("parent_board_id",70,"left","string","상위게시판 아이디",{hidden:true}),new FingerDataGridColumn("group_yn",70,"left","string","그룹여부",{hidden:true}),new FingerDataGridColumn("delete_yn",70,"left","string","삭제여부",{hidden:true}),new FingerDataGridColumn("ParentName",70,"left","string","상위글명",{hidden:true})]);$.grdTree.init({view:"treetable",scroll:"xy",treeKey:{id:"KeyID",parent:"ParentKeyID"}});$.grdTree.setBorder(false);$.grdDept.setColumns([new FingerDataGridColumn("dept_code",150,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("dept_name",150,"left","string",{text:"부서명",css:"col_chk"},{readonly:true}),new FingerDataGridColumn("rw_type",60,"left","string",{text:"R/W",css:"col_chk"}),new FingerDataGridColumn("update_time",110,"left","string","수정일시",{readonly:true}),new FingerDataGridColumn("updateuser",75,"left","string","수정자",{readonly:true})]);$.grdDept.init({panel:$.panDept,nonExcel:true,isFilter:false});$.grdDept.setBorder(false);$.grdDept.setEditable(true);$.grdEmp.setColumns([new FingerDataGridColumn("employee_id",150,"left","string","사원아이디",{hidden:true}),new FingerDataGridColumn("emp_name",150,"left","string",{text:"사원명",css:"col_chk"},{readonly:true}),new FingerDataGridColumn("rw_type",60,"left","string",{text:"R/W",css:"col_chk"}),new FingerDataGridColumn("update_time",110,"left","string","수정일시",{readonly:true}),new FingerDataGridColumn("updateuser",75,"left","string","수정자",{readonly:true})]);$.grdEmp.init({panel:$.panEmp,nonExcel:true,isFilter:false});$.grdEmp.setBorder(false);$.grdEmp.setEditable(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panLeft);$.panMain.add($.panQuery);$.panMain.add($.panDept);$.panMain.add($.panEmp);$.panLeft.add($.btnSearch);$.panLeft.add($.grdTree);$.panQuery.add($.lblboard_name);$.panQuery.add($.txtboard_name);$.panQuery.add($.txtboard_id);$.panQuery.add($.lblparent_board_id);$.panQuery.add($.txtParentName);$.panQuery.add($.txtdept_code);$.panQuery.add($.lbldept_code);$.panQuery.add($.txtdept_name);$.panQuery.add($.lblorder_seq);$.panQuery.add($.numorder_seq);$.panQuery.add($.txtparent_board_id);$.panQuery.add($.lblgroup_yn);$.panQuery.add($.chk1);$.panQuery.add($.lbldelete_yn);$.panQuery.add($.chk2);$.panQuery.add($.txtRdept_code);$.panDept.add($.grdDept);$.panEmp.add($.grdEmp);QueryClick();var ds=bizComponentData2($,"Q2","L_CRM0019");$.grdDept.setColumnDropDownList("rw_type",ds.resultList[0],{key:"sub_code",name:"code_name"});$.grdEmp.setColumnDropDownList("rw_type",ds.resultList[0],{key:"sub_code",name:"code_name"});if(g_main.session.obj.SystemDeptCode==g_main.session.obj.DeptCode){}else{$.chk1.setEnable(false);$.txtdept_name.setEnable(false);$.txtdept_code.setEnable(false);$.txtParentName.setEnable(true);$.chk2.setEnable(false)}};$.callback=function(type,ds){};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){QueryClick()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="txtdept_name"){var param={dept_name:$.txtdept_name.getText()};g_main.openPopup("popDept.html","popDept","",0,0,"","",param,"","");if(panQueryDataStatus!="N"){panQueryDataStatus="U"}}else{if(id=="txtParentName"){var param={};g_main.openPopup("popCondition.html","popCondition","",400,585,"","",param,"","");if(panQueryDataStatus!="N"){panQueryDataStatus="U"}}}};$.fingerbuttonedit_change=function(id,value){if(id=="txtParentName"||id=="txtdept_name"){$.panQuery.enableButton(["btnSave"]);if(panQueryDataStatus!="N"){panQueryDataStatus="U"}}};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){if(id=="chk1"){$.panQuery.enableButton(["btnSave"]);if(panQueryDataStatus!="N"){panQueryDataStatus="U"}}};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){$.popUpCallId=id;if(id=="grdDept"){if(cInd=="dept_name"){var rId=$.grdDept.getSelectedRowIdx();if($.grdDept.getRowStatus(rId)=="N"){var param={dept_name:$.grdDept.getValue(rId,"dept_name")||""};g_main.openPopup("popDept.html","popDept","",0,0,"","",param,"","")}}}else{if(id=="grdEmp"){if(cInd=="emp_name"){var rId=$.grdEmp.getSelectedRowIdx();if($.grdEmp.getRowStatus(rId)=="N"){var param={emp_name:$.grdEmp.getValue(rId,"emp_name")};g_main.openPopup("popEmpInfo.html","popEmpInfo","",0,0,"","",param,"","")}}}}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdTree"){$.txtboard_id.setValue($.grdTree.getValue(rId,"board_id"));$.numorder_seq.setValue($.grdTree.getValue(rId,"order_seq"));$.txtboard_name.setValue($.grdTree.getValue(rId,"board_name"));$.txtParentName.setText($.grdTree.getValue(rId,"ParentName"));$.txtdept_code.setValue($.grdTree.getValue(rId,"dept_code"));$.txtdept_name.setText($.grdTree.getValue(rId,"dept_name"));$.txtparent_board_id.setValue($.grdTree.getValue(rId,"parent_board_id"));$.chk1.setValue($.grdTree.getValue(rId,"group_yn"));$.chk2.setValue($.grdTree.getValue(rId,"delete_yn"));if(RoleRefreshYN=="Y"){fnQRY_P_crmPostManageAction_Q("ROLE")}if($.chk1.getValue()=="Y"){fnbtnvisible(false);if(g_main.session.obj.SystemDeptCode==g_main.session.obj.DeptCode){$.panQuery.setEnable(true);$.panQuery.enableButton(["btnDelete"])}else{$.panQuery.setEnable(false);$.panQuery.disableButton(["btnDelete"])}}else{fnbtnvisible(true);$.panQuery.setEnable(true);$.panQuery.enableButton(["btnDelete"])}if($.chk2.getValue()=="Y"){$.panQuery.disableButton(["btnDelete"])}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txtboard_name"||id=="numorder_seq"){$.panQuery.enableButton(["btnSave"]);if(panQueryDataStatus!="N"){panQueryDataStatus="U"}}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDept"){if(btnId=="btnAdd"){if($.txtboard_id.getValue()==""){return}$.grdDept.addRow({rw_type:"R"})}else{if(btnId=="btnSave"){if($.txtboard_id.getValue()==""){return}fnSET_P_crmPostManageAction_S("DEPT")}else{if(btnId=="btnDelete"){if($.grdDept.getRowCount()<1){return}var rId=$.grdDept.getSelectedRowIdx();var rowS=$.grdDept.getRowStatus(rId);if(rowS=="N"){$.grdDept.deleteRow(rId);$.grdDept.selectRow(0)}else{confirmBoxShow("정말 삭제하시겠습니까?",function(){if(g_main.msgShare==true){tmp1.push("DEPT","D",$.txtboard_id.getValue(),$.txtboard_name.getValue(),$.txtdept_code.getValue(),Number($.numorder_seq.getValue()),$.txtparent_board_id.getValue(),$.chk1.getValue(),"#EmpCode#",$.chk2.getValue(),$.grdDept.getValue(rId,"dept_code"),$.grdDept.getValue(rId,"rw_type"),"","");$.grdDept.deleteRow(rId);$.grdDept.selectRow(0)}})}}}}}else{if(panelId=="panEmp"){if(btnId=="btnAdd"){if($.txtboard_id.getValue()==""){return}$.grdEmp.addRow({rw_type:"R"})}else{if(btnId=="btnSave"){if($.txtboard_id.getValue()==""){return}fnSET_P_crmPostManageAction_S("EMP")}else{if(btnId=="btnDelete"){if($.txtboard_id.getValue()==""){return}if($.grdEmp.getRowCount()<1){return}var rId=$.grdEmp.getSelectedRowIdx();var rowS=$.grdEmp.getRowStatus(rId);if(rowS=="N"){$.grdEmp.deleteRow(rId);$.grdEmp.selectRow(0)}else{confirmBoxShow("정말 삭제하시겠습니까?",function(){if(g_main.msgShare==true){tmp2.push("EMP","D",$.txtboard_id.getValue(),$.txtboard_name.getValue(),$.txtdept_code.getValue(),Number($.numorder_seq.getValue()),$.txtparent_board_id.getValue(),$.chk1.getValue(),"#EmpCode#",$.chk2.getValue(),"","",$.grdEmp.getValue(rId,"employee_id"),$.grdEmp.getValue(rId,"rw_type"));$.grdEmp.deleteRow(rId);$.grdEmp.selectRow(0)}})}}}}}else{if(panelId=="panQuery"){if(btnId=="btnNew"){$.panQuery.clear();$.grdDept.clear();$.grdEmp.clear();$.panQuery.setEnable(true);fnbtnvisible(false);if(g_main.session.obj.SystemDeptCode==g_main.session.obj.DeptCode){}else{$.txtdept_name.setValue(g_main.session.obj.DeptName);$.txtdept_code.setValue(g_main.session.obj.DeptCode)}$.txtboard_name.setFocus();$.chk2.setValue("N");panQueryDataStatus="N"}else{if(btnId=="btnDelete"){if($.txtboard_id.getValue()==""){return}RoleRefreshYN="N";confirmBoxShow("["+$.txtboard_name.getValue()+"] 게시판을 삭제하시겠습니까?",function(){if(g_main.msgShare==true){if(fnSET_P_crmPostManageAction_S("D")){QueryClick()}}});RoleRefreshYN="Y"}else{if(btnId=="btnSave"){if(panQueryDataStatus=="N"&&$.chk1.getValue()=="Y"){RoleRefreshYN="Y"}else{RoleRefreshYN="N"}if(panQueryDataStatus=="U"){if(g_main.session.obj.DeptCode==$.txtRdept_code.getValue()||g_main.session.obj.DeptCode==g_main.session.obj.SystemDeptCode){if(fnSET_P_crmPostManageAction_S(panQueryDataStatus)){var strboard_id=$.txtboard_id.getValue();QueryClick();return}else{MessageBoxShow("crmPostManageAction_002");return}}}else{if(panQueryDataStatus=="N"){if(fnSET_P_crmPostManageAction_S(panQueryDataStatus)){var strboard_id=$.txtboard_id.getValue();QueryClick()}}}RoleRefreshYN="Y"}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if($.popUpCallId=="txtdept_name"){if(popResult!=null){$.txtdept_code.setValue(popResult.dept_code);$.txtdept_name.setText(popResult.dept_name)}}else{if($.popUpCallId=="grdDept"){if(popResult!=null){var rId=$.grdDept.getSelectedRowIdx();$.grdDept.setValue(rId,"dept_code",popResult.dept_code);$.grdDept.setValue(rId,"dept_name",popResult.dept_name)}}else{if($.popUpCallId=="grdEmp"){if(popResult!=null){var rId=$.grdEmp.getSelectedRowIdx();$.grdEmp.setValue(rId,"employee_id",popResult.employee_id);$.grdEmp.setValue(rId,"emp_name",popResult.emp_name)}}else{if($.popUpCallId=="txtParentName"){if(popResult!=null){$.txtParentName.setText(popResult.board_name);$.txtparent_board_id.setValue(popResult.board_id)}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){}};</script>