<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panAppr=null;$.panView=null;$.tabView=null;$.panViewer1=null;$.panViewer2=null;$.grdList=null;$.htmView1=null;$.htmView2=null;$.panViewer3=null;$.panViewer4=null;$.panViewer5=null;$.htmView3=null;$.htmView4=null;$.htmView5=null;$.btnSearch=null;$.panQuery=null;$.lblWfDate=null;$.lblTerm1=null;$.dteWfFrom=null;$.dteWfTo=null;$.lblBatchJournal=null;$.chkBatchJournal=null;$.lblRePrint=null;$.chkRePrint=null;$.lblParkingYn=null;$.chkParkingYn=null;$.lblEseroYn=null;$.chkEseroYn=null;$.lblCardYn=null;$.chkCardYn=null;$.lblReceiptDate=null;$.lblReceiptDateTerm=null;$.dteReceiptDateFrom=null;$.dteReceiptDateTo=null;$.lblDeptCode=null;$.lblDeptCodeTerm=null;$.cmbDeptFrom=null;$.cmbDeptTo=null;$.lblEmpName=null;$.cmbEmpName=null;$.btnReject=null;$.lblTransNoYn=null;$.chkTransNoYn=null;$.varWFDocId="";$.varWFDocIdB1="";$.varBusinessID="";$.varBatchYn="N";$.strAccCode_00="53140100";$.strAccCode_10="53140200";$.strAccCode_20="53140100";$.strAccCode_30="53140300";$.strAccCode_40="53140400";$.strAccCode_50="53140100";$.strAccCode_60="53140900";$.strAccName_00="接待費-Card";$.strAccName_10="接待費-現金";$.strAccName_20="接待費-Card";$.strAccName_30="接待費-稅金計算書";$.strAccName_40="接待費-計算書";$.strAccName_50="接待費-Card";$.strAccName="";function createJSON_Q(workType,wfDocId){var json=createExecuteParamInfo("P_crmPrintAllSlip_Q2",[workType,workType=="Q"||workType=="Q1"||workType=="Q2"||workType=="Q4"?"":wfDocId,$.cmbDeptFrom.getValue()||"",$.cmbDeptTo.getValue()||"",$.cmbEmpName.getValue()||"",$.dteWfFrom.getValue()||"",$.dteWfTo.getValue()||"",$.dteReceiptDateFrom.getValue()||"",$.dteReceiptDateTo.getValue()||"",$.chkParkingYn.getValue()||"N",$.chkRePrint.getValue()||"N",$.chkBatchJournal.getValue()||"N"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmBudgetUseCHK_S",[workType,$.varWFDocId||"",(workType=="Q"?0:$.arResult[0]),(workType=="Q"?0:$.arResult[1]),(workType=="Q"?"#UserID#":""),(workType=="Q"?$.varBatchYn:"")]);return json}function createJSON_Q3(strAccCode){var json=createExecuteParamInfo("P_crmAPP_ExistERPChk_Q",["Q",strAccCode]);return json}function createJSON_S(workType){var aRows=$.grdList.getAllRows();var rows=[];for(var i in aRows){if(aRows[i].chk_yn=="Y"){rows.push([workType,aRows[i].wf_doc_id])}}return createExecuteParamInfo("P_crmPrintAllSlip_S",rows)}function initControls(){}function searchList(workType,wfDocId){var json=createJSON_Q(workType,wfDocId);callQuery(["req",json],workType,$)}function saveReject(workType){var json=createJSON_S(workType);if(json){callExecute(["req",json],workType,$)}}function B1oJournalVouchers(){var json=createJSON_Q2("Q");var ds=callExecuteSync(["req",json],"Q",$);if(ds){var rs1=overrideBracket(ds.resultList[0][0]);var rs2=overrideBracket(ds.resultList[1]);if(ds.errorCode.substr(0,1)=="E"||ds.errorCode.substr(0,1)=="P"){MessageBoxShow(ds.errorCode+" (분개장번호: "+ds.returnStr+")");return}if($.varBusinessID=="BP00000017"){searchPrintDoc($.varWFDocId);return}if(ds.resultList[0].length>0){if(rs1.B1Exist=="Y"){log("B1Exist : "+rs1.B1Exist);console.log("B1Exist : "+rs1.B1Exist);return}if(rs1.B1JournalExist=="Y"){log("B1JournalExist : "+rs1.B1JournalExist);console.log("B1JournalExist : "+rs1.B1JournalExist);return}}if($.varBusinessID!="BP00000017"){var iRowCnt=rs2.length;var iPMoney=0;var iPCard=0;var bAllEqual=false;var bNoVat=false;var strPRCPCLS="",struse_type=rs1.use_type,stremployee_id=rs1.employee_id,strfor_dept_name=rs1.for_dept_name,strfor_emp_name=rs1.for_emp_name,strAcctName=rs1.AcctName,strcp_code=rs1.cp_code,strbudget_name_for=rs1.budget_name_for,struse_remark=rs1.use_remark,strsales_dept_yn=rs1.sales_dept_yn,strmarketing_dept_yn=rs1.marketing_dept_yn,strbudget_acctype=rs1.budget_acctype,strpay_me=rs1.pay_me,strplan_check=rs1.plan_check,strU_CardNo="",U_USERID=stremployee_id,U_USERNAME=strfor_emp_name,U_DEPTCODE=rs1.use_dept_code,U_DEPTNAME=strfor_dept_name,U_Drftnum=$.varWFDocId,iTotalUseAmt=0,iTotalVatAmt=0,iTotalNoVatAmt=0,iUseAmt=0,iVatAmt=0,iNoVatAmt=0,iTotalPlanAmt=rs1.plan_amt,iPlanDiffAmt=rs1.plan_diff_amt;for(var i in rs2){if(rs2[i].receipt_type=="10"){iPMoney++}else{if(rs2[i].receipt_type=="20"){iPCard++}}iTotalUseAmt+=rs2[i].use_amt;iTotalVatAmt+=rs2[i].tax_amt;iTotalNoVatAmt+=rs2[i].nodeduction_amt;if(!bNoVat&&rs2[i].nodeduction_amt!=0){bNoVat=true}}var strCurrDate=getToday("");var alLine_ID=[],alAccountCode=[],alDebit=[],alCredit=[],alShortName=[],alLineMemo=[],alReferenceDate1=[],alReference2=[],alTaxDate=[],alU_TAXDT=[],alBaseSum=[],alTaxGroup=[],alVatAmount=[],alCostingCode=[],alU_CardNo=[],alU_ApprNo=[],alU_VatRegN=[],alU_VatBP=[],alU_VatBpNM=[],alU_UserName=[],alU_VatBPNM1=[],alU_ItemGroup=[],alU_PayMe=[],alU_BankCode=[],alU_Account=[],alU_AcctName=[],alU_CARDCD=[],alU_CARDNM=[],alU_SAUPNO=[],alU_SUPAMT=[],alU_VAT=[];var strMemo_orgin="",strMemo="",strSAccCd="",strMAccCd="",strPromoCode="",strLineMemo="",strUseDate="",strDeptCode="",strTaxGrp="";var iLine_ID=0;if(struse_remark==""||strbudget_acctype=="90"){strMemo_orgin=strbudget_name_for+" "+strfor_dept_name+"-"+strfor_emp_name}else{strMemo_orgin=struse_remark}var sarLineMemo_tmp=[];for(var i in rs2){var strVatBP="";var strPRCPCLS2=rs2[i].receipt_type;iUseAmt=rs2[i].use_amt;iVatAmt=rs2[i].tax_amt;iNoVatAmt=rs2[i].nodeduction_amt;if($.strAccCode_00==rs1.account_code){bAllEqual=false}if($.strAccCode_60==rs1.account_code){bAllEqual=false}if("Y"==rs1.grape_yn){bAllEqual=false}strMAccCd=fnAccConverter(rs1.account_code,strPRCPCLS2);strPromoCode=rs1.promo_code;strPromoName=rs1.promo_name;strMemo=strMemo_orgin;strLineMemo=strMemo;strUseDate=rs2[i].use_date;strDeptCode=rs2[i].dept_code||"";sarLineMemo_tmp.push(strLineMemo);if(strMAccCd==""){MessageBoxShow("회계계정 부분에서 에러가 발생하였습니다.");return}if(bAllEqual){if(i==rs2.length-1){alLine_ID.push(iLine_ID++);alAccountCode.push(strMAccCd);alDebit.push(iTotalUseAmt);alCredit.push("");alShortName.push("");alLineMemo.push(strLineMemo);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");if(bNoVat){alTaxGroup.push("X4");alVatAmount.push("")}else{alTaxGroup.push("");alVatAmount.push("")}alCostingCode.push(strDeptCode);alU_CardNo.push("");alU_ApprNo.push("");alU_VatRegN.push("");alU_VatBP.push("");alU_VatBpNM.push("");alU_UserName.push(U_USERNAME);alU_VatBPNM1.push("");alU_ItemGroup.push("");alU_PayMe.push("");alU_BankCode.push("");alU_Account.push("");alU_AcctName.push("");alU_CARDCD.push("");alU_CARDNM.push("");alU_SAUPNO.push("");alU_SUPAMT.push("");alU_VAT.push("")}}else{alLine_ID.push(iLine_ID++);alAccountCode.push(strMAccCd);alDebit.push(iUseAmt);alCredit.push("");alShortName.push("");alLineMemo.push(strLineMemo);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");if(bNoVat&&iNoVatAmt!=0){alTaxGroup.push("X4");alVatAmount.push("")}else{if(bNoVat&&iVatAmt!=0){switch(strPRCPCLS2){case"30":strTaxGrp="V2";break;case"40":strTaxGrp="V0";break;case"50":strTaxGrp="V5";break;default:strTaxGrp="";break}alTaxGroup.push(strTaxGrp);alVatAmount.push("")}else{alTaxGroup.push("");alVatAmount.push("")}}alCostingCode.push(strDeptCode);alU_CardNo.push("");alU_ApprNo.push("");alU_VatRegN.push("");alU_VatBP.push("");alU_VatBpNM.push("");alU_UserName.push(U_USERNAME);alU_VatBPNM1.push("");alU_ItemGroup.push("");alU_PayMe.push("");alU_BankCode.push("");alU_Account.push("");alU_AcctName.push("");alU_CARDCD.push("");alU_CARDNM.push("");alU_SAUPNO.push("");alU_SUPAMT.push("");alU_VAT.push("")}if(!bNoVat&&strPRCPCLS2=="40"){strSAccCd="11113100";strVatBP=rs2[i].account_comp_code;alLine_ID.push(iLine_ID++);alAccountCode.push(strSAccCd);alDebit.push(0);alCredit.push("");alShortName.push("");alLineMemo.push(strLineMemo);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push(iUseAmt);alTaxGroup.push("V0");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push("");alU_ApprNo.push("");alU_VatRegN.push("");alU_VatBP.push(strVatBP);alU_VatBpNM.push("");alU_UserName.push("");alU_VatBPNM1.push("");alU_ItemGroup.push("");alU_PayMe.push("");alU_BankCode.push("");alU_Account.push("");alU_AcctName.push("");alU_CARDCD.push(strVatBP);alU_CARDNM.push("");alU_SAUPNO.push("");alU_SUPAMT.push(iUseAmt);alU_VAT.push("")}strVatBP=rs2[i].account_comp_code;if(!bNoVat&&iVatAmt!=0){strSAccCd="11113100";switch(strPRCPCLS2){case"30":strTaxGrp="V2";break;case"40":strTaxGrp="V0";break;case"50":strTaxGrp="V5";break;default:strTaxGrp="";break}alLine_ID.push(iLine_ID++);alAccountCode.push(strSAccCd);alDebit.push(iVatAmt);alCredit.push("");alShortName.push("");alLineMemo.push(strLineMemo);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push(iUseAmt);alTaxGroup.push(strTaxGrp);alVatAmount.push("");alCostingCode.push("");alU_CardNo.push("");alU_ApprNo.push("");alU_VatRegN.push("");alU_VatBP.push(strVatBP);alU_VatBpNM.push("");alU_UserName.push("");alU_VatBPNM1.push("");alU_ItemGroup.push("");alU_PayMe.push("");alU_BankCode.push("");alU_Account.push("");alU_AcctName.push("");alU_CARDCD.push("");alU_CARDNM.push("");alU_SAUPNO.push("");alU_SUPAMT.push("");alU_VAT.push("")}}var bShotNameYN=false;iUseAmt=0;iVatAmt=0;iNoVatAmt=0;var strU_VatRegN="";var strU_VatBP="";var strU_VatBPNM1="";var strU_CardNo="";var strU_ApprNo="";var strU_VatBPNM="";var strU_PayMe="";var strU_BankCode="";var strU_Account="";var strU_AcctName="";for(var k in rs2){strPRCPCLS=rs2[k].receipt_type;strUseDate=rs2[k].use_date;if(struse_type=="40"){strSAccCd="11109200"}else{if(strPRCPCLS=="10"){strSAccCd=rs2[k].deposit_emp_code;bShotNameYN=true}else{if(strPRCPCLS=="20"||strPRCPCLS=="50"){strSAccCd=rs2[k].deposit_emp_code;if(strSAccCd.indexOf("ka")>=0||strSAccCd.indexOf("ypc")>=0||strSAccCd.indexOf("YPC")>=0||strSAccCd.indexOf("AP")>=0){strSAccCd=strSAccCd+"(card)"}bShotNameYN=true}else{strSAccCd=rs2[k].account_comp_code;bShotNameYN=true}}}iUseAmt=rs2[k].use_amt;iVatAmt=rs2[k].tax_amt;iNoVatAmt=rs2[k].nodeduction_amt;strU_VatBP=rs2[k].account_comp_code;strU_VatBPNM1=rs2[k].VatBPNM1;strU_VatRegN=rs2[k].VatRegN;strU_CardNo=rs2[k].CARDNO;if(strU_CardNo.length>=16){if(strU_CardNo.indexOf("-")<0){strU_CardNo=strU_CardNo.substr(0,4)+"-"+strU_CardNo.substr(4,4)+"-"+strU_CardNo.substr(8,4)+"-"+strU_CardNo.substr(12,4)}}strU_ApprNo=rs2[k].APPRNO;strU_VatBPNM=rs2[k].VENKNM;strU_PayMe=rs2[k].pay_me;if(strU_PayMe=="Y"){strU_BankCode=rs2[k].bank;strU_Account=rs2[k].account;strU_AcctName=rs2[k].acct_name}else{strU_BankCode=rs2[k].bank;strU_Account=rs2[k].account;strU_AcctName=rs2[k].acct_name}if(strPRCPCLS=="10"||strPRCPCLS=="20"){if(bShotNameYN){alAccountCode.push("");alShortName.push(strSAccCd)}else{alAccountCode.push(strSAccCd);alShortName.push("")}alLine_ID.push(iLine_ID++);alDebit.push("");alCredit.push(iUseAmt);alLineMemo.push(sarLineMemo_tmp[k]);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");alTaxGroup.push("");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push(strU_CardNo);alU_ApprNo.push(strU_ApprNo);alU_VatRegN.push(strU_VatRegN);alU_VatBP.push(strU_VatBP);alU_VatBpNM.push(strU_VatBPNM);alU_UserName.push(U_USERNAME);alU_VatBPNM1.push(strU_VatBPNM1);alU_ItemGroup.push("");alU_PayMe.push(strU_PayMe);alU_BankCode.push(strU_BankCode);alU_Account.push(strU_Account);alU_AcctName.push(strU_AcctName);alU_CARDCD.push(strU_VatBP);alU_CARDNM.push(strU_VatBPNM1);alU_SAUPNO.push(strU_VatRegN);alU_SUPAMT.push("");alU_VAT.push("");if(strSAccCd==""){MessageBoxShow("전표처리중 상대계정에 에러가 발생하였습니다.");return}else{if(!chkERP(strSAccCd)){if(bShotNameYN){MessageBoxShow("ERP : Not Exist (ShortName)")}else{MessageBoxShow("ERP : Not Exist (AccountCode)")}return}}}else{if(iVatAmt!=0){iUseAmt+=iVatAmt;if(bShotNameYN){alAccountCode.push("");alShortName.push(strSAccCd)}else{alAccountCode.push(strSAccCd);alShortName.push("")}alLine_ID.push(iLine_ID++);alDebit.push("");alCredit.push(iUseAmt);alLineMemo.push(sarLineMemo_tmp[k]);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");alTaxGroup.push("");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push(strU_CardNo);alU_ApprNo.push(strU_ApprNo);alU_VatRegN.push(strU_VatRegN);alU_VatBP.push(strU_VatBP);alU_VatBpNM.push(strU_VatBPNM);alU_UserName.push(U_USERNAME);alU_VatBPNM1.push(strU_VatBPNM1);alU_ItemGroup.push("");alU_PayMe.push(strU_PayMe);alU_BankCode.push(strU_BankCode);alU_Account.push(strU_Account);alU_AcctName.push(strU_AcctName);alU_CARDCD.push(strU_VatBP);alU_CARDNM.push(strU_VatBPNM1);alU_SAUPNO.push(strU_VatRegN);alU_SUPAMT.push("");alU_VAT.push("")}else{if(bNoVat){iUseAmt+=iNoVatAmt;alLine_ID.push(iLine_ID++);alAccountCode.push("");alDebit.push("");alCredit.push(iUseAmt);alShortName.push(strSAccCd);alLineMemo.push(sarLineMemo_tmp[k]);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");alTaxGroup.push("");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push(strU_CardNo);alU_ApprNo.push(strU_ApprNo);alU_VatRegN.push(strU_VatRegN);alU_VatBP.push(strU_VatBP);alU_VatBpNM.push(strU_VatBPNM);alU_UserName.push(U_USERNAME);alU_VatBPNM1.push(strU_VatBPNM1);alU_ItemGroup.push("");alU_PayMe.push(strU_PayMe);alU_BankCode.push(strU_BankCode);alU_Account.push(strU_Account);alU_AcctName.push(strU_AcctName);alU_CARDCD.push(strU_VatBPNM1);alU_CARDNM.push(strU_VatBP);alU_SAUPNO.push(strU_VatRegN);alU_SUPAMT.push("");alU_VAT.push("")}else{if(bShotNameYN){alAccountCode.push("");alShortName.push(strSAccCd)}else{alAccountCode.push(strSAccCd);alShortName.push("")}alLine_ID.push(iLine_ID++);alDebit.push("");alCredit.push(iUseAmt);alLineMemo.push(sarLineMemo_tmp[k]);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");alTaxGroup.push("");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push(strU_CardNo);alU_ApprNo.push(strU_ApprNo);alU_VatRegN.push(strU_VatRegN);alU_VatBP.push(strU_VatBP);alU_VatBpNM.push(strU_VatBPNM);alU_UserName.push(U_USERNAME);alU_VatBPNM1.push(strU_VatBPNM1);alU_ItemGroup.push("");alU_PayMe.push(strU_PayMe);alU_BankCode.push(strU_BankCode);alU_Account.push(strU_Account);alU_AcctName.push(strU_AcctName);alU_CARDCD.push(strU_VatBP);alU_CARDNM.push(strU_VatBPNM1);alU_SAUPNO.push(strU_VatRegN);alU_SUPAMT.push("");alU_VAT.push("")}}if(strSAccCd==""){MessageBoxShow("전표처리중 상대계정에 에러가 발생하였습니다.");return}else{if(!chkERP(strSAccCd)){if(bShotNameYN){MessageBoxShow("ERP : Not Exist (ShortName)")}else{MessageBoxShow("ERP : Not Exist (AccountCode)")}return}}}bShotNameYN=false}if(struse_type=="40"&&iPlanDiffAmt!=0){strSaccCd="11107100";alAccountCode.push(strSAccCd);alShortName.push("");alLine_ID.push(iLine_ID++);alDebit.push(iPlanDiffAmt);alCredit.push("");alLineMemo.push(strMemo);alReferenceDate1.push(strCurrDate);alReference2.push(strUseDate);alTaxDate.push(strUseDate);alU_TAXDT.push(strUseDate);alBaseSum.push("");alTaxGroup.push("");alVatAmount.push("");alCostingCode.push("");alU_CardNo.push("");alU_ApprNo.push("");alU_VatRegN.push("");alU_VatBP.push("");alU_VatBpNM.push("");alU_UserName.push("");alU_VatBPNM1.push("");alU_ItemGroup.push("");alU_PayMe.push("N");alU_BankCode.push("");alU_Account.push("");alU_AcctName.push("");alU_CARDCD.push("");alU_CARDNM.push("");alU_SAUPNO.push("");alU_SUPAMT.push("");alU_VAT.push("")}var sarLine_ID=alLine_ID,sarAccountCode=alAccountCode,sarDebit=alDebit,sarCredit=alCredit,sarShortName=alShortName,sarLineMemo=alLineMemo,sarReferenceDate1=alReferenceDate1,sarReference2=alReference2,sarTaxDate=alTaxDate,sarU_TAXDT=alU_TAXDT,sarBaseSum=alBaseSum,sarTaxGroup=alTaxGroup,sarVatAmount=alVatAmount,sarCostingCode=alCostingCode,sarU_CardNo=alU_CardNo,sarU_ApprNo=alU_ApprNo,sarU_VatRegN=alU_VatRegN,sarU_VatBP=alU_VatBP,sarU_VatBpNM=alU_VatBpNM,sarU_UserName=alU_UserName,sarU_VatBPNM1=alU_VatBPNM1,sarU_ItemGroup=alU_ItemGroup,sarU_PayMe=alU_PayMe,sarU_BankCode=alU_BankCode,sarU_Account=alU_Account,sarU_AcctName=alU_AcctName,sarU_CARDCD=alU_CARDCD,sarU_CARDNM=alU_CARDNM,sarU_SAUPNO=alU_SAUPNO,sarU_SUPAMT=alU_SUPAMT,sarU_VAT=alU_VAT;var json=createExecuteParamInfo("oJournalVouchers_S",[stremployee_id||"","",strCurrDate,strMemo,strCurrDate,strCurrDate,strCurrDate,bNoVat?"Y":"N",U_USERID,U_USERNAME,U_DEPTCODE,U_DEPTNAME,U_Drftnum,sarLine_ID,sarAccountCode,sarDebit,sarCredit,sarShortName,sarLineMemo,sarReferenceDate1,sarReference2,sarTaxDate,sarU_TAXDT,sarBaseSum,sarTaxGroup,sarVatAmount,sarCostingCode,sarU_CardNo,sarU_ApprNo,sarU_VatRegN,sarU_VatBP,sarU_VatBpNM,sarU_UserName,sarU_VatBPNM1,sarU_ItemGroup,sarU_PayMe,sarU_BankCode,sarU_Account,sarU_AcctName,sarU_CARDCD,sarU_CARDNM,sarU_SAUPNO,sarU_SUPAMT,sarU_VAT]);var ds2=callSBO(["req",json],"Q_SAP",$,true);log(ds2);console.log(ds2);if(ds2.result.indexOf("Error")>=0){MessageBoxShow(ds2.result);return}$.arResult=ds2.result.split("\t");var json=createJSON_Q2("U");var ds3=callExecuteSync(["req",json],"U",$);log(ds3);console.log(ds3);if(ds3){if(ds3.errorCode.substr(0,1)=="P"||ds3.errorCode.substr(0,1)=="E"){MessageBoxShow("문서번호: "+$.varWFDocId+"<br>"+ds3.errorCode+"</br>"+ds3.errorMsg);return}}}if($.varBatchYn!="Y"){searchPrintDoc($.varWFDocId)}}}function fnAccConverter(value,type){var strAcc="";$.strAccName="";if(value==$.strAccCode_00){switch(type){case"10":strAcc=$.strAccCode_10;$.strAccName=$.strAccName_10;break;case"20":strAcc=$.strAccCode_20;$.strAccName=$.strAccName_20;break;case"30":strAcc=$.strAccCode_30;$.strAccName=$.strAccName_30;break;case"40":strAcc=$.strAccCode_40;$.strAccName=$.strAccName_40;break;case"50":strAcc=$.strAccCode_50;$.strAccName=$.strAccName_50;break;default:strAcc=value;break}}else{strAcc=value}return strAcc}function chkERP(strAccCode){var json=createJSON_Q3(strAccCode);var ds=callExecuteSync(["req",json],"CHK_ERP",$);if(ds.errorCode.substr(0,1)=="E"||ds.errorCode.substr(0,1)=="P"){return false}else{if(ds.resultList[0][0].CNT>0){return true}}}$.printStack=null;function printStackClear(){$.printStack=""}function searchPrintDoc(wfDocId){var json=createJSON_Q("Q3",wfDocId);var ds=callQuerySync(["req",json],"Q3");console.log(wfDocId+" ("+$.varBatchYn+")");if(ds.resultList){$.varBusinessID=ds.resultList[0][0].business_id;$.varWFDocIdB1=ds.resultList[0][0].wf_doc_id;convertJavaDateToJs(ds.resultList,"default_day");$.wfDocView1.init();$.wfDocView1.load(ds.resultList);var html=$.wfDocView1.getPrintBody();$.printStack+=html}}function printDoc(){if($.printStack){setTimeout(function(){var html=$.wfDocView1.getPrintHtml($.printStack);printHtml(html,null,function(){MessageBoxShow($.varWfPrintCnt+"건이 출력 되었습니다.");$.fingerbutton_click("btnSearch")})},1000)}else{$.fingerbutton_click("btnSearch")}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,810);$.panMain.setText("");$.panMain.setBottomLine(true);$.panAppr=new FingerPanel(host,"panAppr",0,210,390,590);$.panAppr.setText("결재 문서 목록");$.panAppr.setBottomLine(true);$.panView=new FingerPanel(host,"panView",405,0,790,800);$.panView.setText("결재 상세");$.panView.setBottomLine(true);$.tabView=new FingerTab(host,"tabView",0,0,800,800);$.panViewer1=new FingerPanel(host,"panViewer1",0,0,820,800);$.panViewer1.setText("");$.panViewer1.setBottomLine(true);$.panViewer2=new FingerPanel(host,"panViewer2",0,0,820,800);$.panViewer2.setText("");$.panViewer2.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,390,545);$.htmView1=new FingerHTMLView(host,"htmView1",0,0,800,770);$.htmView2=new FingerHTMLView(host,"htmView2",0,0,800,770);$.panViewer3=new FingerPanel(host,"panViewer3",0,0,820,800);$.panViewer3.setText("");$.panViewer3.setBottomLine(true);$.panViewer4=new FingerPanel(host,"panViewer4",0,0,820,800);$.panViewer4.setText("");$.panViewer4.setBottomLine(true);$.panViewer5=new FingerPanel(host,"panViewer5",0,0,820,800);$.panViewer5.setText("");$.panViewer5.setBottomLine(true);$.htmView3=new FingerHTMLView(host,"htmView3",0,0,800,770);$.htmView4=new FingerHTMLView(host,"htmView4",0,0,800,770);$.htmView5=new FingerHTMLView(host,"htmView5",0,0,800,770);$.btnSearch=new FingerButton(host,"btnSearch",325,-37.5,80,20);$.btnSearch.setText("조회");$.panQuery=new FingerPanel(host,"panQuery",0,0,390,200);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.lblWfDate=new FingerLabel(host,"lblWfDate",0,70,70,20);$.lblWfDate.setText("기안일자");$.lblTerm1=new FingerLabel(host,"lblTerm1",215,70,20,20);$.lblTerm1.setText("~");$.dteWfFrom=new FingerDateEdit(host,"dteWfFrom",75,70,139,20);$.dteWfTo=new FingerDateEdit(host,"dteWfTo",240,70,140,20);$.lblBatchJournal=new FingerLabel(host,"lblBatchJournal",15,5,95,20);$.lblBatchJournal.setText("일괄전표 처리");$.chkBatchJournal=new FingerCheckBox(host,"chkBatchJournal",110,9,20,20);$.chkBatchJournal.setText("");$.lblRePrint=new FingerLabel(host,"lblRePrint",140,5,90,20);$.lblRePrint.setText("기출력 조회");$.chkRePrint=new FingerCheckBox(host,"chkRePrint",225,9,20,20);$.chkRePrint.setText("");$.lblParkingYn=new FingerLabel(host,"lblParkingYn",260,5,90,20);$.lblParkingYn.setText("주차비 포함");$.chkParkingYn=new FingerCheckBox(host,"chkParkingYn",350,9,20,20);$.chkParkingYn.setText("");$.lblEseroYn=new FingerLabel(host,"lblEseroYn",210,35,140,20);$.lblEseroYn.setText("세금계산서 미처리건");$.chkEseroYn=new FingerCheckBox(host,"chkEseroYn",350,38,20,20);$.chkEseroYn.setText("");$.lblCardYn=new FingerLabel(host,"lblCardYn",10,35,125,20);$.lblCardYn.setText("법인카드 미처리건");$.chkCardYn=new FingerCheckBox(host,"chkCardYn",135,38,20,20);$.chkCardYn.setText("");$.lblReceiptDate=new FingerLabel(host,"lblReceiptDate",0,100,70,20);$.lblReceiptDate.setText("영수증");$.lblReceiptDateTerm=new FingerLabel(host,"lblReceiptDateTerm",215,100,20,20);$.lblReceiptDateTerm.setText("~");$.dteReceiptDateFrom=new FingerDateEdit(host,"dteReceiptDateFrom",75,100,140,20);$.dteReceiptDateTo=new FingerDateEdit(host,"dteReceiptDateTo",240,100,140,20);$.lblDeptCode=new FingerLabel(host,"lblDeptCode",0,130,70,20);$.lblDeptCode.setText("부서");$.lblDeptCodeTerm=new FingerLabel(host,"lblDeptCodeTerm",215,130,20,20);$.lblDeptCodeTerm.setText("~");$.cmbDeptFrom=new FingerComboBox(host,"cmbDeptFrom",75,130,145,20);$.cmbDeptTo=new FingerComboBox(host,"cmbDeptTo",240,130,145,20);$.lblEmpName=new FingerLabel(host,"lblEmpName",0,160,70,20);$.lblEmpName.setText("사원");$.cmbEmpName=new FingerComboBox(host,"cmbEmpName",75,160,145,20);$.btnReject=new FingerButton(host,"btnReject",600,-39.5,120,30);$.btnReject.setText("회계팀 반려");$.lblTransNoYn=new FingerLabel(host,"lblTransNoYn",65,35,140,20);$.lblTransNoYn.setText("전체 미처리건");$.chkTransNoYn=new FingerCheckBox(host,"chkTransNoYn",205,38,20,20);$.chkTransNoYn.setText("");var deptCode=g_main.session.obj.DeptCode;$.dteWfFrom.setValue(getToday().substr(0,6)+"01");$.dteWfTo.setValue(getToday());$.dteReceiptDateTo.setValue(getToday());$.dteWfFrom.setAllowBlank(false,"기안시작일");$.dteWfTo.setAllowBlank(false,"기안종료일");if(g_main.session.obj.SystemDeveloper=="Y"||deptCode=="G110"||g_main.session.obj.EmpCode=="AKR-T00008"){$.lblCardYn.setVisible(true);$.chkCardYn.setVisible(true)}else{$.lblCardYn.setVisible(false);$.chkCardYn.setVisible(false)}if(g_main.session.obj.SystemDeveloper=="Y"||deptCode=="G120"){$.lblEseroYn.setVisible(true);$.chkEseroYn.setVisible(true);$.lblTransNoYn.setVisible(true);$.chkTransNoYn.setVisible(true)}else{$.lblEseroYn.setVisible(false);$.chkEseroYn.setVisible(false);$.lblTransNoYn.setVisible(false);$.chkTransNoYn.setVisible(false)}$.btnReject.setVisible(false);$.panQuery.setBorder(true);$.panView.setBorder(false);$.panView.addButtons(["btnPrint"]);$.panView.disableButton(["btnPrint"]);$.wfDocView1=new CustomWfDocument($,$.htmView1);$.wfDocView2=new CustomWfDocument($,$.htmView2);$.wfDocView3=new CustomWfDocument($,$.htmView3);$.wfDocView4=new CustomWfDocument($,$.htmView4);$.wfDocView5=new CustomWfDocument($,$.htmView5);$.grdListMap=$.grdList.setColumns([new FingerDataGridColumn("chk_yn",35,"center","checkbox","masterCheckbox"),new FingerDataGridColumn("wf_doc_id",120,"left","text","문서아이디"),new FingerDataGridColumn("doc_title",180,"left","text","문서제목"),new FingerDataGridColumn("withdraw_yn",80,"left","text","회계처리"),new FingerDataGridColumn("wf_time",80,"left","text","기안일"),new FingerDataGridColumn("batch_yn",99,"left","text","일괄전표처리여부",{hidden:true}),new FingerDataGridColumn("batchnumYN",99,"left","text","분개장문서 생성여부")]);$.grdList.init({panel:$.panAppr,scroll:"xy",nonExcel:true,isFilter:false});$.grdList.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panAppr);$.panMain.add($.panView);$.panMain.add($.panQuery);$.panAppr.add($.grdList);$.panAppr.add($.btnSearch);$.panView.add($.tabView);$.panView.add($.btnReject);$.panViewer1.add($.htmView1);$.panViewer2.add($.htmView2);$.panViewer3.add($.htmView3);$.panViewer4.add($.htmView4);$.panViewer5.add($.htmView5);$.panQuery.add($.dteWfTo);$.panQuery.add($.dteWfFrom);$.panQuery.add($.lblTerm1);$.panQuery.add($.lblWfDate);$.panQuery.add($.lblBatchJournal);$.panQuery.add($.chkBatchJournal);$.panQuery.add($.lblRePrint);$.panQuery.add($.chkRePrint);$.panQuery.add($.lblParkingYn);$.panQuery.add($.chkParkingYn);$.panQuery.add($.lblEseroYn);$.panQuery.add($.chkEseroYn);$.panQuery.add($.lblCardYn);$.panQuery.add($.chkCardYn);$.panQuery.add($.lblReceiptDate);$.panQuery.add($.lblReceiptDateTerm);$.panQuery.add($.dteReceiptDateFrom);$.panQuery.add($.dteReceiptDateTo);$.panQuery.add($.lblDeptCode);$.panQuery.add($.lblDeptCodeTerm);$.panQuery.add($.cmbDeptFrom);$.panQuery.add($.cmbDeptTo);$.panQuery.add($.lblEmpName);$.panQuery.add($.cmbEmpName);$.panQuery.add($.lblTransNoYn);$.panQuery.add($.chkTransNoYn);$.cmbDeptFrom.setEmptyRow(true);$.cmbDeptTo.setEmptyRow(true);$.cmbEmpName.setEmptyRow(true);$.cmbDeptFrom.setColumn("dept_code","dept_name");$.cmbDeptTo.setColumn("dept_code","dept_name");$.cmbEmpName.setColumn("employee_id","emp_name");var ds=bizComponentData2($,"Q1","L_CRM0051_2|L_CRM0104");setComboBind([$.cmbDeptFrom,$.cmbEmpName],ds);setComboBind([$.cmbDeptTo],ds);$.tabView.addTab([{text:"기안내용",body:$.panViewer1,width:150},{text:"",body:$.panViewer2,width:200},{text:"",body:$.panViewer3,width:200},{text:"",body:$.panViewer4,width:200},{text:"",body:$.panViewer5,width:200}]);$.tabView.hideTab(1);$.tabView.hideTab(2);$.tabView.hideTab(3);$.tabView.hideTab(4);initControls()};$.callback=function(type,ds){if(type=="Q"||type=="Q1"||type=="Q2"||type=="Q4"){convertJavaDateToJs(ds.resultList);var rs=ds.resultList[0];for(var i in rs){rs[i].wf_time=rs[i].wf_time.substr(4,2)+"-"+rs[i].wf_time.substr(6,2)}setDataGrid([$.grdList],ds);$.grdList.selectRow(0)}else{if(type=="Q3"){if(ds.resultList){$.varBusinessID=ds.resultList[0][0].business_id;$.varWFDocIdB1=ds.resultList[0][0].wf_doc_id;$.panView.enableButton(["btnPrint"]);convertJavaDateToJs(ds.resultList,"default_day");var wfResult=$.wfDocView1.load(ds.resultList);var relWf=wfResult.relWf;if(relWf&&relWf.length){for(var i=0;i<relWf.length;i++){var refTab=(i+1);var refDoc=relWf[i];$.tabView.showTab(refTab);$.tabView.setTabText(refTab,refDoc.doc_title);var json=createJSON_Q("Q1",refDoc.rel_wf_doc_id);callQuery(["req",json],("WF_DOC_REL"+refTab),$)}}}else{$.panView.disableButton(["btnPrint"])}}else{if(type=="S"){if(ds.errorCode=="MSG0001"){if($.chkCardYn.getValue()=="Y"){$.chkBatchJournal.setValue("N");$.chkEseroYn.setValue("N");$.chkParkingYn.setValue("N");$.chkRePrint.setValue("N");searchList("Q1","")}else{if($.chkEseroYn.getValue()=="Y"){$.chkBatchJournal.setValue("N");$.chkRePrint.setValue("N");$.chkParkingYn.setValue("N");searchList("Q2","")}else{searchList("Q","")}}}}}}};$.update=function(args){if(args){$.varWfDocId=args.wf_doc_id;searchList("Q")}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){if($.chkCardYn.getValue()=="Y"){$.chkBatchJournal.setValue("N");$.chkEseroYn.setValue("N");$.chkParkingYn.setValue("N");$.chkRePrint.setValue("N");$.chkTransNoYn.setValue("N");searchList("Q1","")}else{if($.chkEseroYn.getValue()=="Y"){$.chkBatchJournal.setValue("N");$.chkRePrint.setValue("N");$.chkParkingYn.setValue("N");$.chkTransNoYn.setValue("N");searchList("Q2","")}else{if($.chkTransNoYn.getValue()=="Y"){$.chkBatchJournal.setValue("N");$.chkEseroYn.setValue("N");$.chkCardYn.setValue("N");$.chkParkingYn.setValue("N");$.chkRePrint.setValue("N");searchList("Q4","")}else{searchList("Q","")}}}}else{if(id=="btnReject"){var aRows=$.grdList.getAllRows();var chk_cnt=0;for(var i in aRows){if(aRows[i].chk_yn=="Y"){chk_cnt++}}if(chk_cnt>0){confirmBoxShow(chk_cnt+"건에 대해 반려 처리 하시겠습니까?",function(){if(g_main.msgShare){saveReject("S")}})}else{MessageBoxShow("선택 된 기결문서가 없습니다.");return}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteWfEmpName"){var param=null;g_main.openPopup("popEmp.html","popEmp","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbDeptFrom"){if(value){$.cmbEmpName.clear();var ds=bizComponentData2($,"Q3","L_CRM0052",value);setComboBind([$.cmbEmpName],ds)}else{$.cmbEmpName.clear()}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){$.wfDocView1.init();$.tabView.setActiveTab(0);$.tabView.hideTab(1);$.tabView.hideTab(2);$.tabView.hideTab(3);$.tabView.hideTab(4);$.varWFDocId=$.grdList.getValue(rId,"wf_doc_id");$.varBatchYn=$.grdList.getValue(rId,"batch_yn");if($.varWFDocId){searchList("Q3",$.varWFDocId)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panView"){if(btnId=="btnPrint"){printStackClear();var cnt=0;var aRows=$.grdList.getAllRows();var chkRows=[];for(var i in aRows){if(aRows[i].chk_yn=="Y"){cnt++;chkRows.push(aRows[i])}}$.varWfPrintCnt=cnt;if(cnt>0){if($.chkRePrint.getValue()=="Y"){confirmBoxShow(cnt+"건에 대해 재출력 하시겠습니까?",function(){if(g_main.msgShare){for(var i in chkRows){$.htmView1.setHTML("");$.varWFDocId=chkRows[i].wf_doc_id;$.varBatchYn=chkRows[i].batch_yn;searchPrintDoc($.varWFDocId)}printDoc()}})}else{confirmBoxShow(cnt+"건에 대해 일괄 증빙 출력 하시겠습니까?",function(){if(g_main.msgShare){for(var i in chkRows){log(i);$.htmView1.setHTML("");$.varWFDocId=chkRows[i].wf_doc_id;$.varBatchYn=chkRows[i].batch_yn;log(chkRows[i].batchnumYN);log($.varBusinessID);if(chkRows[i].batchnumYN=="N"&&($.varBusinessID=="BP00000021"||$.varBusinessID=="BP00000022"||$.varBusinessID=="BP00000023"||$.varBusinessID=="BP00000024"||$.varBusinessID=="BP00000025"||$.varBusinessID=="BP00000027"||$.varBusinessID=="BP00000028"||$.varBusinessID=="BP00000029")){B1oJournalVouchers()}else{searchPrintDoc($.varWFDocId)}}printDoc()}})}}else{MessageBoxShow("증빙출력 할 기안이 선택되지 않았습니다.");return}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popEmp"){if($.popUpCallId=="bteWfEmpName"){$.varEmployeeId=popResult.employee_id;$.bteWfEmpName.setValue(popResult.emp_name)}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>