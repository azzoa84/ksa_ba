<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTree=null;$.panInfo=null;$.panList=null;$.lblPrItemCode=null;$.txtPrItemCode=null;$.lblPrItemName=null;$.txtPrItemName=null;$.grdPrList=null;$.grdList=null;$.lblPrCode=null;$.txtPrCode=null;$.lblPrName=null;$.txtPrName=null;$.btnSearch=null;$.lblParentPrItem=null;$.bteParentPrItem=null;$.speCurStock=null;$.lblCheck1=null;$.lblCheck2=null;$.chkGroupYn=null;$.chkUseYn=null;$.lblDesc=null;$.memDesc=null;$.imgPrItem=null;$.btnAdd=null;$.btnDelete=null;$.speUnitPrice=null;$.lblUnitPrice=null;function createJson_Q(workType,itemCode,itemName){var json=createExecuteParamInfo("P_crmPromoItem_Q",[workType,workType=="Q"?$.txtPrCode.getValue():itemCode,workType=="Q"?$.txtPrName.getValue():itemName]);return json}function createJson_S(workType){var strdept_code="";var strstart_date="";var strend_date="";var strrequest_yn="";var strreq_qty="";var tempDate="";var tempDate2="";var yyyy="";var mm="";var dd="";for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"request_yn")!="Y"){$.grdList.setValue(i,"request_yn","N")}if(!$.grdList.getValue(i,"req_qty")){$.grdList.setValue(i,"req_qty","0")}if($.grdList.getRowStatus(i)=="N"){tempDate="";tempDate2="";tempDate=$.grdList.getValue(i,"start_date").toString().replace(/-/gi,"");tempDate2=$.grdList.getValue(i,"end_date").toString().replace(/-/gi,"")}else{tempDate="";tempDate2="";tempDate=$.grdList.getValue(i,"start_date").toString().replace(/-/gi,"");tempDate=tempDate.toString().replace(" 00:00","");tempDate2=$.grdList.getValue(i,"end_date").toString().replace(/-/gi,"");tempDate2=tempDate2.toString().replace(" 00:00","")}strdept_code+=$.grdList.getValue(i,"dept_code")+"|";strstart_date+=tempDate+"|";strend_date+=tempDate2+"|";strrequest_yn+=$.grdList.getValue(i,"request_yn")+"|";strreq_qty+=$.grdList.getValue(i,"req_qty")+"|"}if($.grdList.getRowCount()>0){strdept_code=strdept_code.substring(0,strdept_code.length-1).toString();strstart_date=strstart_date.substring(0,strstart_date.length-1).toString();strend_date=strend_date.substring(0,strend_date.length-1).toString();strrequest_yn=strrequest_yn.substring(0,strrequest_yn.length-1).toString();strreq_qty=strreq_qty.substring(0,strreq_qty.length-1).toString()}var json=createExecuteParamInfo("P_crmPromoItem_S",[workType=="D"?workType:$.workType,$.txtPrItemCode.getValue(),$.txtPrItemName.getValue(),$.memDesc.getValue(),$.imgPrItem.getValue()!=""?$.imgPrItem.getUploadParam().image_base64:"",Number($.speUnitPrice.getValue()),Number($.speCurStock.getValue()),$.chkUseYn.getValue(),$.bteParentPrItem.getValue(),$.chkGroupYn.getValue(),"#EmpCode#",strdept_code,strstart_date,strend_date,strrequest_yn,strreq_qty]);return json}function searchList(workType,itemCode,itemName){var json=createJson_Q(workType,itemCode,itemName);callQuery(["req",json],workType,$)}function getToday(){var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if((""+month).length==1){month="0"+month}if((""+day).length==1){day="0"+day}return""+year+month+day}function savePr(workType){if(!validateControls([$.txtPrItemCode,$.txtPrItemName])){return}var deptStock=0;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"dept_code")==""||$.grdList.getValue(i,"start_date")==""||$.grdList.getValue(i,"end_date")==""){MessageBoxShow("사용부서를 정확히 입력해주세요.");return}if(!$.grdList.getValue(i,"dept_code")){MessageBoxShow("사용부서를 정확히 입력해주세요.");return}if(!$.grdList.getValue(i,"start_date")){MessageBoxShow("시작일를 정확히 입력해주세요.");return}if(!$.grdList.getValue(i,"end_date")){MessageBoxShow("종료일를 정확히 입력해주세요.");return}deptStock+=parseInt($.grdList.getValue(i,"req_qty"))}if($.speCurStock.getValue()<deptStock){MessageBoxShow("판촉물 재고가 부서신청가능수량의 합계보다 크거나 같아야 합니다.");return}var json=createJson_S(workType);callQuery(["req",json],"N",$)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,770);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTree=new FingerPanel(host,"panTree",0,0,660,760);$.panTree.setText("판촉물 리스트");$.panTree.setBottomLine(true);$.panInfo=new FingerPanel(host,"panInfo",670,0,530,325);$.panInfo.setText("판촉물 정보");$.panInfo.setBottomLine(true);$.panList=new FingerPanel(host,"panList",670,335,530,425);$.panList.setText("판촉물 사용부서");$.panList.setBottomLine(true);$.lblPrItemCode=new FingerLabel(host,"lblPrItemCode",0,10,100,20);$.lblPrItemCode.setText("판촉물코드");$.txtPrItemCode=new FingerEdit(host,"txtPrItemCode",105,10,240,20);$.lblPrItemName=new FingerLabel(host,"lblPrItemName",0,40,100,20);$.lblPrItemName.setText("판촉물명");$.txtPrItemName=new FingerEdit(host,"txtPrItemName",105,40,240,20);$.grdPrList=new FingerDataGrid(host,"grdPrList",0,75,660,640);$.grdList=new FingerDataGrid(host,"grdList",0,0,530,380);$.lblPrCode=new FingerLabel(host,"lblPrCode",0,10,100,20);$.lblPrCode.setText("판촉물코드");$.txtPrCode=new FingerEdit(host,"txtPrCode",105,10,140,20);$.lblPrName=new FingerLabel(host,"lblPrName",0,40,100,20);$.lblPrName.setText("판촉물명");$.txtPrName=new FingerEdit(host,"txtPrName",105,40,140,20);$.btnSearch=new FingerButton(host,"btnSearch",580,40,80,20);$.btnSearch.setText("조회");$.lblParentPrItem=new FingerLabel(host,"lblParentPrItem",0,70,100,20);$.lblParentPrItem.setText("상위판촉물");$.bteParentPrItem=new FingerButtonEdit(host,"bteParentPrItem",105,70,240,20);$.bteParentPrItem.setText("");$.speCurStock=new FingerSpinEdit(host,"speCurStock",20,225,30,20);$.lblCheck1=new FingerLabel(host,"lblCheck1",0,130,100,20);$.lblCheck1.setText("그룹여부");$.lblCheck2=new FingerLabel(host,"lblCheck2",215,130,100,20);$.lblCheck2.setText("신청가능여부");$.chkGroupYn=new FingerCheckBox(host,"chkGroupYn",105,132.5,20,20);$.chkGroupYn.setText("");$.chkUseYn=new FingerCheckBox(host,"chkUseYn",320,132.5,25,20);$.chkUseYn.setText("");$.lblDesc=new FingerLabel(host,"lblDesc",0,160,100,20);$.lblDesc.setText("판촉물설명");$.memDesc=new FingerMemoEdit(host,"memDesc",105,160,400,100);$.imgPrItem=new FingerImage(host,"imgPrItem",360,10,150,143);$.btnAdd=new FingerButton(host,"btnAdd",350,-37.5,100,20);$.btnAdd.setText("행 추가");$.btnDelete=new FingerButton(host,"btnDelete",435,-37.5,100,20);$.btnDelete.setText("행 삭제");$.speUnitPrice=new FingerSpinEdit(host,"speUnitPrice",105,100,140,20);$.lblUnitPrice=new FingerLabel(host,"lblUnitPrice",0,100,100,20);$.lblUnitPrice.setText("단가");$.txtPrItemCode.setReadOnly(true);$.txtPrItemCode.setAllowBlank(false,"판촉물코드");$.txtPrItemName.setAllowBlank(false,"판촉물명");$.panInfo.addButton("btnDelete","삭제");$.panInfo.addButton("btnSave","저장");$.panInfo.addButton("btnNew","신규");$.panInfo.setButtonAction("btnNew","new");$.panInfo.setButtonAction("btnSave","save");$.panInfo.setButtonAction("btnDelete","delete");$.grdListMap=$.grdPrList.setColumns([new FingerDataGridColumn("pr_item_code",230,"left","text","판촉물코드",{template:"tree"}),new FingerDataGridColumn("pr_item_name",410,"left","text","판촉물명"),new FingerDataGridColumn("group_yn",80,"left","text","그룹여부",{hidden:true})]);$.grdPrList.init({nonExcel:true,panel:$.panTree,scroll:"xy",view:"treetable",treeKey:{id:"ID",parent:"ParentID"}});$.grdPrList.setBorder(false);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("pr_item_code",100,"left","string","판촉물코드",{hidden:true}),new FingerDataGridColumn("dept_code",100,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("dept_name",110,"right","string","부서명"),new FingerDataGridColumn("start_date",90,"right","date","시작일",{format:"ymd"}),new FingerDataGridColumn("end_date",90,"right","date","종료일",{format:"ymd"}),new FingerDataGridColumn("request_yn",100,"center","checkbox","신청가능여부"),new FingerDataGridColumn("req_qty",120,"right","string","신청가능수량",{format:"int"}),new FingerDataGridColumn("create_time",100,"left","string","생성일시",{hidden:true}),new FingerDataGridColumn("update_time",100,"left","string","수정일시",{hidden:true})]);$.grdList.init();$.grdList.setEditable(true);$.imgGroup=new FingerImageGroup([$.imgPrItem]);$.imgPrItem.setMode("N");$.imgPrItem.setZooming(true,true,true);$.speCurStock.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTree);$.panMain.add($.panInfo);$.panMain.add($.panList);$.panTree.add($.grdPrList);$.panTree.add($.lblPrCode);$.panTree.add($.txtPrCode);$.panTree.add($.lblPrName);$.panTree.add($.txtPrName);$.panTree.add($.btnSearch);$.panInfo.add($.lblPrItemCode);$.panInfo.add($.txtPrItemCode);$.panInfo.add($.lblPrItemName);$.panInfo.add($.txtPrItemName);$.panInfo.add($.lblParentPrItem);$.panInfo.add($.bteParentPrItem);$.panInfo.add($.speCurStock);$.panInfo.add($.lblCheck1);$.panInfo.add($.lblCheck2);$.panInfo.add($.chkGroupYn);$.panInfo.add($.chkUseYn);$.panInfo.add($.lblDesc);$.panInfo.add($.memDesc);$.panInfo.add($.imgPrItem);$.panInfo.add($.speUnitPrice);$.panInfo.add($.lblUnitPrice);$.panList.add($.grdList);$.panList.add($.btnAdd);$.panList.add($.btnDelete);$.wfDocId="";$.varDeptCode="";$.varEmployeeId="";$.workType="";searchList("Q")};$.callback=function(type,ds){if(type=="ITEMTREE"){setDataGrid([$.grdPrList],ds)}else{if(type=="Q"){setDataGrid([$.grdPrList],ds);$.grdPrList.openNode("all");if($.txtPrItemCode.getValue()!=""){$.grdPrList.selectRow($.grdPrList.getGridRowIndex("pr_item_code",$.txtPrItemCode.getValue()))}}else{if(type=="Q2"){$.imgPrItem.setValue(ds.get(0,0,"pr_item_picture"));$.imgPrItem.setMode("U");$.txtPrItemCode.setValue(ds.resultList[0][0].pr_item_code);$.txtPrItemName.setValue(ds.resultList[0][0].pr_item_name);$.bteParentPrItem.setValue(ds.resultList[0][0].parent_pr_item_code);$.bteParentPrItem.setText(ds.resultList[0][0].parent_pr_item_name);$.speUnitPrice.setValue(ds.resultList[0][0].unit_price);$.speCurStock.setValue(ds.resultList[0][0].cur_stock);$.chkGroupYn.setValue(ds.resultList[0][0].group_yn);$.chkUseYn.setValue(ds.resultList[0][0].request_yn);$.memDesc.setValue(ds.resultList[0][0].pr_item_desc);$.grdList.extObj.clearAll();if(ds.resultList[1].length>0){var tempDate="";var tempDate1="";for(var i=0;i<ds.resultList[1].length;i++){tempDate=ds.resultList[1][i].start_date;tempDate1=ds.resultList[1][i].end_date;ds.resultList[1][i].start_date=(tempDate.substring(0,4)+"-"+tempDate.substring(4,6)+"-"+tempDate.substring(6,8));ds.resultList[1][i].end_date=(tempDate1.substring(0,4)+"-"+tempDate1.substring(4,6)+"-"+tempDate1.substring(6,8))}setDataGrid([$.grdList],ds.resultList[1],true)}}else{if(type=="N"||type=="U"||type=="D"){searchList("Q")}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnAdd"){$.grdList.addRow()}else{if(id=="btnDelete"){var deleteChk=$.grdList.getRowStatus($.grdList.getSelectedRowIdx());if(deleteChk=="N"){$.grdList.deleteRow($.grdList.getSelectedRowIdx())}else{if(deleteChk=="U"){confirmBoxShow("해당 내용을 삭제하시겠습니까?",function(){if(g_main.msgShare==true){$.grdList.deleteRow($.grdList.getSelectedRowIdx())}})}}}else{if(id=="btnSearch"){searchList("Q")}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteParentPrItem"){var param={pr_item_name:$.bteParentPrItem.getText()||""};g_main.openPopup("popPrItem.html","popPrItem","판촉물 조회",605,545,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){$.varRowIdx=rId;if(cInd=="dept_name"){$.popUpCallId="dept_name";var param={deptCode:"",dept_name:$.grdList.getValue(rId,"dept_name")||""};g_main.openPopup("popDept.html","popDept","부서 조회",350,600,"","",param,"","")}}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdPrList"){$.workType="U";$.panInfo.clear();$.txtPrItemCode.setAllowBlank(false,"판촉물코드");searchList("Q2",$.grdPrList.getValue(rId,"pr_item_code"),$.grdPrList.getValue(rId,"pr_item_name"));if($.grdPrList.getValue(rId,"group_yn")=="Y"){$.btnAdd.setVisible(false);$.btnDelete.setVisible(false);$.speCurStock.setReadOnly(false)}else{$.speCurStock.setReadOnly(true);$.btnAdd.setVisible(true);$.btnDelete.setVisible(true)}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){if(id=="grdList"){return}};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panInfo"){if(btnId=="btnSave"){savePr()}else{if(btnId=="btnNew"){$.txtPrItemCode.setReadOnly(false);$.speCurStock.setReadOnly(false);$.parentPrItemCode="";$.bteParentPrItem.setText("");$.bteParentPrItem.setValue("");$.grdList.extObj.clearAll();$.panInfo.clear();$.workType="N";$.imgPrItem.setValue("");$.imgPrItem.setMode("N")}else{if(btnId=="btnDelete"){if($.grdPrList.getSelectedRowIdx()<0||!$.grdPrList.getSelectedRowIdx()){return}confirmBoxShow("["+$.txtPrItemName.getValue()+"] 을 삭제하시겠습니까?",function(){if(g_main.msgShare==true){savePr("D")}})}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popDept"){if($.popUpCallId=="dept_name"){if(!popResult.dept_code){$.grdList.setValue("");$.grdList.setValue("")}else{$.grdList.setValue($.varRowIdx,"dept_code",popResult.dept_code);$.grdList.setValue($.varRowIdx,"dept_name",popResult.dept_name)}}}else{if(id=="popPrItem"){if($.popUpCallId=="bteParentPrItem"){if(!popResult.pr_item_code){$.bteParentPrItem.setValue("");$.bteParentPrItem.setText("")}else{$.bteParentPrItem.setValue(popResult.pr_item_code);$.bteParentPrItem.setText(popResult.pr_item_name)}}}}}};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>