<script>function Main(){var $=this;$.host=null;$.panMeetingroomList=null;$.panMain=null;$.lblMeetingroomQ=null;$.txtMeetingroomQ=null;$.btnSearchQ=null;$.grdMeetingroom=null;$.panReserveInfo=null;$.lblReserveStartDate=null;$.lblReserveEndDate=null;$.lblReserveDept=null;$.lblReserveEmp=null;$.lblReserveRemark=null;$.dteStartDate=null;$.dteEndDate=null;$.txtReserveDept=null;$.txtReserveEmp=null;$.memReserveRemark=null;$.panMeetingroomState=null;$.schMeetingroomState=null;$.txtStartHour=null;$.txtStartMin=null;$.lblStartTime=null;$.lblEndTime=null;$.txtEndHour=null;$.txtEndMin=null;$.btnMeetingRoom=null;$.meetingroomId="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmResourceReserve1_Q",[workType,$.meetingroom_id,"",$.txtMeetingroomQ.getText()]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmResourceReserve1_S",[workType,$.reserve_id,$.meetingroom_id,$.start_date||getToday(),$.start_date||getToday(),$.end_date||getToday(),$.end_date||getToday(),"#DeptCode#","#UserID#",$.memReserveRemark.getValue(),"N","","#UserID#"]);return json}function searchMeetingRoom(workType){if(workType=="Q"){var json=createJSON_Q("Q");callQuery(["req",json],"Q",$)}else{if(workType=="Q1"){var json=createJSON_Q("Q1");callQuery(["req",json],"Q1",$)}else{if(workType=="Q2"){var json=createJSON_Q("Q2");callQuery(["req",json],"Q2",$,false)}}}}function saveMeetingRoom(workType){if(workType=="D"){console.log("D");var json=createJSON_S("D");callQuery(["req",json],"D",$,false)}else{console.log($.reserve_id);if($.reserve_id==""){console.log("N");var json=createJSON_S("N");callQuery(["req",json],"N",$,false)}else{console.log("U");var json=createJSON_S("U");callQuery(["req",json],"U",$,false)}}}function saveMeetingRoomInfo(workType){var json=createJSON_S("U2");callQuery(["req",json],"U2",$,false)}function getToday(){var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if((""+month).length==1){month="0"+month}if((""+day).length==1){day="0"+day}return""+year+month+day}function getNowTime(){var d=new Date();if(d.getHours()<10){var temp_hour="0"+d.getHours();$.txtStartHour.setValue(temp_hour);if(d.getHours()+1<=9){var temp_hour2="0"+d.getHours()+1;$.txtEndHour.setValue(d.getHours()+1)}else{$.txtEndHour.setValue(d.getHours()+1)}}else{$.txtStartHour.setValue(d.getHours());$.txtEndHour.setValue(d.getHours()+1)}if(d.getMinutes()>0&&d.getMinutes()<30){$.txtStartMin.setValue("30");$.txtEndMin.setValue("30")}else{if(d.getMinutes()>=30){$.txtStartHour.setValue(d.getHours()+1);$.txtEndHour.setValue(d.getHours()+2);$.txtStartMin.setValue("00");$.txtEndMin.setValue("00")}}}function fingerEditHourChk(value){value=unmask(value);if(value.length==1){value="0"+value}else{if(value.length==2){if(Number(value)>23){value="00"}}}return value}function fingerEditMinChk(value){value=unmask(value);if(value.length==1){value="0"+value}else{if(value.length==2){if(Number(value)>59){value="00"}}}return value}$.init=function(host,args){$.panMeetingroomList=new FingerPanel(host,"panMeetingroomList",0,0,250,445);$.panMeetingroomList.setText("회의실리스트");$.panMeetingroomList.setBottomLine(true);$.panMain=new FingerPanel(host,"panMain",0,0,1200,800);$.panMain.setText("");$.panMain.setBottomLine(true);$.lblMeetingroomQ=new FingerLabel(host,"lblMeetingroomQ",0,20,65,20);$.lblMeetingroomQ.setText("회의실명");$.txtMeetingroomQ=new FingerEdit(host,"txtMeetingroomQ",70,20,105,20);$.btnSearchQ=new FingerButton(host,"btnSearchQ",180,20,80,20);$.btnSearchQ.setText("검색");$.grdMeetingroom=new FingerDataGrid(host,"grdMeetingroom",0,65,250,325);$.panReserveInfo=new FingerPanel(host,"panReserveInfo",0,455,250,330);$.panReserveInfo.setText("예약정보");$.panReserveInfo.setBottomLine(true);$.lblReserveStartDate=new FingerLabel(host,"lblReserveStartDate",0,10,80,20);$.lblReserveStartDate.setText("예약시작일");$.lblReserveEndDate=new FingerLabel(host,"lblReserveEndDate",0,40,80,20);$.lblReserveEndDate.setText("예약종료일");$.lblReserveDept=new FingerLabel(host,"lblReserveDept",0,70,80,20);$.lblReserveDept.setText("예약부서");$.lblReserveEmp=new FingerLabel(host,"lblReserveEmp",0,95,80,20);$.lblReserveEmp.setText("예약사원");$.lblReserveRemark=new FingerLabel(host,"lblReserveRemark",0,120,80,20);$.lblReserveRemark.setText("신청사유");$.dteStartDate=new FingerDateEdit(host,"dteStartDate",85,10,100,20);$.dteEndDate=new FingerDateEdit(host,"dteEndDate",85,40,100,20);$.txtReserveDept=new FingerEdit(host,"txtReserveDept",85,70,155,20);$.txtReserveEmp=new FingerEdit(host,"txtReserveEmp",85,100,155,20);$.memReserveRemark=new FingerMemoEdit(host,"memReserveRemark",85,130,150,130);$.panMeetingroomState=new FingerPanel(host,"panMeetingroomState",260,0,940,785);$.panMeetingroomState.setText("예약현황");$.panMeetingroomState.setBottomLine(true);$.schMeetingroomState=new FingerScheduler(host,"schMeetingroomState","workweek",["30"],[],10,5,925,750);$.txtStartHour=new FingerEdit(host,"txtStartHour",190,10,20,20);$.txtStartMin=new FingerEdit(host,"txtStartMin",220,10,20,20);$.lblStartTime=new FingerLabel(host,"lblStartTime",205,10,15,20);$.lblStartTime.setText(":");$.lblEndTime=new FingerLabel(host,"lblEndTime",205,40,15,20);$.lblEndTime.setText(":");$.txtEndHour=new FingerEdit(host,"txtEndHour",190,40,20,20);$.txtEndMin=new FingerEdit(host,"txtEndMin",220,40,20,20);$.btnMeetingRoom=new FingerButton(host,"btnMeetingRoom",165,-40,95,20);$.btnMeetingRoom.setText("회의실관리");$.panReserveInfo.addButton("btnDelete","삭제");$.panReserveInfo.addButton("btnSave","저장");$.panReserveInfo.setButtonAction("btnSave","save");$.panReserveInfo.setButtonAction("btnDelete","delete");if(g_main.session.getValue("DeptCode")=="A120"){$.btnMeetingRoom.setVisible(true)}$.grdMeetingroom.colIdx=$.grdMeetingroom.setColumns([new FingerDataGridColumn("resource_code",0,"","hidden",""),new FingerDataGridColumn("resource_type",70,"center","string","구분"),new FingerDataGridColumn("resource_name",150,"left","string","회의실이름")]);$.grdMeetingroom.init();$.grdMeetingroom.setColumnHidden(["resource_code"],true);$.grdMeetingroom.setBorder(false);$.schMeetingroomState.setMeetingRoomWeek();$.panReserveInfo.setTitleType("SMALL");$.panMeetingroomList.setTitleType("SMALL");$.panMeetingroomState.setTitleType("SMALL");$.txtStartHour.setMaxLength(2);$.txtStartMin.setMaxLength(2);$.txtEndHour.setMaxLength(2);$.txtEndMin.setMaxLength(2);$.host=host;$.args=args};$.start=function(){$.panMeetingroomList.add($.lblMeetingroomQ);$.panMeetingroomList.add($.txtMeetingroomQ);$.panMeetingroomList.add($.btnSearchQ);$.panMeetingroomList.add($.grdMeetingroom);$.panMeetingroomList.add($.btnMeetingRoom);$.panMain.add($.panMeetingroomList);$.panMain.add($.panReserveInfo);$.panMain.add($.panMeetingroomState);$.panReserveInfo.add($.lblReserveDept);$.panReserveInfo.add($.lblReserveEmp);$.panReserveInfo.add($.lblReserveEndDate);$.panReserveInfo.add($.lblReserveRemark);$.panReserveInfo.add($.lblReserveStartDate);$.panReserveInfo.add($.dteStartDate);$.panReserveInfo.add($.dteEndDate);$.panReserveInfo.add($.txtReserveDept);$.panReserveInfo.add($.txtReserveEmp);$.panReserveInfo.add($.memReserveRemark);$.panReserveInfo.add($.txtStartHour);$.panReserveInfo.add($.txtStartMin);$.panReserveInfo.add($.lblStartTime);$.panReserveInfo.add($.txtEndHour);$.panReserveInfo.add($.txtEndMin);$.panReserveInfo.add($.lblEndTime);$.panMeetingroomState.add($.schMeetingroomState);searchMeetingRoom("Q");$.dteStartDate.setValue(getToday());$.dteEndDate.setValue(getToday());getNowTime();$.resource_rev_id="";$.reserve_id="";$.txtReserveDept.setValue(g_main.session.getValue("DeptName"));$.txtReserveEmp.setValue(g_main.session.getValue("UserName"));$.txtReserveDept.setReadOnly(true);$.txtReserveEmp.setReadOnly(true)};$.callback=function(type,ds){if(type=="Q"){var dz={};var tmp=[];for(var i in ds.resultList[0]){if(ds.resultList[0][i].ParentKeyID=="M0000"){dz=ds.resultList[0][i];tmp.push(dz);dz={}}}setDataGrid([$.grdMeetingroom],tmp,true);if($.meetingroomId!=""){for(var i in ds.resultList[0]){if($.grdMeetingroom.getValue(i,"resource_code")==$.meetingroomId){$.grdMeetingroom.selectRow(i)}}}else{$.grdMeetingroom.selectRow(0)}}else{if(type=="Q2"){if($.resource_rev_id==""){var size=Object.keys(ds.resultList[0]).length;for(var i=0;i<size;i++){var start_time;var end_time;var hour=0;if(ds.resultList[0][i].start_time.hours>12){hour=ds.resultList[0][i].start_time.hours-12;if(ds.resultList[0][i].start_time.minutes==0){ds.resultList[0][i].start_time.minutes="00"}start_time="오후"+hour+":"+ds.resultList[0][i].start_time.minutes}else{if(ds.resultList[0][i].start_time.minutes==0){ds.resultList[0][i].start_time.minutes="00"}start_time="오전"+ds.resultList[0][i].start_time.hours+":"+ds.resultList[0][i].start_time.minutes}if(ds.resultList[0][i].end_time.hours>12){hour=ds.resultList[0][i].end_time.hours-12;if(ds.resultList[0][i].end_time.minutes==0){ds.resultList[0][i].end_time.minutes="00"}end_time="오후"+hour+":"+ds.resultList[0][i].end_time.minutes}else{if(ds.resultList[0][i].end_time.minutes==0){ds.resultList[0][i].end_time.minutes="00"}end_time="오전"+ds.resultList[0][i].end_time.hours+":"+ds.resultList[0][i].end_time.minutes}ds.resultList[0][i].type="COMPLETE";if($.viewType=="agendaWeek"){ds.resultList[0][i].title="["+ds.resultList[0][i].dept_name+"] ("+ds.resultList[0][i].emp_name+")\n"+ds.resultList[0][i].reserve_remark}else{if($.viewType=="month"){ds.resultList[0][i].title=start_time+" "+end_time+"\n["+ds.resultList[0][i].dept_name+"] ("+ds.resultList[0][i].emp_name+")"}}ds.resultList[0][i].start=ds.resultList[0][i].start_date;ds.resultList[0][i].end=ds.resultList[0][i].end_date;ds.resultList[0][i].bindId=ds.resultList[0][i].resource_rev_id}$.schMeetingroomState.removeEvents();$.schMeetingroomState.addEventSource(ds.resultList[0])}else{if($.resource_rev_id!=""){$.dteStartDate.setText(ds.resultList[0][0].start_date.split(" ")[0]);$.dteEndDate.setText(ds.resultList[0][0].end_date.split(" ")[0]);if(ds.resultList[0][0].start_time.hours<10){var hours="0"+ds.resultList[0][0].start_time.hours;$.txtStartHour.setValue(hours)}else{$.txtStartHour.setValue(ds.resultList[0][0].start_time.hours)}if(ds.resultList[0][0].start_time.minutes<10){var minutes="0"+ds.resultList[0][0].start_time.minutes;$.txtStartMin.setValue(minutes)}else{$.txtStartMin.setValue(ds.resultList[0][0].start_time.minutes)}if(ds.resultList[0][0].end_time.hours<10){var hours="0"+ds.resultList[0][0].end_time.hours;$.txtEndHour.setValue(hours)}else{$.txtEndHour.setValue(ds.resultList[0][0].end_time.hours)}if(ds.resultList[0][0].end_time.minutes<10){var minutes="0"+ds.resultList[0][0].end_time.minutes;$.txtEndMin.setValue(minutes)}else{$.txtEndMin.setValue(ds.resultList[0][0].end_time.minutes)}$.txtReserveDept.setValue(ds.resultList[0][0].dept_name);$.txtReserveEmp.setValue(ds.resultList[0][0].emp_name);$.memReserveRemark.setValue(ds.resultList[0][0].reserve_remark);$.resource_rev_id=""}}}else{if(type=="N"||type=="U"){if(ds.errorCode=="P_crmResourceReserve1_S_001"){MessageBoxShow("신청한 기간에 다른 예약건이 있습니다. 신청기간을 수정해 주세요.")}$.meetingroomId=$.grdMeetingroom.getValue($.grdMeetingroom.getSelectedRowIdx(),"resource_code");searchMeetingRoom("Q")}else{if(type=="D"){$.meetingroomId=$.grdMeetingroom.getValue($.grdMeetingroom.getSelectedRowIdx(),"resource_code");$.reserve_id="";searchMeetingRoom("Q")}}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearchQ"){searchMeetingRoom("Q")}else{if(id=="btnMeetingRoom"){$.popUpCallId="btnMRSave";var param={};param.meetingroom_id=$.meetingroom_id;g_main.openPopup("popMeetingRoomInfo.html","popMeetingRoomInfo","회의실 정보",450,255,"","",param,"","")}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteStartDate"){if(!value){return}if(value>$.dteEndDate.getValue()){$.dteEndDate.setValue(value)}}else{if(id=="dteEndDate"){if(!value){return}if(value<$.dteStartDate.getValue()){$.dteStartDate.setValue(value)}}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdMeetingroom"){$.meetingroom_id=$.grdMeetingroom.getValue(rId,"resource_code");searchMeetingRoom("Q1");searchMeetingRoom("Q2");$.dteStartDate.setValue(getToday());$.dteEndDate.setValue(getToday());getNowTime();$.reserve_id="";$.resource_rev_id=""}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="txtStartHour"){var hour=fingerEditHourChk(value);$.txtStartHour.setValue(hour)}else{if(id=="txtStartMin"){var min=fingerEditMinChk(value);$.txtStartMin.setValue(min)}else{if(id=="txtEndHour"){var hour=fingerEditHourChk(value);$.txtEndHour.setValue(hour)}else{if(id=="txtEndMin"){var min=fingerEditMinChk(value);$.txtEndMin.setValue(min)}}}}};$.fingeredit_keypress=function(id,value){if((id=="txtMeetingroomQ")&&value=="13"){searchMeetingRoom("Q")}};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panReserveInfo"){if(btnId=="btnSave"){if(g_main.session.getValue("DeptName")==$.txtReserveDept.getValue()&&g_main.session.getValue("UserName")==$.txtReserveEmp.getValue()){log($.txtStartHour.getValue());log($.txtStartMin.getValue());log($.txtEndHour.getValue());log($.txtEndMin.getValue());if(!$.txtStartHour.getValue()||!$.txtStartMin.getValue()){log("1");MessageBoxShow("시작시간을 입력하세요.");return}else{if(!$.dteStartDate.getValue()){log("2");MessageBoxShow("시작날짜를 입력하세요.");return}else{if(!$.txtEndHour.getValue()||!$.txtEndMin.getValue()){log("3");MessageBoxShow("종료시간을 입력하세요.");return}else{if($.dteEndDate.getValue()==""){log("4");MessageBoxShow("종료날짜를 입력하세요.");return}else{if(Number($.txtStartHour.getValue())>Number($.txtEndHour.getValue())){log("5");MessageBoxShow("시작시간이 종료시간보다 <br/>느릴 수 없습니다.");$.txtEndHour.setFocus();return}else{if(Number($.txtStartHour.getValue())==Number($.txtEndHour.getValue())){log("6");if(Number($.txtStartMin.getValue())>Number($.txtEndMin.getValue())){MessageBoxShow("시작시간이 종료시간보다 <br/>느릴 수 없습니다.");return}}else{if($.dteStartDate.getValue()>$.dteEndDate.getValue()){log("7");MessageBoxShow("시작날짜가 종료날짜보다 <br/>느릴 수 없습니다.");$.dteStartDate.setFocus();return}else{if($.dteStartDate.getText().length!=8||$.txtStartHour.getText().length!=2||$.txtStartMin.getText().length!=2){log("8");MessageBoxShow("시작날짜가 양식을 확인 하세요.");return}else{if($.dteEndDate.getText().length!=8||$.txtEndHour.getText().length!=2||$.txtEndMin.getText().length!=2){log("9");MessageBoxShow("종료날짜가 양식을 확인 하세요.");return}}}}}}}}}$.start_date=$.dteStartDate.getText()+" "+$.txtStartHour.getValue()+":"+$.txtStartMin.getValue()+":00.000";$.end_date=$.dteEndDate.getText()+" "+$.txtEndHour.getValue()+":"+$.txtEndMin.getValue()+":00.000";saveMeetingRoom()}else{MessageBoxShow("본인 신청건만 수정 가능합니다.")}}else{if(btnId=="btnDelete"){if((g_main.session.getValue("DeptCode")=="A120")||(g_main.session.getValue("DeptName")==$.txtReserveDept.getValue()&&g_main.session.getValue("UserName")==$.txtReserveEmp.getValue())){if($.reserve_id==""){MessageBoxShow("예약 취소할 내용을 선택하세요.")}else{confirmBoxShow("해당 예약을 취소하시겠습니까?",function(){if(g_main.msgShare==true){saveMeetingRoom("D")}})}}else{MessageBoxShow("본인 신청건만  예약 취소 가능합니다.")}}}}};$.fingerpopup_close=function(id){if(id=="popMeetingRoomInfo"){if($.popUpCallId=="btnMRSave"){searchMeetingRoom("Q")}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){if(id=="schMeetingroomState"){if(event_id=="dayClick"){$.dteStartDate.setValue(event_object.date);$.dteEndDate.setValue(event_object.date);$.txtReserveDept.setValue(g_main.session.getValue("DeptName"));$.txtReserveEmp.setValue(g_main.session.getValue("UserName"));$.memReserveRemark.setValue("");getNowTime();$.reserve_id="";$.resource_rev_id=""}else{if(event_id=="eventClick"){$.dteStartDate.setValue(event_object.data.start_date.substr(0,10));$.dteEndDate.setValue(event_object.data.end_date.substr(0,10));$.txtStartHour.setValue(moment(event_object.data.start).format("HH"));$.txtStartMin.setValue(moment(event_object.data.start).format("mm"));$.txtEndHour.setValue(moment(event_object.data.end).format("HH"));$.txtEndMin.setValue(moment(event_object.data.end).format("mm"));$.txtReserveDept.setValue(event_object.data.dept_name);$.txtReserveEmp.setValue(event_object.data.emp_name);$.memReserveRemark.setValue(event_object.data.reserve_remark);$.resource_rev_id=event_object.data.resource_rev_id;$.reserve_id=$.resource_rev_id}}}};$.fingerscheduler_ready=function(id){if(id=="schMeetingroomState"){}};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerscheduler_view_display=function(id,view){$.viewType=view.type;if(view.type=="agendaWeek"){setTimeout(function(){document.querySelector(".fc-scroller").scrollTop=scroll},0)}searchMeetingRoom("Q1");searchMeetingRoom("Q2")};$.fingertree_refresh=function(id){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>