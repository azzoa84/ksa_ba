<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.panList=null;$.btnSearch=null;$.grdList=null;$.panCallHistory=null;$.grdCallHistory=null;$.lbl_Dept=null;$.cmb_Dept=null;$.cmb_Employee=null;$.lbl_Product_code=null;$.cmb_Product_code=null;$.txt_company_id=null;$.txt_contact_id=null;$.lbl_Company=null;$.txt_Company=null;$.lbl_Contact=null;$.txt_Contact=null;$.lbl_level=null;$.cmb_Now_level=null;$.cmb_Bef_level=null;$.lbl_channel=null;$.cmb_channel=null;$.btnHelp=null;$.session=g_main.session.obj;function createJson_Q(workType){var json=createExecuteParamInfo("P_crmSSAT_Calllist_Q",[workType,$.cmb_Dept.getValue()||"",$.cmb_Employee.getValue()||"",$.txt_Company.getValue()||"",$.txt_Contact.getValue()||"",$.cmb_Product_code.getValue()||"",$.cmb_Bef_level.getValue()||"",$.cmb_Now_level.getValue()||"",$.cmb_channel.getValue()||""]);return json}function createJson_Q1(workType){var json=createExecuteParamInfo("P_crmSSAT_Calllist_H",[workType,$.txt_contact_id.getValue()||"",$.cmb_Product_code.getValue()||""]);return json}function searchSSAT_Calllist_Q(workType){var json=createJson_Q(workType);callQuery(["req",json],workType,$)}function searchSSAT_Calllist_H(workType){var json=createJson_Q1(workType);callQuery(["req",json],workType,$)}function queryClick(){searchSSAT_Calllist_Q("Q")}function letter_spacing(){return{"letter-spacing":"7px"}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,795);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,1200,85);$.panQuery.setText("");$.panQuery.setBottomLine(true);$.panList=new FingerPanel(host,"panList",0,95,1200,490);$.panList.setText("고객별Call조회");$.panList.setBottomLine(true);$.btnSearch=new FingerButton(host,"btnSearch",1120,45,80,20);$.btnSearch.setText("조회");$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,445);$.panCallHistory=new FingerPanel(host,"panCallHistory",0,595,1205,191);$.panCallHistory.setText("");$.panCallHistory.setBottomLine(true);$.grdCallHistory=new FingerDataGrid(host,"grdCallHistory",0,0,1200,191);$.lbl_Dept=new FingerLabel(host,"lbl_Dept",0,15,100,20);$.lbl_Dept.setText("부서/담당자");$.cmb_Dept=new FingerComboBox(host,"cmb_Dept",105,15,210,20);$.cmb_Employee=new FingerComboBox(host,"cmb_Employee",320,15,140,20);$.lbl_Product_code=new FingerLabel(host,"lbl_Product_code",440,15,100,20);$.lbl_Product_code.setText("품목");$.cmb_Product_code=new FingerComboBox(host,"cmb_Product_code",545,15,140,20);$.txt_company_id=new FingerEdit(host,"txt_company_id",715,15,60,20);$.txt_contact_id=new FingerEdit(host,"txt_contact_id",780,15,60,20);$.lbl_Company=new FingerLabel(host,"lbl_Company",0,45,100,20);$.lbl_Company.setText("거래처");$.txt_Company=new FingerEdit(host,"txt_Company",105,45,210,20);$.lbl_Contact=new FingerLabel(host,"lbl_Contact",295,45,100,20);$.lbl_Contact.setText("고객");$.txt_Contact=new FingerEdit(host,"txt_Contact",400,45,140,20);$.lbl_level=new FingerLabel(host,"lbl_level",550,45,150,20);$.lbl_level.setText("현등급/전반기등급");$.cmb_Now_level=new FingerComboBox(host,"cmb_Now_level",705,45,80,20);$.cmb_Bef_level=new FingerComboBox(host,"cmb_Bef_level",790,45,80,20);$.lbl_channel=new FingerLabel(host,"lbl_channel",850,45,100,20);$.lbl_channel.setText("채널");$.cmb_channel=new FingerComboBox(host,"cmb_channel",955,45,140,20);$.btnHelp=new FingerButton(host,"btnHelp",1060,15,130,20);$.btnHelp.setText("자료이용안내");$.panQuery.setBorder(true);$.panList.addButton("btnExcelCustom","엑셀");$.panList.setButtonAction("btnExcelCustom","excel_down");$.panList.addButton("btnFilterCustom","필터");$.panList.setButtonAction("btnFilterCustom","filter");$.cmb_Dept.setEmptyRow(true);$.cmb_Employee.setEmptyRow(true);$.cmb_Product_code.setEmptyRow(true);$.cmb_Now_level.setEmptyRow(true);$.cmb_Bef_level.setEmptyRow(true);$.cmb_channel.setEmptyRow(true);$.btnHelp.setVisible(false);$.lbl_channel.setVisible(false);$.cmb_channel.setVisible(false);$.txt_company_id.setVisible(false);$.txt_contact_id.setVisible(false);$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("dept_name",90,"left","string","부서"),new FingerDataGridColumn("emp_name",80,"left","string","담당자"),new FingerDataGridColumn("product_name",60,"left","string","품목"),new FingerDataGridColumn("company_id",173,"left","string","거래처코드"),new FingerDataGridColumn("company_name",173,"left","string","거래처"),new FingerDataGridColumn("code_name",100,"left","string","진료과목"),new FingerDataGridColumn("contact_id",80,"left","string","고객코드"),new FingerDataGridColumn("contact_name",80,"left","string","고객"),new FingerDataGridColumn("contact_p_count",100,"right","int","질환환자수",{format:"int"}),new FingerDataGridColumn("bef_level",60,"left","string","전등급"),new FingerDataGridColumn("bef_fx_call",80,"right","int","전목표콜",{format:"int"}),new FingerDataGridColumn("bef_call",120,"right","int","전반기실행콜",{format:"int"}),new FingerDataGridColumn("now_level",60,"left","string","현등급"),new FingerDataGridColumn("now_fx_call",80,"right","int","현목표콜",{format:"int"}),new FingerDataGridColumn("max_call_date",110,"right","int","마지막 call일자",{format:"s_ymd"}),new FingerDataGridColumn("zero_call_yn",110,"center","int","Zero call 고객",{template:function(obj,common,value){if(value=="Y"){return"<img src='./fingerPlatform/images/check.png' style='width:15px'>"}else{return""}}}),new FingerDataGridColumn("m0",70,"right","int","당월",{format:"int"}),new FingerDataGridColumn("m1",70,"right","int","-1월",{format:"int"}),new FingerDataGridColumn("m2",70,"right","int","-2월",{format:"int"}),new FingerDataGridColumn("m3",70,"right","int","-3월",{format:"int"}),new FingerDataGridColumn("m4",70,"right","int","-4월",{format:"int"}),new FingerDataGridColumn("m5",70,"right","int","-5월",{format:"int"}),new FingerDataGridColumn("m6",70,"right","int","-6월",{format:"int"}),new FingerDataGridColumn("dept_code",80,"left","string","",{hidden:true}),new FingerDataGridColumn("employee_id",80,"left","string","",{hidden:true}),new FingerDataGridColumn("product_code",80,"left","string","",{hidden:true}),new FingerDataGridColumn("channel",1,"left","string","채널",{template:function(obj,common,value){if(value=="21"||value=="22"||value=="23"||value=="24"){return"Clinic"}else{return"Hospital"}}})]);$.grdList.init({panel:$.panList,scroll:"xy",isFilter:false,nonExcel:true});$.grdList.setEditable(false);$.grdList.setBorder(false);$.grdCallHistory.colIdx=$.grdCallHistory.setColumns([]);$.grdCallHistory.init({header:false,scroll:"none"});$.grdCallHistory.setEditable(false);$.grdCallHistory.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panList);$.panMain.add($.panCallHistory);$.panQuery.add($.btnSearch);$.panQuery.add($.btnHelp);$.panQuery.add($.cmb_channel);$.panQuery.add($.lbl_channel);$.panQuery.add($.cmb_Bef_level);$.panQuery.add($.cmb_Now_level);$.panQuery.add($.lbl_level);$.panQuery.add($.txt_Contact);$.panQuery.add($.lbl_Contact);$.panQuery.add($.txt_Company);$.panQuery.add($.lbl_Company);$.panQuery.add($.txt_contact_id);$.panQuery.add($.txt_company_id);$.panQuery.add($.cmb_Product_code);$.panQuery.add($.lbl_Product_code);$.panQuery.add($.cmb_Employee);$.panQuery.add($.cmb_Dept);$.panQuery.add($.lbl_Dept);$.panList.add($.grdList);$.panCallHistory.add($.grdCallHistory);relocateChildIndexInPanel([$.panQuery]);$.grdList.setColumnHidden("company_id",true);$.grdList.setColumnHidden("contact_id",true);var ds=bizComponentData2($,"Q1","L_CRM0003_1|L_CRM0003|L_CRM0195|L_CRM0059");$.cmb_Dept.setColumn("dept_code","dept_name");$.cmb_Product_code.setColumn("product_code","product_name");setComboBind([$.cmb_Now_level,$.cmb_Bef_level,$.cmb_Dept,$.cmb_Product_code],ds);$.cmb_Product_code.setValue("");var ds2=bizComponentData2($,"Q2","L_CRM233");setComboBind([$.cmb_channel],ds2);var subQuery=" and dept_code = '"+$.cmb_Dept.getValue()+"' and delete_yn <> 'Y'";var ds3=bizComponentData2($,"Q4","L_CRM0052",subQuery);$.cmb_Employee.setColumn("employee_id","emp_name");setComboBind([$.cmb_Employee],ds3);if(g_main.session.obj.DutyCode=="08"){$.cmb_Dept.setValue(g_main.session.obj.DeptCode);$.cmb_Dept.setEnable(true);$.cmb_Employee.setEnable(true)}else{$.cmb_Dept.setValue(g_main.session.obj.DeptCode);$.cmb_Employee.setValue(g_main.session.obj.EmpCode);$.cmb_Dept.setEnable(true);$.cmb_Employee.setEnable(true)}if(g_main.session.obj.SystemDeveloper=="Y"||g_main.session.obj.DeptCode=="J110"||g_main.session.obj.DeptCode=="F220"){$.cmb_Dept.setAllowBlank(true,"부서");$.cmb_Employee.setAllowBlank(true,"담당자")}};$.callback=function(type,ds){if(type=="Q"){setDataGrid([$.grdList],ds);$.grdList.selectRow(0)}else{if(type=="H"){if(!ds){$.grdCallHistory.clear()}else{var mondate=getToday("");var month1=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var month2=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var month3=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var month4=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var month5=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var month6=["  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  ","  ◇  "];var imonthcallcount=[0,0,0,0,0,0];var monthList=[];monthList.push(mondate.substring(0,6));monthList.push(getCalcMonth(mondate,-1).substring(0,6));monthList.push(getCalcMonth(mondate,-2).substring(0,6));monthList.push(getCalcMonth(mondate,-3).substring(0,6));monthList.push(getCalcMonth(mondate,-4).substring(0,6));monthList.push(getCalcMonth(mondate,-5).substring(0,6));var rs=ds.resultList[0];for(var i in rs){if(rs[i].call_date.substring(0,6)==monthList[0]){var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month1[day-1]="  ®  "}else{month1[day-1]="  ◆  "}imonthcallcount[0]++}else{if(rs[i].call_date.substring(0,6)==monthList[1]){var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month2[day-1]="  ®  "}else{month2[day-1]="  ◆  "}imonthcallcount[1]++}else{if(rs[i].call_date.substring(0,6)==monthList[2]){var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month3[day-1]="  ®  "}else{month3[day-1]="  ◆  "}imonthcallcount[2]++}else{if(rs[i].call_date.substring(0,6)==monthList[3]){var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month4[day-1]="  ®  "}else{month4[day-1]="  ◆  "}imonthcallcount[3]++}else{if(rs[i].call_date.substring(0,6)==monthList[4]){var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month5[day-1]="  ®  "}else{month5[day-1]="  ◆  "}imonthcallcount[4]++}else{var day=rs[i].call_date.substring(6,8);if(rs[i].report_yn=="  R  "){month6[day-1]="  ®  "}else{month6[day-1]="  ◆  "}imonthcallcount[5]++}}}}}}var mon=["","","","","",""];for(var str in month1){mon[0]+=month1[str]}for(var str in month2){mon[1]+=month2[str]}for(var str in month3){mon[2]+=month3[str]}for(var str in month4){mon[3]+=month4[str]}for(var str in month5){mon[4]+=month5[str]}for(var str in month6){mon[5]+=month6[str]}var arr=[],cols=[];var col_month="month";var col_ten1="ten1";var col_ten2="ten2";var col_ten3="ten3";var col_sum="sum";for(var i=0;i<6;i++){var obj={};obj[col_month]=monthList[i];obj[col_ten1]=mon[i].substring(0,50);obj[col_ten2]=mon[i].substring(50,100);obj[col_ten3]=mon[i].substring(100,155);obj[col_sum]=imonthcallcount[i];arr.push(obj)}cols.push(new FingerDataGridColumn(col_month,75,"left","string",""));cols.push(new FingerDataGridColumn(col_ten1,340,"center","string","",{cssFormat:letter_spacing}));cols.push(new FingerDataGridColumn(col_ten2,340,"center","string","",{cssFormat:letter_spacing}));cols.push(new FingerDataGridColumn(col_ten3,370,"center","string","",{cssFormat:letter_spacing}));cols.push(new FingerDataGridColumn(col_sum,75,"right","string","",{format:"int"}));$.grdCallHistory.resetColumns(cols);setDataGrid([$.grdCallHistory],arr,true)}}}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){queryClick()}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmb_Dept"){if(value==null||value==""){$.cmb_Employee.setValue("");$.cmb_Employee.setEnable(false)}else{$.cmb_Employee.setEnable(true);$.cmb_Employee.clear();var subQuery=" and dept_code = '"+$.cmb_Dept.getValue()+"' and delete_yn <> 'Y'";var ds=bizComponentData2($,"Q4","L_CRM0052",subQuery);$.cmb_Employee.setColumn("employee_id","emp_name");setComboBind([$.cmb_Employee],ds)}}else{if(id=="cmb_Product_code"){if(value==null||value==""){$.cmb_Now_level.setValue("");$.cmb_Bef_level.setValue("");$.cmb_Now_level.setEnable(false);$.cmb_Bef_level.setEnable(false)}else{$.cmb_Now_level.setValue("");$.cmb_Bef_level.setValue("");$.cmb_Now_level.setEnable(true);$.cmb_Bef_level.setEnable(true)}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){$.txt_contact_id.setValue($.grdList.getValue(rId,"contact_id"));$.txt_company_id.setValue($.grdList.getValue(rId,"company_id"));searchSSAT_Calllist_H("H")}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if((id=="txt_Company"||id=="txt_Contact")&&value=="13"){queryClick()}};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnExcelCustom"){if($.session.DeptCode=="J110"){$.grdList.setColumnHidden("company_id",false);$.grdList.setColumnHidden("contact_id",false)}$.grdList.excelDown("고객별Call조회");$.grdList.setColumnHidden("company_id",true);$.grdList.setColumnHidden("contact_id",true)}else{if(btnId=="btnFilterCustom"){$.grdList.setFilterView()}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>