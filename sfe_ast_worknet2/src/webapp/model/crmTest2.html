<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.lblDept=null;$.lblEmp=null;$.lblType=null;$.lblProduct=null;$.lblProductName=null;$.lblProductQty=null;$.lblImage=null;$.lblDescr=null;$.lblLabel1=null;$.txtDept=null;$.txtEmp=null;$.rdoType=null;$.cmbProduct=null;$.txtProductName=null;$.speProductQty=null;$.img1=null;$.img2=null;$.img3=null;$.memDescr=null;$.htmlMemo=null;$.grdFile=null;$.grdDoc=null;$.varWFDocId="";$.varBusinessId="";$.varWFType="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFPromoItemReq"]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmWFPromoItemReq_S2",[workType,$.varWfDocId,$.cmbProduct.getValue(),$.txtProductName.getValue()||0,$.speProductQty.getValue()||0,0,$.memDescr.getValue(),"#DeptCode#","#UserID#",$.rdoType.getValue()]);return json}function searchWFDocument(){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function savePromoItem(workType){var json=createJSON_S(workType);if(json){var ds=callExecuteSync(["req",json],"N",$);var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1250);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,500);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,575,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,975,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,975,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.lblDept=new FingerLabel(host,"lblDept",0,10,100,20);$.lblDept.setText("소속부서");$.lblEmp=new FingerLabel(host,"lblEmp",375,10,100,20);$.lblEmp.setText("신청자");$.lblType=new FingerLabel(host,"lblType",0,40,100,20);$.lblType.setText("신청구분");$.lblProduct=new FingerLabel(host,"lblProduct",0,80,100,20);$.lblProduct.setText("판촉품목");$.lblProductName=new FingerLabel(host,"lblProductName",0,110,100,20);$.lblProductName.setText("판촉물 품명");$.lblProductQty=new FingerLabel(host,"lblProductQty",375,110,100,20);$.lblProductQty.setText("수량");$.lblImage=new FingerLabel(host,"lblImage",0,140,100,20);$.lblImage.setText("판촉물 이미지");$.lblDescr=new FingerLabel(host,"lblDescr",0,270,100,20);$.lblDescr.setText("설명");$.lblLabel1=new FingerLabel(host,"lblLabel1",580,110,20,20);$.lblLabel1.setText("개");$.txtDept=new FingerEdit(host,"txtDept",105,10,250,20);$.txtEmp=new FingerEdit(host,"txtEmp",480,10,125,20);$.rdoType=new FingerRadioBox(host,"rdoType",105,40,500,35);$.cmbProduct=new FingerComboBox(host,"cmbProduct",105,80,250,20);$.txtProductName=new FingerEdit(host,"txtProductName",105,110,250,20);$.speProductQty=new FingerSpinEdit(host,"speProductQty",480,110,100,20);$.img1=new FingerImage(host,"img1",105,140,160,123);$.img2=new FingerImage(host,"img2",273,140,160,123);$.img3=new FingerImage(host,"img3",440,140,160,123);$.memDescr=new FingerMemoEdit(host,"memDescr",105,270,490,170);$.htmlMemo=new FingerHTMLView(host,"htmlMemo",875,5,320,445);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,230);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,230);$.panTitle.setBorder(true);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.txtDept.setAllowBlank(false,"소속부서");$.txtEmp.setAllowBlank(false,"신청자");$.cmbProduct.setAllowBlank(false,"판촉품목");$.txtProductName.setAllowBlank(false,"판촉물 품명");$.speProductQty.setAllowBlank(false,"수량");$.memDescr.setAllowBlank(false,"설명");$.cmbProduct.setEmptyRow(true,"");$.htmlMemo.setVisible(false);$.txtDept.setReadOnly(true);$.txtEmp.setReadOnly(true);$.imgGroup=new FingerImageGroup([$.img1,$.img2,$.img3]);$.img1.setMode("N");$.img2.setMode("N");$.img3.setMode("N");$.img1.setZooming(true);$.img2.setZooming(true);$.img3.setZooming(true);$.img1.setTurnBtn(true);$.img2.setTurnBtn(true);$.img3.setTurnBtn(true);$.rdoType.addButtons([{sub_code:"Promo",code_name:"판촉물"},{sub_code:"Print",code_name:"인쇄물"},{sub_code:"Seminar",code_name:"자사제품설명회"},{sub_code:"Symposium",code_name:"심포지엄"},{sub_code:"IT",code_name:"IT"},{sub_code:"CRO",code_name:"CRO"},{sub_code:"Etc",code_name:"기타"}]);$.rdoType.setValue("Promo");$.txtDept.setValue(g_main.session.obj.DeptName);$.txtEmp.setValue(g_main.session.obj.UserName);$.speProductQty.setValue(0);$.htmlMemo.setBorder(true);$.htmlMemo.setStyleClass("information");$.htmlMemo.setHTML("<div style='text-align: center;'>< 자사제품설명회 기념?답례품 구입 기준 ></div><br><br>- 5만원 이내 (부가세 포함).<br><br>- 골프용품/식?음료 불가.<br><br>- 합리적 수준의 할인은 인정되나,<br>&nbsp;&nbsp;실제 구입가격이 '적정시장가격'에 비추어<br>&nbsp;&nbsp;합리성을 인정할 수 있어야 함.<br><br>- 시중에 판매되지 않는 제품은 업체에서 구입한<br>&nbsp;&nbsp;가격을 기준으로 하나,<br>&nbsp;&nbsp;해당 금액의 합리성 입증 절차 필요.<br><br>- CP팀장 협의결재.");$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.lblDept);$.panWFMain.add($.lblEmp);$.panWFMain.add($.lblType);$.panWFMain.add($.lblProduct);$.panWFMain.add($.lblProductName);$.panWFMain.add($.lblProductQty);$.panWFMain.add($.lblImage);$.panWFMain.add($.lblDescr);$.panWFMain.add($.lblLabel1);$.panWFMain.add($.txtDept);$.panWFMain.add($.txtEmp);$.panWFMain.add($.rdoType);$.panWFMain.add($.cmbProduct);$.panWFMain.add($.txtProductName);$.panWFMain.add($.speProductQty);$.panWFMain.add($.img1);$.panWFMain.add($.img2);$.panWFMain.add($.img3);$.panWFMain.add($.memDescr);$.panWFMain.add($.htmlMemo);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);var ds=bizComponentData2($,"Q1","L_CRM0224");setComboBind([$.cmbProduct],ds);searchWFDocument()};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue(result.business_title)}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.cmbProduct.setValue(md.product_code);$.txtProductName.setValue(md.item_name);$.speProductQty.setValue(md.item_qty);$.memDescr.setValue(md.descr)}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!validateControls([$.txtTitle,$.txtDept,$.txtEmp,$.cmbProduct,$.txtProductName,$.memDescr])){return}var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFPromoItemReq"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){if(saveWFDocument("","N")){savePromoItem("N")}}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(id=="btnDocDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}else{if(id=="btnFileAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnFileDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(saveWFDocument("","Y",popResult)){savePromoItem("N")}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<$.grdDoc.getRowCount();i++){if(popResult.wf_doc_id==$.grdDoc.getValue(i,"wf_doc_id")){return}}$.grdDoc.addRow(popResult)}else{if(id=="popWFGoAboardSub"){if($.popUpCallId=="bteSubject"){$.varSubWfDocId=popResult.wf_doc_id;$.bteSubject.setValue(popResult.subject)}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){if(id=="rdoType"){if(value=="Promo"){$.lblProduct.setText("판촉 품목");$.lblProductName.setText("판촉물 품명");$.lblImage.setText("판촉물 이미지");$.htmlMemo.setVisible(false)}else{if(value=="Print"){$.lblProduct.setText("인쇄 품목");$.lblProductName.setText("인쇄물 품명");$.lblImage.setText("인쇄물 이미지");$.htmlMemo.setVisible(false)}else{if(value=="Seminar"){$.lblProduct.setText("품목");$.lblProductName.setText("품명");$.lblImage.setText("이미지");$.htmlMemo.setVisible(true)}else{if(value=="Symposium"){$.lblProduct.setText("품목");$.lblProductName.setText("품명");$.lblImage.setText("이미지");$.htmlMemo.setVisible(false)}else{if(value=="IT"){$.lblProduct.setText("품목");$.lblProductName.setText("품명");$.lblImage.setText("이미지");$.htmlMemo.setVisible(false)}else{if(value=="CRO"){$.lblProduct.setText("품목");$.lblProductName.setText("품명");$.lblImage.setText("이미지");$.htmlMemo.setVisible(false)}else{if(value=="Etc"){$.lblProduct.setText("품목");$.lblProductName.setText("품명");$.lblImage.setText("이미지");$.htmlMemo.setVisible(false)}}}}}}}}};$.fingerimage_click=function(id){}};</script>