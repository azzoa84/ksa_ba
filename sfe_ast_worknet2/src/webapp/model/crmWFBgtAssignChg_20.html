<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.cmbBaseDate=null;$.panList=null;$.grdList=null;$.panDetail=null;$.lblBudgList=null;$.lblAssignMoney=null;$.lblFusibleMoney=null;$.lblApplyMoney=null;$.cmbBudgList=null;$.speAssignMoney=null;$.speFusibleMoney=null;$.speApplyMoney=null;$.grdFile=null;$.tabObject=null;$.panTotal=null;$.panObject=null;$.lblDeptManage=null;$.lblTargetBudget=null;$.bteDeptManage=null;$.cmbTargetBudget=null;$.speAfterMoney=null;$.lblAfterMoney=null;$.grdTotal=null;$.lblTargetMoney=null;$.speTargetMoney=null;$.grdDoc=null;$.lblTargetHalf=null;$.speTargetHalf=null;$.lblReason=null;$.memReason=null;$.varWfDocId="";$.varBusinessId="";$.varWFType="";$.strsave_type="N";$.btarget=false;$.spin_half_amt=0;$.spin_aval_amt=0;$.isSave=false;$.saveType="";$.noSelect=false;$.isExceptAccount=false;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFBgtAssignChg_20"]);return json}function createJSON_Q1(workType){var strDeptCode="";var strBudgetCode="";var strProductCode="";if(workType=="Q1"){strDeptCode=($.btarget==true)?$.bteDeptManage.getValue():$.cmbBudgList.getValue("dept_code");strBudgetCode=($.btarget==true)?$.cmbTargetBudget.getValue("budget_code"):$.cmbBudgList.getValue("budget_code");strProductCode=($.btarget==true)?$.cmbTargetBudget.getValue("product_code"):$.cmbBudgList.getValue("product_code")}else{if(workType=="Q4"){strDeptCode=g_main.session.obj.DeptCode;strBudgetCode="";strProductCode=""}else{strDeptCode=$.cmbBudgList.getValue("dept_code");strBudgetCode=$.cmbBudgList.getValue("budget_code");strProductCode=$.cmbBudgList.getValue("product_code")}}var json=createExecuteParamInfo("P_crmWFBgtAssignChg_Q",[workType,$.varWfDocId,"20",$.cmbBaseDate.getValue().substring(0,4),$.cmbBaseDate.getValue().substring(4,5),strDeptCode,strBudgetCode,strProductCode,"#UserID#"]);return json}function createJSON_Q2(workType,rowData){var json=createExecuteParamInfo("P_crmBudgetAssignAllow_Q",[workType,rowData.budget_code,rowData.product_code,rowData.except_seq,"#UserID#"]);return json}function createJSON_S(workType){var gRow=$.grdList.getAllRows();var rows=[];var iCount=1;for(var i in gRow){rows.push(["N",$.varWfDocId,$.cmbBaseDate.getValue().substring(0,4),$.cmbBaseDate.getValue().substring(4,5),gRow[i].dept_code,gRow[i].budget_code,gRow[i].product_code,parseInt(iCount),"20",gRow[i].target_dept_code,gRow[i].target_emp_id||"",gRow[i].target_budget_code,gRow[i].target_product_code,Number(gRow[i].target_req_amt),Number(gRow[i].aval_amt),gRow[i].change_remark,"#UserID#",gRow[i].except_seq]);iCount++}var json=createExecuteParamInfo("P_crmWFBgtAssignChgD_S",rows);return json}function createJSON_S1(workType){var rId=$.grdList.getSelectedRowIdx();var json=createExecuteParamInfo("P_crmBudgetTotal_S",[workType,$.varWfDocId,$.cmbBaseDate.getValue().substring(0,4),$.cmbBaseDate.getValue().substring(4,5),$.grdList.getValue(rId,"dept_code"),$.grdList.getValue(rId,"budget_code"),$.grdList.getValue(rId,"product_code"),parseInt(0),"20"]);return json}function createJSON_S2(workType){var json=createExecuteParamInfo("P_crmBudgetAssignAllow_S",[workType,"","","",0,"",0,0,"","","","","N",$.varWfDocId,"#UserID#"]);return json}function searchWFDocument(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function searchApplyList(workType){var json=createJSON_Q1(workType);$.spin_half_amt=0;$.spin_aval_amt=0;if(workType=="Q1"){var ds=callQuerySync(["req",json],workType);log(ds);if(ds.resultList[0].length<1){return false}$.spin_half_amt=ds.resultList[0][0].half_amt;$.spin_aval_amt=ds.resultList[0][0].aval_amt}}function searchExceptAllotCntChk(workType,rowData){var bResult=false;var json=createJSON_Q2(workType,rowData);var ds=callQuerySync(["req",json],workType);if(ds&&ds.resultList[0]){var allowCnt=ds.resultList[0][0].allow_cnt;if(allowCnt&&allowCnt>0){bResult=true}}return bResult}function summit(popResult){if(saveWFDocument("","Y",popResult)){saveBudgetTotal("10")}else{removeWFDocument($.varWfDocId)}}function tmpSave(){if(saveWFDocument("","N")){saveWFBqtAssignChg_20("N")}else{removeWFDocument($.varWfDocId)}}function saveWFBqtAssignChg_20(workType){var json=createJSON_S(workType);callExecute(["req",json],workType,$)}function saveBudgetTotal(workType){var json=createJSON_S1(workType);callExecute(["req",json],workType,$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function saveExceptAccountAllowCnt(workType){var bResult=false;var json=createJSON_S2(workType);var ds=callQuerySync(["req",json],workType);if(ds){bResult=true}return bResult}function setbudget_amt(half_amt,aval_amt,btarget_yn){$.btarget=btarget_yn;searchApplyList("Q1");half_amt.setValue($.spin_half_amt);aval_amt.setValue($.spin_aval_amt)}function cmbBudgListChange(){if($.cmbBudgList.getValue()==""){return}setbudget_amt($.speAssignMoney,$.speFusibleMoney,false);changeMoney()}function cmbTargetBudgetChange(){if((g_main.session.obj.DeptCode==$.bteDeptManage.getValue()||g_main.session.obj.EmpCode==$.cmbTargetBudget.getValue("dept_leader"))&&$.cmbTargetBudget.getValue("budget_code")!=""){$.lblTargetMoney.setVisible(true);$.speTargetMoney.setVisible(true)}else{$.lblTargetMoney.setVisible(false);$.speTargetMoney.setVisible(false)}if($.cmbTargetBudget.getValue("budget_code")==""){return}setbudget_amt($.speTargetHalf,$.speTargetMoney,true)}function changeMoney(){$.speAfterMoney.setValue($.speApplyMoney.getValue()+$.speFusibleMoney.getValue())}function checkValidation(){if(!validateControls([$.txtTitle,$.cmbBaseDate])){return false}if($.grdList.getRowCount()<1){MessageBoxShow("저장할 내용이 존재하지 않습니다.");return false}for(var i=0;i<$.grdList.getRowCount();i++){var rowData=$.grdList.getValue(i);if(rowData.except_seq){if(!searchExceptAllotCntChk("Q_CHK",rowData)){MessageBoxShow("신청하신 예산중<br>예산전용제한 항목이 존재하며<br>해당 예산은 이미 사용중입니다.");return false}}}return true}function targetBudgetChange(){if($.bteDeptManage.getText()==""){$.panObject.clear();return}$.cmbTargetBudget.setValue("");$.cmbTargetBudget.clear();$.cmbTargetBudget.setEnable(true);var subQuery=" where base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' AND base_half = '"+$.cmbBaseDate.getValue().substring(4)+"' AND dept_code = '"+$.bteDeptManage.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0078_2",subQuery);$.cmbTargetBudget.setColumn("budget_code","budget_name");setComboBind([$.cmbTargetBudget],ds);setComboBoxFocus($.cmbTargetBudget)}function moveWFGeneralProc(){var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function setComboBoxFocus(id){var grd=id.getComboList();var list=grd.serialize();var idArr=[];for(var i=0;i<list.length;i++){if(list[i].budget_type&&list[i].budget_type=="EXCEPT"){idArr.push(list[i].id)}}if(idArr.length){id.setSelectedItemAddCss(idArr,"combo-focus")}}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1120);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,540,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1100,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFDetail=new FingerPanel(host,"panWFDetail",0,530,1200,285);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,825,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,825,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,210);$.cmbBaseDate=new FingerComboBox(host,"cmbBaseDate",510,77,140,20);$.panList=new FingerPanel(host,"panList",0,275,1200,240);$.panList.setText("신청추가");$.panList.setBottomLine(true);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,195);$.panDetail=new FingerPanel(host,"panDetail",0,65,700,200);$.panDetail.setText("신청내역");$.panDetail.setBottomLine(true);$.lblBudgList=new FingerLabel(host,"lblBudgList",0,10,100,20);$.lblBudgList.setText("예산항목");$.lblAssignMoney=new FingerLabel(host,"lblAssignMoney",0,40,100,20);$.lblAssignMoney.setText("배정금액");$.lblFusibleMoney=new FingerLabel(host,"lblFusibleMoney",325,40,100,20);$.lblFusibleMoney.setText("가용잔액");$.lblApplyMoney=new FingerLabel(host,"lblApplyMoney",0,70,100,20);$.lblApplyMoney.setText("신청금액");$.cmbBudgList=new FingerComboBox(host,"cmbBudgList",105,10,545,20);$.speAssignMoney=new FingerSpinEdit(host,"speAssignMoney",105,40,215,20);$.speFusibleMoney=new FingerSpinEdit(host,"speFusibleMoney",430,40,215,20);$.speApplyMoney=new FingerSpinEdit(host,"speApplyMoney",105,70,215,20);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.tabObject=new FingerTab(host,"tabObject",710,85,490,185);$.panTotal=new FingerPanel(host,"panTotal",0,0,485,150);$.panTotal.setText("");$.panTotal.setBottomLine(true);$.panObject=new FingerPanel(host,"panObject",710,65,485,200);$.panObject.setText("대상내역");$.panObject.setBottomLine(true);$.lblDeptManage=new FingerLabel(host,"lblDeptManage",0,10,100,20);$.lblDeptManage.setText("주관부서");$.lblTargetBudget=new FingerLabel(host,"lblTargetBudget",0,40,100,20);$.lblTargetBudget.setText("대상예산항목");$.bteDeptManage=new FingerButtonEdit(host,"bteDeptManage",105,10,215,20);$.bteDeptManage.setText("");$.cmbTargetBudget=new FingerComboBox(host,"cmbTargetBudget",105,40,360,20);$.speAfterMoney=new FingerSpinEdit(host,"speAfterMoney",430,70,215,15);$.lblAfterMoney=new FingerLabel(host,"lblAfterMoney",325,70,100,20);$.lblAfterMoney.setText("신청후잔액");$.grdTotal=new FingerDataGrid(host,"grdTotal",0,5,485,150);$.lblTargetMoney=new FingerLabel(host,"lblTargetMoney",230,70,100,20);$.lblTargetMoney.setText("가용잔액");$.speTargetMoney=new FingerSpinEdit(host,"speTargetMoney",335,70,126,20);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.lblTargetHalf=new FingerLabel(host,"lblTargetHalf",0,70,100,20);$.lblTargetHalf.setText("배정금액");$.speTargetHalf=new FingerSpinEdit(host,"speTargetHalf",105,70,125,20);$.lblReason=new FingerLabel(host,"lblReason",0,100,100,20);$.lblReason.setText("사유");$.memReason=new FingerMemoEdit(host,"memReason",105,100,535,35);$.panTitle.setBorder(true);$.panList.addButtons(["btnDelete","btnSave","btnNew"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.cmbBaseDate.setAllowBlank(false,"반기");$.cmbBudgList.setEmptyRow(true);$.cmbBudgList.setAllowBlank(false,"예산항목");$.cmbTargetBudget.setAllowBlank(false,"대상예산항목");$.speApplyMoney.setAllowBlank(false,"신청금액");$.speApplyMoney.setValue(0);$.speAssignMoney.setValue(0);$.speFusibleMoney.setValue(0);$.speAfterMoney.setValue(0);$.speAssignMoney.setReadOnly(true);$.speFusibleMoney.setReadOnly(true);$.speAfterMoney.setReadOnly(true);$.bteDeptManage.setAllowBlank(false,"주관부서");$.cmbTargetBudget.setEnable(false);$.cmbTargetBudget.setEmptyRow(true);$.lblTargetMoney.setVisible(false);$.speTargetMoney.setValue(0);$.speTargetMoney.setReadOnly(true);$.speTargetMoney.setVisible(false);$.lblTargetHalf.setVisible(false);$.speTargetHalf.setValue(0);$.speTargetHalf.setReadOnly(true);$.speTargetHalf.setVisible(false);$.lblReason.setVisible(true);$.memReason.setVisible(true);$.memReason.setAllowBlank(false,"사유");$.cmbBaseDate.setReadOnly(true);$.panTotal.setVisible(false);$.btnTmpSave.setVisible(false);$.cmbBudgList.setColumnConfig([{id:"budget_name",width:200},{id:"dept_code",width:60},{id:"dept_name",width:60},{id:"except_yn",width:90},{id:"budget_code",width:80},{id:"product_code",width:60},{id:"not_transfer_yn",width:50},{id:"budget_transfer_type",width:60},{id:"dept_leader",hidden:true},{id:"base_yyyy",hidden:true},{id:"base_half",hidden:true},{id:"ucoa_code",hidden:true},{id:"budget_type",hidden:true},{id:"allow_amt",hidden:true},{id:"seq",hidden:true}]);$.cmbTargetBudget.setColumnConfig([{id:"budget_name",width:200},{id:"dept_code",width:60},{id:"dept_name",width:60},{id:"except_yn",width:90},{id:"budget_code",width:80},{id:"product_code",width:60},{id:"not_transfer_yn",width:50},{id:"budget_transfer_type",width:60},{id:"dept_leader",hidden:true},{id:"base_yyyy",hidden:true},{id:"base_half",hidden:true},{id:"ucoa_code",hidden:true},{id:"budget_type",hidden:true},{id:"key_budget_code",hidden:true},{id:"key_product_code",hidden:true},{id:"key_seq",hidden:true}]);$.cmbBaseDate.setColumn("half_code","half_name");$.cmbBudgList.setColumn("budget_code","budget_name");$.cmbTargetBudget.setColumn("budget_code","budget_name");$.grdList.colIdx=$.grdList.setColumns([new FingerDataGridColumn("budget_name",200,"left","string","예산항목"),new FingerDataGridColumn("aval_amt",120,"right","int","전용 전 가용잔액",{format:"int"}),new FingerDataGridColumn("target_req_amt",110,"right","int","신청금액",{format:"int"}),new FingerDataGridColumn("target_dept_name",110,"left","string","주관부서"),new FingerDataGridColumn("target_budget_name",200,"left","string","대상예산항목"),new FingerDataGridColumn("afteraval_amt",120,"right","int","전용 후 가용잔액",{format:"int"}),new FingerDataGridColumn("dept_code",120,"left","string","코드",{hidden:true}),new FingerDataGridColumn("budget_code",240,"left","string","예산항목코드",{hidden:true}),new FingerDataGridColumn("product_code",200,"left","string","품목코드",{hidden:true}),new FingerDataGridColumn("target_dept_code",100,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("target_budget_code",200,"left","string","대상예산코드",{hidden:true}),new FingerDataGridColumn("target_product_code",200,"left","string","대상품목코드",{hidden:true}),new FingerDataGridColumn("change_remark",310,"left","string","사유",{hidden:false}),new FingerDataGridColumn("target_emp_id",200,"left","string","대상사원코드",{hidden:true}),new FingerDataGridColumn("dept_name",200,"left","string","부서명",{hidden:true}),new FingerDataGridColumn("target_aval_amt",200,"left","string","부서명",{hidden:true}),new FingerDataGridColumn("except_seq",0,"left","string","",{hidden:true})]);$.grdList.init({panel:$.panList,nonExcel:true,isFilter:false});$.grdList.setEditable(false);$.grdList.setBorder(false);$.grdTotal.colIdx=$.grdTotal.setColumns([new FingerDataGridColumn("budget_name",150,"left","string","예산항목"),new FingerDataGridColumn("product_code",120,"right","string","품목"),new FingerDataGridColumn("target_req_amt",120,"right","int","신청금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("half_amt",120,"right","int","배정금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("aval_amt",120,"right","int","가용잔액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("req_amt",120,"right","int","신청후잔액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("budget_code",240,"left","string","예산코드",{hidden:true}),new FingerDataGridColumn("product_name",240,"left","string","품목",{hidden:true})]);$.grdTotal.init({scroll:"xy",footer:true});$.grdTotal.setEditable(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panList);$.panMain.add($.panDetail);$.panMain.add($.tabObject);$.panMain.add($.cmbBaseDate);$.panMain.add($.panObject);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panList.add($.grdList);$.panDetail.add($.lblBudgList);$.panDetail.add($.lblAssignMoney);$.panDetail.add($.lblFusibleMoney);$.panDetail.add($.lblApplyMoney);$.panDetail.add($.cmbBudgList);$.panDetail.add($.speAssignMoney);$.panDetail.add($.speFusibleMoney);$.panDetail.add($.speApplyMoney);$.panDetail.add($.speAfterMoney);$.panDetail.add($.lblAfterMoney);$.panDetail.add($.lblReason);$.panDetail.add($.memReason);$.panTotal.add($.grdTotal);$.panObject.add($.lblDeptManage);$.panObject.add($.lblTargetBudget);$.panObject.add($.bteDeptManage);$.panObject.add($.cmbTargetBudget);$.panObject.add($.lblTargetMoney);$.panObject.add($.speTargetMoney);$.panObject.add($.lblTargetHalf);$.panObject.add($.speTargetHalf);relocateChildIndexInPanel([$.panTitle,$.panDetail,$.panObject]);searchWFDocument("Q3");var ds=bizComponentData2($,"Q1","L_CRM0008");setComboBind([$.cmbBaseDate],ds);$.cmbBaseDate.setValue(ds.resultList[0][0].half_code);searchApplyList("Q4");var subQuery=" where base_yyyy = '"+$.cmbBaseDate.getValue().substring(0,4)+"' AND base_half = '"+$.cmbBaseDate.getValue().substring(4)+"' AND (dept_code = '"+g_main.session.obj.DeptCode+"' OR dept_leader = '"+g_main.session.obj.UserID+"')";var ds1=bizComponentData2($,"Q4","L_CRM0078",subQuery);$.cmbBudgList.setColumn("budget_code","budget_name");setComboBind([$.cmbBudgList],ds1);setComboBoxFocus($.cmbBudgList)};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue("["+g_main.session.getValue("DeptName")+"] "+result.business_title)}else{if(type=="N"){if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);removeWFDocument($.varWfDocId);return}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);removeWFDocument($.varWfDocId);return}}if($.saveType=="summit"){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFBgtAssignChg_20",new_line:true};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if($.saveType=="tmp"){moveWFGeneralProc()}}}}else{if(type=="10"){if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);removeWFDocument($.varWfDocId)}else{if(ds.errorCode=="MSG0002"){var bResult=false;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"except_seq")){bResult=true;break}}if(bResult){if(!saveExceptAccountAllowCnt("U_CNT")){MessageBoxShow("상신은 완료되었으나<br>전용횟수 변경에 실패하였습니다.");return}}moveWFGeneralProc()}else{if(ds.errorCode=="MSG0029"){MessageBoxShow("등록된 레코드가 없습니다.")}}}}}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];console.log(args);if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);setDataGrid([$.grdList],args[6],true);$.grdList.selectRow(0);$.isSave=true;$.noSelect=false}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!checkValidation()){return}confirmBoxShow("상신 하시겠습니까?",function(){if(g_main.msgShare==true){$.saveType="summit";tmpSave()}})}else{if(id=="btnTmpSave"){if(!checkValidation()){return}confirmBoxShow("임시저장 하시겠습니까?",function(){if(g_main.msgShare==true){$.saveType="tmp";tmpSave()}})}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteDeptManage"){var param={dept_name:$.bteDeptManage.getText()||"",};g_main.openPopup("popDept.html","popDept","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){if(id=="bteDeptManage"){if($.bteDeptManage.getText()==""){$.cmbTargetBudget.clear();$.lblTargetMoney.setVisible(false);$.speTargetMoney.setVisible(false);$.speTargetMoney.setValue(0)}}};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cmbBudgList"){cmbBudgListChange()}else{if(id=="cmbTargetBudget"){cmbTargetBudgetChange()}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList"){if($.grdList.getValue(rId,"budget_code")==""){return}if(!$.noSelect){$.bteDeptManage.setValue($.grdList.getValue(rId,"target_dept_code"));$.speApplyMoney.setValue($.grdList.getValue(rId,"target_req_amt"));$.memReason.setValue($.grdList.getValue(rId,"change_remark"));$.bteDeptManage.setText($.grdList.getValue(rId,"target_dept_name"));$.cmbBudgList.setValue($.grdList.getValue(rId,"budget_code"));targetBudgetChange();$.cmbTargetBudget.setValue($.grdList.getValue(rId,"target_budget_code"))}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){if(id=="speApplyMoney"){changeMoney()}};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnSave"){$.noSelect=false;if(!validateControls([$.cmbBudgList,$.cmbBaseDate,$.bteDeptManage,$.memReason])){return}if($.cmbTargetBudget.getValue("budget_code")==""||!$.cmbTargetBudget.getValue("budget_code")){MessageBoxShow("대상예산항목 (은)는 필수 입력 항목입니다.");return}if(Number($.speApplyMoney.getValue())>Number($.speTargetMoney.getValue())){MessageBoxShow("대상예산항목의 가용잔액 내에서 전용이 가능합니다.");return}if($.cmbBudgList.getValue("budget_code")=="B01500004"||$.cmbTargetBudget.getValue("budget_code")=="B01500004"||$.cmbBudgList.getValue("budget_code")=="B01500023"||$.cmbTargetBudget.getValue("budget_code")=="B01500023"||$.cmbBudgList.getValue("budget_code")=="B01500022"||$.cmbTargetBudget.getValue("budget_code")=="B01500022"){}else{if(($.cmbBudgList.getValue("budget_code")=="B01500069"&$.cmbTargetBudget.getValue("budget_code")=="B01500069")||(($.cmbBudgList.getValue("budget_code")=="B01600012"||$.cmbBudgList.getValue("budget_code")=="B01600046")&($.cmbTargetBudget.getValue("budget_code")=="B01600012"||$.cmbTargetBudget.getValue("budget_code")=="B01600046"))){}else{if($.cmbBudgList.getValue("budget_code")=="B01600003"&$.cmbTargetBudget.getValue("budget_code")=="B01600003"){}else{if(($.cmbBudgList.getValue("dept_code").substring(0,1)!=="S"&$.cmbBudgList.getValue("dept_code").substring(0,1)!=="T"&$.cmbBudgList.getValue("dept_code").substring(0,1)!=="J")&(($.cmbBudgList.getValue("budget_code")=="B01100001"||$.cmbBudgList.getValue("budget_code")=="B01100003"||$.cmbBudgList.getValue("budget_code")=="B01100005"||$.cmbBudgList.getValue("budget_code")=="B01100013"||$.cmbBudgList.getValue("budget_code")=="B01100014"||$.cmbBudgList.getValue("budget_code")=="B01100015"||$.cmbBudgList.getValue("budget_code")=="B01100016"||$.cmbBudgList.getValue("budget_code")=="B01100017"||$.cmbBudgList.getValue("budget_code")=="B01100018")&$.cmbTargetBudget.getValue("budget_code")=="B01100004")){}else{if(($.cmbBudgList.getValue("budget_code")=="B01500073"||$.cmbBudgList.getValue("budget_code")=="B00800008"||$.cmbBudgList.getValue("budget_code")=="B01100005"||$.cmbBudgList.getValue("budget_code")=="B01100011"||$.cmbBudgList.getValue("budget_code")=="B01100003"||$.cmbBudgList.getValue("budget_code")=="B01100001")&($.cmbTargetBudget.getValue("budget_code")=="B01500073"||$.cmbTargetBudget.getValue("budget_code")=="B00800008"||$.cmbTargetBudget.getValue("budget_code")=="B01100005"||$.cmbTargetBudget.getValue("budget_code")=="B01100011"||$.cmbTargetBudget.getValue("budget_code")=="B01100003"||$.cmbTargetBudget.getValue("budget_code")=="B01100001")){}else{if(($.cmbBudgList.getValue("budget_code")=="B01600046"&$.cmbTargetBudget.getValue("budget_code")=="B01600046")||($.cmbBudgList.getValue("budget_code")=="B01600023"&$.cmbTargetBudget.getValue("budget_code")=="B01600023")||($.cmbBudgList.getValue("budget_code")=="B01600012"&$.cmbTargetBudget.getValue("budget_code")=="B01600012")||($.cmbBudgList.getValue("budget_code")=="B01600018"&$.cmbTargetBudget.getValue("budget_code")=="B01600018")){}else{$.isExceptAccount=false;if($.cmbBudgList.getValue("budget_type")=="EXCEPT"){if(Number($.cmbBudgList.getValue("allow_amt"))&&$.cmbBudgList.getValue("allow_amt")<$.speApplyMoney.getValue()){MessageBoxShow("신청금액이 전용금액을 초과하였습니다.<br>(전용제한금액 : "+$.cmbBudgList.getValue("allow_amt")+")");return}if($.cmbBudgList.getValue("budget_code")==$.cmbTargetBudget.getValue("key_budget_code")&&$.cmbBudgList.getValue("product_code")==$.cmbTargetBudget.getValue("key_product_code")&&$.cmbBudgList.getValue("seq")==$.cmbTargetBudget.getValue("key_seq")){$.isExceptAccount=true}}if(!$.isExceptAccount){if($.cmbBudgList.getValue("dept_code")!=$.cmbTargetBudget.getValue("dept_code")){MessageBoxShow("같은 부서 내에서만 전용이 가능합니다.");return}if($.cmbBudgList.getValue("ucoa_code")!=$.cmbTargetBudget.getValue("ucoa_code")){MessageBoxShow("같은 U-CoA 내에서만 전용이 가능합니다.");return}if($.cmbBudgList.getValue("product_code")!=$.cmbTargetBudget.getValue("product_code")){MessageBoxShow("같은 품목 내에서만 전용이 가능합니다.");return}}}}}}}}var applyMoney=$.speApplyMoney.getValue();var iRow=0;if($.grdList.getRowCount()>0){for(var i=0;i<$.grdList.getRowCount();i++){if($.cmbBudgList.getValue("budget_code")==$.grdList.getValue(i,"budget_code")&&$.cmbBudgList.getValue("product_code")==$.grdList.getValue(i,"product_code")&&$.bteDeptManage.getValue()==$.grdList.getValue(i,"target_dept_code")&&$.cmbTargetBudget.getValue("budget_code")==$.grdList.getValue(i,"target_budget_code")&&$.cmbTargetBudget.getValue("product_code")==$.grdList.getValue(i,"target_product_code")){iRow=i;break}}}if(Number(applyMoney)<=0){MessageBoxShow("신청금액을 0보다 큰값을 넣어주십시요.");$.speApplyMoney.setFocus();return}if($.cmbBudgList.getValue("dept_code")==$.bteDeptManage.getValue()&&$.cmbBudgList.getValue("budget_code")==$.cmbTargetBudget.getValue("budget_code")&&$.cmbBudgList.getValue("product_code")==$.cmbTargetBudget.getValue("product_code")){MessageBoxShow("같은 예산항목의 금액을 변경하실수 없습니다.");return}var dtotal_target_req_amt=0;dtotal_target_req_amt=applyMoney;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"target_dept_code")==$.bteDeptManage.getValue()&&$.grdList.getValue(i,"target_budget_code")==$.cmbTargetBudget.getValue("budget_code")&&$.grdList.getValue(i,"target_product_code")==$.cmbTargetBudget.getValue("product_code")){if($.grdList.getValue(i,"dept_code")==$.cmbBudgList.getValue("dept_code")&&$.grdList.getValue(i,"budget_code")==$.cmbBudgList.getValue("budget_code")&&$.grdList.getValue(i,"product_code")==$.cmbBudgList.getValue("product_code")){}else{dtotal_target_req_amt=Number(dtotal_target_req_amt)+Number($.grdList.getValue(i,"target_req_amt"))}if(Number(dtotal_target_req_amt)>Number($.speTargetMoney.getValue())){MessageBoxShow("대상예산항목의 가용잔액 내에서 전용이 가능합니다.");return}}}$.noSelect=true;var dtarget_req_amt=0;for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"budget_code")==$.cmbBudgList.getValue("budget_code")&&$.grdList.getValue(i,"product_code")==$.cmbBudgList.getValue("product_code")&&$.grdList.getValue(i,"target_dept_code")==$.bteDeptManage.getValue()&&$.grdList.getValue(i,"target_budget_code")==$.cmbTargetBudget.getValue("budget_code")&&$.grdList.getValue(i,"target_product_code")==$.cmbTargetBudget.getValue("product_code")){$.strsave_type="Y";dtarget_req_amt=$.grdList.getValue(i,"target_req_amt");$.grdList.setValue(i,"target_req_amt",applyMoney);$.grdList.setValue(i,"afteraval_amt",($.speFusibleMoney.getValue()+applyMoney));$.grdList.setValue(i,"change_remark",$.memReason.getValue());$.grdList.selectRow(i);$.grdList.getItem(i).rowType="N";break}}if($.strsave_type=="N"){$.grdList.addRow({dept_code:$.cmbBudgList.getValue("dept_code"),budget_code:$.cmbBudgList.getValue("budget_code"),budget_name:$.cmbBudgList.getValue("budget_name"),product_code:$.cmbBudgList.getValue("product_code"),target_req_amt:Number(applyMoney),target_budget_code:$.cmbTargetBudget.getValue("budget_code"),target_budget_name:$.cmbTargetBudget.getValue("budget_name"),target_dept_code:$.bteDeptManage.getValue(),target_dept_name:$.bteDeptManage.getText(),target_product_code:$.cmbTargetBudget.getValue("product_code"),aval_amt:Number($.speFusibleMoney.getValue()),change_remark:$.memReason.getValue(),afteraval_amt:(Number($.speFusibleMoney.getValue())+Number(applyMoney)),except_seq:$.cmbBudgList.getValue("seq")},$.grdList.getRowCount())}$.noSelect=false;$.strsave_type="N"}else{if(btnId=="btnNew"){$.panDetail.clear();$.panObject.clear();$.cmbBudgList.setFocus();$.strsave_type="N";$.cmbTargetBudget.setEnable(false);$.lblTargetMoney.setVisible(false);$.speTargetMoney.setVisible(false);$.speTargetMoney.setValue(0)}else{if(btnId=="btnDelete"){if($.grdList.getRowCount()<1){return}var listrId=$.grdList.getSelectedRowIdx();var totalrId=$.grdTotal.getSelectedRowIdx();var strbudget_code=$.grdTotal.getValue(totalrId,"budget_code");var strproduct_code=$.grdTotal.getValue(totalrId,"product_code");var dtarget_req_amt=Number($.grdList.getValue(listrId,"target_req_amt"));$.grdList.deleteRow($.grdList.getSelectedRowIdx());$.grdList.selectRow(0);for(var i=0;i<$.grdTotal.getRowCount();i++){if($.grdTotal.getValue(i,"budget_code")==strbudget_code&&$.grdTotal.getValue(i,"product_code")==strproduct_code){var dValue=$.grdTotal.getValue(i,"target_req_amt");dValue=Number(dValue)-Number(dtarget_req_amt);if(dValue<=0){$.grdTotal.selectRow(i);$.grdTotal.deleteRow($.grdTotal.getSelectedRowIdx())}else{$.grdTotal.setValue(i,"target_req_amt",dValue)}}}$.strsave_type="N";$.cmbTargetBudget.setEnable(false);$.lblTargetMoney.setVisible(false);$.speTargetMoney.setVisible(false);if($.grdList.getRowCount()<1){$.panDetail.clear();$.panObject.clear()}}}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(fileList)})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});confirmBoxShow("정말 삭제하시겠습니까? 삭제하시려면 예를 클릭하세요",function(){if(g_main.msgShare==true){if(result){MessageBoxShow("파일 삭제 되었습니다.");$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}})}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popDept"){if($.popUpCallId=="bteDeptManage"){$.bteDeptManage.setValue(popResult.dept_code);$.bteDeptManage.setText(popResult.dept_name);$.speTargetMoney.setValue(0);$.lblTargetMoney.setVisible(false);$.speTargetMoney.setVisible(false);targetBudgetChange()}}else{if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){removeWFDocument($.varWfDocId)}else{$.isSave=false;summit(popResult)}}}else{if(id=="crmWFEndDocSub"){var rows=[];for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}}else{if($.popUpCallId=="btnSubmit"){removeWFDocument($.varWfDocId)}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>