<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panList1=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.panList2=null;$.grdList2=null;$.btnEsero=null;$.panWFMain=null;$.cmbBase=null;$.grdList1=null;$.btnCard=null;$.lblBudget=null;$.lblAval=null;$.lblPlan=null;$.lblTotal=null;$.lblRemark=null;$.txtBudget=null;$.speAval=null;$.spePlan=null;$.speTotal=null;$.txtRemark=null;$.grdUseDate=null;$.grdDoc=null;$.grdFile=null;$.tabDetail=null;$.panDate=null;$.panStay=null;$.grdStay=null;$.bteSubject=null;$.lblSubject=null;$.lblVice=null;$.chkVice=null;$.lblGrapeFn=null;$.cmbGrapeFn=null;$.lblPresident=null;$.chkPresident=null;$.btnDefineAccount=null;$.varWFDocId="";$.varOriginWfDocId="";$.varBusinessId="";$.varWFType="";$.varBank="";$.varAccount="";$.varBankAccount="";$.varSubWfDocId="";$.ref_wf_doc_id="";function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFBgtUseFor"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmWFBudgetUse_Q",[workType,$.varWFDocId||"",$.cmbBase.getValue().substr(0,4),$.cmbBase.getValue().substr(4,1),"#DeptCode#","","",0,"","#UserID#"]);return json}function createJSON_Q3(workType,cardCode,cardName){var json=createExecuteParamInfo("P_vwB1_OCRD_Q",[workType,"S","230",cardCode,cardName]);return json}function createJSON_S(workType){var sumUseAmt=0,sumTaxAmt=0,sumDedAmt=0;var cRow=$.grdList2.getAllRows();for(var i in cRow){sumUseAmt+=Number(cRow[i].use_amt);sumTaxAmt+=Number(cRow[i].tax_amt);sumDedAmt+=Number(cRow[i].nodeduction_amt)}var json=createExecuteParamInfo("P_crmWFBgtAftD_S",[workType,$.varWfDocId,$.cmbBase.getValue().substr(0,4),$.cmbBase.getValue().substr(4,1),$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"dept_code")||"",$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"budget_code"),$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"product_code"),"50","",$.speTotal.getValue()||0,"","","#UserID#","","","","",$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"assign_seq")||1,"#DeptCode#","#UserID#",$.grdList1.getValue($.grdList1.getSelectedRowIdx(),"plan_seq")||1,1,"80",sumUseAmt||0,sumTaxAmt||0,sumDedAmt||0,$.txtRemark.getValue(),$.chkPresident.getValue(),($.chkVice.getValue()==true||$.chkVice.getValue()=="Y"?"Y":"N"),$.ref_wf_doc_id||"",1,"","",$.varSubWfDocId||"","","",$.cmbGrapeFn.getValue("extra_field1")||""]);return json}function createJSON_S2(workType){var json="";var cRow=$.grdList2.getAllRows();if(cRow.length<1){return}var rows=[];for(var i in cRow){rows.push([workType,$.varWfDocId,Number(i)+1,"#DeptCode#","#UserID#",cRow[i].receipt_type,unmask(cRow[i].use_date),"",cRow[i].use_amt||0,cRow[i].tax_amt||0,cRow[i].nodeduction_amt||0,cRow[i].deposit_emp_code||"",cRow[i].deposit_emp_name||"",cRow[i].account_comp_code||"",cRow[i].account_comp_name||"",cRow[i].VatBPNM1||"",cRow[i].VatRegN||"",cRow[i].use_remark||"",cRow[i].APPDAT||"",cRow[i].CARDNO||"",cRow[i].APPRNO||"",cRow[i].SAPCODE||"",cRow[i].VENKNM||"",cRow[i].pay_me||"",cRow[i].bank_account||"",cRow[i].bank||"",cRow[i].account||"",cRow[i].acct_name||"","",0,"#UserID#"])}json=createExecuteParamInfo("P_crmReceipt_S",rows);return json}function createJSON_S3(workType){var date="",week="",amt="",trip="",way="",remark="";var cRow=$.grdStay.getAllRows();for(var i in cRow){date+=(date?"|":"")+unmask(cRow[i].trans_date).substr(0,8);week+=(week?"|":"")+" ";amt+=(amt?"|":"")+(cRow[i].trans_amt||0);trip+=(trip?"|":"")+(cRow[i].trans_trip||0);way+=(way?"|":"")+(cRow[i].trans_way||" ");remark+=(remark?"|":"")+" "}var json=createExecuteParamInfo("P_crmWFBudgetUsePDDetail_S",[workType,$.varWfDocId,0,0,date,week,amt,trip,way,remark]);return json}function createJSON_S4(workType){var date="",wage="",meal="",roaming="",charge="",total_amt="",charge_name="";var cRow=$.grdUseDate.getAllRows();for(var i in cRow){date+=(date?"|":"")+unmask(cRow[i].day_date).substr(0,8);wage+=(wage?"|":"")+(cRow[i].day_wage||0);meal+=(meal?"|":"")+(cRow[i].day_meal||0);roaming+=(roaming?"|":"")+(cRow[i].day_roaming||0);charge+=(charge?"|":"")+(cRow[i].day_charge||0);total_amt+=(total_amt?"|":"")+(cRow[i].day_total_amt||0);charge_name+=(charge_name?"|":"")+(cRow[i].day_charge_name||" ")}var json=createExecuteParamInfo("P_crmWFBudgetUsePDStay_S",[workType,$.varWfDocId,0,0,date,wage,meal,roaming,charge,total_amt,charge_name]);return json}function createJSON_S5(workType){var rId=$.grdList2.getSelectedRowIdx();var data=$.grdList2.getValue(rId);var json=createExecuteParamInfo("P_crmBCARDMAS_S",[workType,data.APPDAT,data.CARDNO,data.APPRNO,"","","","#UserID#"]);return json}function searchWFDocument(){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchAdvence(){var json=createJSON_Q2("FOR");callQuery(["req",json],"FOR",$)}function searchDepositEmpCheck(cardCode,cardName){var json=createJSON_Q3("Q",cardCode,cardName);var ds=callExecuteSync(["req",json],"Q",$,false);if(ds.resultList[0].length>=1){return true}else{return false}}function saveBudgetUseAft(workType){var json=createJSON_S(workType);var ds=callExecuteSync(["req",json],workType,$,false);var bResult=false;if(ds){if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg)}else{bResult=true}}return bResult}function saveReceipt(workType){var json=createJSON_S2(workType);var ds=callExecuteSync(["req",json],workType,$,false);var bResult=true;if(ds){var rs=ds.resultList;if(rs.length>1){for(var i in rs){if(rs[i].errorCode.substring(0,1)=="P"||rs[i].errorCode.substring(0,1)=="E"){MessageBoxShow(rs[i].errorCode+"</br>"+rs[i].errorMsg);bResult=false}}}else{if(ds.errorCode.substring(0,1)=="P"||ds.errorCode.substring(0,1)=="E"){MessageBoxShow(ds.errorCode+"</br>"+ds.errorMsg);bResult=false}}}else{bResult=false}log(bResult);return bResult}function saveUseTrans(workType){if($.grdStay.getAllRows().length<=0){return true}var json=createJSON_S3(workType);var ds=callExecuteSync(["req",json],workType,$,false);if(ds.errorCode=="MSG0002"){return true}}function saveUseDetail(workType){if($.grdUseDate.getAllRows().length<=0){return true}var json=createJSON_S4(workType);var ds=callExecuteSync(["req",json],workType,$,false);if(ds.errorCode=="MSG0002"){return true}}function saveCardRe(workType){var json=createJSON_S5(workType);var ds=callExecuteSync(["req",json],workType,$,false);log(ds);if(ds){return true}}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function rowProperties(rId,val){switch(val){case"10":$.grdList2.setValue(rId,"modify_yn","Y");$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt",0);$.grdList2.setValue(rId,"deposit_emp_name_readonly",false);$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"SAPCODE_readonly",false);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false);break;case"20":$.grdList2.setValue(rId,"modify_yn","N");$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",true);break;case"30":if($.grdList2.getValue(rId,"modify_yn")=="Y"){$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",false);$.grdList2.setValue(rId,"nodeduction_amt_readonly",false);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false)}else{$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",true);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",true);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false)}break;case"40":$.grdList2.setValue(rId,"use_date_readonly",false);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",true);$.grdList2.setValue(rId,"nodeduction_amt_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"SAPCODE","");$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",false);break;case"50":$.grdList2.setValue(rId,"modify_yn","Y");$.grdList2.setValue(rId,"use_date_readonly",true);$.grdList2.setValue(rId,"use_amt_readonly",false);$.grdList2.setValue(rId,"tax_amt_readonly",false);$.grdList2.setValue(rId,"nodeduction_amt_readonly",false);$.grdList2.setValue(rId,"deposit_emp_name_readonly",true);$.grdList2.setValue(rId,"account_comp_name_readonly",false);$.grdList2.setValue(rId,"SAPCODE_readonly",true);$.grdList2.setValue(rId,"APPRNO_readonly",true);$.grdList2.setValue(rId,"VENKNM_readonly",true);break}}function calcUseAmt(type){if(type=="S"){var useAmt=0,stayAmt=0;var cRow1=$.grdUseDate.getAllRows();var cRow2=$.grdStay.getAllRows();for(var i in cRow1){useAmt+=Number(cRow1[i].day_total_amt)}for(var i in cRow2){stayAmt+=Number(cRow2[i].trans_amt)}$.spePlan.setValue(useAmt+stayAmt)}else{if(type=="D_D"){$.spePlan.setValue(Number($.spePlan.getValue())-Number($.grdUseDate.getValue($.grdUseDate.getSelectedRowIdx(),"day_total_amt")))}else{if(type=="D_S"){$.spePlan.setValue(Number($.spePlan.getValue())-Number($.grdStay.getValue($.grdStay.getSelectedRowIdx(),"trans_amt")))}}}}function calcReceiptAmt(type){if(type=="S"){var useAmt=0,nodAmt=0;var cRow=$.grdList2.getAllRows();for(var i in cRow){useAmt+=Number(cRow[i].use_amt);nodAmt+=Number(cRow[i].nodeduction_amt)}$.speTotal.setValue(useAmt+nodAmt)}else{if(type=="D"){$.speTotal.setValue(Number($.speTotal.getValue())-(Number($.grdList2.getValue($.grdList2.getSelectedRowIdx(),"use_amt"))+Number($.grdList2.getValue($.grdList2.getSelectedRowIdx(),"nodeduction_amt"))))}}}function chkReceipt(){var cRow=$.grdList2.getAllRows();var start=$.cmbBase.getValue("receipt_start_date");var end=$.cmbBase.getValue("receipt_end_date");for(var i in cRow){if(cRow[i].use_amt==0||cRow[i].use_amt==""){MessageBoxShow("영수증 사용금액은 0보다 큰 값을 입력하셔야 합니다.");return false}var use_date=unmask(cRow[i].use_date).substring(0,8);if(Number(use_date)<Number(start)||Number(use_date)>Number(end)){MessageBoxShow("반기에 해당하는 영수증 일자만 처리 가능합니다.");return false}if(cRow[i].bank_account==""||cRow[i].bank==""||cRow[i].account==""||cRow[i].acct_name==""){MessageBoxShow("입금계좌 정보가 없습니다.");return false}if(cRow[i].receipt_type=="10"){var strdeposit_emp_name=cRow[i].deposit_emp_name;var strsepartor=strdeposit_emp_name.split("]");var strCardCode="";var strCardName="";if(strsepartor.length>=2){strCardCode=strsepartor[0].replace("[","");strCardName=(strsepartor.length>2?strsepartor[1]+"]":strsepartor[1])}if(cRow[i].deposit_emp_name==""||strCardCode==""||strCardName==""||!searchDepositEmpCheck(cRow[i].deposit_emp_code,cRow[i].deposit_emp_name)){MessageBoxShow("입금처로 등록되지 않은 사원코드 입니다. 재무회계팀에 확인 하시기 바랍니다.");return false}}else{if(cRow[i].receipt_type=="30"||cRow[i].receipt_type=="40"){if(cRow[i].account_comp_name==""){MessageBoxShow("영수증종류가 세금계산서, 계산서일 경우 회계거래처를 필수로 입력하셔야 합니다.");return false}}else{if(cRow[i].receipt_type=="50"){if(cRow[i].account_comp_name==""||!cRow[i].account_comp_name){MessageBoxShow("영수증종류가 카드매입일 경우 회계거래처를 필수로 입력하셔야 합니다.");return false}}}}}return true}function setGrape(rId){var rData=$.grdList1.getValue(rId);$.cmbGrapeFn.setEnable(false);if((rData.grape_yn&&rData.grape_yn=="Y")||rData.grape_function_code){$.lblGrapeFn.setVisible(true);$.cmbGrapeFn.setVisible(true);$.cmbGrapeFn.setAllowBlank(false,"Grape Function");if(rData.grape_yn&&rData.grape_yn=="Y"){$.cmbGrapeFn.setEnable(true)}if(rData.grape_function_code){$.cmbGrapeFn.clear();var ds="";ds=bizComponentData2($,"Q1","L_CRM0274");if(rData.grape_function_code=="E122"){var subQuery=" AND extra_field1 in ('E123', 'E124')";ds=bizComponentData2($,"Q4","L_CRM0274",subQuery)}setComboBind([$.cmbGrapeFn],ds);$.cmbGrapeFn.setValue(rData.grape_function_code)}}else{$.lblGrapeFn.setVisible(false);$.cmbGrapeFn.setVisible(false);$.cmbGrapeFn.setAllowBlank(true)}}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1685);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panList1=new FingerPanel(host,"panList1",0,65,1200,410);$.panList1.setText("예산사용집계");$.panList1.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,985,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,1380,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,1380,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.panList2=new FingerPanel(host,"panList2",0,745,1200,230);$.panList2.setText("영수증 내역");$.panList2.setBottomLine(true);$.grdList2=new FingerDataGrid(host,"grdList2",0,0,1200,185);$.btnEsero=new FingerButton(host,"btnEsero",710,-37.5,130,15);$.btnEsero.setText("전자세금계산서");$.panWFMain=new FingerPanel(host,"panWFMain",0,485,1200,250);$.panWFMain.setText("내역");$.panWFMain.setBottomLine(true);$.cmbBase=new FingerComboBox(host,"cmbBase",805,-38,140,20);$.grdList1=new FingerDataGrid(host,"grdList1",0,0,1200,365);$.btnCard=new FingerButton(host,"btnCard",825,-37.5,130,20);$.btnCard.setText("법인카드내역");$.lblBudget=new FingerLabel(host,"lblBudget",0,30,100,20);$.lblBudget.setText("예산항목");$.lblAval=new FingerLabel(host,"lblAval",0,60,100,20);$.lblAval.setText("가용잔액");$.lblPlan=new FingerLabel(host,"lblPlan",310,60,100,20);$.lblPlan.setText("신청금액");$.lblTotal=new FingerLabel(host,"lblTotal",0,90,100,20);$.lblTotal.setText("영수증합계");$.lblRemark=new FingerLabel(host,"lblRemark",0,120,100,20);$.lblRemark.setText("사용내역");$.txtBudget=new FingerEdit(host,"txtBudget",105,30,470,20);$.speAval=new FingerSpinEdit(host,"speAval",105,60,160,20);$.spePlan=new FingerSpinEdit(host,"spePlan",415,60,160,20);$.speTotal=new FingerSpinEdit(host,"speTotal",105,90,160,20);$.txtRemark=new FingerEdit(host,"txtRemark",105,120,470,20);$.grdUseDate=new FingerDataGrid(host,"grdUseDate",0,0,580,130);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,230);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,230);$.tabDetail=new FingerTab(host,"tabDetail",620,0,580,205);$.panDate=new FingerPanel(host,"panDate",0,0,580,175);$.panDate.setText("일비");$.panDate.setBottomLine(true);$.panStay=new FingerPanel(host,"panStay",0,0,580,300);$.panStay.setText("교통비");$.panStay.setBottomLine(true);$.grdStay=new FingerDataGrid(host,"grdStay",0,0,580,130);$.bteSubject=new FingerButtonEdit(host,"bteSubject",415,90,155,20);$.bteSubject.setText("");$.lblSubject=new FingerLabel(host,"lblSubject",300,90,110,20);$.lblSubject.setText("해외출장신청서");$.lblVice=new FingerLabel(host,"lblVice",0,150,100,20);$.lblVice.setText("본부장예산");$.chkVice=new FingerCheckBox(host,"chkVice",100,153,20,20);$.chkVice.setText("");$.lblGrapeFn=new FingerLabel(host,"lblGrapeFn",305,150,105,20);$.lblGrapeFn.setText("Grape Function");$.cmbGrapeFn=new FingerComboBox(host,"cmbGrapeFn",415,150,165,20);$.lblPresident=new FingerLabel(host,"lblPresident",145,150,100,20);$.lblPresident.setText("사장님예산");$.chkPresident=new FingerCheckBox(host,"chkPresident",245,153,25,20);$.chkPresident.setText("");$.btnDefineAccount=new FingerButton(host,"btnDefineAccount",950,-40,100,30);$.btnDefineAccount.setText("예산정의");$.panTitle.setBorder(true);$.panList2.addButtons(["btnDelete","btnAdd"]);$.panDate.addButtons(["btnDelete","btnAdd"]);$.panStay.addButtons(["btnDelete","btnAdd"]);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.cmbBase.setAllowBlank(false,"기준년도/반기");$.cmbBase.setEnable(false);$.txtBudget.setReadOnly(true);$.speAval.setReadOnly(true);$.spePlan.setReadOnly(true);$.speTotal.setReadOnly(true);$.txtRemark.setReadOnly(true);if((g_main.session.obj.DeptCode=="F110"||g_main.session.obj.DeptCode=="C210")&&g_main.session.obj.DutyCode=="09"){$.chkVice.setEnable(true)}else{$.chkVice.setEnable(false)}$.btnDefineAccount.setClass("btn_add");$.grdList1.setColumns([new FingerDataGridColumn("wf_doc_id",99,"left","string","참조결재문서아이디",{hidden:true}),new FingerDataGridColumn("dept_code",99,"left","string","부서코드",{hidden:true}),new FingerDataGridColumn("budget_code",99,"left","string","예산항목코드",{hidden:true}),new FingerDataGridColumn("budget_name",460,"left","string","예산항목"),new FingerDataGridColumn("budget_acctype",99,"left","string","예산항목유형",{hidden:true}),new FingerDataGridColumn("budget_name_for",99,"left","string","예산항목(한자)",{hidden:true}),new FingerDataGridColumn("AcctName",99,"left","string","계쩡명",{hidden:true}),new FingerDataGridColumn("product_code",99,"left","string","품목코드",{hidden:true}),new FingerDataGridColumn("promo_budget_yn",99,"left","string","판촉예산여부",{hidden:true}),new FingerDataGridColumn("half_amt",120,"right","string","배정금액",{format:"int"}),new FingerDataGridColumn("plan_use_amt",120,"right","string","사용금액",{format:"int"}),new FingerDataGridColumn("plan_using_amt",120,"right","string","결재중금액",{format:"int"}),new FingerDataGridColumn("plan_aval_amt",120,"right","string","Hold금액",{format:"int"}),new FingerDataGridColumn("aval_amt",120,"right","string","가용잔액",{format:"int"}),new FingerDataGridColumn("use_percent",120,"right","string","사용비율",{format:"floor_2"}),new FingerDataGridColumn("assign_seq",99,"left","string","배정순번",{hidden:true}),new FingerDataGridColumn("plan_seq",99,"left","string","계획연번",{hidden:true}),new FingerDataGridColumn("for_dept_name",99,"left","string","부서명(한자)",{hidden:true}),new FingerDataGridColumn("sales_dept_yn",99,"left","string","영업무서여부",{hidden:true}),new FingerDataGridColumn("marketing_dept_yn",99,"left","string","마케팅부서여부",{hidden:true}),new FingerDataGridColumn("grape_yn",99,"left","string","Grape Function 여부",{hidden:true}),new FingerDataGridColumn("grape_function_code",99,"left","string","Grape Function Code",{hidden:true})]);$.grdList1.init({panel:$.panList1,scroll:"xy"});$.grdList1.setBorder(false);$.grdList2.setColumns([new FingerDataGridColumn("seq",99,"left","string","시퀀스",{hidden:true}),new FingerDataGridColumn("ref_wf_doc_id",99,"left","string","참조결재문서아이디",{hidden:true}),new FingerDataGridColumn("modify_yn",99,"left","string","수정가능여부",{hidden:true}),new FingerDataGridColumn("receipt_type",100,"center","string","영수증종류",{footer:{text:"총계:",colspan:2}}),new FingerDataGridColumn("use_date",80,"center","date","사용일자",{format:"ymd"}),new FingerDataGridColumn("use_amt",100,"right","string","사용금액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("tax_amt",86,"right","string","부가세",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("nodeduction_amt",86,"right","string","불공제액",{format:"int",footer:{content:"summColumn"}}),new FingerDataGridColumn("deposit_emp_code",99,"left","string","입금처코드",{hidden:true}),new FingerDataGridColumn("deposit_emp_name",130,"left","string","입금처",{readonly:true}),new FingerDataGridColumn("account_comp_code",99,"left","string","회계거래처코드",{hidden:true}),new FingerDataGridColumn("account_comp_name",150,"left","string","회계거래처",{readonly:true}),new FingerDataGridColumn("VatBPNM1",99,"left","string","회계거래처명",{hidden:true}),new FingerDataGridColumn("VatRegN",99,"left","string","사업자번호",{hidden:true}),new FingerDataGridColumn("SAPCODE",150,"left","string","원천대상/기타 거래처",{readonly:true}),new FingerDataGridColumn("pay_me",99,"left","string","지급처변경",{hidden:true}),new FingerDataGridColumn("bank_account",150,"left","string","입금계좌",{readonly:true}),new FingerDataGridColumn("bank",99,"left","string","은행",{hidden:true}),new FingerDataGridColumn("account",99,"left","string","계좌번호",{hidden:true}),new FingerDataGridColumn("acct_name",99,"left","string","예금주",{hidden:true}),new FingerDataGridColumn("promo_budget_yn",99,"left","string","판촉예산여부",{hidden:true}),new FingerDataGridColumn("APPDAT",99,"left","string","승인일",{hidden:true}),new FingerDataGridColumn("CARDNO",99,"left","string","카드번호",{hidden:true}),new FingerDataGridColumn("VENKNM",150,"left","string","가맹점",{readonly:false}),new FingerDataGridColumn("APPRNO",100,"left","string","승인번호",{readonly:true}),new FingerDataGridColumn("APPAMT",99,"left","string","사용내역",{hidden:true}),new FingerDataGridColumn("use_remark",99,"left","string","사용내역",{hidden:true})]);$.grdList2.init({panel:$.panList2,scroll:"xy",footer:true,eventCellReadOnly:true,isFilter:false});$.grdList2.setEditable(true);$.grdList2.setBorder(false);$.grdUseDate.setColumns([new FingerDataGridColumn("day_date",100,"left","date","일자",{format:"ymd"}),new FingerDataGridColumn("day_wage",85,"right","string","일당",{format:"int"}),new FingerDataGridColumn("day_meal",85,"right","string","식대",{hidden:true}),new FingerDataGridColumn("day_roaming",85,"right","string","로밍비용",{format:"int"}),new FingerDataGridColumn("day_charge",85,"right","string","숙박비",{format:"int"}),new FingerDataGridColumn("day_charge_name",100,"left","string","숙박업소"),new FingerDataGridColumn("day_total_amt",105,"right","string","합계",{format:"int",readonly:true})]);$.grdUseDate.init({scroll:"xy",nonExcel:true,eventCellReadOnly:true});$.grdUseDate.setEditable(true);$.panDate.setBorder(false);$.grdStay.setColumns([new FingerDataGridColumn("trans_date",100,"left","date","일자",{format:"ymd"}),new FingerDataGridColumn("trans_trip",220,"left","string","출장지역"),new FingerDataGridColumn("trans_way",120,"left","string","교통수단"),new FingerDataGridColumn("trans_amt",120,"right","string","금액",{format:"int"}),new FingerDataGridColumn("trans_modifyyn",99,"left","string","변경가능",{hidden:true})]);$.grdStay.init({scroll:"xy",nonExcel:true,eventCellReadOnly:true});$.grdStay.setEditable(true);$.panStay.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명",{readonly:true,isLink:true,pathLinkCols:["server_path","server_fname"]}),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panList1);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panList2);$.panMain.add($.panWFMain);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panList1.add($.cmbBase);$.panList1.add($.grdList1);$.panList1.add($.btnDefineAccount);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panList2.add($.grdList2);$.panList2.add($.btnEsero);$.panList2.add($.btnCard);$.panWFMain.add($.lblBudget);$.panWFMain.add($.lblAval);$.panWFMain.add($.lblPlan);$.panWFMain.add($.lblTotal);$.panWFMain.add($.lblRemark);$.panWFMain.add($.txtBudget);$.panWFMain.add($.speAval);$.panWFMain.add($.spePlan);$.panWFMain.add($.speTotal);$.panWFMain.add($.txtRemark);$.panWFMain.add($.tabDetail);$.panWFMain.add($.panDate);$.panWFMain.add($.panStay);$.panWFMain.add($.lblSubject);$.panWFMain.add($.bteSubject);$.panWFMain.add($.chkVice);$.panWFMain.add($.lblVice);$.panWFMain.add($.lblGrapeFn);$.panWFMain.add($.cmbGrapeFn);$.panWFMain.add($.chkPresident);$.panWFMain.add($.lblPresident);$.panDate.add($.grdUseDate);$.panStay.add($.grdStay);var ds=bizComponentData2($,"Q1","L_CRM0041");$.grdList2.setColumnDropDownList("receipt_type",ds.resultList[0]);$.cmbGrapeFn.setEmptyRow(true);$.cmbBase.setColumn("half_code","half_name");var ds=bizComponentData2($,"Q1","L_CRM0008|L_CRM0274");setComboBind([$.cmbBase,$.cmbGrapeFn],ds);var ds=bizComponentData2($,"Q4","L_CRM0048"," and sub_code not in ('55', '90')");$.grdStay.setColumnDropDownList("trans_way",ds.resultList[0]);var userId=g_main.session.obj.UserID;$.tabDetail.addTab([{text:"일비",body:$.panDate},{text:"교통비",body:$.panStay}]);log($.cmbBase.getValue("receipt_start_date"));relocateChildIndexInPanel([$.panWFMain]);searchWFDocument();searchAdvence();if(g_main.session.obj.UserID=="ka080049"){$.chkPresident.setVisible(true);$.lblPresident.setVisible(true)}else{$.chkPresident.setVisible(false);$.lblPresident.setVisible(false)}if(g_main.session.obj.UserID=="ka041191"){$.chkVice.setVisible(true);$.lblVice.setVisible(true)}else{$.chkVice.setVisible(false);$.lblVice.setVisible(false)}};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue("["+g_main.session.obj.DeptName+"] "+result.business_title)}else{if(type=="FOR"){setDataGrid([$.grdList1],ds);if(ds.resultList[0].length>0){if($.varWfDocId&&$.varBgtCode){$.grdList1.selectRow($.grdList1.getGridRowIndex("budget_code",$.varBgtCode,0))}else{$.grdList1.selectRow(0)}}$.varBank=ds.resultList[1][0].bank;$.varAccount=ds.resultList[1][0].account;$.varBankAccount=ds.resultList[1][0].bank_account;$.varAcctName=ds.resultList[1][0].acct_name}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.varBgtCode=md.budget_code;$.bteSubject.setText(md.subject);$.varSubWfDocId=md.sub_wf_doc_id}setDataGrid([$.grdList2],args[7],true);calcReceiptAmt("S");if(args[8]){for(var i=0;i<args[8].length;i++){args[8][i].trans_date=extFormat(args[8][i].trans_date,"yyyyMMdd","-")}setDataGrid([$.grdStay],args[8],true)}if(args[9]){for(var i=0;i<args[9].length;i++){args[9][i].day_date=extFormat(args[9][i].day_date,"yyyyMMdd","-")}setDataGrid([$.grdUseDate],args[9],true);calcUseAmt("S")}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!validateControls([$.txtTitle,$.cmbBase,$.cmbPromo,$.cmbProduct,$.cmbGrapeFn])){return}if($.grdList2.getRowCount()<=0){MessageBoxShow("저장할 영수증내역이 없습니다.");return}else{if($.spePlan.getValue()!=$.speTotal.getValue()){MessageBoxShow("신청금액과 영수증합계과 다릅니다. 확인해 주십시오.");return}else{if($.speAval.getValue()!=0&&$.speAval.getValue()<$.speTotal.getValue()){MessageBoxShow("사용금액이 가용잔액을 초과할 수 없습니다.");return}}}var cRow=$.grdStay.getAllRows();for(var i in cRow){if(!cRow[i].trans_way){MessageBoxShow("교통수단은 필수입력 항목입니다.");return}}if(!chkReceipt()){return}if(!$.varWfDocId){saveWFDocument("","N")}if(saveBudgetUseAft("N")&&saveReceipt("N")&&saveUseTrans("N")&&saveUseDetail("N")){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFBgtUseFor",new_line:true};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{removeWFDocument($.varWfDocId)}}else{if(id=="btnTmpSave"){if($.grdList2.getRowCount()<=0){MessageBoxShow("저장할 영수증내역이 없습니다.");return}if(saveWFDocument("","N")){if(saveBudgetUseAft("N")&&saveReceipt("N")&&saveUseTrans("N")&&saveUseDetail("N")){var param={wf_doc_id:$.varWfDocId};log(param);g_main.openModelWithBusiness("crmWFGeneralProc",param)}else{removeWFDocument($.varWfDocId)}}else{removeWFDocument($.varWfDocId)}}else{if(id=="btnEsero"){if($.grdList1.getRowCount()<=0){return}var param={};g_main.openPopup("popEseroApprovalSub.html","popEseroApprovalSub","세금계산서&계산서 수신내역",0,0,"","",param,"","")}else{if(id=="btnCard"){if($.grdList1.getRowCount()<=0){return}var param={};g_main.openPopup("popCardApprovalSub.html","popCardApprovalSub","카드승인내역",0,0,"","",param,"","")}else{if(id=="btnDefineAccount"){var rId=$.grdList1.getSelectedRowIdx();if(!rId){MessageBoxShow("예산을 선택해 주세요.");return}var rowData=$.grdList1.getValue(rId);var param={budget_code:rowData.budget_code,list:$.grdList1.getAllRows()};g_main.openPopup("popDefileAccount.html","popDefileAccount","정의/정산",0,0,"","",param,"","")}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){$.popUpCallId=id;if(id=="bteSubject"){var param={};g_main.openPopup("popWFGoAboardSub.html","popWFGoAboardSub","",0,0,"","",param,"","")}};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList2"){$.varRowIdx=rId;if(cInd=="deposit_emp_name"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="30"||$.grdList2.getValue(rId,"receipt_type")=="40"||$.grdList2.getValue(rId,"receipt_type")=="50"){return}$.popUpCallId="deposit_emp_name";var param={cardCode:$.grdList2.getValue(rId,"deposit_emp_code")};g_main.openPopup("popDepositEmpSub.html","popDepositEmpSub","입금처 리스트",0,0,"","",param,"","")}else{if(cInd=="SAPCODE"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="30"||$.grdList2.getValue(rId,"receipt_type")=="40"||$.grdList2.getValue(rId,"receipt_type")=="50"){return}$.popUpCallId="SAPCODE";var param={};g_main.openPopup("popWithholdmentSub.html","popWithholdmentSub","원천대상 및 기타거래처",0,0,"","",param,"","")}else{if(cInd=="account_comp_name"){if($.grdList2.getValue(rId,"modify_yn")=="N"||$.grdList2.getValue(rId,"receipt_type")=="10"||$.grdList2.getValue(rId,"receipt_type")=="20"){return}$.popUpCallId="account_comp_name";var param={};g_main.openPopup("popAccountCompany.html","popAccountCompany","회계거래처 리스트",0,0,"","",param,"","")}}}}};$.fingerdatagrid_selectionchange=function(id,rId){if(id=="grdList1"){$.txtBudget.setValue($.grdList1.getValue(rId,"budget_name"));$.speAval.setValue($.grdList1.getValue(rId,"aval_amt")||0);$.spePlan.setValue($.grdList1.getValue(rId,"plan_amt")||0);$.speTotal.setValue(0);$.txtRemark.setValue($.grdList1.getValue(rId,"use_remark"));$.ref_wf_doc_id=$.grdList1.getValue(rId,"wf_doc_id");var bgtAcc=$.grdList1.getValue(rId,"budget_acctype")||"";if(bgtAcc!=""){if(bgtAcc=="10"||bgtAcc=="11"||bgtAcc=="12"||bgtAcc=="20"||bgtAcc=="30"){$.txtRemark.setValue($.grdList1.getValue(rId,"AcctName")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}}else{if($.grdList1.getValue(rId,"sales_dept_yn")=="Y"||$.grdList1.getValue(rId,"marketing_dept_yn")=="Y"){if($.grdList1.getValue(rId,"budget_name_for")!=""&&$.grdList1.getValue(rId," for_dept_name")!=""){$.txtRemark.setValue($.grdList1.getValue(rId,"budget_name_for")+"-"+$.grdList1.getValue(rId,"for_dept_name")+"-"+g_main.session.obj.EmpNameFOR)}else{$.txtRemark.setValue(g_main.session.obj.EmpNameFOR)}}else{$.txtRemark.setReadOnly(true)}}if($.varWfDocId!=""){calcUseAmt("S");calcReceiptAmt("S")}setGrape(rId)}else{if(id=="grdList2"){log(1);rowProperties(rId,$.grdList2.getValue(rId,"receipt_type"))}}};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){if(id=="grdList2"){if(cInd=="receipt_type"){if(oValue!=""){if(oValue=="20"||oValue=="50"){if(nValue=="10"||nValue=="30"||nValue=="40"){MessageBoxShow("영수증종류가 법인카드, 카드매입일경우 현금, 세금계산서, 계산서로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}if(oValue=="50"&&nValue=="20"){if($.grdList2.getValue(rId,"tax_amt")!=0||$.grdList2.getValue(rId,"nodeduction_amt")!=0){MessageBoxShow("영수증종류가 법인카드일 경우 부가세가 0이어야 합니다.");$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt",0)}$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");rowProperties(rId,nValue)}else{if(oValue=="20"&&nValue=="50"){rowProperties(rId,nValue)}}}else{if(oValue=="10"||oValue=="30"||oValue=="40"){if(nValue=="20"||nValue=="50"){MessageBoxShow("영수증종류가 현금, 세금계산서, 계산서일경우 법인카드, 카드매입로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}if(oValue!="30"&&nValue=="30"&&$.grdList2.getValue(rId,"modify_yn")=="Y"){confirmBoxShow("전자세금계산서가 아닌지 다시 한번 확인해주십시오.<br><br>종이세금계산서가 맞다면 '예'를 눌러주시고,<br><br>전자세금계산서라면 '아니오'를 눌러주세요.",function(){if(g_main.msgShare==true){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");rowProperties(rId,"30");return}else{calcReceiptAmt("D");$.grdList2.deleteCurrentRow();$.popUpCallId="btnEsero";var param={};g_main.openPopup("popEseroApprovalSub.html","popEseroApprovalSub","세금계산서&계산서 수신내역",0,0,"","",param,"","")}},230)}else{if(oValue=="30"&&nValue!="30"&&$.grdList2.getValue(rId,"modify_yn")=="N"){MessageBoxShow("영수증종류가 전자세금계산서일 경우 그외 항목으로 변경 할 수 없습니다.");$.grdList2.setValue(rId,"receipt_type",oValue);rowProperties(rId,oValue);return}}if(oValue=="30"&&nValue=="40"){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");$.grdList2.setValue(rId,"tax_amt",0);$.grdList2.setValue(rId,"nodeduction_amt",0);rowProperties(rId,nValue)}if((oValue=="30"||oValue=="40")&&nValue=="10"){$.grdList2.setValue(rId,"account_comp_code","");$.grdList2.setValue(rId,"account_comp_name","");$.grdList2.setValue(rId,"VatBPNM1","");$.grdList2.setValue(rId,"VatRegN","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");rowProperties(rId,nValue)}if(oValue=="10"&&nValue=="40"){$.grdList2.setValue(rId,"deposit_emp_code","");$.grdList2.setValue(rId,"deposit_emp_name","");$.grdList2.setValue(rId,"bank_account","");$.grdList2.setValue(rId,"bank","");$.grdList2.setValue(rId,"account","");$.grdList2.setValue(rId,"acct_name","");rowProperties(rId,nValue)}}}}if(nValue=="10"){$.grdList2.setValue(rId,"deposit_emp_code",g_main.session.obj.UserID);$.grdList2.setValue(rId,"deposit_emp_name","["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName);$.grdList2.setValue(rId,"bank",$.varBank);$.grdList2.setValue(rId,"account",$.varAccount);$.grdList2.setValue(rId,"bank_account",$.varBankAccount);$.grdList2.setValue(rId,"acct_name",g_main.session.obj.UserName)}}else{if(cInd=="tax_amt"){if($.grdList2.getValue(rId,"receipt_type")=="30"){if(nValue==0){return}$.grdList2.setValue(rId,"nodeduction_amt",0);calcReceiptAmt("S")}else{if($.grdList2.getValue(rId,"receipt_type")=="50"){if(nValue==0){return}$.grdList2.setValue(rId,"nodeduction_amt",0);calcReceiptAmt("S")}}}else{if(cInd=="nodeduction_amt"){if($.grdList2.getValue(rId,"receipt_type")=="30"){if(nValue==0){return}$.grdList2.setValue(rId,"tax_amt",0);calcReceiptAmt("S")}else{if($.grdList2.getValue(rId,"receipt_type")=="50"){if(nValue==0){return}$.grdList2.setValue(rId,"tax_amt",0);calcReceiptAmt("S")}}}else{if(cInd=="use_amt"){calcReceiptAmt("S")}else{if(cInd=="use_date"){var now=getFormatDate(nValue,"yyyyMMdd").substr(0,8);if(Number(now)>Number(getToday(""))){$.grdList2.setValue(rId,cInd,oValue);return}var start=$.cmbBase.getValue("receipt_start_date");var end=$.cmbBase.getValue("receipt_end_date");if(unmask(nValue)<start||unmask(nValue)>end){$.grdList2.setValue(rId,"use_date",oValue);MessageBoxShow("반기에 해당하는 영수증 일자만 처리 가능합니다.");return false}}else{if(cInd=="deposit_emp_name"){$.grdList2.setValue(rId,"SAPCODE","")}}}}}}}else{if(id=="grdUseDate"){if(cInd=="day_date"){$.grdUseDate.setValue(rId,"day_date",oValue);var cRow=$.grdUseDate.getAllRows();for(var i in cRow){if(unmask(cRow[i].day_date.substr(0,10))==unmask(nValue.substr(0,10))){$.grdUseDate.setValue(rId,"day_date",oValue);return}}$.grdUseDate.setValue(rId,"day_date",nValue)}else{if(cInd=="day_meal"||cInd=="day_charge"||cInd=="day_wage"||cInd=="day_roaming"){$.grdUseDate.setValue(rId,"day_total_amt",Number($.grdUseDate.getValue(rId,"day_meal"))+Number($.grdUseDate.getValue(rId,"day_charge"))+Number($.grdUseDate.getValue(rId,"day_wage"))+Number($.grdUseDate.getValue(rId,"day_roaming")));calcUseAmt("S")}}}else{if(id=="grdStay"){if(cInd=="trans_amt"){calcUseAmt("S")}}}}};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList2"){if($.grdList1.getRowCount()<=0){return}if(btnId=="btnAdd"){$.grdList2.addRow({modify_yn:"Y",receipt_type:"10",use_date:getToday("-"),use_date_readonly:false,use_amt:0,use_amt_readonly:false,tax_amt:0,tax_amt_readonly:true,nodeduction_amt:0,nodeduction_amt_readonly:true,deposit_emp_code:g_main.session.obj.UserID,deposit_emp_name:"["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName,bank:$.varBank,account:$.varAccount,bank_account:$.varBankAccount,acct_name:g_main.session.obj.UserName});$.varReceiptType="10";rowProperties($.grdList2.getSelectedRowIdx(),"10")}else{if(btnId=="btnDelete"){var rId=$.grdList2.getSelectedRowIdx();if(!rId){return}var data=$.grdList2.getValue(rId);if(data.receipt_type=="20"||data.receipt_type=="50"){if(saveCardRe("FTRFLG10")){calcReceiptAmt("D");$.grdList2.deleteCurrentRow()}}else{calcReceiptAmt("D");$.grdList2.deleteCurrentRow()}}}}else{if(panelId=="panDate"){if(btnId=="btnAdd"){if($.grdUseDate.getRowCount()>0){var cRow=$.grdUseDate.getAllRows();var dt=[];for(var i in cRow){dt.push(unmask(cRow[i].day_date.substr(0,10)))}var k=1,today=getToday("");while(true){if(dt.indexOf(today)==-1){break}else{today=getCalcDate(today,k)}}var date=new Date(today.substr(0,4),today.substr(4,2)-1,today.substr(6,2));$.grdUseDate.addRow({day_date:extFormat(today,"yyyyMMdd"),day_meal:0,day_wage:0,day_roaming:0,day_charge:0,day_total_amt:0},$.grdUseDate.getRowCount())}else{var date=new Date();$.grdUseDate.addRow({day_date:getToday("-"),day_meal:0,day_wage:0,day_roaming:0,day_charge:0,day_total_amt:0})}}else{if(btnId=="btnDelete"){calcUseAmt("D_D");$.grdUseDate.deleteCurrentRow()}}}else{if(panelId=="panStay"){if(btnId=="btnAdd"){$.grdStay.addRow({trans_date:getToday("-"),trans_amt:0})}else{if(btnId=="btnDelete"){if($.grdStay.getRowCount()<=0){return}calcUseAmt("D_S");$.grdStay.deleteCurrentRow()}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.varWfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)&&saveBudgetUseAft("N")&&saveReceipt("N")&&saveUseTrans("N")&&saveUseDetail("N")){var param={wf_doc_id:$.varWfDocId,doc_type:"70"};g_main.openModelWithBusiness("crmWFGeneralProc",param)}else{removeWFDocument($.varWfDocId)}}}}else{if(id=="popEseroApprovalSub"){if($.popUpCallId=="btnEsero"){var overlap=false;var ioe=false;for(var i=0;i<popResult.length;i++){overlap=false;for(var j=0;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(j,"APPRNO")==popResult[i].APPRNO){overlap=true}}if(overlap){MessageBoxShow("선택한 계산서는 이미 영수증내역에 추가되어 있습니다.");return}$.grdList2.addRow({receipt_type:popResult[i].receipt_type,use_date:popResult[i].APPDAT||"",use_date_readonly:true,use_amt:popResult[i].APPAMT||"",use_amt_readonly:true,tax_amt:(popResult[i].VAT_DEDUCT_YN=="Y"?popResult[i].TAXAMT:0),tax_amt_readonly:true,nodeduction_amt:(popResult[i].VAT_DEDUCT_YN=="N"?popResult[i].TAXAMT:0),nodeduction_amt_readonly:true,APPRNO:popResult[i].APPRNO,account_comp_name:popResult[i].account_comp_name||"",VatRegN:popResult[i].BIZNUM||"",VatBPNM1:popResult[i].BIZNAME||"",deposit_emp_name:"",deposit_emp_code:"",SAPCODE:"",deposit_emp_name_readonly:true,account_comp_code:popResult[i].account_comp_code||"",SAPCODE_readonly:true,modify_yn:popResult[i].modify_yn||"N",VENKNM_readonly:false});if(popResult[i].receipt_type=="10"){ioe=true}calcReceiptAmt("S")}if(!ioe){$.popUpCallId="IOE";var param={account_comp_code:popResult[0].account_comp_code||""};g_main.openPopup("popAccountCompany.html","popAccountCompany","회계거래처 리스트",0,0,"","",param,"","")}else{for(var i=0;i<$.grdList2.getRowCount();i++){if($.grdList2.getValue(i,"receipt_type")!="10"){$.grdList2.setValue(i,"bank_account","농협 111-1111-11111");$.grdList2.setValue(i,"bank","11");$.grdList2.setValue(i,"account","111-1111-11111");$.grdList2.setValue(i,"acct_name","임시은행");$.grdList2.setValue(i,"pay_me","N")}else{$.grdList2.setValue(i,"bank_account",$.varBankAccount);$.grdList2.setValue(i,"bank",$.varBank);$.grdList2.setValue(i,"account",$.varAccount);$.grdList2.setValue(i,"acct_name",$.varAcctName);$.grdList2.setValue(i,"deposit_emp_name","["+g_main.session.obj.UserID+"]"+g_main.session.obj.UserName);$.grdList2.setValue(i,"deposit_emp_code",g_main.session.obj.UserID)}}}}}else{if(id=="popCardApprovalSub"){if($.popUpCallId=="btnCard"){$.varReceiptType="";var overlapCnt=0;for(var i=0;i<popResult.length;i++){var overlap=false;for(var j=0;j<$.grdList2.getRowCount();j++){if($.grdList2.getValue(j,"APPRNO")==popResult[i].APPRNO){overlapCnt++;overlap=true}}if(overlap){continue}$.grdList2.addRow({receipt_type:"20",use_date:extFormat(getToday("").substr(0,2)+popResult[i].APPDAT.replace(/\//g,"").substr(0,6),"yyyyMMdd","-"),use_date_readonly:true,use_amt:popResult[i].APPAMT||"",use_amt_readonly:true,tax_amt:0,tax_amt_readonly:true,nodeduction_amt:0,nodeduction_amt_readonly:true,deposit_emp_name:popResult[i].CARDNO,deposit_emp_code:popResult[i].EMPNUM||"",CARDNO:popResult[i].CARDNO||"",APPRNO:popResult[i].APPRNO||"",modify_yn:"N",VENKNM:popResult[i].VENKNM||"",VENKNM_readonly:true,account:popResult[i].ACCOUNT||"",bank_account:popResult[i].BANK_ACCOUNT||"",APPDAT:popResult[i].APPDAT||"",VENGRP:popResult[i].VENGRP||"",bank:popResult[i].BANK||"",acct_name:popResult[i].ACCT_NAME||""})}calcReceiptAmt("S");if(overlapCnt>0){MessageBoxShow("선택한 법인카드 건중 이미 영수증내역에 추가되어 있는 건이 있습니다.")}}}else{if(id=="popDepositEmpSub"){if($.popUpCallId=="deposit_emp_name"){$.grdList2.setValue($.varRowIdx,"deposit_emp_code",popResult.code);$.grdList2.setValue($.varRowIdx,"deposit_emp_name","["+popResult.code+"]"+popResult.emp_name);$.grdList2.setValue($.varRowIdx,"bank_account",popResult.bank_account);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"SAPCODE","");if($.grdList2.getValue($.varRowIdx,"receipt_type")=="10"){if($.grdList2.getValue($.varRowIdx,"deposit_emp_code")=="ka777777"){$.grdList2.setValue($.varRowIdx,"SAPCODE_readonly",true)}else{$.grdList2.setValue($.varRowIdx,"SAPCODE_readonly",false)}}}}else{if(id=="popWithholdmentSub"){if($.popUpCallId=="SAPCODE"){$.grdList2.setValue($.varRowIdx,"SAPCODE",popResult.target_info);if(popResult.pay_me=="Y"){$.grdList2.setValue($.varRowIdx,"bank_account",$.varBankAccount);$.grdList2.setValue($.varRowIdx,"bank",$.varBank);$.grdList2.setValue($.varRowIdx,"account",$.varAccount);$.grdList2.setValue($.varRowIdx,"acct_name",$.varAcctName);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}else{$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me);$.grdList2.setValue($.varRowIdx,"bank_account",popResult.target_info2);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name)}}}else{if(id=="popAccountCompany"){if($.popUpCallId=="IOE"){var rId=$.grdList2.getSelectedRowIdx();if(popResult.pay_me=="Y"){$.grdList2.setValue(rId,"bank_account",$.varBankAccount);$.grdList2.setValue(rId,"bank",$.varBank);$.grdList2.setValue(rId,"account",$.varAccount);$.grdList2.setValue(rId,"acct_name",$.varAcctName);$.grdList2.setValue(rId,"pay_me",popResult.pay_me)}else{$.grdList2.setValue(rId,"bank_account",popResult.bank_account);$.grdList2.setValue(rId,"bank",popResult.bank);$.grdList2.setValue(rId,"account",popResult.account);$.grdList2.setValue(rId,"acct_name",popResult.acct_name);$.grdList2.setValue(rId,"pay_me",popResult.pay_me)}}else{if($.popUpCallId=="account_comp_name"){$.grdList2.setValue($.varRowIdx,"account_comp_code",popResult.card_code);$.grdList2.setValue($.varRowIdx,"VatBPNM1",popResult.card_name);$.grdList2.setValue($.varRowIdx,"VatRegN",popResult.VATRegNum);$.grdList2.setValue($.varRowIdx,"account_comp_name",popResult.account_comp_name);if($.grdList2.getValue($.varRowIdx,"receipt_type")!="50"){if(popResult.pay_me=="Y"){$.grdList2.setValue($.varRowIdx,"bank_account",$.varBankAccount);$.grdList2.setValue($.varRowIdx,"bank",$.varBank);$.grdList2.setValue($.varRowIdx,"account",$.varAccount);$.grdList2.setValue($.varRowIdx,"acct_name",$.varAcctName);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}else{$.grdList2.setValue($.varRowIdx,"bank_account",popResult.bank_account);$.grdList2.setValue($.varRowIdx,"bank",popResult.bank);$.grdList2.setValue($.varRowIdx,"account",popResult.account);$.grdList2.setValue($.varRowIdx,"acct_name",popResult.acct_name);$.grdList2.setValue($.varRowIdx,"pay_me",popResult.pay_me)}}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popWFGoAboardSub"){if($.popUpCallId=="bteSubject"){$.varSubWfDocId=popResult.wf_doc_id;$.bteSubject.setText(popResult.subject)}}}}}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>