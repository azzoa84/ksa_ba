<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.lblDeptName=null;$.lblEmpName=null;$.lblStartDate=null;$.lblEndDate=null;$.lblVacDate=null;$.lblVacType=null;$.lblVacDesc=null;$.lblEmPhone=null;$.lblEmPlace=null;$.txtDeptName=null;$.txtEmpName=null;$.dteStartDate=null;$.dteEndDate=null;$.txtVacDay=null;$.htmlVacType=null;$.txtEmPhone=null;$.txtEmPlace=null;$.panMyVacation=null;$.lblTotYch=null;$.lblUseYch=null;$.lblSumYch=null;$.speTotYch=null;$.speUseYch=null;$.speSumYch=null;$.rdolVacType=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.btnFileAdd=null;$.btnFileDelete=null;$.btnDocAdd=null;$.btnDocDelete=null;$.ediDetail=null;$.grdDoc=null;$.grdFile=null;$.memVacDesc=null;function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFVacationReq"]);return json}function createJSON_Q2(workType){var json=createExecuteParamInfo("P_crmMyVacation_Q",[workType,"#UserID#"]);return json}function createJSON_Q3(workType){var json=createExecuteParamInfo("P_crmMyVacation_Q2",[workType,"#UserID#",$.dteStartDate.getValue()]);return json}function createJSON_S(workType){var json=createExecuteParamInfo("P_crmWFVacationReq_S",[workType,$.wfDocId,$.dteStartDate.getValue(),$.dteEndDate.getValue(),$.txtVacDay.getValue(),$.rdolVacType.getValue(),$.memVacDesc.getValue(),$.txtEmPhone.getValue(),$.txtEmPlace.getValue(),"#DeptCode#","#UserID#","",$.speSumYch.getValue()]);return json}function searchWFDocument(workType){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchMyVacation(workType){var json=createJSON_Q2("Q");callQuery(["req",json],"Q",$)}function searchMyVacation2(workType){var json=createJSON_Q3(workType);callQuery(["req",json],workType,$)}function saveWFVacation(workType){var json=createJSON_S("N");callExecute(["req",json],"N",$)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.businessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.ediDetail,$.wfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.wfDocId=ds.returnStr}return true}function dateChange(){var betweenDay=getCompareDate($.dteStartDate.getValue(),$.dteEndDate.getValue());$.txtVacDay.setValue(((betweenDay+1).toString()+"일"))}function chkVacation(){if($.rdolVacType.getValue()=="94"){if(g_main.session.obj.SalesEmpYN=="N"){MessageBoxShow("영업부서만 신청 할 수 있습니다.");$.rdolVacType.setValue("10");return false}else{if($.dteStartDate.getValue()!=$.dteEndDate.getValue()){MessageBoxShow("Family Friday는 1일만 신청 가능합니다.");return false}else{var day=getWeekday(getFormatDate($.dteStartDate.getValue(),"yyyyMMdd"));if(day!=5){MessageBoxShow("Family Friday는 금요일만 신청 가능합니다.");return false}else{searchMyVacation2("FF");return true}}}}else{if($.rdolVacType.getValue()=="95"){var betweenDay=getCompareDate($.dteStartDate.getValue(),$.dteEndDate.getValue());if(betweenDay!=0){MessageBoxShow("건강검진휴가는 1일만 신청 가능합니다.");return false}else{if($.dteStartDate.getValue().substr(4,2)!="10"&&$.dteStartDate.getValue().substr(4,2)!="11"&&$.dteStartDate.getValue().substr(4,2)!="12"){MessageBoxShow("건강검진휴가는 10, 11, 12월에만 신청 가능합니다.");return false}else{searchMyVacation2("CHECKUP");return true}}}else{return true}}}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}function getWeekday(sDate){log(sDate);var yy=parseInt(sDate.substr(0,4),10);var mm=sDate.length==8?parseInt(sDate.substr(4,2),10):parseInt(sDate.substr(4,2),10);var dd=sDate.length==8?parseInt(sDate.substr(6),10):parseInt(sDate.substr(8),10);var d=new Date(yy,mm-1,dd);var weekday=[];weekday[0]="0";weekday[1]="1";weekday[2]="2";weekday[3]="3";weekday[4]="4";weekday[5]="5";weekday[6]="6";return weekday[d.getDay()]}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1070);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine(true);$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,310);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.lblDeptName=new FingerLabel(host,"lblDeptName",0,10,100,20);$.lblDeptName.setText("소속부서");$.lblEmpName=new FingerLabel(host,"lblEmpName",235,10,100,20);$.lblEmpName.setText("신청인");$.lblStartDate=new FingerLabel(host,"lblStartDate",0,40,100,20);$.lblStartDate.setText("시작일");$.lblEndDate=new FingerLabel(host,"lblEndDate",235,40,100,20);$.lblEndDate.setText("종료일");$.lblVacDate=new FingerLabel(host,"lblVacDate",480,40,100,20);$.lblVacDate.setText("기간(일)");$.lblVacType=new FingerLabel(host,"lblVacType",0,70,100,20);$.lblVacType.setText("신청구분");$.lblVacDesc=new FingerLabel(host,"lblVacDesc",0,180,100,15);$.lblVacDesc.setText("사유 (자율작성)");$.lblEmPhone=new FingerLabel(host,"lblEmPhone",0,150,100,20);$.lblEmPhone.setText("비상연락처");$.lblEmPlace=new FingerLabel(host,"lblEmPlace",235,150,100,20);$.lblEmPlace.setText("장소");$.txtDeptName=new FingerEdit(host,"txtDeptName",105,10,140,20);$.txtEmpName=new FingerEdit(host,"txtEmpName",340,10,140,20);$.dteStartDate=new FingerDateEdit(host,"dteStartDate",105,40,140,20);$.dteEndDate=new FingerDateEdit(host,"dteEndDate",340,40,140,20);$.txtVacDay=new FingerEdit(host,"txtVacDay",585,40,140,20);$.htmlVacType=new FingerHTMLView(host,"htmlVacType",0,70,620,70);$.txtEmPhone=new FingerEdit(host,"txtEmPhone",105,150,140,20);$.txtEmPlace=new FingerEdit(host,"txtEmPlace",340,150,385,20);$.panMyVacation=new FingerPanel(host,"panMyVacation",905,0,290,258);$.panMyVacation.setText("잔여휴가");$.panMyVacation.setBottomLine(true);$.lblTotYch=new FingerLabel(host,"lblTotYch",0,10,100,20);$.lblTotYch.setText("총일수");$.lblUseYch=new FingerLabel(host,"lblUseYch",0,40,100,20);$.lblUseYch.setText("사용일수");$.lblSumYch=new FingerLabel(host,"lblSumYch",0,70,100,20);$.lblSumYch.setText("잔여일수");$.speTotYch=new FingerSpinEdit(host,"speTotYch",105,10,140,20);$.speUseYch=new FingerSpinEdit(host,"speUseYch",105,40,140,20);$.speSumYch=new FingerSpinEdit(host,"speSumYch",105,70,140,20);$.rdolVacType=new FingerRadioBox(host,"rdolVacType",105,65,660,75);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,385,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,780,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,780,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.btnFileAdd=new FingerButton(host,"btnFileAdd",215,-37.5,120,20);$.btnFileAdd.setText("파일추가");$.btnFileDelete=new FingerButton(host,"btnFileDelete",320,-37.5,120,20);$.btnFileDelete.setText("파일삭제");$.btnDocAdd=new FingerButton(host,"btnDocAdd",525,-37.5,120,20);$.btnDocAdd.setText("문서추가");$.btnDocDelete=new FingerButton(host,"btnDocDelete",630,-37.5,120,20);$.btnDocDelete.setText("문서삭제");$.ediDetail=new FingerWebEditor(host,"ediDetail",0,0,1200,310);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,235);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,235);$.memVacDesc=new FingerEdit(host,"memVacDesc",105,180,620,20);$.panTitle.setBorder(true);$.txtTitle.setAllowBlank(false,"문서제목");$.dteStartDate.setAllowBlank(false,"시작일");$.dteEndDate.setAllowBlank(false,"종료일");$.txtEmPhone.setAllowBlank(false,"비상연락처");$.lblVacDesc.setAlign("right");$.rdolVacType.addButtons([{sub_code:"10",code_name:"연차",margin:80},{sub_code:"23",code_name:"보건(무급)",margin:60},{sub_code:"30",code_name:"조퇴",margin:80},{sub_code:"40",code_name:"예비군",margin:80},{sub_code:"50",code_name:"산전후",margin:90},{sub_code:"60",code_name:"경조",margin:80},{sub_code:"70",code_name:"반차(4시간)",margin:53},{sub_code:"91",code_name:"배우자 출산휴가",margin:20},{sub_code:"93",code_name:"부임휴가",margin:210},{sub_code:"94",code_name:"Family Friday 휴가(영업직무/금요일만 사용가능)",margin:90},{sub_code:"95",code_name:"건강검진휴가(10~12월내 사용필수)",margin:50}]);$.rdolVacType.setValue("10");$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.btnFileAdd.setVisible(false);$.btnFileDelete.setVisible(false);$.btnDocAdd.setVisible(false);$.btnDocDelete.setVisible(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.lblDeptName);$.panWFMain.add($.lblEmpName);$.panWFMain.add($.lblStartDate);$.panWFMain.add($.lblEndDate);$.panWFMain.add($.lblVacDate);$.panWFMain.add($.lblVacType);$.panWFMain.add($.lblVacDesc);$.panWFMain.add($.lblEmPhone);$.panWFMain.add($.lblEmPlace);$.panWFMain.add($.txtDeptName);$.panWFMain.add($.txtEmpName);$.panWFMain.add($.dteStartDate);$.panWFMain.add($.dteEndDate);$.panWFMain.add($.txtVacDay);$.panWFMain.add($.htmlVacType);$.panWFMain.add($.txtEmPhone);$.panWFMain.add($.txtEmPlace);$.panWFMain.add($.panMyVacation);$.panWFMain.add($.rdolVacType);$.panWFMain.add($.memVacDesc);$.panMyVacation.add($.lblTotYch);$.panMyVacation.add($.lblUseYch);$.panMyVacation.add($.lblSumYch);$.panMyVacation.add($.speTotYch);$.panMyVacation.add($.speUseYch);$.panMyVacation.add($.speSumYch);$.panWFDetail.add($.ediDetail);$.panFile.add($.btnFileAdd);$.panFile.add($.btnFileDelete);$.panFile.add($.grdFile);$.panDoc.add($.btnDocAdd);$.panDoc.add($.btnDocDelete);$.panDoc.add($.grdDoc);searchWFDocument();searchMyVacation();$.dteStartDate.setValue(getToday());$.dteEndDate.setValue(getToday());dateChange();$.txtDeptName.setValue(g_main.session.getValue("DeptName"));$.txtEmpName.setValue(g_main.session.getValue("UserName"));$.txtDeptName.setReadOnly(true);$.txtEmpName.setReadOnly(true);$.speTotYch.setReadOnly(true);$.speUseYch.setReadOnly(true);$.speSumYch.setReadOnly(true);$.txtVacDay.setReadOnly(true);$.wfDocId=""};$.callback=function(type,ds){if(type=="Q3"){$.businessId=ds.resultList[0][0].business_id;$.wfType=ds.resultList[0][0].wf_type;$.txtTitle.setValue(ds.resultList[0][0].business_title)}else{if(type=="Q"){$.speTotYch.setValue(ds.resultList[0][0].U_TOTYCH);$.speUseYch.setValue(ds.resultList[0][0].U_USEYCH);$.speSumYch.setValue(ds.resultList[0][0].U_SUMYCH)}else{if(type=="N"){var param={wf_doc_id:$.wfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.wfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.ediDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6][0];if(md){$.dteStartDate.setValue(md.start_date);$.dteEndDate.setValue(md.end_date);dateChange();$.rdolVacType.setValue(md.vac_type);$.memVacDesc.setValue(md.vac_desc);$.txtEmPhone.setValue(md.em_phone);$.txtEmPlace.setValue(md.em_place)}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){if(!validateControls([$.txtTitle,$.dteStartDate,$.dteEndDate,$.memVacDesc,$.txtEmPhone])){return}if($.dteStartDate.getValue()>$.dteEndDate.getValue()){MessageBoxShow("시작일이 종료일보다 늦습니다. 다시 선택해주세요.");return}if(!chkVacation()){return}var param={wf_doc_id:$.wfDocId,wf_form_id:"crmWFVacationReq"};g_main.openPopup("popModAppr.html","popModAppr","결재라인 지정",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){if(!validateControls([$.txtTitle,$.dteStartDate,$.dteEndDate])){return}if($.dteStartDate.getValue()>$.dteEndDate.getValue()){MessageBoxShow("시작일이 종료일보다 늦습니다. 다시 선택해주세요.");return}if(!chkVacation()){return}saveWFDocument("","N");saveWFVacation(id)}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(id=="btnDocDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}else{if(id=="btnFileAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnFileDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){if(id=="dteStartDate"){dateChange()}else{if(id=="dteEndDate"){dateChange()}}};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panDoc"){if(btnId=="btnAdd"){$.popUpCallId="btnDocAdd";var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","기결문서",1100,735,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getSSSSValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){log(popResult);if(popResult.isCancel){$.wfDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveWFVacation()}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){if(id=="rdolVacType"){if(value=="70"){$.dteEndDate.setValue($.dteStartDate.getValue());$.txtVacDay.setValue("0.5일")}else{if(value=="94"){if(g_main.session.obj.SalesEmpYN=="N"){MessageBoxShow("영업부서만 신청 할 수 있습니다.");$.rdolVacType.setValue("10")}}else{dateChange()}}}};$.fingerimage_click=function(id){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>