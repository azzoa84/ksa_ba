<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTitle=null;$.lblTitle=null;$.txtTitle=null;$.btnSubmit=null;$.btnTmpSave=null;$.panWFMain=null;$.panWFDetail=null;$.panFile=null;$.panDoc=null;$.wbeWFDetail=null;$.grdList=null;$.panList=null;$.lblLabel1=null;$.lblLabel2=null;$.lblLabel3=null;$.dteDate=null;$.grdFile=null;$.grdDoc=null;$.varWFDocId="";$.varBusinessId="";$.varWFType="";$.varList=[];function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmWFDocument_Q",[workType,"","","crmWFVehicleLog"]);return json}function createJSON_Q2(workType){var yyyymmdd=$.dteDate.getValue()+$.day;var json=createExecuteParamInfo("P_crmWFVehicleLog_Q",[workType,"#DeptCode#",extFormat(getCalcMonth(yyyymmdd,-1),"yyyyMMdd")]);return json}function createJSON_S(workType){var p1="",p2="",p3="",p4="",p5="",p6="",p7="",p8="";for(var i=0;i<$.grdList.getRowCount();i++){if($.grdList.getValue(i,"dept_code")==""||$.grdList.getValue(i,"employee_id")==""){$.grdList.selectRow(i);MessageBoxShow("부서코드, 사원코드 은(는) 필수입력 항목 입니다.");return}p1+=((p1?"|":"")+$.grdList.getValue(i,"dept_code"));p2+=((p2?"|":"")+$.grdList.getValue(i,"employee_id"));p3+=((p3?"|":"")+$.grdList.getValue(i,"car_no")||" ");p4+=((p4?"|":"")+$.grdList.getValue(i,"first_meter")||0);p5+=((p5?"|":"")+$.grdList.getValue(i,"forward_meter")||0);p6+=((p6?"|":"")+$.grdList.getValue(i,"this_meter")||0);p7+=((p7?"|":"")+$.grdList.getValue(i,"sum_meter")||0);p8+=((p8?"|":"")+$.grdList.getValue(i,"memo")||" ")}var json=createExecuteParamInfo("P_crmWFVehicleLog_S",[workType,$.varWfDocId,extFormat(($.dteDate.getValue()+"01"),"yyyyMMdd"),p1,p2,p3,p4,p5,p6,p7,p8]);return json}function searchWFDocument(){var json=createJSON_Q("Q3");callQuery(["req",json],"Q3",$)}function searchVehicleLog(){var json=createJSON_Q2("Q");callQuery(["req",json],"Q",$)}function saveWFVehicleLog(){var json=createJSON_S("N");var ds=callExecuteSync(["req",json],"N",$,false);var param={wf_doc_id:$.varWfDocId};g_main.openModelWithBusiness("crmWFGeneralProc",param)}function saveWFDocument(workType,docType,wfLine){var ds=commWFDocument(workType,docType,$.txtTitle.getValue(),$.varBusinessId,$.varOriginWfDocId,wfLine,$.grdFile,$.grdDoc,$.wbeWFDetail,$.varWfDocId);if(ds==null||ds.errorCode.substr(0,1)=="P"||ds.errorCode.substr(0,1)=="E"){return false}if(ds.returnStr!=""){$.varWfDocId=ds.returnStr}return true}function getName(type,list,value){if(type=="D"){for(var i in list){if(list[i].dept_code==value){return list[i].dept_name}}}else{if(type=="E"){for(var i in list){if(list[i].employee_id==value){return list[i].emp_name}}}}}function chkdoc(strwf_doc_id){for(var i=0;i<$.grdDoc.getRowCount();i++){if($.grdDoc.getValue(i,"wf_doc_id")==strwf_doc_id){return false}}return true}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1200,1250);$.panMain.setText("");$.panMain.setBottomLine(true);$.panTitle=new FingerPanel(host,"panTitle",0,0,1200,55);$.panTitle.setText("");$.panTitle.setBottomLine();$.lblTitle=new FingerLabel(host,"lblTitle",0,15,100,20);$.lblTitle.setText("문서제목");$.txtTitle=new FingerEdit(host,"txtTitle",105,15,500,20);$.btnSubmit=new FingerButton(host,"btnSubmit",1010,15,100,20);$.btnSubmit.setText("상신");$.btnTmpSave=new FingerButton(host,"btnTmpSave",1100,15,100,20);$.btnTmpSave.setText("임시저장");$.panWFMain=new FingerPanel(host,"panWFMain",0,65,1200,140);$.panWFMain.setText("기안내용");$.panWFMain.setBottomLine(true);$.panWFDetail=new FingerPanel(host,"panWFDetail",0,525,1200,385);$.panWFDetail.setText("기안 상세");$.panWFDetail.setBottomLine(true);$.panFile=new FingerPanel(host,"panFile",0,925,440,280);$.panFile.setText("첨부 파일");$.panFile.setBottomLine(true);$.panDoc=new FingerPanel(host,"panDoc",450,925,750,280);$.panDoc.setText("기결 문서");$.panDoc.setBottomLine(true);$.wbeWFDetail=new FingerWebEditor(host,"wbeWFDetail",0,0,1200,310);$.grdList=new FingerDataGrid(host,"grdList",0,0,1200,250);$.panList=new FingerPanel(host,"panList",0,215,1200,295);$.panList.setText("차량운행기록표");$.panList.setBottomLine(true);$.lblLabel1=new FingerLabel(host,"lblLabel1",0,20,300,20);$.lblLabel1.setText("최초계기: 차량 등록 시 1회에 한하여 기록한다.");$.lblLabel2=new FingerLabel(host,"lblLabel2",0,40,380,20);$.lblLabel2.setText("누적계기: 매월 1일 본인의 자가용 계기 기록 km를 기록한다.");$.lblLabel3=new FingerLabel(host,"lblLabel3",630,40,100,20);$.lblLabel3.setText("기준일");$.dteDate=new FingerDateEdit(host,"dteDate",735,40,140,20);$.grdFile=new FingerDataGrid(host,"grdFile",0,0,440,230);$.grdDoc=new FingerDataGrid(host,"grdDoc",0,0,750,230);$.panTitle.setBorder(true);$.panList.addButton("btnDelete","삭제");$.panList.addButton("btnNew","신규");$.panList.setButtonAction("btnDelete","delete");$.panList.setButtonAction("btnNew","new");$.panFile.addButtons(["btnDelete","btnAdd"]);$.panDoc.addButtons(["btnDelete","btnAdd"]);$.txtTitle.setAllowBlank(false,"문서제목");$.dteDate.setDateFormat("yyyymm");$.lblLabel1.setAlign("left");$.lblLabel2.setAlign("left");$.grdList.setColumns([new FingerDataGridColumn("dept_code",99,"left","string","부서코드"),new FingerDataGridColumn("dept_name",200,"left","string","부서",{readonly:true}),new FingerDataGridColumn("employee_id",99,"left","string","사번"),new FingerDataGridColumn("emp_name",150,"left","string","운전자",{readonly:true}),new FingerDataGridColumn("car_no",120,"left","string","차량번호"),new FingerDataGridColumn("first_meter",120,"right","string","최초등록계기",{format:"int"}),new FingerDataGridColumn("forward_meter",120,"right","string","전월 누적계기",{format:"int"}),new FingerDataGridColumn("this_meter",120,"right","string","당월 계기",{format:"int"}),new FingerDataGridColumn("sum_meter",99,"right","string","총 사용계기"),new FingerDataGridColumn("memo",352,"left","string","비고")]);$.grdList.init({panel:$.panList,isFilter:false});$.grdList.setEditable(true);$.grdList.setColumnHidden(["dept_code","employee_id","sum_meter"],true);$.grdList.setBorder(false);$.grdFile.setColumns([new FingerDataGridColumn("file_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_path",0,"left","string","",{hidden:true}),new FingerDataGridColumn("server_fname",0,"left","string","",{hidden:true}),new FingerDataGridColumn("local_fname",280,"left","string","파일명"),new FingerDataGridColumn("file_size",145,"left","string","파일크기",{format:"file_size"})]);$.grdFile.init({header:false,isFilter:false});$.grdFile.setBorder(false);$.grdDoc.setColumns([new FingerDataGridColumn("wf_doc_id",125,"left","string","문서아이디"),new FingerDataGridColumn("doc_id",105,"left","string","문서아이디"),new FingerDataGridColumn("doc_title",420,"left","string","기안명"),new FingerDataGridColumn("employee_id",0,"left","string","",{hidden:true}),new FingerDataGridColumn("emp_name",90,"left","string","기안자")]);$.grdDoc.init({header:false,isFilter:false});$.grdDoc.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTitle);$.panMain.add($.panWFMain);$.panMain.add($.panWFDetail);$.panMain.add($.panFile);$.panMain.add($.panDoc);$.panMain.add($.panList);$.panTitle.add($.lblTitle);$.panTitle.add($.txtTitle);$.panTitle.add($.btnSubmit);$.panTitle.add($.btnTmpSave);$.panWFMain.add($.lblLabel1);$.panWFMain.add($.lblLabel2);$.panWFMain.add($.lblLabel3);$.panWFMain.add($.dteDate);$.panWFDetail.add($.wbeWFDetail);$.panFile.add($.grdFile);$.panDoc.add($.grdDoc);$.panList.add($.grdList);var now=getToday("");var nDay=now.substring(6,8);if(Number(nDay)>24){$.dteDate.setValue(getCalcMonth(now,-1))}else{var aNow=getCalcDate(now,-1);var day=aNow.substring(6,8);$.dteDate.setValue(getCalcDate(now,-day));nDay=getCalcDate(now,-day).substring(6,8)}$.day=nDay;searchWFDocument();searchVehicleLog()};$.callback=function(type,ds){if(type=="Q3"){var result=ds.resultList[0][0];$.varBusinessId=result.business_id;$.varWFType=result.wf_type;$.txtTitle.setValue(result.business_title)}else{if(type=="Q"){if(!$.varWfDocId){setDataGrid([$.grdList],ds)}else{setDataGrid([$.grdList],$.varList,true)}}}};$.update=function(args){if(args&&args.length){try{var cs=args[0][0];if(cs.wf_status=="80"){$.varOriginWfDocId=cs.wf_doc_id}else{$.varWfDocId=cs.wf_doc_id}$.txtTitle.setValue(cs.doc_title);$.wbeWFDetail.setValue(cs.doc_comment);setDataGrid([$.grdFile],args[4],true);setDataGrid([$.grdDoc],args[5],true);var md=args[6];if(md){var deptList=commCodeData2($,"Q","#DEPT_LIST#").resultList[0];var empList=commCodeData2($,"Q","#EMP_LIST#").resultList[0];for(var i=0;i<md.length;i++){md[i].dept_name=getName("D",deptList,md[i].dept_code);md[i].emp_name=getName("E",empList,md[i].employee_id)}$.varList=md}}catch(err){MessageBoxShow("데이터 불러오기 중 오류가 발생 하였습니다. ("+err.message+")")}}$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){$.popUpCallId=id;if(id=="btnSubmit"){var param={wf_doc_id:$.varWfDocId,wf_form_id:"crmWFVehicleLog"};g_main.openPopup("popModAppr.html","popModAppr","",0,0,"","",param,"","")}else{if(id=="btnTmpSave"){if(saveWFDocument("","N")){saveWFVehicleLog()}}else{if(id=="btnDocAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(id=="btnDocDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}else{if(id=="btnFileAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(id=="btnFileDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){if(id=="grdList"){if(cInd=="dept_name"||cInd=="emp_name"){$.popUpCallId="grdList";var param={emp_name:""};g_main.openPopup("popEmp.html","popEmp","사원팝업",750,500,"","",param,"","")}}};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panList"){if(btnId=="btnNew"){$.grdList.addRow()}else{if(btnId=="btnDelete"){var rId=$.grdList.getSelectedRowIdx();$.grdList.deleteRow(rId)}}}else{if(panelId=="panFile"){if(btnId=="btnAdd"){OpenFileUploader("WFFileAttatch",function(ds){if(!ds||ds.errorCode=="ERR0000"){MessageBoxShow("파일 업로드가 실패 하였습니다.");return}var fileList=ds.resultList[0];var grdFileLen=$.grdFile.getRowCount();for(var i=0;i<fileList.length;i++){for(var j=0;j<grdFileLen;j++){if(fileList[i]["local_fname"]==$.grdFile.getValue(j,"local_fname")&&fileList[i]["file_size"]==$.grdFile.getValue(j,"file_size")){MessageBoxShow("중복된 파일이 있습니다. 리스트를 확인해 주세요.")}}}$.grdFile.addRows(ds.resultList[0])})}else{if(btnId=="btnDelete"){var rId=$.grdFile.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 파일을 선택해 주시기 바랍니다.");return}var result=removeSysAttachFile({file_path:($.grdFile.getValue(rId,"server_path")+$.grdFile.getValue(rId,"server_fname"))});if(result){$.grdFile.deleteRow(rId)}else{MessageBoxShow("파일을 삭제하는 도중 오류가 발생 하였습니다.");return}}}}else{if(panelId=="panDoc"){if(btnId=="btnAdd"){var param={};g_main.openPopup("crmWFEndDocSub.html","crmWFEndDocSub","",0,0,"","",param,"","")}else{if(btnId=="btnDelete"){var rId=$.grdDoc.getSelectedRowIdx();if(!rId){MessageBoxShow("삭제할 기결문서를 선택해 주시기 바랍니다.");return}$.grdDoc.deleteRow(rId)}}}}}};$.fingerpopup_close=function(id){var popResult=g_popupStack.shareData;if(popResult){if(id=="popEmp"){if($.popUpCallId=="grdList"){var rId=$.grdList.getSelectedRowIdx();$.grdList.setValue(rId,"dept_code",popResult.dept_code);$.grdList.setValue(rId,"dept_name",popResult.dept_name);$.grdList.setValue(rId,"employee_id",popResult.employee_id);$.grdList.setValue(rId,"emp_name",popResult.emp_name)}}else{if(id=="popModAppr"){if($.popUpCallId=="btnSubmit"){if(popResult.isCancel){$.varWFDocId=popResult.wf_doc_id}else{if(saveWFDocument("","Y",popResult)){saveWFVehicleLog()}}}}else{if(id=="crmWFEndDocSub"){for(var i=0;i<popResult.length;i++){if(chkdoc(popResult[i]["wf_doc_id"])){$.grdDoc.addRow(popResult[i],$.grdDoc.getRowCount())}}}else{if(id=="popWFGoAboardSub"){if($.popUpCallId=="bteSubject"){$.varSubWfDocId=popResult.wf_doc_id;$.bteSubject.setValue(popResult.subject)}}}}}}};$.fingerpopup2_close=function(id){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerradiobox_change=function(id,value){};$.fingerimage_click=function(id){}};</script>