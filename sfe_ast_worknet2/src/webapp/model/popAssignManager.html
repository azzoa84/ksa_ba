<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panQuery=null;$.lblCompanyName=null;$.txtCompanyName=null;$.lblSido=null;$.cboSido=null;$.lblGu=null;$.cboGu=null;$.btnSearch=null;$.panCompany=null;$.panAssign=null;$.grdCompany=null;$.grdAssign=null;$.btnSave=null;$.btnCancel=null;$.imgApprUp=null;$.imgApprDown=null;var arrTotal=[];var arrMatched=[];var selectedId="";var selectedName="";$.resetEmpId="RESET";$.isSearch=false;$.isDebug=false;function initSearchOption(){var ds;ds=bizComponentData2($,"Q1","L_CRM0035");if(ds&&ds.resultList){setComboBind([$.cboSido],ds)}}function createJSON_Q(workType){var json=createExecuteParamInfo("P_crmTargetAllocation_Q",[workType,"",$.isDebug?"S500":$.p_argument.deptCode,"","","","","",$.txtCompanyName.getValue(),$.cboSido.getValue()||"",$.cboGu.getValue()||"","#UserID#","#DeptCode#"]);return json}function doSearch(workType){var json=createJSON_Q(workType);callQuery(["req",json],workType,$)}function doReloadData(){$.grdCompany.setData(arrTotal);$.grdAssign.setData(arrMatched);doDataSort($.grdCompany);doDataSort($.grdAssign)}function doDataSort(objGrid){var arrRows=objGrid.getAllRows();var arrMatched=[];var arrNotMatched=[];if(Array.isArray(arrRows)&&arrRows.length){var arrData=[];for(var index=0;index<arrRows.length;index++){if(arrRows[index].employee_id==$.resetEmpId){arrNotMatched.push(arrRows[index])}else{arrMatched.push(arrRows[index])}}arrMatched.sort(function(a,b){if(a.emp_name!=b.emp_name){return(a.emp_name?(a.emp_name>b.emp_name?1:-1):-1)}else{return a.company_name>b.company_name?1:-1}});if(arrNotMatched.length){arrNotMatched.sort(function(a,b){return a.company_name<b.company_name?-1:1})}arrData=arrNotMatched.concat(arrMatched);arrData.forEach(function(item){if(item.id){delete item.id}});objGrid.setData(arrData)}}function doFilterGrid(){var searchTrigger=false;var companyName=$.txtCompanyName.getValue();var zipSido=$.cboSido.getValue();var zipGungu=$.cboGu.getValue();if(companyName){$.grdCompany.extObj.filter(function(obj){return obj.company_name.indexOf(companyName)>=0})}if(zipSido){$.grdCompany.extObj.filter(function(obj){return obj.sido_code.indexOf(zipSido)>=0})}if(zipGungu){$.grdCompany.extObj.filter(function(obj){return obj.gungu_code.indexOf(zipGungu)>=0})}searchTrigger=companyName||zipSido||zipGungu;if(!searchTrigger){doReloadData()}}function doMoveRows(type,arrData){var fromGrd=(type=="U"?$.grdAssign:$.grdCompany);var toGrd=(type=="U"?$.grdCompany:$.grdAssign);for(var index=0;index<arrData.length;index++){var objRow=arrData[index];objRow.checkYN="N";objRow.employee_id=(type=="U")?$.resetEmpId:selectedId,objRow.emp_name=(type=="U")?"배정되지 않음":selectedName;fromGrd.deleteRow(objRow.id);toGrd.addRow(objRow,0)}fromGrd.clearSelect();toGrd.clearSelect();doDataSort(fromGrd);doDataSort(toGrd)}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,800,685);$.panMain.setText("");$.panMain.setBottomLine(true);$.panQuery=new FingerPanel(host,"panQuery",0,0,800,55);$.panQuery.setText("");$.panQuery.setBottomLine();$.lblCompanyName=new FingerLabel(host,"lblCompanyName",0,10,90,20);$.lblCompanyName.setText("거래처/지역");$.txtCompanyName=new FingerEdit(host,"txtCompanyName",95,10,140,20);$.lblSido=new FingerLabel(host,"lblSido",245,10,90,20);$.lblSido.setText("시도");$.cboSido=new FingerComboBox(host,"cboSido",340,10,125,20);$.lblGu=new FingerLabel(host,"lblGu",475,10,90,20);$.lblGu.setText("구");$.cboGu=new FingerComboBox(host,"cboGu",570,10,125,20);$.btnSearch=new FingerButton(host,"btnSearch",720,10,80,20);$.btnSearch.setText("조회");$.panCompany=new FingerPanel(host,"panCompany",0,65,800,260);$.panCompany.setText("거래처 목록");$.panCompany.setBottomLine(true);$.panAssign=new FingerPanel(host,"panAssign",0,380,800,260);$.panAssign.setText("배정 거래처");$.panAssign.setBottomLine(true);$.grdCompany=new FingerDataGrid(host,"grdCompany",0,0,800,210);$.grdAssign=new FingerDataGrid(host,"grdAssign",0,0,800,210);$.btnSave=new FingerButton(host,"btnSave",305,650,85,20);$.btnSave.setText("확인");$.btnCancel=new FingerButton(host,"btnCancel",400,650,85,20);$.btnCancel.setText("취소");$.imgApprUp=new FingerImage(host,"imgApprUp",320,350,30,30);$.imgApprDown=new FingerImage(host,"imgApprDown",425,350,30,30);$.panQuery.setBorder(true);$.panCompany.setBorder(false);$.panAssign.setBorder(false);$.imgApprUp.setBorder(false);$.imgApprDown.setBorder(false);$.imgApprUp.setValue("fingerPlatform/images/btn_up.png",true);$.imgApprDown.setValue("fingerPlatform/images/btn_down.png",true);$.panCompany.addButton("btnCustom","담당 거래처목록 재 표시");$.panCompany.setButtonAction("btnCustom","custom",150);$.txtCompanyName.setAllowBlank(false,"거래처명");$.cboSido.setColumn("sidogu_code","sidogu_name");$.cboSido.setEmptyRow(true);$.cboGu.setColumn("sidogu_code","sidogu_name");$.cboGu.setEmptyRow(true);$.grdCompany.setColumns([new FingerDataGridColumn("checkYN",50,"center","checkbox",{content:"masterCheckbox"}),new FingerDataGridColumn("employee_id",150,"center","string","담당자ID",{hidden:true}),new FingerDataGridColumn("emp_name",150,"center","string","담당자"),new FingerDataGridColumn("company_id",200,"center","string","거래처ID",{hidden:true}),new FingerDataGridColumn("company_name",200,"center","string","거래처명"),new FingerDataGridColumn("num_beds",80,"right","int","베드 수",{format:"int"}),new FingerDataGridColumn("channel",100,"center","string","채널코드",{hidden:true}),new FingerDataGridColumn("channel_name",100,"center","string","채널"),new FingerDataGridColumn("sido_code",100,"center","string","시도",{hidden:true}),new FingerDataGridColumn("zip_sido",100,"center","string","시도"),new FingerDataGridColumn("gungu_code",100,"center","string","구",{hidden:true}),new FingerDataGridColumn("zip_gungu",100,"center","string","구")]);$.grdCompany.init({scroll:"xy",nonExcel:true,isFilter:false});$.grdCompany.setBorder(true);$.grdAssign.setColumns([new FingerDataGridColumn("checkYN",50,"center","checkbox",{content:"masterCheckbox"}),new FingerDataGridColumn("employee_id",150,"center","string","담당자ID",{hidden:true}),new FingerDataGridColumn("emp_name",150,"center","string","담당자"),new FingerDataGridColumn("company_id",200,"center","string","거래처ID",{hidden:true}),new FingerDataGridColumn("company_name",200,"center","string","거래처명"),new FingerDataGridColumn("num_beds",80,"right","int","베드 수",{format:"int"}),new FingerDataGridColumn("channel",100,"center","string","채널코드",{hidden:true}),new FingerDataGridColumn("channel_name",100,"center","string","채널"),new FingerDataGridColumn("zip_sido",100,"center","string","시도"),new FingerDataGridColumn("zip_gungu",100,"center","string","구")]);$.grdAssign.init({scroll:"xy",nonExcel:true,isFilter:false});$.grdAssign.setBorder(true);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panQuery);$.panMain.add($.panCompany);$.panMain.add($.panAssign);$.panMain.add($.btnSave);$.panMain.add($.btnCancel);$.panMain.add($.imgApprUp);$.panMain.add($.imgApprDown);$.panQuery.add($.btnSearch);$.panQuery.add($.cboGu);$.panQuery.add($.lblGu);$.panQuery.add($.cboSido);$.panQuery.add($.lblSido);$.panQuery.add($.txtCompanyName);$.panQuery.add($.lblCompanyName);$.panCompany.add($.grdCompany);$.panAssign.add($.grdAssign);if($.isDebug){}else{initSearchOption()}if($.p_argument){if($.p_argument.totalInfo&&$.p_argument.totalInfo.length){for(var index=0;index<$.p_argument.totalInfo.length;index++){if($.p_argument.totalInfo[index].company_id){arrTotal.push($.p_argument.totalInfo[index])}}if(arrTotal.length){$.grdCompany.setData(JSON.parse(JSON.stringify(arrTotal)));doDataSort($.grdCompany)}}if($.p_argument.selectedInfo&&$.p_argument.selectedInfo.length){for(var index=0;index<$.p_argument.selectedInfo.length;index++){if($.p_argument.selectedInfo[index].company_id){arrMatched.push($.p_argument.selectedInfo[index])}}if(arrMatched.length){$.grdAssign.setData(JSON.parse(JSON.stringify(arrMatched)));doDataSort($.grdAssign)}}if($.p_argument.emp_id){selectedId=$.p_argument.emp_id}if($.p_argument.emp_name){selectedName=$.p_argument.emp_name;$.panAssign.setText("'"+$.p_argument.emp_name+"' 배정 거래처")}}};$.callback=function(type,ds){if(type=="Q_ADDR"){var dt=deepCopyObj(ds);var filterData=[];if(dt&&dt.errorCode=="MSG0001"){var rs=dt.resultList[0];for(var i=0;i<rs.length;i++){var bResult=true;for(var index=0;index<$.grdAssign.getRowCount();index++){var companyRow=$.grdAssign.getValue(index);if(rs[i].company_id==companyRow.company_id){bResult=false}}if(bResult){rs[i].employee_id="RESET";rs[i].emp_name="배정되지 않음";rs[i].gungu_code=rs[i].sidogu_code;rs[i].isSearch=true;filterData.push(rs[i])}}}setDataGrid([$.grdCompany],filterData,true);doDataSort($.grdCompany)}};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSearch"){$.isSearch=true;if(!$.isDebug){if(!$.panQuery.validateControls()){return}doSearch("Q_ADDR")}else{var dt={errorCode:"MSG0001",returnStr:"",errorMsg:"",resultList:[[{company_id:"H00000017",company_name:"분당서울대학교병원",num_beds:"1161",channel:"11",channel_name:"UH",sidogu_code:"100033",zip_sido:"경기",zip_gungu:"성남시 분당구"},{company_id:"H00000057",company_name:"삼성서울병원",num_beds:"1720",channel:"11",channel_name:"UH",sidogu_code:"100141",zip_sido:"서울",zip_gungu:"강남구"},{company_id:"H00000140",company_name:"삼육서울병원",num_beds:"408",channel:"12",channel_name:"GH",sidogu_code:"100151",zip_sido:"서울",zip_gungu:"동대문구"},{company_id:"H00000083",company_name:"서울대학교병원",num_beds:"1561",channel:"11",channel_name:"UH",sidogu_code:"100163",zip_sido:"서울",zip_gungu:"종로구"},{company_id:"H00001087",company_name:"서울대학교치과병원",num_beds:"40",channel:"13",channel_name:"GH2",sidogu_code:"100163",zip_sido:"서울",zip_gungu:"종로구"},{company_id:"H00000086",company_name:"서울적십자병원",num_beds:"275",channel:"13",channel_name:"GH2",sidogu_code:"100163",zip_sido:"서울",zip_gungu:"종로구"},{company_id:"H00000068",company_name:"서울특별시보라매병원",num_beds:"699",channel:"11",channel_name:"UH",sidogu_code:"100152",zip_sido:"서울",zip_gungu:"동작구"},{company_id:"H00000167",company_name:"서울특별시서남병원",num_beds:"311",channel:"12",channel_name:"GH",sidogu_code:"100159",zip_sido:"서울",zip_gungu:"양천구"},{company_id:"H00000056",company_name:"서울특별시서울의료원",num_beds:"549",channel:"11",channel_name:"UH",sidogu_code:"100165",zip_sido:"서울",zip_gungu:"중랑구"},{company_id:"H00000082",company_name:"순천향대학교부속서울병원",num_beds:"658",channel:"11",channel_name:"UH",sidogu_code:"100161",zip_sido:"서울",zip_gungu:"용산구"},{company_id:"H00000144",company_name:"인제대학교서울백병원",num_beds:"221",channel:"13",channel_name:"GH2",sidogu_code:"100164",zip_sido:"서울",zip_gungu:"중구"},{company_id:"H00000075",company_name:"재단법인아산사회복지재단서울아산병원",num_beds:"2435",channel:"11",channel_name:"UH",sidogu_code:"100158",zip_sido:"서울",zip_gungu:"송파구"},{company_id:"H00000071",company_name:"학교법인가톨릭학원가톨릭대학교서울성모병원",num_beds:"1125",channel:"11",channel_name:"UH",sidogu_code:"100155",zip_sido:"서울",zip_gungu:"서초구"}]]};var ds=deepCopyObj(dt);var filterData=[];if(ds&&ds.errorCode=="MSG0001"){var rs=ds.resultList[0];for(var i=0;i<rs.length;i++){var bResult=true;for(var index=0;index<$.grdAssign.getRowCount();index++){var companyRow=$.grdAssign.getValue(index);if(rs[i].company_id==companyRow.company_id){bResult=false}}if(bResult){rs[i].employee_id="RESET";rs[i].emp_name="배정되지 않음";rs[i].gungu_code=rs[i].sidogu_code;rs[i].isSearch=true;filterData.push(rs[i])}}}setDataGrid([$.grdCompany],filterData,true);doDataSort($.grdCompany)}}else{if(id=="btnSave"){var arrAssignRows=[];var changeRows=$.grdAssign.getChangedRows();if(changeRows.length){arrAssignRows=changeRows}var arrCompanyRows=$.grdCompany.getChangedRows();if(arrAssignRows){for(var index=0;index<arrAssignRows.length;index++){delete arrAssignRows[index].id}}if(arrCompanyRows){for(var index=0;index<arrCompanyRows.length;index++){delete arrCompanyRows[index].id}}var objReturn={assign:(arrAssignRows.length?arrAssignRows:[]),unsign:(arrCompanyRows.length?arrCompanyRows:[]),};g_popupStack.setData(objReturn);g_popupStack.close()}else{if(id=="btnCancel"){g_popupStack.close()}}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){if(id=="cboSido"){$.cboGu.clear();if(value){var subQuery=" AND parent_sidogu = '"+$.cboSido.getValue()+"'";var ds=bizComponentData2($,"Q4","L_CRM0036",subQuery);if(ds&&ds.resultList){setComboBind([$.cboGu],ds)}}}};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){if(id=="txtCompanyName"&&value=="13"){if(!$.panQuery.validateControls()){return}doSearch("Q_ADDR")}};$.fingeredit_lostfocus=function(id,value){};$.fingerimage_click=function(id){if(id=="imgApprUp"){var arrRows=$.grdAssign.getCheckedRows("checkYN");doMoveRows("U",arrRows)}else{if(id=="imgApprDown"){var arrRows=$.grdCompany.getCheckedRows("checkYN");doMoveRows("D",arrRows)}}return;if(id=="imgApprUp"){var arrRows=$.grdAssign.getCheckedRows("checkYN");var compData=deepCopyObj($.grdCompany.getAllRows());var assignData=deepCopyObj($.grdAssign.getAllRows());var exceptData=[];var addData=[];exceptData=assignData.filter(function(array_el){return arrRows.filter(function(anotherOne_el){return anotherOne_el.cs_id==array_el.cs_id}).length==0});setDataGrid([$.grdAssign],exceptData,true);for(var i=0;i<arrRows.length;i++){var rowData=arrRows[i];rowData.checkYN="N";compData.push(rowData)}var sortData=compData.sort(function(a,b){if(a.company_name+a.zip_sido+a.zip_gungu<b.company_name+b.zip_sido+b.zip_gungu){return -1}});setDataGrid([$.grdCompany],sortData,true)}else{if(id=="imgApprDown"){var arrRows=$.grdCompany.getCheckedRows("checkYN");var compData=deepCopyObj($.grdCompany.getAllRows());var assignData=deepCopyObj($.grdAssign.getAllRows());var exceptData=[];var addData=[];exceptData=compData.filter(function(array_el){return arrRows.filter(function(anotherOne_el){return anotherOne_el.cs_id==array_el.cs_id}).length==0});setDataGrid([$.grdCompany],exceptData,true);for(var i=0;i<arrRows.length;i++){var rowData=arrRows[i];rowData.checkYN="N";rowData.employee_id=$.p_argument.employeeId;rowData.emp_name=$.p_argument.empName;assignData.push(rowData)}var sortData=assignData.sort(function(a,b){if(a.company_name+a.zip_sido+a.zip_gungu<b.company_name+b.zip_sido+b.zip_gungu){return -1}});setDataGrid([$.grdAssign],sortData,true)}}};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panCompany"){if(btnId=="btnCustom"){$.isSearch=false;doReloadData()}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>