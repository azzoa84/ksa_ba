<script>function Main(){var $=this;$.host=null;$.panMain=null;$.panTree=null;$.panAppr=null;$.panConf=null;$.panRefs=null;$.treEmp=null;$.grdAppr=null;$.grdConf=null;$.grdRefs=null;$.btnSubmit=null;$.btnCancel=null;$.panApprList=null;$.htmApprList=null;$.imgApprUp=null;$.imgApprDown=null;$.imgConfUp=null;$.imgConfDown=null;$.imgRefsUp=null;$.imgRefsDown=null;$.varSelectedTree=[];$.fingerpopup_click_x_button=function(){var rm={isCancel:true,wf_doc_id:$.apprLine.getWfDocId()};rm.isXButton=true;g_popupStack.setData(rm)};function loadApprList(wf_doc_id,wf_form_id,new_line){$.apprLine.load(wf_doc_id,wf_form_id,new_line);var apprList=$.apprLine.getApprList();if(apprList){$.grdAppr.setData(apprList[0]);$.grdConf.setData(apprList[1]);$.grdRefs.setData(apprList[2])}}function searchOverlap(grdId,employeeId){for(var i=0;i<$[grdId].getRowCount();i++){if($[grdId].getValue(i,"employee_id")==employeeId){return false}}return true}function getTreeData(nodeId){var treeData={line_yn:"N",employee_id:nodeId,emp_name:$.treEmp.getUserData(nodeId,"name"),dept_code:$.treEmp.getParentNodeId(nodeId),dept_name:$.treEmp.getParentNodeText(nodeId)};return treeData}function getGridData(grdId){var grdData=[];for(var i=0;i<$[grdId].getRowCount();i++){grdData.push({line_yn:$[grdId].getValue(i,"line_yn"),employee_id:$[grdId].getValue(i,"employee_id"),emp_name:$[grdId].getValue(i,"emp_name"),dept_code:$[grdId].getValue(i,"dept_code"),dept_name:$[grdId].getValue(i,"dept_name")})}return grdData}$.init=function(host,args){$.panMain=new FingerPanel(host,"panMain",0,0,1000,700);$.panMain.setText("");$.panMain.setBottomLine(false);$.panTree=new FingerPanel(host,"panTree",0,100,400,475);$.panTree.setText("사원");$.panTree.setBottomLine(true);$.panAppr=new FingerPanel(host,"panAppr",420,100,500,140);$.panAppr.setText("결재");$.panAppr.setBottomLine(true);$.panConf=new FingerPanel(host,"panConf",420,250,500,140);$.panConf.setText("협의");$.panConf.setBottomLine(false);$.panRefs=new FingerPanel(host,"panRefs",420,400,500,140);$.panRefs.setText("참조");$.panRefs.setBottomLine(true);$.treEmp=new FingerTree(host,"treEmp",0,0,400,425);$.grdAppr=new FingerDataGrid(host,"grdAppr",0,0,500,95);$.grdConf=new FingerDataGrid(host,"grdConf",0,0,500,95);$.grdRefs=new FingerDataGrid(host,"grdRefs",0,0,500,95);$.btnSubmit=new FingerButton(host,"btnSubmit",800,555,100,20);$.btnSubmit.setText("확인");$.btnCancel=new FingerButton(host,"btnCancel",895,555,100,20);$.btnCancel.setText("취소");$.panApprList=new FingerPanel(host,"panApprList",0,0,1000,100);$.panApprList.setText("");$.panApprList.setBottomLine(true);$.htmApprList=new FingerHTMLView(host,"htmApprList",0,0,1000,100);$.imgApprUp=new FingerImage(host,"imgApprUp",525,10,28,28);$.imgApprDown=new FingerImage(host,"imgApprDown",525,55,28,28);$.imgConfUp=new FingerImage(host,"imgConfUp",525,10,28,28);$.imgConfDown=new FingerImage(host,"imgConfDown",525,55,28,28);$.imgRefsUp=new FingerImage(host,"imgRefsUp",525,10,28,28);$.imgRefsDown=new FingerImage(host,"imgRefsDown",525,55,28,28);$.apprLine=new CustomApprLine($,$.htmApprList);$.panAppr.addButtons(["btnDelete","btnAdd"]);$.panConf.addButtons(["btnDelete","btnAdd"]);$.panRefs.addButtons(["btnDelete","btnAdd"]);$.imgApprUp.setBorder(false);$.imgApprDown.setBorder(false);$.imgConfUp.setBorder(false);$.imgConfDown.setBorder(false);$.imgRefsUp.setBorder(false);$.imgRefsDown.setBorder(false);$.imgApprUp.setValue("fingerPlatform/images/btn_up.png",true);$.imgApprDown.setValue("fingerPlatform/images/btn_down.png",true);$.imgConfUp.setValue("fingerPlatform/images/btn_up.png",true);$.imgConfDown.setValue("fingerPlatform/images/btn_down.png",true);$.imgRefsUp.setValue("fingerPlatform/images/btn_up.png",true);$.imgRefsDown.setValue("fingerPlatform/images/btn_down.png",true);$.grdAppr.setColumns([new FingerDataGridColumn("line_yn",0,"left","string","Line Yn"),new FingerDataGridColumn("employee_id",0,"left","string","사원ID"),new FingerDataGridColumn("emp_name",140,"left","string","사원"),new FingerDataGridColumn("dept_code",0,"left","string","부서코드"),new FingerDataGridColumn("dept_name",320,"left","string","부서")]);$.grdAppr.init({header:false,isFilter:false});$.grdAppr.setColumnHidden(["line_yn","employee_id","dept_code"],true);$.grdAppr.setBorder(false);$.grdConf.setColumns([new FingerDataGridColumn("line_yn",0,"left","string","Line Yn"),new FingerDataGridColumn("employee_id",0,"left","string","사원ID"),new FingerDataGridColumn("emp_name",140,"left","string","사원"),new FingerDataGridColumn("dept_code",0,"left","string","부서코드"),new FingerDataGridColumn("dept_name",320,"left","string","부서")]);$.grdConf.init({header:false,isFilter:false});$.grdConf.setColumnHidden(["line_yn","employee_id","dept_code"],true);$.grdConf.setBorder(false);$.grdRefs.setColumns([new FingerDataGridColumn("line_yn",0,"left","string","Line Yn"),new FingerDataGridColumn("employee_id",0,"left","string","사원ID"),new FingerDataGridColumn("emp_name",140,"left","string","사원"),new FingerDataGridColumn("dept_code",0,"left","string","부서코드"),new FingerDataGridColumn("dept_name",320,"left","string","부서")]);$.grdRefs.init({header:false,isFilter:false});$.grdRefs.setColumnHidden(["line_yn","employee_id","dept_code"],true);$.grdRefs.setBorder(false);$.host=host;$.args=args};$.start=function(){$.panMain.add($.panTree);$.panMain.add($.panAppr);$.panMain.add($.panConf);$.panMain.add($.panRefs);$.panMain.add($.btnSubmit);$.panMain.add($.btnCancel);$.panMain.add($.panApprList);$.panTree.add($.treEmp);$.panAppr.add($.grdAppr);$.panAppr.add($.imgApprUp);$.panAppr.add($.imgApprDown);$.panConf.add($.grdConf);$.panConf.add($.imgConfUp);$.panConf.add($.imgConfDown);$.panRefs.add($.grdRefs);$.panRefs.add($.imgRefsUp);$.panRefs.add($.imgRefsDown);$.panApprList.add($.htmApprList);var ds=commCodeData2($,"Q_TREE","#EMP_LIST#");$.treEmp.clearAll();$.treEmp.load(ds.resultList[0],"id","parent_id","name","ico_id","order_seq");$.treEmp.showCheckbox();if($.p_argument){if(!$.p_argument.wf_form_id){MessageBoxShow("기안서 폼ID는 필수입니다.");return}}else{$.p_argument={}}loadApprList($.p_argument.wf_doc_id,$.p_argument.wf_form_id,$.p_argument.new_line)};$.callback=function(type,ds){};$.update=function(args){$.args=args};$.executeScript=function(script){eval(script)};$.fingerbutton_click=function(id){if(id=="btnSubmit"){var appr=$.grdAppr.getAllRows();var conf=$.grdConf.getAllRows();var refs=$.grdRefs.getAllRows();var rm={appr:"",conf:"",refs:"",appr_yn:"",conf_yn:"",refs_yn:""};if(appr&&appr.length){for(var i=0;i<appr.length;i++){rm.appr+=(appr[i]["employee_id"]+"|");rm.appr_yn+=(appr[i]["line_yn"]+"|")}rm.appr=rm.appr.substr(0,rm.appr.length-1);rm.appr_yn=rm.appr_yn.substr(0,rm.appr_yn.length-1)}if(conf&&conf.length){for(var i=0;i<conf.length;i++){rm.conf+=(conf[i]["employee_id"]+"|");rm.conf_yn+=(conf[i]["line_yn"]+"|")}rm.conf=rm.conf.substr(0,rm.conf.length-1);rm.conf_yn=rm.conf_yn.substr(0,rm.conf_yn.length-1)}if(refs&&refs.length){for(var i=0;i<refs.length;i++){rm.refs+=(refs[i]["employee_id"]+"|");rm.refs_yn+=(refs[i]["line_yn"]+"|")}rm.refs=rm.refs.substr(0,rm.refs.length-1);rm.refs_yn=rm.refs_yn.substr(0,rm.refs_yn.length-1)}rm.wf_doc_id=$.apprLine.getWfDocId();g_popupStack.setData(rm);g_popupStack.close()}else{if(id=="btnCancel"){var rm={isCancel:true,wf_doc_id:$.apprLine.getWfDocId()};g_popupStack.setData(rm);g_popupStack.close()}}};$.fingermultiselect_checkchange=function(id,index){};$.fingermultiselect_itemchange=function(id){};$.fingerbuttonedit_click=function(id){};$.fingerbuttonedit_change=function(id,value){};$.fingerbuttonedit_keypress=function(id,value){};$.fingerbuttonedit_lostfocus=function(id,value){};$.fingercheckbox_change=function(id,value){};$.fingercombobox_change=function(id,value){};$.fingerdateedit_click=function(id){};$.fingerdateedit_change=function(id,value){};$.fingerdatagrid_itemclick=function(id,rId,cInd){};$.fingerdatagrid_selectionchange=function(id,rId){};$.fingerdatagrid_cellvaluechange=function(id,rId,cInd,nValue,oValue){};$.fingerdatagrid_rowdblclicked=function(id,rId,cInd){};$.fingerdatagrid_celllink_click=function(e,gridid,rId,cId,value){};$.fingerdatagrid_popupcelldblclicked=function(id,rId,cInd){};$.fingerdatagrid_drag=function(id,sId,tId,sObj,tObj,sInd,tInd){};$.fingeredit_change=function(id,value){};$.fingeredit_keypress=function(id,value){};$.fingeredit_lostfocus=function(id,value){};$.fingerlayout_panelresizefinish=function(id){};$.fingerlayout_resizefinish=function(id){};$.fingerpanel_button_click=function(panelId,btnId){if(panelId=="panAppr"){if(btnId=="btnAdd"){var checked=$.treEmp.getAllChecked();for(var i=0;i<checked.length;i++){if($.treEmp.getUserData(checked[i],"type")=="EMP"){if(!searchOverlap("grdAppr",checked[i])){continue}$.grdAppr.addRow(getTreeData(checked[i]))}}$.treEmp.setAllNoneCheck();$.apprLine.modify("appr",$.grdAppr.getAllRows())}else{if(btnId=="btnDelete"){var rId=$.grdAppr.getSelectedRowIdx();if(rId==-1){return}if($.grdAppr.getValue(rId,"line_yn")=="Y"){MessageBoxShow("자동으로 생성된 결재자는 삭제하실 수 없습니다.");return}$.grdAppr.deleteRow(rId);$.apprLine.modify("appr",$.grdAppr.getAllRows())}}}else{if(panelId=="panConf"){if(btnId=="btnAdd"){var checked=$.treEmp.getAllChecked();for(var i=0;i<checked.length;i++){if($.treEmp.getUserData(checked[i],"type")=="EMP"){if(!searchOverlap("grdConf",checked[i])){continue}$.grdConf.addRow(getTreeData(checked[i]))}}$.treEmp.setAllNoneCheck();$.apprLine.modify("conf",$.grdConf.getAllRows())}else{if(btnId=="btnDelete"){var rId=$.grdConf.getSelectedRowIdx();if(rId==-1){return}if($.grdConf.getValue(rId,"line_yn")=="Y"){MessageBoxShow("자동으로 생성된 결재자는 삭제하실 수 없습니다.");return}$.grdConf.deleteRow(rId);$.apprLine.modify("conf",$.grdConf.getAllRows())}}}else{if(panelId=="panRefs"){if(btnId=="btnAdd"){var checked=$.treEmp.getAllChecked();for(var i=0;i<checked.length;i++){if($.treEmp.getUserData(checked[i],"type")=="EMP"){if(!searchOverlap("grdRefs",checked[i])){continue}$.grdRefs.addRow(getTreeData(checked[i]))}}$.treEmp.setAllNoneCheck();$.apprLine.modify("refs",$.grdRefs.getAllRows())}else{if(btnId=="btnDelete"){var rId=$.grdRefs.getSelectedRowIdx();if(rId==-1){return}if($.grdRefs.getValue(rId,"line_yn")=="Y"){MessageBoxShow("자동으로 생성된 결재자는 삭제하실 수 없습니다.");return}$.grdRefs.deleteRow(rId);$.apprLine.modify("refs",$.grdRefs.getAllRows())}}}}}};$.fingerpopup_close=function(id){};$.fingerpopup2_close=function(id){};$.fingerradiobox_change=function(id,value){};$.fingertab_selectionchange=function(id,tabid){};$.fingertab_ontabclose=function(id,tabid){};$.fingertree_select=function(id,value){};$.fingertree_dblclick=function(id,nodeid){};$.fingertree_refresh=function(id){if(id=="treEmp"){$.treEmp.openNode("ROOT")}};$.fingerscheduler_before_event_changed=function(id,event_object,native_event,is_new,unmodified_event){};$.fingerscheduler_before_event_delete=function(id,event_id,event_object){};$.fingerscheduler_event_click=function(id,event_id,event_object,native_event_object){};$.fingerscheduler_ready=function(id){};$.fingerscheduler_before_event_created=function(id,start_date,end_date){};$.fingerscheduler_view_display=function(id,view){};$.fingerscheduler_event_reg=function(id,obj){};$.fingerfilepanel_upload_click=function(id,fileId,fileName){};$.fingerfilepanel_download_click=function(id,fileId,fileName){};$.fingerfilepanel_delete_click=function(id,fileId,fileName){};$.fingerimage_click=function(id){var grdId=id.replace(/Up|Down/,"").replace("img","grd");if(!$[grdId].getSelectedRowIdx()){MessageBoxShow("위치 변경할 결재자를 선택해 주시기 바랍니다.");return}var rowId=$[grdId].getSelectedRowIdx();var rowItem=$[grdId].getValue(rowId);if(rowItem.line_yn=="Y"){return}if(id.indexOf("Up")>-1){$[grdId].moveUp(rowId)}else{$[grdId].moveDown(rowId)}if(id.indexOf("Appr")>-1){$.apprLine.modify("appr",$[grdId].getAllRows())}else{if(id.indexOf("Conf")>-1){$.apprLine.modify("conf",$[grdId].getAllRows())}else{$.apprLine.modify("refs",$[grdId].getAllRows())}}};$.fingerimage_change=function(id,value){};$.fingerimage_rotate=function(id,value){};$.fingertab_click=function(id,tabid){};$.fingerpopup_click_x_button=function(){};$.fingeriframe_onload=function(id){};$.fingerhtmlview_click=function(id){}};</script>